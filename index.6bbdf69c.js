let e,t,r,n,i,s,a,o,l,h,c,u,d,p,f,m,g,v,y,x,_,b;var w,S,T,E,A,C,R,L,I,P,k,D,U,O,N,F,B,z=globalThis,G={};function H(e){return{start:performance.now(),category:e}}function V(e){var t=(performance.now()-e.start)/1e3;G[e.category]||(G[e.category]=0),G[e.category]+=t}let W={"/w/api.php":["wikipedia.org","wikimedia.org"],"/api.php":["fandom.com"],"/mediawiki/api.php":[],"/wiki/api.php":[]};async function j(e){for(let[t,r]of Object.entries(W))if(r.some(t=>e.endsWith(t)))return`${e}${t}`;for(let[t,r]of(console.log("Unknown domain! Have to guess..."),Object.entries(W)))try{if((await window.fetch(`${e}${t}?origin=*`)).ok)return W[t].push(e),`${e}${t}`}catch(e){}throw Error(`Failed to find API URL for domain ${e}`)}let q={"wiki/":["wikipedia.org","wikimedia.org"],"":["fandom.com"]};async function X(e){for(let[t,r]of Object.entries(q))if(r.some(t=>e.endsWith(t)))return t;let t=await window.fetch(`${await j(e)}?action=query&format=json&meta=siteinfo&origin=*`),r=(await t.json()).query.general.articlepath.replace(/\$1$/,"").replace(/^\//,"");return q[r]||(q[r]=[]),q[r].push(e),r}async function Y(e){let t=await window.fetch(`${await j(e)}?action=query&format=json&origin=*&meta=siteinfo`);return(await t.json()).query.general.mainpage}async function J(e,t){let r=await window.fetch(`${await j(t)}?action=parse&format=json&prop=text&page=${e}&redirects=1&origin=*`),n=await r.json();console.log(n);let i=new DOMParser;if(n?.parse?.text?.["*"]==void 0)throw Error(`Topic "${e}" not found at ${t}`);let s=i.parseFromString(n.parse.text["*"],"text/html").querySelector(".mw-parser-output");console.log(s);let a=await Z(n.parse.title,s);return console.log(a),a}async function Z(e,t){let r=document.createElement("h2");r.innerText="Intro",t.insertBefore(r,t.firstChild);let n=["style",".mw-cite-backlink","sup.reference",".shortdescription",".toc",".toclimit-1",".toclimit-2",".toclimit-3",".toclimit-4",".toclimit-5",".authority-control",".mw-editsection"];n.forEach(e=>{t.querySelectorAll(e).forEach(e=>{e.remove()})}),(n=["center"]).forEach(e=>{t.querySelectorAll(e).forEach(e=>{e.replaceWith(...e.children)})}),(n=[".thumb"]).forEach(e=>{t.querySelectorAll(e).forEach(e=>{let t=document.createElement("figure");e.parentNode.insertBefore(t,e),t.appendChild(e)})}),(n=[".gallery"]).forEach(e=>{[...t.querySelectorAll(e)].forEach(e=>{e.childNodes.forEach(e=>{let t=document.createElement("figure");e.parentNode.insertBefore(t,e),t.appendChild(e)}),e.replaceWith(...e.children)})});let i=t.querySelector(".navbox");if(i){let e=document.createElement("h2");e.innerText="Related",i.parentNode.insertBefore(e,i)}return(n=[".navbox"]).forEach(r=>{t.querySelectorAll(r).forEach(t=>{let r=t.querySelector("th").children;e=r[r.length-1].textContent.trim();let n=document.createElement("h3");n.innerText=e,t.parentNode.insertBefore(n,t)})}),t}function $(e){var t=e.href;return t.startsWith(window.location.origin)&&(t=t.substring(window.location.origin.length)),{text:e.textContent,page:t}}function K(e){var t=[...e.querySelectorAll("a")].map(e=>$(e));return{type:"paragraph",text:e.textContent.trim(),links:t}}const Q="300 es";class ee{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});let r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;let r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;let r=this._listeners[e];if(void 0!==r){let e=r.indexOf(t);-1!==e&&r.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;let t=this._listeners[e.type];if(void 0!==t){e.target=this;let r=t.slice(0);for(let t=0,n=r.length;t<n;t++)r[t].call(this,e);e.target=null}}}const et=[];for(let e=0;e<256;e++)et[e]=(e<16?"0":"")+e.toString(16);let er=1234567;const en=Math.PI/180,ei=180/Math.PI;function es(){let e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(et[255&e]+et[e>>8&255]+et[e>>16&255]+et[e>>24&255]+"-"+et[255&t]+et[t>>8&255]+"-"+et[t>>16&15|64]+et[t>>24&255]+"-"+et[63&r|128]+et[r>>8&255]+"-"+et[r>>16&255]+et[r>>24&255]+et[255&n]+et[n>>8&255]+et[n>>16&255]+et[n>>24&255]).toUpperCase()}function ea(e,t,r){return Math.max(t,Math.min(r,e))}function eo(e,t){return(e%t+t)%t}function el(e,t,r){return(1-r)*e+r*t}function eh(e){return(e&e-1)==0&&0!==e}function ec(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function eu(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}var ed=Object.freeze({__proto__:null,DEG2RAD:en,RAD2DEG:ei,generateUUID:es,clamp:ea,euclideanModulo:eo,mapLinear:function(e,t,r,n,i){return n+(e-t)*(i-n)/(r-t)},inverseLerp:function(e,t,r){return e!==t?(r-e)/(t-e):0},lerp:el,damp:function(e,t,r,n){return el(e,t,1-Math.exp(-r*n))},pingpong:function(e,t=1){return t-Math.abs(eo(e,2*t)-t)},smoothstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t))*e*(3-2*e)},smootherstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){return void 0!==e&&(er=e%2147483647),((er=16807*er%2147483647)-1)/2147483646},degToRad:function(e){return e*en},radToDeg:function(e){return e*ei},isPowerOfTwo:eh,ceilPowerOfTwo:ec,floorPowerOfTwo:eu,setQuaternionFromProperEuler:function(e,t,r,n,i){let s=Math.cos,a=Math.sin,o=s(r/2),l=a(r/2),h=s((t+n)/2),c=a((t+n)/2),u=s((t-n)/2),d=a((t-n)/2),p=s((n-t)/2),f=a((n-t)/2);switch(i){case"XYX":e.set(o*c,l*u,l*d,o*h);break;case"YZY":e.set(l*d,o*c,l*u,o*h);break;case"ZXZ":e.set(l*u,l*d,o*c,o*h);break;case"XZX":e.set(o*c,l*f,l*p,o*h);break;case"YXY":e.set(l*p,o*c,l*f,o*h);break;case"ZYZ":e.set(l*f,l*p,o*c,o*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}});class ep{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let t=this.x,r=this.y,n=e.elements;return this.x=n[0]*t+n[3]*r+n[6],this.y=n[1]*t+n[4]*r+n[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){let r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,r=this.y-e.y;return t*t+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,r){return void 0!==r&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){let r=Math.cos(t),n=Math.sin(t),i=this.x-e.x,s=this.y-e.y;return this.x=i*r-s*n+e.x,this.y=i*n+s*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}ep.prototype.isVector2=!0;class ef{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,r,n,i,s,a,o,l){let h=this.elements;return h[0]=e,h[1]=n,h[2]=a,h[3]=t,h[4]=i,h[5]=o,h[6]=r,h[7]=s,h[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this}extractBasis(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let r=e.elements,n=t.elements,i=this.elements,s=r[0],a=r[3],o=r[6],l=r[1],h=r[4],c=r[7],u=r[2],d=r[5],p=r[8],f=n[0],m=n[3],g=n[6],v=n[1],y=n[4],x=n[7],_=n[2],b=n[5],w=n[8];return i[0]=s*f+a*v+o*_,i[3]=s*m+a*y+o*b,i[6]=s*g+a*x+o*w,i[1]=l*f+h*v+c*_,i[4]=l*m+h*y+c*b,i[7]=l*g+h*x+c*w,i[2]=u*f+d*v+p*_,i[5]=u*m+d*y+p*b,i[8]=u*g+d*x+p*w,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){let e=this.elements,t=e[0],r=e[1],n=e[2],i=e[3],s=e[4],a=e[5],o=e[6],l=e[7],h=e[8];return t*s*h-t*a*l-r*i*h+r*a*o+n*i*l-n*s*o}invert(){let e=this.elements,t=e[0],r=e[1],n=e[2],i=e[3],s=e[4],a=e[5],o=e[6],l=e[7],h=e[8],c=h*s-a*l,u=a*o-h*i,d=l*i-s*o,p=t*c+r*u+n*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);let f=1/p;return e[0]=c*f,e[1]=(n*l-h*r)*f,e[2]=(a*r-n*s)*f,e[3]=u*f,e[4]=(h*t-n*o)*f,e[5]=(n*i-a*t)*f,e[6]=d*f,e[7]=(r*o-l*t)*f,e[8]=(s*t-r*i)*f,this}transpose(){let e;let t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,r,n,i,s,a){let o=Math.cos(i),l=Math.sin(i);return this.set(r*o,r*l,-r*(o*s+l*a)+s+e,-n*l,n*o,-n*(-l*s+o*a)+a+t,0,0,1),this}scale(e,t){let r=this.elements;return r[0]*=e,r[3]*=e,r[6]*=e,r[1]*=t,r[4]*=t,r[7]*=t,this}rotate(e){let t=Math.cos(e),r=Math.sin(e),n=this.elements,i=n[0],s=n[3],a=n[6],o=n[1],l=n[4],h=n[7];return n[0]=t*i+r*o,n[3]=t*s+r*l,n[6]=t*a+r*h,n[1]=-r*i+t*o,n[4]=-r*s+t*l,n[7]=-r*a+t*h,this}translate(e,t){let r=this.elements;return r[0]+=e*r[2],r[3]+=e*r[5],r[6]+=e*r[8],r[1]+=t*r[2],r[4]+=t*r[5],r[7]+=t*r[8],this}equals(e){let t=this.elements,r=e.elements;for(let e=0;e<9;e++)if(t[e]!==r[e])return!1;return!0}fromArray(e,t=0){for(let r=0;r<9;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){let r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}ef.prototype.isMatrix3=!0;class em{static getDataURL(t){let r;if(/^data:/i.test(t.src)||"undefined"==typeof HTMLCanvasElement)return t.src;if(t instanceof HTMLCanvasElement)r=t;else{void 0===e&&(e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),e.width=t.width,e.height=t.height;let n=e.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),r=e}return r.width>2048||r.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),r.toDataURL("image/jpeg",.6)):r.toDataURL("image/png")}}let eg=0;class ev extends ee{constructor(e=ev.DEFAULT_IMAGE,t=ev.DEFAULT_MAPPING,r=1001,n=1001,i=1006,s=1008,a=1023,o=1009,l=1,h=3e3){super(),Object.defineProperty(this,"id",{value:eg++}),this.uuid=es(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=r,this.wrapT=n,this.magFilter=i,this.minFilter=s,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new ep(0,0),this.repeat=new ep(1,1),this.center=new ep(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ef,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=h,this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this}toJSON(e){let t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];let r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){let n=this.image;if(void 0===n.uuid&&(n.uuid=es()),!t&&void 0===e.images[n.uuid]){let t;if(Array.isArray(n)){t=[];for(let e=0,r=n.length;e<r;e++)n[e].isDataTexture?t.push(ey(n[e].image)):t.push(ey(n[e]))}else t=ey(n);e.images[n.uuid]={uuid:n.uuid,url:t}}r.image=n.uuid}return t||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case 1e3:e.x=e.x-Math.floor(e.x);break;case 1001:e.x=e.x<0?0:1;break;case 1002:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case 1e3:e.y=e.y-Math.floor(e.y);break;case 1001:e.y=e.y<0?0:1;break;case 1002:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&this.version++}}function ey(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?em.getDataURL(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}ev.DEFAULT_IMAGE=void 0,ev.DEFAULT_MAPPING=300,ev.prototype.isTexture=!0;class ex{constructor(e=0,t=0,r=0,n=1){this.x=e,this.y=t,this.z=r,this.w=n}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,r,n){return this.x=e,this.y=t,this.z=r,this.w=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let t=this.x,r=this.y,n=this.z,i=this.w,s=e.elements;return this.x=s[0]*t+s[4]*r+s[8]*n+s[12]*i,this.y=s[1]*t+s[5]*r+s[9]*n+s[13]*i,this.z=s[2]*t+s[6]*r+s[10]*n+s[14]*i,this.w=s[3]*t+s[7]*r+s[11]*n+s[15]*i,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,r,n,i;let s=e.elements,a=s[0],o=s[4],l=s[8],h=s[1],c=s[5],u=s[9],d=s[2],p=s[6],f=s[10];if(.01>Math.abs(o-h)&&.01>Math.abs(l-d)&&.01>Math.abs(u-p)){if(.1>Math.abs(o+h)&&.1>Math.abs(l+d)&&.1>Math.abs(u+p)&&.1>Math.abs(a+c+f-3))return this.set(1,0,0,0),this;t=Math.PI;let e=(a+1)/2,s=(c+1)/2,m=(f+1)/2,g=(o+h)/4,v=(l+d)/4,y=(u+p)/4;return e>s&&e>m?e<.01?(r=0,n=.707106781,i=.707106781):(n=g/(r=Math.sqrt(e)),i=v/r):s>m?s<.01?(r=.707106781,n=0,i=.707106781):(r=g/(n=Math.sqrt(s)),i=y/n):m<.01?(r=.707106781,n=.707106781,i=0):(r=v/(i=Math.sqrt(m)),n=y/i),this.set(r,n,i,t),this}let m=Math.sqrt((p-u)*(p-u)+(l-d)*(l-d)+(h-o)*(h-o));return .001>Math.abs(m)&&(m=1),this.x=(p-u)/m,this.y=(l-d)/m,this.z=(h-o)/m,this.w=Math.acos((a+c+f-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){let r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this.w=e.w+(t.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,r){return void 0!==r&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}ex.prototype.isVector4=!0;class e_ extends ee{constructor(e,t,r={}){super(),this.width=e,this.height=t,this.depth=1,this.scissor=new ex(0,0,e,t),this.scissorTest=!1,this.viewport=new ex(0,0,e,t),this.texture=new ev(void 0,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.isRenderTargetTexture=!0,this.texture.image={width:e,height:t,depth:1},this.texture.generateMipmaps=void 0!==r.generateMipmaps&&r.generateMipmaps,this.texture.internalFormat=void 0!==r.internalFormat?r.internalFormat:null,this.texture.minFilter=void 0!==r.minFilter?r.minFilter:1006,this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0!==r.stencilBuffer&&r.stencilBuffer,this.depthTexture=void 0!==r.depthTexture?r.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,t,r=1){(this.width!==e||this.height!==t||this.depth!==r)&&(this.width=e,this.height=t,this.depth=r,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=r,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image={...this.texture.image},this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}e_.prototype.isWebGLRenderTarget=!0,(class extends e_{constructor(e,t,r){super(e,t);let n=this.texture;this.texture=[];for(let e=0;e<r;e++)this.texture[e]=n.clone()}setSize(e,t,r=1){if(this.width!==e||this.height!==t||this.depth!==r){this.width=e,this.height=t,this.depth=r;for(let n=0,i=this.texture.length;n<i;n++)this.texture[n].image.width=e,this.texture[n].image.height=t,this.texture[n].image.depth=r;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(let t=0,r=e.texture.length;t<r;t++)this.texture[t]=e.texture[t].clone();return this}}).prototype.isWebGLMultipleRenderTargets=!0;class eb extends e_{constructor(e,t,r){super(e,t,r),this.samples=4}copy(e){return super.copy.call(this,e),this.samples=e.samples,this}}eb.prototype.isWebGLMultisampleRenderTarget=!0;class ew{constructor(e=0,t=0,r=0,n=1){this._x=e,this._y=t,this._z=r,this._w=n}static slerp(e,t,r,n){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),r.slerpQuaternions(e,t,n)}static slerpFlat(e,t,r,n,i,s,a){let o=r[n+0],l=r[n+1],h=r[n+2],c=r[n+3],u=i[s+0],d=i[s+1],p=i[s+2],f=i[s+3];if(0===a){e[t+0]=o,e[t+1]=l,e[t+2]=h,e[t+3]=c;return}if(1===a){e[t+0]=u,e[t+1]=d,e[t+2]=p,e[t+3]=f;return}if(c!==f||o!==u||l!==d||h!==p){let e=1-a,t=o*u+l*d+h*p+c*f,r=t>=0?1:-1,n=1-t*t;if(n>Number.EPSILON){let i=Math.sqrt(n),s=Math.atan2(i,t*r);e=Math.sin(e*s)/i,a=Math.sin(a*s)/i}let i=a*r;if(o=o*e+u*i,l=l*e+d*i,h=h*e+p*i,c=c*e+f*i,e===1-a){let e=1/Math.sqrt(o*o+l*l+h*h+c*c);o*=e,l*=e,h*=e,c*=e}}e[t]=o,e[t+1]=l,e[t+2]=h,e[t+3]=c}static multiplyQuaternionsFlat(e,t,r,n,i,s){let a=r[n],o=r[n+1],l=r[n+2],h=r[n+3],c=i[s],u=i[s+1],d=i[s+2],p=i[s+3];return e[t]=a*p+h*c+o*d-l*u,e[t+1]=o*p+h*u+l*c-a*d,e[t+2]=l*p+h*d+a*u-o*c,e[t+3]=h*p-a*c-o*u-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,r,n){return this._x=e,this._y=t,this._z=r,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!(e&&e.isEuler))throw Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");let r=e._x,n=e._y,i=e._z,s=e._order,a=Math.cos,o=Math.sin,l=a(r/2),h=a(n/2),c=a(i/2),u=o(r/2),d=o(n/2),p=o(i/2);switch(s){case"XYZ":this._x=u*h*c+l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c-u*d*p;break;case"YXZ":this._x=u*h*c+l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c+u*d*p;break;case"ZXY":this._x=u*h*c-l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c-u*d*p;break;case"ZYX":this._x=u*h*c-l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c+u*d*p;break;case"YZX":this._x=u*h*c+l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c-u*d*p;break;case"XZY":this._x=u*h*c-l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c+u*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){let r=t/2,n=Math.sin(r);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){let t=e.elements,r=t[0],n=t[4],i=t[8],s=t[1],a=t[5],o=t[9],l=t[2],h=t[6],c=t[10],u=r+a+c;if(u>0){let e=.5/Math.sqrt(u+1);this._w=.25/e,this._x=(h-o)*e,this._y=(i-l)*e,this._z=(s-n)*e}else if(r>a&&r>c){let e=2*Math.sqrt(1+r-a-c);this._w=(h-o)/e,this._x=.25*e,this._y=(n+s)/e,this._z=(i+l)/e}else if(a>c){let e=2*Math.sqrt(1+a-r-c);this._w=(i-l)/e,this._x=(n+s)/e,this._y=.25*e,this._z=(o+h)/e}else{let e=2*Math.sqrt(1+c-r-a);this._w=(s-n)/e,this._x=(i+l)/e,this._y=(o+h)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let r=e.dot(t)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0):(this._x=0,this._y=-e.z,this._z=e.y)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x),this._w=r,this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(ea(this.dot(e),-1,1)))}rotateTowards(e,t){let r=this.angleTo(e);return 0===r||this.slerp(e,Math.min(1,t/r)),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){let r=e._x,n=e._y,i=e._z,s=e._w,a=t._x,o=t._y,l=t._z,h=t._w;return this._x=r*h+s*a+n*l-i*o,this._y=n*h+s*o+i*a-r*l,this._z=i*h+s*l+r*o-n*a,this._w=s*h-r*a-n*o-i*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);let r=this._x,n=this._y,i=this._z,s=this._w,a=s*e._w+r*e._x+n*e._y+i*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=s,this._x=r,this._y=n,this._z=i,this;let o=1-a*a;if(o<=Number.EPSILON){let e=1-t;return this._w=e*s+t*this._w,this._x=e*r+t*this._x,this._y=e*n+t*this._y,this._z=e*i+t*this._z,this.normalize(),this._onChangeCallback(),this}let l=Math.sqrt(o),h=Math.atan2(l,a),c=Math.sin((1-t)*h)/l,u=Math.sin(t*h)/l;return this._w=s*c+this._w*u,this._x=r*c+this._x*u,this._y=n*c+this._y*u,this._z=i*c+this._z*u,this._onChangeCallback(),this}slerpQuaternions(e,t,r){this.copy(e).slerp(t,r)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}ew.prototype.isQuaternion=!0;class eS{constructor(e=0,t=0,r=0){this.x=e,this.y=t,this.z=r}set(e,t,r){return void 0===r&&(r=this.z),this.x=e,this.y=t,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(eT.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(eT.setFromAxisAngle(e,t))}applyMatrix3(e){let t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6]*n,this.y=i[1]*t+i[4]*r+i[7]*n,this.z=i[2]*t+i[5]*r+i[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let t=this.x,r=this.y,n=this.z,i=e.elements,s=1/(i[3]*t+i[7]*r+i[11]*n+i[15]);return this.x=(i[0]*t+i[4]*r+i[8]*n+i[12])*s,this.y=(i[1]*t+i[5]*r+i[9]*n+i[13])*s,this.z=(i[2]*t+i[6]*r+i[10]*n+i[14])*s,this}applyQuaternion(e){let t=this.x,r=this.y,n=this.z,i=e.x,s=e.y,a=e.z,o=e.w,l=o*t+s*n-a*r,h=o*r+a*t-i*n,c=o*n+i*r-s*t,u=-i*t-s*r-a*n;return this.x=l*o+-(u*i)+-(h*a)- -(c*s),this.y=h*o+-(u*s)+-(c*i)- -(l*a),this.z=c*o+-(u*a)+-(l*s)- -(h*i),this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[4]*r+i[8]*n,this.y=i[1]*t+i[5]*r+i[9]*n,this.z=i[2]*t+i[6]*r+i[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){let r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this}cross(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){let r=e.x,n=e.y,i=e.z,s=t.x,a=t.y,o=t.z;return this.x=n*o-i*a,this.y=i*s-r*o,this.z=r*a-n*s,this}projectOnVector(e){let t=e.lengthSq();if(0===t)return this.set(0,0,0);let r=e.dot(this)/t;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return eM.copy(this).projectOnVector(e),this.sub(eM)}reflect(e){return this.sub(eM.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());return 0===t?Math.PI/2:Math.acos(ea(this.dot(e)/t,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,r=this.y-e.y,n=this.z-e.z;return t*t+r*r+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,r){let n=Math.sin(t)*e;return this.x=n*Math.sin(r),this.y=Math.cos(t)*e,this.z=n*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){let t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){let t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=n,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,r){return void 0!==r&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}eS.prototype.isVector3=!0;const eM=new eS,eT=new ew;class eE{constructor(e=new eS(1/0,1/0,1/0),t=new eS(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,r=1/0,n=1/0,i=-1/0,s=-1/0,a=-1/0;for(let o=0,l=e.length;o<l;o+=3){let l=e[o],h=e[o+1],c=e[o+2];l<t&&(t=l),h<r&&(r=h),c<n&&(n=c),l>i&&(i=l),h>s&&(s=h),c>a&&(a=c)}return this.min.set(t,r,n),this.max.set(i,s,a),this}setFromBufferAttribute(e){let t=1/0,r=1/0,n=1/0,i=-1/0,s=-1/0,a=-1/0;for(let o=0,l=e.count;o<l;o++){let l=e.getX(o),h=e.getY(o),c=e.getZ(o);l<t&&(t=l),h<r&&(r=h),c<n&&(n=c),l>i&&(i=l),h>s&&(s=h),c>a&&(a=c)}return this.min.set(t,r,n),this.max.set(i,s,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let r=eC.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);let t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),eR.copy(t.boundingBox),eR.applyMatrix4(e.matrixWorld),this.union(eR));let r=e.children;for(let e=0,t=r.length;e<t;e++)this.expandByObject(r[e]);return this}containsPoint(e){return!(e.x<this.min.x)&&!(e.x>this.max.x)&&!(e.y<this.min.y)&&!(e.y>this.max.y)&&!(e.z<this.min.z)&&!(e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x)&&!(e.min.x>this.max.x)&&!(e.max.y<this.min.y)&&!(e.min.y>this.max.y)&&!(e.max.z<this.min.z)&&!(e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,eC),eC.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(eO),eN.subVectors(this.max,eO),eL.subVectors(e.a,eO),eI.subVectors(e.b,eO),eP.subVectors(e.c,eO),ek.subVectors(eI,eL),eD.subVectors(eP,eI),eU.subVectors(eL,eP);let t=[0,-ek.z,ek.y,0,-eD.z,eD.y,0,-eU.z,eU.y,ek.z,0,-ek.x,eD.z,0,-eD.x,eU.z,0,-eU.x,-ek.y,ek.x,0,-eD.y,eD.x,0,-eU.y,eU.x,0];return!!(ez(t,eL,eI,eP,eN)&&ez(t=[1,0,0,0,1,0,0,0,1],eL,eI,eP,eN))&&(eF.crossVectors(ek,eD),ez(t=[eF.x,eF.y,eF.z],eL,eI,eP,eN))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return eC.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(eC).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(eA[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),eA[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),eA[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),eA[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),eA[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),eA[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),eA[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),eA[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(eA)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}eE.prototype.isBox3=!0;const eA=[new eS,new eS,new eS,new eS,new eS,new eS,new eS,new eS],eC=new eS,eR=new eE,eL=new eS,eI=new eS,eP=new eS,ek=new eS,eD=new eS,eU=new eS,eO=new eS,eN=new eS,eF=new eS,eB=new eS;function ez(e,t,r,n,i){for(let s=0,a=e.length-3;s<=a;s+=3){eB.fromArray(e,s);let a=i.x*Math.abs(eB.x)+i.y*Math.abs(eB.y)+i.z*Math.abs(eB.z),o=t.dot(eB),l=r.dot(eB),h=n.dot(eB);if(Math.max(-Math.max(o,l,h),Math.min(o,l,h))>a)return!1}return!0}const eG=new eE,eH=new eS,eV=new eS,eW=new eS;class ej{constructor(e=new eS,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){let r=this.center;void 0!==t?r.copy(t):eG.setFromPoints(e).getCenter(r);let n=0;for(let t=0,i=e.length;t<i;t++)n=Math.max(n,r.distanceToSquared(e[t]));return this.radius=Math.sqrt(n),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){let r=this.center.distanceToSquared(e);return t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?e.makeEmpty():(e.set(this.center,this.center),e.expandByScalar(this.radius)),e}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){eW.subVectors(e,this.center);let t=eW.lengthSq();if(t>this.radius*this.radius){let e=Math.sqrt(t),r=(e-this.radius)*.5;this.center.add(eW.multiplyScalar(r/e)),this.radius+=r}return this}union(e){return eV.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(eH.copy(e.center).add(eV)),this.expandByPoint(eH.copy(e.center).sub(eV)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const eq=new eS,eX=new eS,eY=new eS,eJ=new eS,eZ=new eS,e$=new eS,eK=new eS;class eQ{constructor(e=new eS,t=new eS(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,eq)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);let r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(r).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let t=eq.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(eq.copy(this.direction).multiplyScalar(t).add(this.origin),eq.distanceToSquared(e))}distanceSqToSegment(e,t,r,n){let i,s,a,o;eX.copy(e).add(t).multiplyScalar(.5),eY.copy(t).sub(e).normalize(),eJ.copy(this.origin).sub(eX);let l=.5*e.distanceTo(t),h=-this.direction.dot(eY),c=eJ.dot(this.direction),u=-eJ.dot(eY),d=eJ.lengthSq(),p=Math.abs(1-h*h);if(p>0){if(i=h*u-c,s=h*c-u,o=l*p,i>=0){if(s>=-o){if(s<=o){let e=1/p;i*=e,s*=e,a=i*(i+h*s+2*c)+s*(h*i+s+2*u)+d}else a=-(i=Math.max(0,-(h*(s=l)+c)))*i+s*(s+2*u)+d}else a=-(i=Math.max(0,-(h*(s=-l)+c)))*i+s*(s+2*u)+d}else s<=-o?(s=(i=Math.max(0,-(-h*l+c)))>0?-l:Math.min(Math.max(-l,-u),l),a=-i*i+s*(s+2*u)+d):s<=o?(i=0,a=(s=Math.min(Math.max(-l,-u),l))*(s+2*u)+d):(s=(i=Math.max(0,-(h*l+c)))>0?l:Math.min(Math.max(-l,-u),l),a=-i*i+s*(s+2*u)+d)}else s=h>0?-l:l,a=-(i=Math.max(0,-(h*s+c)))*i+s*(s+2*u)+d;return r&&r.copy(this.direction).multiplyScalar(i).add(this.origin),n&&n.copy(eY).multiplyScalar(s).add(eX),a}intersectSphere(e,t){eq.subVectors(e.center,this.origin);let r=eq.dot(this.direction),n=eq.dot(eq)-r*r,i=e.radius*e.radius;if(n>i)return null;let s=Math.sqrt(i-n),a=r-s,o=r+s;return a<0&&o<0?null:a<0?this.at(o,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;let r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null}intersectPlane(e,t){let r=this.distanceToPlane(e);return null===r?null:this.at(r,t)}intersectsPlane(e){let t=e.distanceToPoint(this.origin);return!!(0===t||e.normal.dot(this.direction)*t<0)}intersectBox(e,t){let r,n,i,s,a,o;let l=1/this.direction.x,h=1/this.direction.y,c=1/this.direction.z,u=this.origin;return(l>=0?(r=(e.min.x-u.x)*l,n=(e.max.x-u.x)*l):(r=(e.max.x-u.x)*l,n=(e.min.x-u.x)*l),h>=0?(i=(e.min.y-u.y)*h,s=(e.max.y-u.y)*h):(i=(e.max.y-u.y)*h,s=(e.min.y-u.y)*h),r>s||i>n)?null:((i>r||r!=r)&&(r=i),(s<n||n!=n)&&(n=s),c>=0?(a=(e.min.z-u.z)*c,o=(e.max.z-u.z)*c):(a=(e.max.z-u.z)*c,o=(e.min.z-u.z)*c),r>o||a>n)?null:((a>r||r!=r)&&(r=a),(o<n||n!=n)&&(n=o),n<0)?null:this.at(r>=0?r:n,t)}intersectsBox(e){return null!==this.intersectBox(e,eq)}intersectTriangle(e,t,r,n,i){let s;eZ.subVectors(t,e),e$.subVectors(r,e),eK.crossVectors(eZ,e$);let a=this.direction.dot(eK);if(a>0){if(n)return null;s=1}else{if(!(a<0))return null;s=-1,a=-a}eJ.subVectors(this.origin,e);let o=s*this.direction.dot(e$.crossVectors(eJ,e$));if(o<0)return null;let l=s*this.direction.dot(eZ.cross(eJ));if(l<0||o+l>a)return null;let h=-s*eJ.dot(eK);return h<0?null:this.at(h/a,i)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class e0{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,r,n,i,s,a,o,l,h,c,u,d,p,f,m){let g=this.elements;return g[0]=e,g[4]=t,g[8]=r,g[12]=n,g[1]=i,g[5]=s,g[9]=a,g[13]=o,g[2]=l,g[6]=h,g[10]=c,g[14]=u,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new e0().fromArray(this.elements)}copy(e){let t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this}copyPosition(e){let t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this}setFromMatrix3(e){let t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this}extractRotation(e){let t=this.elements,r=e.elements,n=1/e1.setFromMatrixColumn(e,0).length(),i=1/e1.setFromMatrixColumn(e,1).length(),s=1/e1.setFromMatrixColumn(e,2).length();return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t[3]=0,t[4]=r[4]*i,t[5]=r[5]*i,t[6]=r[6]*i,t[7]=0,t[8]=r[8]*s,t[9]=r[9]*s,t[10]=r[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");let t=this.elements,r=e.x,n=e.y,i=e.z,s=Math.cos(r),a=Math.sin(r),o=Math.cos(n),l=Math.sin(n),h=Math.cos(i),c=Math.sin(i);if("XYZ"===e.order){let e=s*h,r=s*c,n=a*h,i=a*c;t[0]=o*h,t[4]=-o*c,t[8]=l,t[1]=r+n*l,t[5]=e-i*l,t[9]=-a*o,t[2]=i-e*l,t[6]=n+r*l,t[10]=s*o}else if("YXZ"===e.order){let e=o*h,r=o*c,n=l*h,i=l*c;t[0]=e+i*a,t[4]=n*a-r,t[8]=s*l,t[1]=s*c,t[5]=s*h,t[9]=-a,t[2]=r*a-n,t[6]=i+e*a,t[10]=s*o}else if("ZXY"===e.order){let e=o*h,r=o*c,n=l*h,i=l*c;t[0]=e-i*a,t[4]=-s*c,t[8]=n+r*a,t[1]=r+n*a,t[5]=s*h,t[9]=i-e*a,t[2]=-s*l,t[6]=a,t[10]=s*o}else if("ZYX"===e.order){let e=s*h,r=s*c,n=a*h,i=a*c;t[0]=o*h,t[4]=n*l-r,t[8]=e*l+i,t[1]=o*c,t[5]=i*l+e,t[9]=r*l-n,t[2]=-l,t[6]=a*o,t[10]=s*o}else if("YZX"===e.order){let e=s*o,r=s*l,n=a*o,i=a*l;t[0]=o*h,t[4]=i-e*c,t[8]=n*c+r,t[1]=c,t[5]=s*h,t[9]=-a*h,t[2]=-l*h,t[6]=r*c+n,t[10]=e-i*c}else if("XZY"===e.order){let e=s*o,r=s*l,n=a*o,i=a*l;t[0]=o*h,t[4]=-c,t[8]=l*h,t[1]=e*c+i,t[5]=s*h,t[9]=r*c-n,t[2]=n*c-r,t[6]=a*h,t[10]=i*c+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(e3,e,e4)}lookAt(e,t,r){let n=this.elements;return e8.subVectors(e,t),0===e8.lengthSq()&&(e8.z=1),e8.normalize(),e5.crossVectors(r,e8),0===e5.lengthSq()&&(1===Math.abs(r.z)?e8.x+=1e-4:e8.z+=1e-4,e8.normalize(),e5.crossVectors(r,e8)),e5.normalize(),e6.crossVectors(e8,e5),n[0]=e5.x,n[4]=e6.x,n[8]=e8.x,n[1]=e5.y,n[5]=e6.y,n[9]=e8.y,n[2]=e5.z,n[6]=e6.z,n[10]=e8.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let r=e.elements,n=t.elements,i=this.elements,s=r[0],a=r[4],o=r[8],l=r[12],h=r[1],c=r[5],u=r[9],d=r[13],p=r[2],f=r[6],m=r[10],g=r[14],v=r[3],y=r[7],x=r[11],_=r[15],b=n[0],w=n[4],S=n[8],T=n[12],E=n[1],A=n[5],C=n[9],R=n[13],L=n[2],I=n[6],P=n[10],k=n[14],D=n[3],U=n[7],O=n[11],N=n[15];return i[0]=s*b+a*E+o*L+l*D,i[4]=s*w+a*A+o*I+l*U,i[8]=s*S+a*C+o*P+l*O,i[12]=s*T+a*R+o*k+l*N,i[1]=h*b+c*E+u*L+d*D,i[5]=h*w+c*A+u*I+d*U,i[9]=h*S+c*C+u*P+d*O,i[13]=h*T+c*R+u*k+d*N,i[2]=p*b+f*E+m*L+g*D,i[6]=p*w+f*A+m*I+g*U,i[10]=p*S+f*C+m*P+g*O,i[14]=p*T+f*R+m*k+g*N,i[3]=v*b+y*E+x*L+_*D,i[7]=v*w+y*A+x*I+_*U,i[11]=v*S+y*C+x*P+_*O,i[15]=v*T+y*R+x*k+_*N,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){let e=this.elements,t=e[0],r=e[4],n=e[8],i=e[12],s=e[1],a=e[5],o=e[9],l=e[13],h=e[2],c=e[6],u=e[10],d=e[14],p=e[3];return p*(+i*o*c-n*l*c-i*a*u+r*l*u+n*a*d-r*o*d)+e[7]*(+t*o*d-t*l*u+i*s*u-n*s*d+n*l*h-i*o*h)+e[11]*(+t*l*c-t*a*d-i*s*c+r*s*d+i*a*h-r*l*h)+e[15]*(-n*a*h-t*o*c+t*a*u+n*s*c-r*s*u+r*o*h)}transpose(){let e;let t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(e,t,r){let n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=r),this}invert(){let e=this.elements,t=e[0],r=e[1],n=e[2],i=e[3],s=e[4],a=e[5],o=e[6],l=e[7],h=e[8],c=e[9],u=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15],v=c*m*l-f*u*l+f*o*d-a*m*d-c*o*g+a*u*g,y=p*u*l-h*m*l-p*o*d+s*m*d+h*o*g-s*u*g,x=h*f*l-p*c*l+p*a*d-s*f*d-h*a*g+s*c*g,_=p*c*o-h*f*o-p*a*u+s*f*u+h*a*m-s*c*m,b=t*v+r*y+n*x+i*_;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let w=1/b;return e[0]=v*w,e[1]=(f*u*i-c*m*i-f*n*d+r*m*d+c*n*g-r*u*g)*w,e[2]=(a*m*i-f*o*i+f*n*l-r*m*l-a*n*g+r*o*g)*w,e[3]=(c*o*i-a*u*i-c*n*l+r*u*l+a*n*d-r*o*d)*w,e[4]=y*w,e[5]=(h*m*i-p*u*i+p*n*d-t*m*d-h*n*g+t*u*g)*w,e[6]=(p*o*i-s*m*i-p*n*l+t*m*l+s*n*g-t*o*g)*w,e[7]=(s*u*i-h*o*i+h*n*l-t*u*l-s*n*d+t*o*d)*w,e[8]=x*w,e[9]=(p*c*i-h*f*i-p*r*d+t*f*d+h*r*g-t*c*g)*w,e[10]=(s*f*i-p*a*i+p*r*l-t*f*l-s*r*g+t*a*g)*w,e[11]=(h*a*i-s*c*i-h*r*l+t*c*l+s*r*d-t*a*d)*w,e[12]=_*w,e[13]=(h*f*n-p*c*n+p*r*u-t*f*u-h*r*m+t*c*m)*w,e[14]=(p*a*n-s*f*n-p*r*o+t*f*o+s*r*m-t*a*m)*w,e[15]=(s*c*n-h*a*n+h*r*o-t*c*o-s*r*u+t*a*u)*w,this}scale(e){let t=this.elements,r=e.x,n=e.y,i=e.z;return t[0]*=r,t[4]*=n,t[8]*=i,t[1]*=r,t[5]*=n,t[9]*=i,t[2]*=r,t[6]*=n,t[10]*=i,t[3]*=r,t[7]*=n,t[11]*=i,this}getMaxScaleOnAxis(){let e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10]))}makeTranslation(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}makeRotationX(e){let t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this}makeRotationY(e){let t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this}makeRotationZ(e){let t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){let r=Math.cos(t),n=Math.sin(t),i=1-r,s=e.x,a=e.y,o=e.z,l=i*s,h=i*a;return this.set(l*s+r,l*a-n*o,l*o+n*a,0,l*a+n*o,h*a+r,h*o-n*s,0,l*o-n*a,h*o+n*s,i*o*o+r,0,0,0,0,1),this}makeScale(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,t,r,n,i,s){return this.set(1,r,i,0,e,1,s,0,t,n,1,0,0,0,0,1),this}compose(e,t,r){let n=this.elements,i=t._x,s=t._y,a=t._z,o=t._w,l=i+i,h=s+s,c=a+a,u=i*l,d=i*h,p=i*c,f=s*h,m=s*c,g=a*c,v=o*l,y=o*h,x=o*c,_=r.x,b=r.y,w=r.z;return n[0]=(1-(f+g))*_,n[1]=(d+x)*_,n[2]=(p-y)*_,n[3]=0,n[4]=(d-x)*b,n[5]=(1-(u+g))*b,n[6]=(m+v)*b,n[7]=0,n[8]=(p+y)*w,n[9]=(m-v)*w,n[10]=(1-(u+f))*w,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}decompose(e,t,r){let n=this.elements,i=e1.set(n[0],n[1],n[2]).length(),s=e1.set(n[4],n[5],n[6]).length(),a=e1.set(n[8],n[9],n[10]).length();0>this.determinant()&&(i=-i),e.x=n[12],e.y=n[13],e.z=n[14],e2.copy(this);let o=1/i,l=1/s,h=1/a;return e2.elements[0]*=o,e2.elements[1]*=o,e2.elements[2]*=o,e2.elements[4]*=l,e2.elements[5]*=l,e2.elements[6]*=l,e2.elements[8]*=h,e2.elements[9]*=h,e2.elements[10]*=h,t.setFromRotationMatrix(e2),r.x=i,r.y=s,r.z=a,this}makePerspective(e,t,r,n,i,s){void 0===s&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");let a=this.elements;return a[0]=2*i/(t-e),a[4]=0,a[8]=(t+e)/(t-e),a[12]=0,a[1]=0,a[5]=2*i/(r-n),a[9]=(r+n)/(r-n),a[13]=0,a[2]=0,a[6]=0,a[10]=-(s+i)/(s-i),a[14]=-2*s*i/(s-i),a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,r,n,i,s){let a=this.elements,o=1/(t-e),l=1/(r-n),h=1/(s-i);return a[0]=2*o,a[4]=0,a[8]=0,a[12]=-((t+e)*o),a[1]=0,a[5]=2*l,a[9]=0,a[13]=-((r+n)*l),a[2]=0,a[6]=0,a[10]=-2*h,a[14]=-((s+i)*h),a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){let t=this.elements,r=e.elements;for(let e=0;e<16;e++)if(t[e]!==r[e])return!1;return!0}fromArray(e,t=0){for(let r=0;r<16;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){let r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}e0.prototype.isMatrix4=!0;const e1=new eS,e2=new e0,e3=new eS(0,0,0),e4=new eS(1,1,1),e5=new eS,e6=new eS,e8=new eS,e7=new e0,e9=new ew;class te{constructor(e=0,t=0,r=0,n=te.DefaultOrder){this._x=e,this._y=t,this._z=r,this._order=n}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,r,n=this._order){return this._x=e,this._y=t,this._z=r,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,r=!0){let n=e.elements,i=n[0],s=n[4],a=n[8],o=n[1],l=n[5],h=n[9],c=n[2],u=n[6],d=n[10];switch(t){case"XYZ":this._y=Math.asin(ea(a,-1,1)),.9999999>Math.abs(a)?(this._x=Math.atan2(-h,d),this._z=Math.atan2(-s,i)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-ea(h,-1,1)),.9999999>Math.abs(h)?(this._y=Math.atan2(a,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-c,i),this._z=0);break;case"ZXY":this._x=Math.asin(ea(u,-1,1)),.9999999>Math.abs(u)?(this._y=Math.atan2(-c,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(o,i));break;case"ZYX":this._y=Math.asin(-ea(c,-1,1)),.9999999>Math.abs(c)?(this._x=Math.atan2(u,d),this._z=Math.atan2(o,i)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(ea(o,-1,1)),.9999999>Math.abs(o)?(this._x=Math.atan2(-h,l),this._y=Math.atan2(-c,i)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-ea(s,-1,1)),.9999999>Math.abs(s)?(this._x=Math.atan2(u,l),this._y=Math.atan2(a,i)):(this._x=Math.atan2(-h,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===r&&this._onChangeCallback(),this}setFromQuaternion(e,t,r){return e7.makeRotationFromQuaternion(e),this.setFromRotationMatrix(e7,t,r)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return e9.setFromEuler(this),this.setFromQuaternion(e9,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new eS(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}te.prototype.isEuler=!0,te.DefaultOrder="XYZ",te.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class tt{constructor(){this.mask=1}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!=0}}let tr=0;const tn=new eS,ti=new ew,ts=new e0,ta=new eS,to=new eS,tl=new eS,th=new ew,tc=new eS(1,0,0),tu=new eS(0,1,0),td=new eS(0,0,1),tp={type:"added"},tf={type:"removed"};class tm extends ee{constructor(){super(),Object.defineProperty(this,"id",{value:tr++}),this.uuid=es(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=tm.DefaultUp.clone();let e=new eS,t=new te,r=new ew,n=new eS(1,1,1);t._onChange(function(){r.setFromEuler(t,!1)}),r._onChange(function(){t.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new e0},normalMatrix:{value:new ef}}),this.matrix=new e0,this.matrixWorld=new e0,this.matrixAutoUpdate=tm.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new tt,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return ti.setFromAxisAngle(e,t),this.quaternion.multiply(ti),this}rotateOnWorldAxis(e,t){return ti.setFromAxisAngle(e,t),this.quaternion.premultiply(ti),this}rotateX(e){return this.rotateOnAxis(tc,e)}rotateY(e){return this.rotateOnAxis(tu,e)}rotateZ(e){return this.rotateOnAxis(td,e)}translateOnAxis(e,t){return tn.copy(e).applyQuaternion(this.quaternion),this.position.add(tn.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(tc,e)}translateY(e){return this.translateOnAxis(tu,e)}translateZ(e){return this.translateOnAxis(td,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(ts.copy(this.matrixWorld).invert())}lookAt(e,t,r){e.isVector3?ta.copy(e):ta.set(e,t,r);let n=this.parent;this.updateWorldMatrix(!0,!1),to.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ts.lookAt(to,ta,this.up):ts.lookAt(ta,to,this.up),this.quaternion.setFromRotationMatrix(ts),n&&(ts.extractRotation(n.matrixWorld),ti.setFromRotationMatrix(ts),this.quaternion.premultiply(ti.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?console.error("THREE.Object3D.add: object can't be added as a child of itself.",e):e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(tp)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}let t=this.children.indexOf(e);return -1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(tf)),this}removeFromParent(){let e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){let t=this.children[e];t.parent=null,t.dispatchEvent(tf)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),ts.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),ts.multiply(e.parent.matrixWorld)),e.applyMatrix4(ts),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let r=0,n=this.children.length;r<n;r++){let n=this.children[r].getObjectByProperty(e,t);if(void 0!==n)return n}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(to,e,tl),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(to,th,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);let t=this.children;for(let r=0,n=t.length;r<n;r++)t[r].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);let t=this.children;for(let r=0,n=t.length;r<n;r++)t[r].traverseVisible(e)}traverseAncestors(e){let t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);let t=this.children;for(let r=0,n=t.length;r<n;r++)t[r].updateMatrixWorld(e)}updateWorldMatrix(e,t){let r=this.parent;if(!0===e&&null!==r&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){let e=this.children;for(let t=0,r=e.length;t<r;t++)e[t].updateWorldMatrix(!1,!0)}}toJSON(e){let t=void 0===e||"string"==typeof e,r={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let n={};function i(t,r){return void 0===t[r.uuid]&&(t[r.uuid]=r.toJSON(e)),r.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(n.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(n.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=i(e.geometries,this.geometry);let t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){let r=t.shapes;if(Array.isArray(r))for(let t=0,n=r.length;t<n;t++){let n=r[t];i(e.shapes,n)}else i(e.shapes,r)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(e.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),void 0!==this.material){if(Array.isArray(this.material)){let t=[];for(let r=0,n=this.material.length;r<n;r++)t.push(i(e.materials,this.material[r]));n.material=t}else n.material=i(e.materials,this.material)}if(this.children.length>0){n.children=[];for(let t=0;t<this.children.length;t++)n.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){n.animations=[];for(let t=0;t<this.animations.length;t++){let r=this.animations[t];n.animations.push(i(e.animations,r))}}if(t){let t=s(e.geometries),n=s(e.materials),i=s(e.textures),a=s(e.images),o=s(e.shapes),l=s(e.skeletons),h=s(e.animations);t.length>0&&(r.geometries=t),n.length>0&&(r.materials=n),i.length>0&&(r.textures=i),a.length>0&&(r.images=a),o.length>0&&(r.shapes=o),l.length>0&&(r.skeletons=l),h.length>0&&(r.animations=h)}return r.object=n,r;function s(e){let t=[];for(let r in e){let n=e[r];delete n.metadata,t.push(n)}return t}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){let r=e.children[t];this.add(r.clone())}return this}}tm.DefaultUp=new eS(0,1,0),tm.DefaultMatrixAutoUpdate=!0,tm.prototype.isObject3D=!0;const tg=new eS,tv=new eS,ty=new eS,tx=new eS,t_=new eS,tb=new eS,tw=new eS,tS=new eS,tM=new eS,tT=new eS;class tE{constructor(e=new eS,t=new eS,r=new eS){this.a=e,this.b=t,this.c=r}static getNormal(e,t,r,n){n.subVectors(r,t),tg.subVectors(e,t),n.cross(tg);let i=n.lengthSq();return i>0?n.multiplyScalar(1/Math.sqrt(i)):n.set(0,0,0)}static getBarycoord(e,t,r,n,i){tg.subVectors(n,t),tv.subVectors(r,t),ty.subVectors(e,t);let s=tg.dot(tg),a=tg.dot(tv),o=tg.dot(ty),l=tv.dot(tv),h=tv.dot(ty),c=s*l-a*a;if(0===c)return i.set(-2,-1,-1);let u=1/c,d=(l*o-a*h)*u,p=(s*h-a*o)*u;return i.set(1-d-p,p,d)}static containsPoint(e,t,r,n){return this.getBarycoord(e,t,r,n,tx),tx.x>=0&&tx.y>=0&&tx.x+tx.y<=1}static getUV(e,t,r,n,i,s,a,o){return this.getBarycoord(e,t,r,n,tx),o.set(0,0),o.addScaledVector(i,tx.x),o.addScaledVector(s,tx.y),o.addScaledVector(a,tx.z),o}static isFrontFacing(e,t,r,n){return tg.subVectors(r,t),tv.subVectors(e,t),0>tg.cross(tv).dot(n)}set(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this}setFromPointsAndIndices(e,t,r,n){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[n]),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return tg.subVectors(this.c,this.b),tv.subVectors(this.a,this.b),.5*tg.cross(tv).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return tE.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return tE.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,r,n,i){return tE.getUV(e,this.a,this.b,this.c,t,r,n,i)}containsPoint(e){return tE.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return tE.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){let r,n;let i=this.a,s=this.b,a=this.c;t_.subVectors(s,i),tb.subVectors(a,i),tS.subVectors(e,i);let o=t_.dot(tS),l=tb.dot(tS);if(o<=0&&l<=0)return t.copy(i);tM.subVectors(e,s);let h=t_.dot(tM),c=tb.dot(tM);if(h>=0&&c<=h)return t.copy(s);let u=o*c-h*l;if(u<=0&&o>=0&&h<=0)return r=o/(o-h),t.copy(i).addScaledVector(t_,r);tT.subVectors(e,a);let d=t_.dot(tT),p=tb.dot(tT);if(p>=0&&d<=p)return t.copy(a);let f=d*l-o*p;if(f<=0&&l>=0&&p<=0)return n=l/(l-p),t.copy(i).addScaledVector(tb,n);let m=h*p-d*c;if(m<=0&&c-h>=0&&d-p>=0)return tw.subVectors(a,s),n=(c-h)/(c-h+(d-p)),t.copy(s).addScaledVector(tw,n);let g=1/(m+f+u);return r=f*g,n=u*g,t.copy(i).addScaledVector(t_,r).addScaledVector(tb,n)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let tA=0;class tC extends ee{constructor(){super(),Object.defineProperty(this,"id",{value:tA++}),this.uuid=es(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.format=1023,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(let t in e){let r=e[t];if(void 0===r){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if("shading"===t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===r;continue}let n=this[t];if(void 0===n){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}n&&n.isColor?n.set(r):n&&n.isVector3&&r&&r.isVector3?n.copy(r):this[t]=r}}toJSON(e){let t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});let r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(e){let t=[];for(let r in e){let n=e[r];delete n.metadata,t.push(n)}return t}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),this.sheenTint&&this.sheenTint.isColor&&(r.sheenTint=this.sheenTint.getHex()),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(r.specularIntensity=this.specularIntensity),this.specularTint&&this.specularTint.isColor&&(r.specularTint=this.specularTint.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearcoat&&(r.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularTintMap&&this.specularTintMap.isTexture&&(r.specularTintMap=this.specularTintMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(r.combine=this.combine)),void 0!==this.envMapIntensity&&(r.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(r.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&(r.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationTint&&(r.attenuationTint=this.attenuationTint.getHex()),void 0!==this.size&&(r.size=this.size),null!==this.shadowSide&&(r.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(r.blending=this.blending),0!==this.side&&(r.side=this.side),this.vertexColors&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),1023!==this.format&&(r.format=this.format),!0===this.transparent&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,r.colorWrite=this.colorWrite,r.stencilWrite=this.stencilWrite,r.stencilWriteMask=this.stencilWriteMask,r.stencilFunc=this.stencilFunc,r.stencilRef=this.stencilRef,r.stencilFuncMask=this.stencilFuncMask,r.stencilFail=this.stencilFail,r.stencilZFail=this.stencilZFail,r.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(r.rotation=this.rotation),!0===this.polygonOffset&&(r.polygonOffset=!0),0!==this.polygonOffsetFactor&&(r.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(r.linewidth=this.linewidth),void 0!==this.dashSize&&(r.dashSize=this.dashSize),void 0!==this.gapSize&&(r.gapSize=this.gapSize),void 0!==this.scale&&(r.scale=this.scale),!0===this.dithering&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(r.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(r.wireframe=this.wireframe),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(r.flatShading=this.flatShading),!1===this.visible&&(r.visible=!1),!1===this.toneMapped&&(r.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),t){let t=n(e.textures),i=n(e.images);t.length>0&&(r.textures=t),i.length>0&&(r.images=i)}return r}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.format=e.format,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;let t=e.clippingPlanes,r=null;if(null!==t){let e=t.length;r=Array(e);for(let n=0;n!==e;++n)r[n]=t[n].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}tC.prototype.isMaterial=!0;const tR={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},tL={h:0,s:0,l:0},tI={h:0,s:0,l:0};function tP(e,t,r){return(r<0&&(r+=1),r>1&&(r-=1),r<1/6)?e+(t-e)*6*r:r<.5?t:r<2/3?e+(t-e)*6*(2/3-r):e}function tk(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function tD(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}class tU{constructor(e,t,r){if(void 0===t&&void 0===r)return this.set(e);return this.setRGB(e,t,r)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}setRGB(e,t,r){return this.r=e,this.g=t,this.b=r,this}setHSL(e,t,r){if(e=eo(e,1),t=ea(t,0,1),r=ea(r,0,1),0===t)this.r=this.g=this.b=r;else{let n=r<=.5?r*(1+t):r+t-r*t,i=2*r-n;this.r=tP(i,n,e+1/3),this.g=tP(i,n,e),this.b=tP(i,n,e-1/3)}return this}setStyle(e){let t;function r(t){void 0!==t&&1>parseFloat(t)&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}if(t=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let e;let n=t[1],i=t[2];switch(n){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,r(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,r(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i)){let t=parseFloat(e[1])/360,n=parseInt(e[2],10)/100,i=parseInt(e[3],10)/100;return r(e[4]),this.setHSL(t,n,i)}}}else if(t=/^\#([A-Fa-f\d]+)$/.exec(e)){let e=t[1],r=e.length;if(3===r)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,this;if(6===r)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){let t=tR[e.toLowerCase()];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,t=2){return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}copyLinearToGamma(e,t=2){let r=t>0?1/t:1;return this.r=Math.pow(e.r,r),this.g=Math.pow(e.g,r),this.b=Math.pow(e.b,r),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=tk(e.r),this.g=tk(e.g),this.b=tk(e.b),this}copyLinearToSRGB(e){return this.r=tD(e.r),this.g=tD(e.g),this.b=tD(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){let t,r;let n=this.r,i=this.g,s=this.b,a=Math.max(n,i,s),o=Math.min(n,i,s),l=(o+a)/2;if(o===a)t=0,r=0;else{let e=a-o;switch(r=l<=.5?e/(a+o):e/(2-a-o),a){case n:t=(i-s)/e+(i<s?6:0);break;case i:t=(s-n)/e+2;break;case s:t=(n-i)/e+4}t/=6}return e.h=t,e.s=r,e.l=l,e}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(e,t,r){return this.getHSL(tL),tL.h+=e,tL.s+=t,tL.l+=r,this.setHSL(tL.h,tL.s,tL.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,r){return this.r=e.r+(t.r-e.r)*r,this.g=e.g+(t.g-e.g)*r,this.b=e.b+(t.b-e.b)*r,this}lerpHSL(e,t){this.getHSL(tL),e.getHSL(tI);let r=el(tL.h,tI.h,t),n=el(tL.s,tI.s,t),i=el(tL.l,tI.l,t);return this.setHSL(r,n,i),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}tU.NAMES=tR,tU.prototype.isColor=!0,tU.prototype.r=1,tU.prototype.g=1,tU.prototype.b=1;class tO extends tC{constructor(e){super(),this.type="MeshBasicMaterial",this.color=new tU(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}tO.prototype.isMeshBasicMaterial=!0;const tN=new eS,tF=new ep;class tB{constructor(e,t,r){if(Array.isArray(e))throw TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===r,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,r){e*=this.itemSize,r*=t.itemSize;for(let n=0,i=this.itemSize;n<i;n++)this.array[e+n]=t.array[r+n];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){let t=this.array,r=0;for(let n=0,i=e.length;n<i;n++){let i=e[n];void 0===i&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),i=new tU),t[r++]=i.r,t[r++]=i.g,t[r++]=i.b}return this}copyVector2sArray(e){let t=this.array,r=0;for(let n=0,i=e.length;n<i;n++){let i=e[n];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),i=new ep),t[r++]=i.x,t[r++]=i.y}return this}copyVector3sArray(e){let t=this.array,r=0;for(let n=0,i=e.length;n<i;n++){let i=e[n];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),i=new eS),t[r++]=i.x,t[r++]=i.y,t[r++]=i.z}return this}copyVector4sArray(e){let t=this.array,r=0;for(let n=0,i=e.length;n<i;n++){let i=e[n];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),i=new ex),t[r++]=i.x,t[r++]=i.y,t[r++]=i.z,t[r++]=i.w}return this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,r=this.count;t<r;t++)tF.fromBufferAttribute(this,t),tF.applyMatrix3(e),this.setXY(t,tF.x,tF.y);else if(3===this.itemSize)for(let t=0,r=this.count;t<r;t++)tN.fromBufferAttribute(this,t),tN.applyMatrix3(e),this.setXYZ(t,tN.x,tN.y,tN.z);return this}applyMatrix4(e){for(let t=0,r=this.count;t<r;t++)tN.x=this.getX(t),tN.y=this.getY(t),tN.z=this.getZ(t),tN.applyMatrix4(e),this.setXYZ(t,tN.x,tN.y,tN.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)tN.x=this.getX(t),tN.y=this.getY(t),tN.z=this.getZ(t),tN.applyNormalMatrix(e),this.setXYZ(t,tN.x,tN.y,tN.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)tN.x=this.getX(t),tN.y=this.getY(t),tN.z=this.getZ(t),tN.transformDirection(e),this.setXYZ(t,tN.x,tN.y,tN.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this}setXYZ(e,t,r,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=n,this}setXYZW(e,t,r,n,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=n,this.array[e+3]=i,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),35044!==this.usage&&(e.usage=this.usage),(0!==this.updateRange.offset||-1!==this.updateRange.count)&&(e.updateRange=this.updateRange),e}}tB.prototype.isBufferAttribute=!0;class tz extends tB{constructor(e,t,r){super(new Uint16Array(e),t,r)}}class tG extends tB{constructor(e,t,r){super(new Uint32Array(e),t,r)}}(class extends tB{constructor(e,t,r){super(new Uint16Array(e),t,r)}}).prototype.isFloat16BufferAttribute=!0;class tH extends tB{constructor(e,t,r){super(new Float32Array(e),t,r)}}function tV(e){if(0===e.length)return-1/0;let t=e[0];for(let r=1,n=e.length;r<n;++r)e[r]>t&&(t=e[r]);return t}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;let tW=0;const tj=new e0,tq=new tm,tX=new eS,tY=new eE,tJ=new eE,tZ=new eS;class t$ extends ee{constructor(){super(),Object.defineProperty(this,"id",{value:tW++}),this.uuid=es(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(tV(e)>65535?tG:tz)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,r=0){this.groups.push({start:e,count:t,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){let t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);let r=this.attributes.normal;if(void 0!==r){let t=new ef().getNormalMatrix(e);r.applyNormalMatrix(t),r.needsUpdate=!0}let n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(e),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return tj.makeRotationFromQuaternion(e),this.applyMatrix4(tj),this}rotateX(e){return tj.makeRotationX(e),this.applyMatrix4(tj),this}rotateY(e){return tj.makeRotationY(e),this.applyMatrix4(tj),this}rotateZ(e){return tj.makeRotationZ(e),this.applyMatrix4(tj),this}translate(e,t,r){return tj.makeTranslation(e,t,r),this.applyMatrix4(tj),this}scale(e,t,r){return tj.makeScale(e,t,r),this.applyMatrix4(tj),this}lookAt(e){return tq.lookAt(e),tq.updateMatrix(),this.applyMatrix4(tq.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(tX).negate(),this.translate(tX.x,tX.y,tX.z),this}setFromPoints(e){let t=[];for(let r=0,n=e.length;r<n;r++){let n=e[r];t.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new tH(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new eE);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new eS(-1/0,-1/0,-1/0),new eS(1/0,1/0,1/0));return}if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,r=t.length;e<r;e++){let r=t[e];tY.setFromBufferAttribute(r),this.morphTargetsRelative?(tZ.addVectors(this.boundingBox.min,tY.min),this.boundingBox.expandByPoint(tZ),tZ.addVectors(this.boundingBox.max,tY.max),this.boundingBox.expandByPoint(tZ)):(this.boundingBox.expandByPoint(tY.min),this.boundingBox.expandByPoint(tY.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new ej);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new eS,1/0);return}if(e){let r=this.boundingSphere.center;if(tY.setFromBufferAttribute(e),t)for(let e=0,r=t.length;e<r;e++){let r=t[e];tJ.setFromBufferAttribute(r),this.morphTargetsRelative?(tZ.addVectors(tY.min,tJ.min),tY.expandByPoint(tZ),tZ.addVectors(tY.max,tJ.max),tY.expandByPoint(tZ)):(tY.expandByPoint(tJ.min),tY.expandByPoint(tJ.max))}tY.getCenter(r);let n=0;for(let t=0,i=e.count;t<i;t++)tZ.fromBufferAttribute(e,t),n=Math.max(n,r.distanceToSquared(tZ));if(t)for(let i=0,s=t.length;i<s;i++){let s=t[i],a=this.morphTargetsRelative;for(let t=0,i=s.count;t<i;t++)tZ.fromBufferAttribute(s,t),a&&(tX.fromBufferAttribute(e,t),tZ.add(tX)),n=Math.max(n,r.distanceToSquared(tZ))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let r=e.array,n=t.position.array,i=t.normal.array,s=t.uv.array,a=n.length/3;void 0===t.tangent&&this.setAttribute("tangent",new tB(new Float32Array(4*a),4));let o=t.tangent.array,l=[],h=[];for(let e=0;e<a;e++)l[e]=new eS,h[e]=new eS;let c=new eS,u=new eS,d=new eS,p=new ep,f=new ep,m=new ep,g=new eS,v=new eS,y=this.groups;0===y.length&&(y=[{start:0,count:r.length}]);for(let e=0,t=y.length;e<t;++e){let t=y[e],i=t.start,a=t.count;for(let e=i,t=i+a;e<t;e+=3)!function(e,t,r){c.fromArray(n,3*e),u.fromArray(n,3*t),d.fromArray(n,3*r),p.fromArray(s,2*e),f.fromArray(s,2*t),m.fromArray(s,2*r),u.sub(c),d.sub(c),f.sub(p),m.sub(p);let i=1/(f.x*m.y-m.x*f.y);isFinite(i)&&(g.copy(u).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(i),v.copy(d).multiplyScalar(f.x).addScaledVector(u,-m.x).multiplyScalar(i),l[e].add(g),l[t].add(g),l[r].add(g),h[e].add(v),h[t].add(v),h[r].add(v))}(r[e+0],r[e+1],r[e+2])}let x=new eS,_=new eS,b=new eS,w=new eS;function S(e){b.fromArray(i,3*e),w.copy(b);let t=l[e];x.copy(t),x.sub(b.multiplyScalar(b.dot(t))).normalize(),_.crossVectors(w,t);let r=_.dot(h[e]);o[4*e]=x.x,o[4*e+1]=x.y,o[4*e+2]=x.z,o[4*e+3]=r<0?-1:1}for(let e=0,t=y.length;e<t;++e){let t=y[e],n=t.start,i=t.count;for(let e=n,t=n+i;e<t;e+=3)S(r[e+0]),S(r[e+1]),S(r[e+2])}}computeVertexNormals(){let e=this.index,t=this.getAttribute("position");if(void 0!==t){let r=this.getAttribute("normal");if(void 0===r)r=new tB(new Float32Array(3*t.count),3),this.setAttribute("normal",r);else for(let e=0,t=r.count;e<t;e++)r.setXYZ(e,0,0,0);let n=new eS,i=new eS,s=new eS,a=new eS,o=new eS,l=new eS,h=new eS,c=new eS;if(e)for(let u=0,d=e.count;u<d;u+=3){let d=e.getX(u+0),p=e.getX(u+1),f=e.getX(u+2);n.fromBufferAttribute(t,d),i.fromBufferAttribute(t,p),s.fromBufferAttribute(t,f),h.subVectors(s,i),c.subVectors(n,i),h.cross(c),a.fromBufferAttribute(r,d),o.fromBufferAttribute(r,p),l.fromBufferAttribute(r,f),a.add(h),o.add(h),l.add(h),r.setXYZ(d,a.x,a.y,a.z),r.setXYZ(p,o.x,o.y,o.z),r.setXYZ(f,l.x,l.y,l.z)}else for(let e=0,a=t.count;e<a;e+=3)n.fromBufferAttribute(t,e+0),i.fromBufferAttribute(t,e+1),s.fromBufferAttribute(t,e+2),h.subVectors(s,i),c.subVectors(n,i),h.cross(c),r.setXYZ(e+0,h.x,h.y,h.z),r.setXYZ(e+1,h.x,h.y,h.z),r.setXYZ(e+2,h.x,h.y,h.z);this.normalizeNormals(),r.needsUpdate=!0}}merge(e,t){if(!(e&&e.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);return}void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));let r=this.attributes;for(let n in r){if(void 0===e.attributes[n])continue;let i=r[n].array,s=e.attributes[n],a=s.array,o=s.itemSize*t,l=Math.min(a.length,i.length-o);for(let e=0,t=o;e<l;e++,t++)i[t]=a[e]}return this}normalizeNormals(){let e=this.attributes.normal;for(let t=0,r=e.count;t<r;t++)tZ.fromBufferAttribute(e,t),tZ.normalize(),e.setXYZ(t,tZ.x,tZ.y,tZ.z)}toNonIndexed(){function e(e,t){let r=e.array,n=e.itemSize,i=e.normalized,s=new r.constructor(t.length*n),a=0,o=0;for(let i=0,l=t.length;i<l;i++){a=e.isInterleavedBufferAttribute?t[i]*e.data.stride+e.offset:t[i]*n;for(let e=0;e<n;e++)s[o++]=r[a++]}return new tB(s,n,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let t=new t$,r=this.index.array,n=this.attributes;for(let i in n){let s=e(n[i],r);t.setAttribute(i,s)}let i=this.morphAttributes;for(let n in i){let s=[],a=i[n];for(let t=0,n=a.length;t<n;t++){let n=e(a[t],r);s.push(n)}t.morphAttributes[n]=s}t.morphTargetsRelative=this.morphTargetsRelative;let s=this.groups;for(let e=0,r=s.length;e<r;e++){let r=s[e];t.addGroup(r.start,r.count,r.materialIndex)}return t}toJSON(){let e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){let t=this.parameters;for(let r in t)void 0!==t[r]&&(e[r]=t[r]);return e}e.data={attributes:{}};let t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});let r=this.attributes;for(let t in r){let n=r[t];e.data.attributes[t]=n.toJSON(e.data)}let n={},i=!1;for(let t in this.morphAttributes){let r=this.morphAttributes[t],s=[];for(let t=0,n=r.length;t<n;t++){let n=r[t];s.push(n.toJSON(e.data))}s.length>0&&(n[t]=s,i=!0)}i&&(e.data.morphAttributes=n,e.data.morphTargetsRelative=this.morphTargetsRelative);let s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));let a=this.boundingSphere;return null!==a&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new t$().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let t={};this.name=e.name;let r=e.index;null!==r&&this.setIndex(r.clone(t));let n=e.attributes;for(let e in n){let r=n[e];this.setAttribute(e,r.clone(t))}let i=e.morphAttributes;for(let e in i){let r=[],n=i[e];for(let e=0,i=n.length;e<i;e++)r.push(n[e].clone(t));this.morphAttributes[e]=r}this.morphTargetsRelative=e.morphTargetsRelative;let s=e.groups;for(let e=0,t=s.length;e<t;e++){let t=s[e];this.addGroup(t.start,t.count,t.materialIndex)}let a=e.boundingBox;null!==a&&(this.boundingBox=a.clone());let o=e.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}t$.prototype.isBufferGeometry=!0;const tK=new e0,tQ=new eQ,t0=new ej,t1=new eS,t2=new eS,t3=new eS,t4=new eS,t5=new eS,t6=new eS,t8=new eS,t7=new eS,t9=new eS,re=new ep,rt=new ep,rr=new ep,rn=new eS,ri=new eS;class rs extends tm{constructor(e=new t$,t=new tO){super(),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){let e=this.geometry;if(e.isBufferGeometry){let t=e.morphAttributes,r=Object.keys(t);if(r.length>0){let e=t[r[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,r=e.length;t<r;t++){let r=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=t}}}}else{let t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,t){let r;let n=this.geometry,i=this.material,s=this.matrixWorld;if(void 0!==i&&(null===n.boundingSphere&&n.computeBoundingSphere(),t0.copy(n.boundingSphere),t0.applyMatrix4(s),!1!==e.ray.intersectsSphere(t0))){if(tK.copy(s).invert(),tQ.copy(e.ray).applyMatrix4(tK),null!==n.boundingBox&&!1===tQ.intersectsBox(n.boundingBox))return;if(n.isBufferGeometry){let s=n.index,a=n.attributes.position,o=n.morphAttributes.position,l=n.morphTargetsRelative,h=n.attributes.uv,c=n.attributes.uv2,u=n.groups,d=n.drawRange;if(null!==s){if(Array.isArray(i))for(let n=0,p=u.length;n<p;n++){let p=u[n],f=i[p.materialIndex],m=Math.max(p.start,d.start),g=Math.min(p.start+p.count,d.start+d.count);for(let n=m;n<g;n+=3)(r=ra(this,f,e,tQ,a,o,l,h,c,s.getX(n),s.getX(n+1),s.getX(n+2)))&&(r.faceIndex=Math.floor(n/3),r.face.materialIndex=p.materialIndex,t.push(r))}else{let n=Math.max(0,d.start),u=Math.min(s.count,d.start+d.count);for(let d=n;d<u;d+=3)(r=ra(this,i,e,tQ,a,o,l,h,c,s.getX(d),s.getX(d+1),s.getX(d+2)))&&(r.faceIndex=Math.floor(d/3),t.push(r))}}else if(void 0!==a){if(Array.isArray(i))for(let n=0,s=u.length;n<s;n++){let s=u[n],p=i[s.materialIndex],f=Math.max(s.start,d.start),m=Math.min(s.start+s.count,d.start+d.count);for(let n=f;n<m;n+=3)(r=ra(this,p,e,tQ,a,o,l,h,c,n,n+1,n+2))&&(r.faceIndex=Math.floor(n/3),r.face.materialIndex=s.materialIndex,t.push(r))}else{let n=Math.max(0,d.start),s=Math.min(a.count,d.start+d.count);for(let u=n;u<s;u+=3)(r=ra(this,i,e,tQ,a,o,l,h,c,u,u+1,u+2))&&(r.faceIndex=Math.floor(u/3),t.push(r))}}}else n.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function ra(e,t,r,n,i,s,a,o,l,h,c,u){t1.fromBufferAttribute(i,h),t2.fromBufferAttribute(i,c),t3.fromBufferAttribute(i,u);let d=e.morphTargetInfluences;if(s&&d){t8.set(0,0,0),t7.set(0,0,0),t9.set(0,0,0);for(let e=0,t=s.length;e<t;e++){let t=d[e],r=s[e];0!==t&&(t4.fromBufferAttribute(r,h),t5.fromBufferAttribute(r,c),t6.fromBufferAttribute(r,u),a?(t8.addScaledVector(t4,t),t7.addScaledVector(t5,t),t9.addScaledVector(t6,t)):(t8.addScaledVector(t4.sub(t1),t),t7.addScaledVector(t5.sub(t2),t),t9.addScaledVector(t6.sub(t3),t)))}t1.add(t8),t2.add(t7),t3.add(t9)}e.isSkinnedMesh&&(e.boneTransform(h,t1),e.boneTransform(c,t2),e.boneTransform(u,t3));let p=function(e,t,r,n,i,s,a,o){if(null===(1===t.side?n.intersectTriangle(a,s,i,!0,o):n.intersectTriangle(i,s,a,2!==t.side,o)))return null;ri.copy(o),ri.applyMatrix4(e.matrixWorld);let l=r.ray.origin.distanceTo(ri);return l<r.near||l>r.far?null:{distance:l,point:ri.clone(),object:e}}(e,t,r,n,t1,t2,t3,rn);if(p){o&&(re.fromBufferAttribute(o,h),rt.fromBufferAttribute(o,c),rr.fromBufferAttribute(o,u),p.uv=tE.getUV(rn,t1,t2,t3,re,rt,rr,new ep)),l&&(re.fromBufferAttribute(l,h),rt.fromBufferAttribute(l,c),rr.fromBufferAttribute(l,u),p.uv2=tE.getUV(rn,t1,t2,t3,re,rt,rr,new ep));let e={a:h,b:c,c:u,normal:new eS,materialIndex:0};tE.getNormal(t1,t2,t3,e.normal),p.face=e}return p}rs.prototype.isMesh=!0;class ro extends t${constructor(e=1,t=1,r=1,n=1,i=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:n,heightSegments:i,depthSegments:s};let a=this;n=Math.floor(n),i=Math.floor(i);let o=[],l=[],h=[],c=[],u=0,d=0;function p(e,t,r,n,i,s,p,f,m,g,v){let y=s/m,x=p/g,_=s/2,b=p/2,w=f/2,S=m+1,T=g+1,E=0,A=0,C=new eS;for(let s=0;s<T;s++){let a=s*x-b;for(let o=0;o<S;o++){let u=o*y-_;C[e]=u*n,C[t]=a*i,C[r]=w,l.push(C.x,C.y,C.z),C[e]=0,C[t]=0,C[r]=f>0?1:-1,h.push(C.x,C.y,C.z),c.push(o/m),c.push(1-s/g),E+=1}}for(let e=0;e<g;e++)for(let t=0;t<m;t++){let r=u+t+S*e,n=u+t+S*(e+1),i=u+(t+1)+S*(e+1),s=u+(t+1)+S*e;o.push(r,n,s),o.push(n,i,s),A+=6}a.addGroup(d,A,v),d+=A,u+=E}p("z","y","x",-1,-1,r,t,e,s=Math.floor(s),i,0),p("z","y","x",1,-1,r,t,-e,s,i,1),p("x","z","y",1,1,e,r,t,n,s,2),p("x","z","y",1,-1,e,r,-t,n,s,3),p("x","y","z",1,-1,e,t,r,n,i,4),p("x","y","z",-1,-1,e,t,-r,n,i,5),this.setIndex(o),this.setAttribute("position",new tH(l,3)),this.setAttribute("normal",new tH(h,3)),this.setAttribute("uv",new tH(c,2))}static fromJSON(e){return new ro(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function rl(e){let t={};for(let r in e)for(let n in t[r]={},e[r]){let i=e[r][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?t[r][n]=i.clone():Array.isArray(i)?t[r][n]=i.slice():t[r][n]=i}return t}function rh(e){let t={};for(let r=0;r<e.length;r++){let n=rl(e[r]);for(let e in n)t[e]=n[e]}return t}const rc={clone:rl,merge:rh};class ru extends tC{constructor(e){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=rl(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){let t=super.toJSON(e);for(let r in t.glslVersion=this.glslVersion,t.uniforms={},this.uniforms){let n=this.uniforms[r].value;n&&n.isTexture?t.uniforms[r]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[r]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[r]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[r]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[r]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[r]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[r]={type:"m4",value:n.toArray()}:t.uniforms[r]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;let r={};for(let e in this.extensions)!0===this.extensions[e]&&(r[e]=!0);return Object.keys(r).length>0&&(t.extensions=r),t}}ru.prototype.isShaderMaterial=!0;class rd extends tm{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new e0,this.projectionMatrix=new e0,this.projectionMatrixInverse=new e0}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}rd.prototype.isCamera=!0;class rp extends rd{constructor(e=50,t=1,r=.1,n=2e3){super(),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=n,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){let t=.5*this.getFilmHeight()/e;this.fov=2*ei*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){let e=Math.tan(.5*en*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*ei*Math.atan(Math.tan(.5*en*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,r,n,i,s){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,t=e*Math.tan(.5*en*this.fov)/this.zoom,r=2*t,n=this.aspect*r,i=-.5*n,s=this.view;if(null!==this.view&&this.view.enabled){let e=s.fullWidth,a=s.fullHeight;i+=s.offsetX*n/e,t-=s.offsetY*r/a,n*=s.width/e,r*=s.height/a}let a=this.filmOffset;0!==a&&(i+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+n,t,t-r,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}rp.prototype.isPerspectiveCamera=!0;class rf extends tm{constructor(e,t,r){if(super(),this.type="CubeCamera",!0!==r.isWebGLCubeRenderTarget){console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");return}this.renderTarget=r;let n=new rp(90,1,e,t);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new eS(1,0,0)),this.add(n);let i=new rp(90,1,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new eS(-1,0,0)),this.add(i);let s=new rp(90,1,e,t);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new eS(0,1,0)),this.add(s);let a=new rp(90,1,e,t);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new eS(0,-1,0)),this.add(a);let o=new rp(90,1,e,t);o.layers=this.layers,o.up.set(0,-1,0),o.lookAt(new eS(0,0,1)),this.add(o);let l=new rp(90,1,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new eS(0,0,-1)),this.add(l)}update(e,t){null===this.parent&&this.updateMatrixWorld();let r=this.renderTarget,[n,i,s,a,o,l]=this.children,h=e.xr.enabled,c=e.getRenderTarget();e.xr.enabled=!1;let u=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0),e.render(t,n),e.setRenderTarget(r,1),e.render(t,i),e.setRenderTarget(r,2),e.render(t,s),e.setRenderTarget(r,3),e.render(t,a),e.setRenderTarget(r,4),e.render(t,o),r.texture.generateMipmaps=u,e.setRenderTarget(r,5),e.render(t,l),e.setRenderTarget(c),e.xr.enabled=h}}class rm extends ev{constructor(e,t,r,n,i,s,a,o,l,h){super(e=void 0!==e?e:[],t=void 0!==t?t:301,r,n,i,s,a=void 0!==a?a:1022,o,l,h),this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}rm.prototype.isCubeTexture=!0;class rg extends e_{constructor(e,t,r){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=r),super(e,e,t),t=t||{},this.texture=new rm(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:1006,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=1023,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;let r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},n=new ro(5,5,5),i=new ru({name:"CubemapFromEquirect",uniforms:rl(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:1,blending:0});i.uniforms.tEquirect.value=t;let s=new rs(n,i),a=t.minFilter;return 1008===t.minFilter&&(t.minFilter=1006),new rf(1,10,this).update(e,s),t.minFilter=a,s.geometry.dispose(),s.material.dispose(),this}clear(e,t,r,n){let i=e.getRenderTarget();for(let i=0;i<6;i++)e.setRenderTarget(this,i),e.clear(t,r,n);e.setRenderTarget(i)}}rg.prototype.isWebGLCubeRenderTarget=!0;const rv=new eS,ry=new eS,rx=new ef;class r_{constructor(e=new eS(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,r,n){return this.normal.set(e,t,r),this.constant=n,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,r){let n=rv.subVectors(r,t).cross(ry.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(n,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){let r=e.delta(rv),n=this.normal.dot(r);if(0===n)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;let i=-(e.start.dot(this.normal)+this.constant)/n;return i<0||i>1?null:t.copy(r).multiplyScalar(i).add(e.start)}intersectsLine(e){let t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){let r=t||rx.getNormalMatrix(e),n=this.coplanarPoint(rv).applyMatrix4(e),i=this.normal.applyMatrix3(r).normalize();return this.constant=-n.dot(i),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}r_.prototype.isPlane=!0;const rb=new ej,rw=new eS;class rS{constructor(e=new r_,t=new r_,r=new r_,n=new r_,i=new r_,s=new r_){this.planes=[e,t,r,n,i,s]}set(e,t,r,n,i,s){let a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(r),a[3].copy(n),a[4].copy(i),a[5].copy(s),this}copy(e){let t=this.planes;for(let r=0;r<6;r++)t[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e){let t=this.planes,r=e.elements,n=r[0],i=r[1],s=r[2],a=r[3],o=r[4],l=r[5],h=r[6],c=r[7],u=r[8],d=r[9],p=r[10],f=r[11],m=r[12],g=r[13],v=r[14],y=r[15];return t[0].setComponents(a-n,c-o,f-u,y-m).normalize(),t[1].setComponents(a+n,c+o,f+u,y+m).normalize(),t[2].setComponents(a+i,c+l,f+d,y+g).normalize(),t[3].setComponents(a-i,c-l,f-d,y-g).normalize(),t[4].setComponents(a-s,c-h,f-p,y-v).normalize(),t[5].setComponents(a+s,c+h,f+p,y+v).normalize(),this}intersectsObject(e){let t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),rb.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(rb)}intersectsSprite(e){return rb.center.set(0,0,0),rb.radius=.7071067811865476,rb.applyMatrix4(e.matrixWorld),this.intersectsSphere(rb)}intersectsSphere(e){let t=this.planes,r=e.center,n=-e.radius;for(let e=0;e<6;e++)if(t[e].distanceToPoint(r)<n)return!1;return!0}intersectsBox(e){let t=this.planes;for(let r=0;r<6;r++){let n=t[r];if(rw.x=n.normal.x>0?e.max.x:e.min.x,rw.y=n.normal.y>0?e.max.y:e.min.y,rw.z=n.normal.z>0?e.max.z:e.min.z,0>n.distanceToPoint(rw))return!1}return!0}containsPoint(e){let t=this.planes;for(let r=0;r<6;r++)if(0>t[r].distanceToPoint(e))return!1;return!0}clone(){return new this.constructor().copy(this)}}function rM(){let e=null,t=!1,r=null,n=null;function i(t,s){r(t,s),n=e.requestAnimationFrame(i)}return{start:function(){!0!==t&&null!==r&&(n=e.requestAnimationFrame(i),t=!0)},stop:function(){e.cancelAnimationFrame(n),t=!1},setAnimationLoop:function(e){r=e},setContext:function(t){e=t}}}function rT(e,t){let r=t.isWebGL2,n=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),n.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);let r=n.get(t);r&&(e.deleteBuffer(r.buffer),n.delete(t))},update:function(t,i){if(t.isGLBufferAttribute){let e=n.get(t);(!e||e.version<t.version)&&n.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version});return}t.isInterleavedBufferAttribute&&(t=t.data);let s=n.get(t);void 0===s?n.set(t,function(t,n){let i=t.array,s=t.usage,a=e.createBuffer();e.bindBuffer(n,a),e.bufferData(n,i,s),t.onUploadCallback();let o=5126;return i instanceof Float32Array?o=5126:i instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):i instanceof Uint16Array?t.isFloat16BufferAttribute?r?o=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):o=5123:i instanceof Int16Array?o=5122:i instanceof Uint32Array?o=5125:i instanceof Int32Array?o=5124:i instanceof Int8Array?o=5120:i instanceof Uint8Array?o=5121:i instanceof Uint8ClampedArray&&(o=5121),{buffer:a,type:o,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version}}(t,i)):s.version<t.version&&(!function(t,n,i){let s=n.array,a=n.updateRange;e.bindBuffer(i,t),-1===a.count?e.bufferSubData(i,0,s):(r?e.bufferSubData(i,a.offset*s.BYTES_PER_ELEMENT,s,a.offset,a.count):e.bufferSubData(i,a.offset*s.BYTES_PER_ELEMENT,s.subarray(a.offset,a.offset+a.count)),a.count=-1)}(s.buffer,t,i),s.version=t.version)}}}class rE extends t${constructor(e=1,t=1,r=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:n};let i=e/2,s=t/2,a=Math.floor(r),o=Math.floor(n),l=a+1,h=o+1,c=e/a,u=t/o,d=[],p=[],f=[],m=[];for(let e=0;e<h;e++){let t=e*u-s;for(let r=0;r<l;r++){let n=r*c-i;p.push(n,-t,0),f.push(0,0,1),m.push(r/a),m.push(1-e/o)}}for(let e=0;e<o;e++)for(let t=0;t<a;t++){let r=t+l*e,n=t+l*(e+1),i=t+1+l*(e+1),s=t+1+l*e;d.push(r,n,s),d.push(n,i,s)}this.setIndex(d),this.setAttribute("position",new tH(p,3)),this.setAttribute("normal",new tH(f,3)),this.setAttribute("uv",new tH(m,2))}static fromJSON(e){return new rE(e.width,e.height,e.widthSegments,e.heightSegments)}}const rA={alphamap_fragment:"#ifdef USE_ALPHAMAP\n	diffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n	uniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n	if ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n	uniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n	reflectedLight.indirectDiffuse *= ambientOcclusion;\n	#if defined( USE_ENVMAP ) && defined( STANDARD )\n		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n	#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n	uniform sampler2D aoMap;\n	uniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n	vec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n	return RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n	float a2 = pow2( alpha );\n	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n	return 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n	float a2 = pow2( alpha );\n	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n	return RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n	float alpha = pow2( roughness );\n	vec3 halfDir = normalize( incidentLight.direction + viewDir );\n	float dotNL = saturate( dot( normal, incidentLight.direction ) );\n	float dotNV = saturate( dot( normal, viewDir ) );\n	float dotNH = saturate( dot( normal, halfDir ) );\n	float dotVH = saturate( dot( viewDir, halfDir ) );\n	vec3 F = F_Schlick( f0, f90, dotVH );\n	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n	float D = D_GGX( alpha, dotNH );\n	return F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n	const float LUT_SIZE = 64.0;\n	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n	const float LUT_BIAS = 0.5 / LUT_SIZE;\n	float dotNV = saturate( dot( N, V ) );\n	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n	uv = uv * LUT_SCALE + LUT_BIAS;\n	return uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n	float l = length( f );\n	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n	float x = dot( v1, v2 );\n	float y = abs( x );\n	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n	float b = 3.4175940 + ( 4.1616724 + y ) * y;\n	float v = a / b;\n	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n	return cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n	vec3 lightNormal = cross( v1, v2 );\n	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n	vec3 T1, T2;\n	T1 = normalize( V - N * dot( V, N ) );\n	T2 = - cross( N, T1 );\n	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n	vec3 coords[ 4 ];\n	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n	coords[ 0 ] = normalize( coords[ 0 ] );\n	coords[ 1 ] = normalize( coords[ 1 ] );\n	coords[ 2 ] = normalize( coords[ 2 ] );\n	coords[ 3 ] = normalize( coords[ 3 ] );\n	vec3 vectorFormFactor = vec3( 0.0 );\n	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n	return vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n	return 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n	vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n	float dotNH = saturate( dot( geometry.normal, halfDir ) );\n	float dotVH = saturate( dot( geometry.viewDir, halfDir ) );\n	vec3 F = F_Schlick( specularColor, 1.0, dotVH );\n	float G = G_BlinnPhong_Implicit( );\n	float D = D_BlinnPhong( shininess, dotNH );\n	return F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float NoH ) {\n	float invAlpha = 1.0 / roughness;\n	float cos2h = NoH * NoH;\n	float sin2h = max( 1.0 - cos2h, 0.0078125 );\n	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float NoV, float NoL ) {\n	return saturate( 1.0 / ( 4.0 * ( NoL + NoV - NoL * NoV ) ) );\n}\nvec3 BRDF_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n	vec3 N = geometry.normal;\n	vec3 V = geometry.viewDir;\n	vec3 H = normalize( V + L );\n	float dotNH = saturate( dot( N, H ) );\n	return specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n	uniform sampler2D bumpMap;\n	uniform float bumpScale;\n	vec2 dHdxy_fwd() {\n		vec2 dSTdx = dFdx( vUv );\n		vec2 dSTdy = dFdy( vUv );\n		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n		return vec2( dBx, dBy );\n	}\n	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n		vec3 vN = surf_norm;\n		vec3 R1 = cross( vSigmaY, vN );\n		vec3 R2 = cross( vN, vSigmaX );\n		float fDet = dot( vSigmaX, R1 ) * faceDirection;\n		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n		return normalize( abs( fDet ) * surf_norm - vGrad );\n	}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n	vec4 plane;\n	#pragma unroll_loop_start\n	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n		plane = clippingPlanes[ i ];\n		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n	}\n	#pragma unroll_loop_end\n	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n		bool clipped = true;\n		#pragma unroll_loop_start\n		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n			plane = clippingPlanes[ i ];\n			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n		}\n		#pragma unroll_loop_end\n		if ( clipped ) discard;\n	#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n	varying vec3 vClipPosition;\n	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n	varying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n	vClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n	diffuseColor *= vColor;\n#elif defined( USE_COLOR )\n	diffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n	varying vec4 vColor;\n#elif defined( USE_COLOR )\n	varying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n	varying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n	varying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n	vColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n	vColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n	vColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n	vColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n	const highp float a = 12.9898, b = 78.233, c = 43758.5453;\n	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n	return fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n	float precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n	float precisionSafeLength( vec3 v ) {\n		float maxComponent = max3( abs( v ) );\n		return length( v / maxComponent ) * maxComponent;\n	}\n#endif\nstruct IncidentLight {\n	vec3 color;\n	vec3 direction;\n	bool visible;\n};\nstruct ReflectedLight {\n	vec3 directDiffuse;\n	vec3 directSpecular;\n	vec3 indirectDiffuse;\n	vec3 indirectSpecular;\n};\nstruct GeometricContext {\n	vec3 position;\n	vec3 normal;\n	vec3 viewDir;\n#ifdef USE_CLEARCOAT\n	vec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n	mat3 tmp;\n	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n	return tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n	return dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n	return m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n	return vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n	#define cubeUV_maxMipLevel 8.0\n	#define cubeUV_minMipLevel 4.0\n	#define cubeUV_maxTileSize 256.0\n	#define cubeUV_minTileSize 16.0\n	float getFace( vec3 direction ) {\n		vec3 absDirection = abs( direction );\n		float face = - 1.0;\n		if ( absDirection.x > absDirection.z ) {\n			if ( absDirection.x > absDirection.y )\n				face = direction.x > 0.0 ? 0.0 : 3.0;\n			else\n				face = direction.y > 0.0 ? 1.0 : 4.0;\n		} else {\n			if ( absDirection.z > absDirection.y )\n				face = direction.z > 0.0 ? 2.0 : 5.0;\n			else\n				face = direction.y > 0.0 ? 1.0 : 4.0;\n		}\n		return face;\n	}\n	vec2 getUV( vec3 direction, float face ) {\n		vec2 uv;\n		if ( face == 0.0 ) {\n			uv = vec2( direction.z, direction.y ) / abs( direction.x );\n		} else if ( face == 1.0 ) {\n			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n		} else if ( face == 2.0 ) {\n			uv = vec2( - direction.x, direction.y ) / abs( direction.z );\n		} else if ( face == 3.0 ) {\n			uv = vec2( - direction.z, direction.y ) / abs( direction.x );\n		} else if ( face == 4.0 ) {\n			uv = vec2( - direction.x, direction.z ) / abs( direction.y );\n		} else {\n			uv = vec2( direction.x, direction.y ) / abs( direction.z );\n		}\n		return 0.5 * ( uv + 1.0 );\n	}\n	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n		float face = getFace( direction );\n		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n		mipInt = max( mipInt, cubeUV_minMipLevel );\n		float faceSize = exp2( mipInt );\n		float texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n		vec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n		vec2 f = fract( uv );\n		uv += 0.5 - f;\n		if ( face > 2.0 ) {\n			uv.y += faceSize;\n			face -= 3.0;\n		}\n		uv.x += face * faceSize;\n		if ( mipInt < cubeUV_maxMipLevel ) {\n			uv.y += 2.0 * cubeUV_maxTileSize;\n		}\n		uv.y += filterInt * 2.0 * cubeUV_minTileSize;\n		uv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n		uv *= texelSize;\n		vec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n		uv.x += texelSize;\n		vec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n		uv.y += texelSize;\n		vec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n		uv.x -= texelSize;\n		vec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n		vec3 tm = mix( tl, tr, f.x );\n		vec3 bm = mix( bl, br, f.x );\n		return mix( tm, bm, f.y );\n	}\n	#define r0 1.0\n	#define v0 0.339\n	#define m0 - 2.0\n	#define r1 0.8\n	#define v1 0.276\n	#define m1 - 1.0\n	#define r4 0.4\n	#define v4 0.046\n	#define m4 2.0\n	#define r5 0.305\n	#define v5 0.016\n	#define m5 3.0\n	#define r6 0.21\n	#define v6 0.0038\n	#define m6 4.0\n	float roughnessToMip( float roughness ) {\n		float mip = 0.0;\n		if ( roughness >= r1 ) {\n			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n		} else if ( roughness >= r4 ) {\n			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n		} else if ( roughness >= r5 ) {\n			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n		} else if ( roughness >= r6 ) {\n			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n		} else {\n			mip = - 2.0 * log2( 1.16 * roughness );		}\n		return mip;\n	}\n	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n		float mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n		float mipF = fract( mip );\n		float mipInt = floor( mip );\n		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n		if ( mipF == 0.0 ) {\n			return vec4( color0, 1.0 );\n		} else {\n			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n			return vec4( mix( color0, color1, mipF ), 1.0 );\n		}\n	}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n	mat3 m = mat3( instanceMatrix );\n	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n	transformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n	transformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n	#ifdef FLIP_SIDED\n		transformedTangent = - transformedTangent;\n	#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n	uniform sampler2D displacementMap;\n	uniform float displacementScale;\n	uniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n	vec4 emissiveColor = texture2D( emissiveMap, vUv );\n	emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n	totalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n	uniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n	return value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n	return vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n	return vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n	return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n	float maxComponent = max( max( value.r, value.g ), value.b );\n	float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n	return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n	return vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n	float maxRGB = max( value.r, max( value.g, value.b ) );\n	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n	M = ceil( M * 255.0 ) / 255.0;\n	return vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n	return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n	float maxRGB = max( value.r, max( value.g, value.b ) );\n	float D = max( maxRange / maxRGB, 1.0 );\n	D = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n	return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n	vec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n	Xp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n	vec4 vResult;\n	vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n	float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n	vResult.w = fract( Le );\n	vResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n	return vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n	float Le = value.z * 255.0 + value.w;\n	vec3 Xp_Y_XYZp;\n	Xp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n	Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n	Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n	vec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n	return vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n	#ifdef ENV_WORLDPOS\n		vec3 cameraToFrag;\n		if ( isOrthographic ) {\n			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n		} else {\n			cameraToFrag = normalize( vWorldPosition - cameraPosition );\n		}\n		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n		#ifdef ENVMAP_MODE_REFLECTION\n			vec3 reflectVec = reflect( cameraToFrag, worldNormal );\n		#else\n			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n		#endif\n	#else\n		vec3 reflectVec = vReflect;\n	#endif\n	#ifdef ENVMAP_TYPE_CUBE\n		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n		envColor = envMapTexelToLinear( envColor );\n	#elif defined( ENVMAP_TYPE_CUBE_UV )\n		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n	#else\n		vec4 envColor = vec4( 0.0 );\n	#endif\n	#ifdef ENVMAP_BLENDING_MULTIPLY\n		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n	#elif defined( ENVMAP_BLENDING_MIX )\n		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n	#elif defined( ENVMAP_BLENDING_ADD )\n		outgoingLight += envColor.xyz * specularStrength * reflectivity;\n	#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n	uniform float envMapIntensity;\n	uniform float flipEnvMap;\n	uniform int maxMipLevel;\n	#ifdef ENVMAP_TYPE_CUBE\n		uniform samplerCube envMap;\n	#else\n		uniform sampler2D envMap;\n	#endif\n	\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n	uniform float reflectivity;\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n		#define ENV_WORLDPOS\n	#endif\n	#ifdef ENV_WORLDPOS\n		varying vec3 vWorldPosition;\n		uniform float refractionRatio;\n	#else\n		varying vec3 vReflect;\n	#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n		#define ENV_WORLDPOS\n	#endif\n	#ifdef ENV_WORLDPOS\n		\n		varying vec3 vWorldPosition;\n	#else\n		varying vec3 vReflect;\n		uniform float refractionRatio;\n	#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n	#ifdef ENVMAP_MODE_REFRACTION\n		uniform float refractionRatio;\n	#endif\n	vec3 getIBLIrradiance( const in GeometricContext geometry ) {\n		#if defined( ENVMAP_TYPE_CUBE_UV )\n			vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n			return PI * envMapColor.rgb * envMapIntensity;\n		#else\n			return vec3( 0.0 );\n		#endif\n	}\n	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n		#if defined( ENVMAP_TYPE_CUBE_UV )\n			vec3 reflectVec;\n			#ifdef ENVMAP_MODE_REFLECTION\n				reflectVec = reflect( - viewDir, normal );\n				reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n			#else\n				reflectVec = refract( - viewDir, normal, refractionRatio );\n			#endif\n			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n			return envMapColor.rgb * envMapIntensity;\n		#else\n			return vec3( 0.0 );\n		#endif\n	}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n	#ifdef ENV_WORLDPOS\n		vWorldPosition = worldPosition.xyz;\n	#else\n		vec3 cameraToVertex;\n		if ( isOrthographic ) {\n			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n		} else {\n			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n		}\n		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n		#ifdef ENVMAP_MODE_REFLECTION\n			vReflect = reflect( cameraToVertex, worldNormal );\n		#else\n			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n		#endif\n	#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n	vFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n	varying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n	#ifdef FOG_EXP2\n		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n	#else\n		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n	#endif\n	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n	uniform vec3 fogColor;\n	varying float vFogDepth;\n	#ifdef FOG_EXP2\n		uniform float fogDensity;\n	#else\n		uniform float fogNear;\n		uniform float fogFar;\n	#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n	uniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n	float dotNL = dot( normal, lightDirection );\n	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n	#ifdef USE_GRADIENTMAP\n		return texture2D( gradientMap, coord ).rgb;\n	#else\n		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n	#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n	vec4 lightMapTexel = texture2D( lightMap, vUv2 );\n	vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n	#ifndef PHYSICALLY_CORRECT_LIGHTS\n		lightMapIrradiance *= PI;\n	#endif\n	reflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n	uniform sampler2D lightMap;\n	uniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n	vLightBack = vec3( 0.0 );\n	vIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n		getPointLightInfo( pointLights[ i ], geometry, directLight );\n		dotNL = dot( geometry.normal, directLight.direction );\n		directLightColor_Diffuse = directLight.color;\n		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n		#ifdef DOUBLE_SIDED\n			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n		#endif\n	}\n	#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n		getSpotLightInfo( spotLights[ i ], geometry, directLight );\n		dotNL = dot( geometry.normal, directLight.direction );\n		directLightColor_Diffuse = directLight.color;\n		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n		#ifdef DOUBLE_SIDED\n			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n		#endif\n	}\n	#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n		getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n		dotNL = dot( geometry.normal, directLight.direction );\n		directLightColor_Diffuse = directLight.color;\n		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n		#ifdef DOUBLE_SIDED\n			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n		#endif\n	}\n	#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n		#ifdef DOUBLE_SIDED\n			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n		#endif\n	}\n	#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n	float x = normal.x, y = normal.y, z = normal.z;\n	vec3 result = shCoefficients[ 0 ] * 0.886227;\n	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n	return result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n	vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n	return irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n	vec3 irradiance = ambientLightColor;\n	return irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n	#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n		if ( cutoffDistance > 0.0 ) {\n			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n		}\n		return distanceFalloff;\n	#else\n		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n		}\n		return 1.0;\n	#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n	return smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n	struct DirectionalLight {\n		vec3 direction;\n		vec3 color;\n	};\n	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n		light.color = directionalLight.color;\n		light.direction = directionalLight.direction;\n		light.visible = true;\n	}\n#endif\n#if NUM_POINT_LIGHTS > 0\n	struct PointLight {\n		vec3 position;\n		vec3 color;\n		float distance;\n		float decay;\n	};\n	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n		vec3 lVector = pointLight.position - geometry.position;\n		light.direction = normalize( lVector );\n		float lightDistance = length( lVector );\n		light.color = pointLight.color;\n		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n		light.visible = ( light.color != vec3( 0.0 ) );\n	}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n	struct SpotLight {\n		vec3 position;\n		vec3 direction;\n		vec3 color;\n		float distance;\n		float decay;\n		float coneCos;\n		float penumbraCos;\n	};\n	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n		vec3 lVector = spotLight.position - geometry.position;\n		light.direction = normalize( lVector );\n		float angleCos = dot( light.direction, spotLight.direction );\n		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n		if ( spotAttenuation > 0.0 ) {\n			float lightDistance = length( lVector );\n			light.color = spotLight.color * spotAttenuation;\n			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n			light.visible = ( light.color != vec3( 0.0 ) );\n		} else {\n			light.color = vec3( 0.0 );\n			light.visible = false;\n		}\n	}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n	struct RectAreaLight {\n		vec3 color;\n		vec3 position;\n		vec3 halfWidth;\n		vec3 halfHeight;\n	};\n	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;\n	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n	struct HemisphereLight {\n		vec3 direction;\n		vec3 skyColor;\n		vec3 groundColor;\n	};\n	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n		float dotNL = dot( geometry.normal, hemiLight.direction );\n		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n		return irradiance;\n	}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n	vec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct				RE_Direct_Toon\n#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )	(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n	vec3 diffuseColor;\n	vec3 specularColor;\n	float specularShininess;\n	float specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n	vec3 irradiance = dotNL * directLight.color;\n	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct				RE_Direct_BlinnPhong\n#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )	(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n	#ifdef SPECULAR\n		float specularIntensityFactor = specularIntensity;\n		vec3 specularTintFactor = specularTint;\n		#ifdef USE_SPECULARINTENSITYMAP\n			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n		#endif\n		#ifdef USE_SPECULARTINTMAP\n			specularTintFactor *= specularTintMapTexelToLinear( texture2D( specularTintMap, vUv ) ).rgb;\n		#endif\n		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n	#else\n		float specularIntensityFactor = 1.0;\n		vec3 specularTintFactor = vec3( 1.0 );\n		material.specularF90 = 1.0;\n	#endif\n	material.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularTintFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n	material.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n	material.clearcoat = clearcoat;\n	material.clearcoatRoughness = clearcoatRoughness;\n	material.clearcoatF0 = vec3( 0.04 );\n	material.clearcoatF90 = 1.0;\n	#ifdef USE_CLEARCOATMAP\n		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n	#endif\n	#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n	#endif\n	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n	material.clearcoatRoughness += geometryRoughness;\n	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n	material.sheenTint = sheenTint;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n	vec3 diffuseColor;\n	float roughness;\n	vec3 specularColor;\n	float specularF90;\n	#ifdef USE_CLEARCOAT\n		float clearcoat;\n		float clearcoatRoughness;\n		vec3 clearcoatF0;\n		float clearcoatF90;\n	#endif\n	#ifdef USE_SHEEN\n		vec3 sheenTint;\n	#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n	float dotNV = saturate( dot( normal, viewDir ) );\n	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n	vec4 r = roughness * c0 + c1;\n	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n	return fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n	vec2 fab = DFGApprox( normal, viewDir, roughness );\n	return specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n	vec2 fab = DFGApprox( normal, viewDir, roughness );\n	vec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n	float Ess = fab.x + fab.y;\n	float Ems = 1.0 - Ess;\n	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n	singleScatter += FssEss;\n	multiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n		vec3 normal = geometry.normal;\n		vec3 viewDir = geometry.viewDir;\n		vec3 position = geometry.position;\n		vec3 lightPos = rectAreaLight.position;\n		vec3 halfWidth = rectAreaLight.halfWidth;\n		vec3 halfHeight = rectAreaLight.halfHeight;\n		vec3 lightColor = rectAreaLight.color;\n		float roughness = material.roughness;\n		vec3 rectCoords[ 4 ];\n		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n		vec2 uv = LTC_Uv( normal, viewDir, roughness );\n		vec4 t1 = texture2D( ltc_1, uv );\n		vec4 t2 = texture2D( ltc_2, uv );\n		mat3 mInv = mat3(\n			vec3( t1.x, 0, t1.y ),\n			vec3(    0, 1,    0 ),\n			vec3( t1.z, 0, t1.w )\n		);\n		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n	}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n	vec3 irradiance = dotNL * directLight.color;\n	#ifdef USE_CLEARCOAT\n		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n		vec3 ccIrradiance = dotNLcc * directLight.color;\n		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n	#endif\n	#ifdef USE_SHEEN\n		reflectedLight.directSpecular += irradiance * BRDF_Sheen( material.roughness, directLight.direction, geometry, material.sheenTint );\n	#else\n		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n	#endif\n	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n	#ifdef USE_CLEARCOAT\n		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n	#endif\n	vec3 singleScattering = vec3( 0.0 );\n	vec3 multiScattering = vec3( 0.0 );\n	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n	computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n	reflectedLight.indirectSpecular += radiance * singleScattering;\n	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct				RE_Direct_Physical\n#define RE_Direct_RectArea		RE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular		RE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n	geometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n	PointLight pointLight;\n	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n	PointLightShadow pointLightShadow;\n	#endif\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n		pointLight = pointLights[ i ];\n		getPointLightInfo( pointLight, geometry, directLight );\n		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n		pointLightShadow = pointLightShadows[ i ];\n		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n		#endif\n		RE_Direct( directLight, geometry, material, reflectedLight );\n	}\n	#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n	SpotLight spotLight;\n	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n	SpotLightShadow spotLightShadow;\n	#endif\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n		spotLight = spotLights[ i ];\n		getSpotLightInfo( spotLight, geometry, directLight );\n		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n		spotLightShadow = spotLightShadows[ i ];\n		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n		#endif\n		RE_Direct( directLight, geometry, material, reflectedLight );\n	}\n	#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n	DirectionalLight directionalLight;\n	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n	DirectionalLightShadow directionalLightShadow;\n	#endif\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n		directionalLight = directionalLights[ i ];\n		getDirectionalLightInfo( directionalLight, geometry, directLight );\n		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n		directionalLightShadow = directionalLightShadows[ i ];\n		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n		#endif\n		RE_Direct( directLight, geometry, material, reflectedLight );\n	}\n	#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n	RectAreaLight rectAreaLight;\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n		rectAreaLight = rectAreaLights[ i ];\n		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n	}\n	#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n	vec3 iblIrradiance = vec3( 0.0 );\n	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n	irradiance += getLightProbeIrradiance( lightProbe, geometry );\n	#if ( NUM_HEMI_LIGHTS > 0 )\n		#pragma unroll_loop_start\n		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n		}\n		#pragma unroll_loop_end\n	#endif\n#endif\n#if defined( RE_IndirectSpecular )\n	vec3 radiance = vec3( 0.0 );\n	vec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n	#ifdef USE_LIGHTMAP\n		vec4 lightMapTexel = texture2D( lightMap, vUv2 );\n		vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n		#ifndef PHYSICALLY_CORRECT_LIGHTS\n			lightMapIrradiance *= PI;\n		#endif\n		irradiance += lightMapIrradiance;\n	#endif\n	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n		iblIrradiance += getIBLIrradiance( geometry );\n	#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n	#ifdef USE_CLEARCOAT\n		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n	#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n	uniform float logDepthBufFC;\n	varying float vFragDepth;\n	varying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n	#ifdef USE_LOGDEPTHBUF_EXT\n		varying float vFragDepth;\n		varying float vIsPerspective;\n	#else\n		uniform float logDepthBufFC;\n	#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n	#ifdef USE_LOGDEPTHBUF_EXT\n		vFragDepth = 1.0 + gl_Position.w;\n		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n	#else\n		if ( isPerspectiveMatrix( projectionMatrix ) ) {\n			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n			gl_Position.z *= gl_Position.w;\n		}\n	#endif\n#endif",map_fragment:"#ifdef USE_MAP\n	vec4 texelColor = texture2D( map, vUv );\n	texelColor = mapTexelToLinear( texelColor );\n	diffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n	uniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n	vec4 mapTexel = texture2D( map, uv );\n	diffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n	diffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n	uniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n	uniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n	uniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n	vec4 texelMetalness = texture2D( metalnessMap, vUv );\n	metalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n	uniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n	objectNormal *= morphTargetBaseInfluence;\n	objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n	objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n	objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n	objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n	uniform float morphTargetBaseInfluence;\n	#ifndef USE_MORPHNORMALS\n		uniform float morphTargetInfluences[ 8 ];\n	#else\n		uniform float morphTargetInfluences[ 4 ];\n	#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n	transformed *= morphTargetBaseInfluence;\n	transformed += morphTarget0 * morphTargetInfluences[ 0 ];\n	transformed += morphTarget1 * morphTargetInfluences[ 1 ];\n	transformed += morphTarget2 * morphTargetInfluences[ 2 ];\n	transformed += morphTarget3 * morphTargetInfluences[ 3 ];\n	#ifndef USE_MORPHNORMALS\n		transformed += morphTarget4 * morphTargetInfluences[ 4 ];\n		transformed += morphTarget5 * morphTargetInfluences[ 5 ];\n		transformed += morphTarget6 * morphTargetInfluences[ 6 ];\n		transformed += morphTarget7 * morphTargetInfluences[ 7 ];\n	#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n	vec3 normal = normalize( cross( fdx, fdy ) );\n#else\n	vec3 normal = normalize( vNormal );\n	#ifdef DOUBLE_SIDED\n		normal = normal * faceDirection;\n	#endif\n	#ifdef USE_TANGENT\n		vec3 tangent = normalize( vTangent );\n		vec3 bitangent = normalize( vBitangent );\n		#ifdef DOUBLE_SIDED\n			tangent = tangent * faceDirection;\n			bitangent = bitangent * faceDirection;\n		#endif\n		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n			mat3 vTBN = mat3( tangent, bitangent, normal );\n		#endif\n	#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n	#ifdef FLIP_SIDED\n		normal = - normal;\n	#endif\n	#ifdef DOUBLE_SIDED\n		normal = normal * faceDirection;\n	#endif\n	normal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n	mapN.xy *= normalScale;\n	#ifdef USE_TANGENT\n		normal = normalize( vTBN * mapN );\n	#else\n		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n	#endif\n#elif defined( USE_BUMPMAP )\n	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n	varying vec3 vNormal;\n	#ifdef USE_TANGENT\n		varying vec3 vTangent;\n		varying vec3 vBitangent;\n	#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n	varying vec3 vNormal;\n	#ifdef USE_TANGENT\n		varying vec3 vTangent;\n		varying vec3 vBitangent;\n	#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n	vNormal = normalize( transformedNormal );\n	#ifdef USE_TANGENT\n		vTangent = normalize( transformedTangent );\n		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n	#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n	uniform sampler2D normalMap;\n	uniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n	uniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n		vec2 st0 = dFdx( vUv.st );\n		vec2 st1 = dFdy( vUv.st );\n		vec3 N = surf_norm;\n		vec3 q1perp = cross( q1, N );\n		vec3 q0perp = cross( N, q0 );\n		vec3 T = q1perp * st0.x + q0perp * st1.x;\n		vec3 B = q1perp * st0.y + q0perp * st1.y;\n		float det = max( dot( T, T ), dot( B, B ) );\n		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n	}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n	vec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n	clearcoatMapN.xy *= clearcoatNormalScale;\n	#ifdef USE_TANGENT\n		clearcoatNormal = normalize( vTBN * clearcoatMapN );\n	#else\n		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n	#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n	uniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n	uniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n	uniform sampler2D clearcoatNormalMap;\n	uniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n	return normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n	return 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n	vec4 r = vec4( fract( v * PackFactors ), v );\n	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n	return dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n	return ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n	return linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n	return ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n	gl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n	mvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n	gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n	vec3 dithering( vec3 color ) {\n		float grid_position = rand( gl_FragCoord.xy );\n		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n		return color + dither_shift_RGB;\n	}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n	vec4 texelRoughness = texture2D( roughnessMap, vUv );\n	roughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n	uniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n	#if NUM_DIR_LIGHT_SHADOWS > 0\n		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n		struct DirectionalLightShadow {\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n		};\n		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n	#endif\n	#if NUM_SPOT_LIGHT_SHADOWS > 0\n		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n		struct SpotLightShadow {\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n		};\n		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n	#endif\n	#if NUM_POINT_LIGHT_SHADOWS > 0\n		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n		struct PointLightShadow {\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n			float shadowCameraNear;\n			float shadowCameraFar;\n		};\n		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n	#endif\n	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n	}\n	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n		return unpackRGBATo2Half( texture2D( shadow, uv ) );\n	}\n	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n		float occlusion = 1.0;\n		vec2 distribution = texture2DDistribution( shadow, uv );\n		float hard_shadow = step( compare , distribution.x );\n		if (hard_shadow != 1.0 ) {\n			float distance = compare - distribution.x ;\n			float variance = max( 0.00000, distribution.y * distribution.y );\n			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n		}\n		return occlusion;\n	}\n	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n		float shadow = 1.0;\n		shadowCoord.xyz /= shadowCoord.w;\n		shadowCoord.z += shadowBias;\n		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n		bool inFrustum = all( inFrustumVec );\n		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n		bool frustumTest = all( frustumTestVec );\n		if ( frustumTest ) {\n		#if defined( SHADOWMAP_TYPE_PCF )\n			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n			float dx0 = - texelSize.x * shadowRadius;\n			float dy0 = - texelSize.y * shadowRadius;\n			float dx1 = + texelSize.x * shadowRadius;\n			float dy1 = + texelSize.y * shadowRadius;\n			float dx2 = dx0 / 2.0;\n			float dy2 = dy0 / 2.0;\n			float dx3 = dx1 / 2.0;\n			float dy3 = dy1 / 2.0;\n			shadow = (\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n			) * ( 1.0 / 17.0 );\n		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n			float dx = texelSize.x;\n			float dy = texelSize.y;\n			vec2 uv = shadowCoord.xy;\n			vec2 f = fract( uv * shadowMapSize + 0.5 );\n			uv -= f * texelSize;\n			shadow = (\n				texture2DCompare( shadowMap, uv, shadowCoord.z ) +\n				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n					 f.x ) +\n				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n					 f.x ) +\n				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n					 f.y ) +\n				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n					 f.y ) +\n				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n						  f.x ),\n					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n						  f.x ),\n					 f.y )\n			) * ( 1.0 / 9.0 );\n		#elif defined( SHADOWMAP_TYPE_VSM )\n			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n		#else\n			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n		#endif\n		}\n		return shadow;\n	}\n	vec2 cubeToUV( vec3 v, float texelSizeY ) {\n		vec3 absV = abs( v );\n		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n		absV *= scaleToCube;\n		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n		vec2 planar = v.xy;\n		float almostATexel = 1.5 * texelSizeY;\n		float almostOne = 1.0 - almostATexel;\n		if ( absV.z >= almostOne ) {\n			if ( v.z > 0.0 )\n				planar.x = 4.0 - v.x;\n		} else if ( absV.x >= almostOne ) {\n			float signX = sign( v.x );\n			planar.x = v.z * signX + 2.0 * signX;\n		} else if ( absV.y >= almostOne ) {\n			float signY = sign( v.y );\n			planar.x = v.x + 2.0 * signY + 2.0;\n			planar.y = v.z * signY - 2.0;\n		}\n		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n	}\n	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n		vec3 lightToPosition = shadowCoord.xyz;\n		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;\n		vec3 bd3D = normalize( lightToPosition );\n		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n			return (\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n			) * ( 1.0 / 9.0 );\n		#else\n			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n		#endif\n	}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n	#if NUM_DIR_LIGHT_SHADOWS > 0\n		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n		struct DirectionalLightShadow {\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n		};\n		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n	#endif\n	#if NUM_SPOT_LIGHT_SHADOWS > 0\n		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n		struct SpotLightShadow {\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n		};\n		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n	#endif\n	#if NUM_POINT_LIGHT_SHADOWS > 0\n		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n		struct PointLightShadow {\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n			float shadowCameraNear;\n			float shadowCameraFar;\n		};\n		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n	#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n		vec4 shadowWorldPosition;\n	#endif\n	#if NUM_DIR_LIGHT_SHADOWS > 0\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n	}\n	#pragma unroll_loop_end\n	#endif\n	#if NUM_SPOT_LIGHT_SHADOWS > 0\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n	}\n	#pragma unroll_loop_end\n	#endif\n	#if NUM_POINT_LIGHT_SHADOWS > 0\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n	}\n	#pragma unroll_loop_end\n	#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n	float shadow = 1.0;\n	#ifdef USE_SHADOWMAP\n	#if NUM_DIR_LIGHT_SHADOWS > 0\n	DirectionalLightShadow directionalLight;\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n		directionalLight = directionalLightShadows[ i ];\n		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n	}\n	#pragma unroll_loop_end\n	#endif\n	#if NUM_SPOT_LIGHT_SHADOWS > 0\n	SpotLightShadow spotLight;\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n		spotLight = spotLightShadows[ i ];\n		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n	}\n	#pragma unroll_loop_end\n	#endif\n	#if NUM_POINT_LIGHT_SHADOWS > 0\n	PointLightShadow pointLight;\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n		pointLight = pointLightShadows[ i ];\n		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n	}\n	#pragma unroll_loop_end\n	#endif\n	#endif\n	return shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n	mat4 boneMatX = getBoneMatrix( skinIndex.x );\n	mat4 boneMatY = getBoneMatrix( skinIndex.y );\n	mat4 boneMatZ = getBoneMatrix( skinIndex.z );\n	mat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n	uniform mat4 bindMatrix;\n	uniform mat4 bindMatrixInverse;\n	#ifdef BONE_TEXTURE\n		uniform highp sampler2D boneTexture;\n		uniform int boneTextureSize;\n		mat4 getBoneMatrix( const in float i ) {\n			float j = i * 4.0;\n			float x = mod( j, float( boneTextureSize ) );\n			float y = floor( j / float( boneTextureSize ) );\n			float dx = 1.0 / float( boneTextureSize );\n			float dy = 1.0 / float( boneTextureSize );\n			y = dy * ( y + 0.5 );\n			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n			mat4 bone = mat4( v1, v2, v3, v4 );\n			return bone;\n		}\n	#else\n		uniform mat4 boneMatrices[ MAX_BONES ];\n		mat4 getBoneMatrix( const in float i ) {\n			mat4 bone = boneMatrices[ int(i) ];\n			return bone;\n		}\n	#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n	vec4 skinned = vec4( 0.0 );\n	skinned += boneMatX * skinVertex * skinWeight.x;\n	skinned += boneMatY * skinVertex * skinWeight.y;\n	skinned += boneMatZ * skinVertex * skinWeight.z;\n	skinned += boneMatW * skinVertex * skinWeight.w;\n	transformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n	mat4 skinMatrix = mat4( 0.0 );\n	skinMatrix += skinWeight.x * boneMatX;\n	skinMatrix += skinWeight.y * boneMatY;\n	skinMatrix += skinWeight.z * boneMatZ;\n	skinMatrix += skinWeight.w * boneMatW;\n	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n	#ifdef USE_TANGENT\n		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n	#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n	vec4 texelSpecular = texture2D( specularMap, vUv );\n	specularStrength = texelSpecular.r;\n#else\n	specularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n	uniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n	return toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n	color *= toneMappingExposure;\n	return saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n	color *= toneMappingExposure;\n	color = max( vec3( 0.0 ), color - 0.004 );\n	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n	return a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n	const mat3 ACESInputMat = mat3(\n		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),\n		vec3( 0.04823, 0.01566, 0.83777 )\n	);\n	const mat3 ACESOutputMat = mat3(\n		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),\n		vec3( -0.07367, -0.00605,  1.07602 )\n	);\n	color *= toneMappingExposure / 0.6;\n	color = ACESInputMat * color;\n	color = RRTAndODTFit( color );\n	color = ACESOutputMat * color;\n	return saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n	float transmissionAlpha = 1.0;\n	float transmissionFactor = transmission;\n	float thicknessFactor = thickness;\n	#ifdef USE_TRANSMISSIONMAP\n		transmissionFactor *= texture2D( transmissionMap, vUv ).r;\n	#endif\n	#ifdef USE_THICKNESSMAP\n		thicknessFactor *= texture2D( thicknessMap, vUv ).g;\n	#endif\n	vec3 pos = vWorldPosition;\n	vec3 v = normalize( cameraPosition - pos );\n	vec3 n = inverseTransformDirection( normal, viewMatrix );\n	vec4 transmission = getIBLVolumeRefraction(\n		n, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n		pos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n		attenuationTint, attenuationDistance );\n	totalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n	transmissionAlpha = transmission.a;\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n	uniform float transmission;\n	uniform float thickness;\n	uniform float attenuationDistance;\n	uniform vec3 attenuationTint;\n	#ifdef USE_TRANSMISSIONMAP\n		uniform sampler2D transmissionMap;\n	#endif\n	#ifdef USE_THICKNESSMAP\n		uniform sampler2D thicknessMap;\n	#endif\n	uniform vec2 transmissionSamplerSize;\n	uniform sampler2D transmissionSamplerMap;\n	uniform mat4 modelMatrix;\n	uniform mat4 projectionMatrix;\n	varying vec3 vWorldPosition;\n	vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {\n		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n		vec3 modelScale;\n		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n		return normalize( refractionVector ) * thickness * modelScale;\n	}\n	float applyIorToRoughness( float roughness, float ior ) {\n		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n	}\n	vec4 getTransmissionSample( vec2 fragCoord, float roughness, float ior ) {\n		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n		#ifdef TEXTURE_LOD_EXT\n			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n		#else\n			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n		#endif\n	}\n	vec3 applyVolumeAttenuation( vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance ) {\n		if ( attenuationDistance == 0.0 ) {\n			return radiance;\n		} else {\n			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;\n		}\n	}\n	vec4 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 diffuseColor, vec3 specularColor, float specularF90,\n		vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,\n		vec3 attenuationColor, float attenuationDistance ) {\n		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n		vec3 refractedRayExit = position + transmissionRay;\n		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n		vec2 refractionCoords = ndcPos.xy / ndcPos.w;\n		refractionCoords += 1.0;\n		refractionCoords /= 2.0;\n		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n	}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n	varying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n	#ifdef UVS_VERTEX_ONLY\n		vec2 vUv;\n	#else\n		varying vec2 vUv;\n	#endif\n	uniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n	varying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n	attribute vec2 uv2;\n	varying vec2 vUv2;\n	uniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n	vec4 worldPosition = vec4( transformed, 1.0 );\n	#ifdef USE_INSTANCING\n		worldPosition = instanceMatrix * worldPosition;\n	#endif\n	worldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n	vec4 texColor = texture2D( t2D, vUv );\n	gl_FragColor = mapTexelToLinear( texColor );\n	#include <tonemapping_fragment>\n	#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n	gl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n	vec3 vReflect = vWorldDirection;\n	#include <envmap_fragment>\n	gl_FragColor = envColor;\n	gl_FragColor.a *= opacity;\n	#include <tonemapping_fragment>\n	#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n	vWorldDirection = transformDirection( position, modelMatrix );\n	#include <begin_vertex>\n	#include <project_vertex>\n	gl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n	uniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n	#include <clipping_planes_fragment>\n	vec4 diffuseColor = vec4( 1.0 );\n	#if DEPTH_PACKING == 3200\n		diffuseColor.a = opacity;\n	#endif\n	#include <map_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <logdepthbuf_fragment>\n	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n	#if DEPTH_PACKING == 3200\n		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n	#elif DEPTH_PACKING == 3201\n		gl_FragColor = packDepthToRGBA( fragCoordZ );\n	#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n	#include <uv_vertex>\n	#include <skinbase_vertex>\n	#ifdef USE_DISPLACEMENTMAP\n		#include <beginnormal_vertex>\n		#include <morphnormal_vertex>\n		#include <skinnormal_vertex>\n	#endif\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n	#include <clipping_planes_fragment>\n	vec4 diffuseColor = vec4( 1.0 );\n	#include <map_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	float dist = length( vWorldPosition - referencePosition );\n	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n	dist = saturate( dist );\n	gl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <skinbase_vertex>\n	#ifdef USE_DISPLACEMENTMAP\n		#include <beginnormal_vertex>\n		#include <morphnormal_vertex>\n		#include <skinnormal_vertex>\n	#endif\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <worldpos_vertex>\n	#include <clipping_planes_vertex>\n	vWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n	vec3 direction = normalize( vWorldDirection );\n	vec2 sampleUV = equirectUv( direction );\n	vec4 texColor = texture2D( tEquirect, sampleUV );\n	gl_FragColor = mapTexelToLinear( texColor );\n	#include <tonemapping_fragment>\n	#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n	vWorldDirection = transformDirection( position, modelMatrix );\n	#include <begin_vertex>\n	#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	#include <clipping_planes_fragment>\n	if ( mod( vLineDistance, totalSize ) > dashSize ) {\n		discard;\n	}\n	vec3 outgoingLight = vec3( 0.0 );\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <logdepthbuf_fragment>\n	#include <color_fragment>\n	outgoingLight = diffuseColor.rgb;\n	#include <output_fragment>\n	#include <tonemapping_fragment>\n	#include <encodings_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	vLineDistance = scale * lineDistance;\n	#include <color_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n	varying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	#include <clipping_planes_fragment>\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <specularmap_fragment>\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	#ifdef USE_LIGHTMAP\n		vec4 lightMapTexel= texture2D( lightMap, vUv2 );\n		reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n	#else\n		reflectedLight.indirectDiffuse += vec3( 1.0 );\n	#endif\n	#include <aomap_fragment>\n	reflectedLight.indirectDiffuse *= diffuseColor.rgb;\n	vec3 outgoingLight = reflectedLight.indirectDiffuse;\n	#include <envmap_fragment>\n	#include <output_fragment>\n	#include <tonemapping_fragment>\n	#include <encodings_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <uv2_vertex>\n	#include <color_vertex>\n	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n		#include <beginnormal_vertex>\n		#include <morphnormal_vertex>\n		#include <skinbase_vertex>\n		#include <skinnormal_vertex>\n		#include <defaultnormal_vertex>\n	#endif\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <worldpos_vertex>\n	#include <envmap_vertex>\n	#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n	varying vec3 vLightBack;\n	varying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	#include <clipping_planes_fragment>\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <specularmap_fragment>\n	#include <emissivemap_fragment>\n	#ifdef DOUBLE_SIDED\n		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n	#else\n		reflectedLight.indirectDiffuse += vIndirectFront;\n	#endif\n	#include <lightmap_fragment>\n	reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n	#ifdef DOUBLE_SIDED\n		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n	#else\n		reflectedLight.directDiffuse = vLightFront;\n	#endif\n	reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n	#include <aomap_fragment>\n	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n	#include <envmap_fragment>\n	#include <output_fragment>\n	#include <tonemapping_fragment>\n	#include <encodings_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n	varying vec3 vLightBack;\n	varying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <uv2_vertex>\n	#include <color_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <worldpos_vertex>\n	#include <envmap_vertex>\n	#include <lights_lambert_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	#include <clipping_planes_fragment>\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	vec3 viewDir = normalize( vViewPosition );\n	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n	vec3 y = cross( viewDir, x );\n	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n	#ifdef USE_MATCAP\n		vec4 matcapColor = texture2D( matcap, uv );\n		matcapColor = matcapTexelToLinear( matcapColor );\n	#else\n		vec4 matcapColor = vec4( 1.0 );\n	#endif\n	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n	#include <output_fragment>\n	#include <tonemapping_fragment>\n	#include <encodings_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <fog_vertex>\n	vViewPosition = - mvPosition.xyz;\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n	varying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	#include <clipping_planes_fragment>\n	#include <logdepthbuf_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n	varying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n	vViewPosition = - mvPosition.xyz;\n#endif\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	#include <clipping_planes_fragment>\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <specularmap_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_phong_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n	#include <envmap_fragment>\n	#include <output_fragment>\n	#include <tonemapping_fragment>\n	#include <encodings_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <uv2_vertex>\n	#include <color_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <envmap_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n	#define IOR\n	#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n	uniform float ior;\n#endif\n#ifdef SPECULAR\n	uniform float specularIntensity;\n	uniform vec3 specularTint;\n	#ifdef USE_SPECULARINTENSITYMAP\n		uniform sampler2D specularIntensityMap;\n	#endif\n	#ifdef USE_SPECULARTINTMAP\n		uniform sampler2D specularTintMap;\n	#endif\n#endif\n#ifdef USE_CLEARCOAT\n	uniform float clearcoat;\n	uniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n	uniform vec3 sheenTint;\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	#include <clipping_planes_fragment>\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <roughnessmap_fragment>\n	#include <metalnessmap_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <clearcoat_normal_fragment_begin>\n	#include <clearcoat_normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_physical_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n	#include <transmission_fragment>\n	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n	#ifdef USE_CLEARCOAT\n		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n		outgoingLight = outgoingLight * ( 1.0 - clearcoat * Fcc ) + clearcoatSpecular * clearcoat;\n	#endif\n	#include <output_fragment>\n	#include <tonemapping_fragment>\n	#include <encodings_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n	varying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <uv2_vertex>\n	#include <color_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n	vWorldPosition = worldPosition.xyz;\n#endif\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	#include <clipping_planes_fragment>\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_toon_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n	#include <output_fragment>\n	#include <tonemapping_fragment>\n	#include <encodings_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <uv2_vertex>\n	#include <color_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	#include <clipping_planes_fragment>\n	vec3 outgoingLight = vec3( 0.0 );\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <logdepthbuf_fragment>\n	#include <map_particle_fragment>\n	#include <color_fragment>\n	#include <alphatest_fragment>\n	outgoingLight = diffuseColor.rgb;\n	#include <output_fragment>\n	#include <tonemapping_fragment>\n	#include <encodings_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <color_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <project_vertex>\n	gl_PointSize = size;\n	#ifdef USE_SIZEATTENUATION\n		bool isPerspective = isPerspectiveMatrix( projectionMatrix );\n		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n	#endif\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <worldpos_vertex>\n	#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n	#include <tonemapping_fragment>\n	#include <encodings_fragment>\n	#include <fog_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n	#include <begin_vertex>\n	#include <project_vertex>\n	#include <worldpos_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	#include <clipping_planes_fragment>\n	vec3 outgoingLight = vec3( 0.0 );\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	outgoingLight = diffuseColor.rgb;\n	#include <output_fragment>\n	#include <tonemapping_fragment>\n	#include <encodings_fragment>\n	#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n	vec2 scale;\n	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n	#ifndef USE_SIZEATTENUATION\n		bool isPerspective = isPerspectiveMatrix( projectionMatrix );\n		if ( isPerspective ) scale *= - mvPosition.z;\n	#endif\n	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n	vec2 rotatedPosition;\n	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n	mvPosition.xy += rotatedPosition;\n	gl_Position = projectionMatrix * mvPosition;\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <fog_vertex>\n}"},rC={common:{diffuse:{value:new tU(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new ef},uv2Transform:{value:new ef},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new ep(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new tU(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new tU(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ef}},sprite:{diffuse:{value:new tU(16777215)},opacity:{value:1},center:{value:new ep(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ef}}},rR={basic:{uniforms:rh([rC.common,rC.specularmap,rC.envmap,rC.aomap,rC.lightmap,rC.fog]),vertexShader:rA.meshbasic_vert,fragmentShader:rA.meshbasic_frag},lambert:{uniforms:rh([rC.common,rC.specularmap,rC.envmap,rC.aomap,rC.lightmap,rC.emissivemap,rC.fog,rC.lights,{emissive:{value:new tU(0)}}]),vertexShader:rA.meshlambert_vert,fragmentShader:rA.meshlambert_frag},phong:{uniforms:rh([rC.common,rC.specularmap,rC.envmap,rC.aomap,rC.lightmap,rC.emissivemap,rC.bumpmap,rC.normalmap,rC.displacementmap,rC.fog,rC.lights,{emissive:{value:new tU(0)},specular:{value:new tU(1118481)},shininess:{value:30}}]),vertexShader:rA.meshphong_vert,fragmentShader:rA.meshphong_frag},standard:{uniforms:rh([rC.common,rC.envmap,rC.aomap,rC.lightmap,rC.emissivemap,rC.bumpmap,rC.normalmap,rC.displacementmap,rC.roughnessmap,rC.metalnessmap,rC.fog,rC.lights,{emissive:{value:new tU(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:rA.meshphysical_vert,fragmentShader:rA.meshphysical_frag},toon:{uniforms:rh([rC.common,rC.aomap,rC.lightmap,rC.emissivemap,rC.bumpmap,rC.normalmap,rC.displacementmap,rC.gradientmap,rC.fog,rC.lights,{emissive:{value:new tU(0)}}]),vertexShader:rA.meshtoon_vert,fragmentShader:rA.meshtoon_frag},matcap:{uniforms:rh([rC.common,rC.bumpmap,rC.normalmap,rC.displacementmap,rC.fog,{matcap:{value:null}}]),vertexShader:rA.meshmatcap_vert,fragmentShader:rA.meshmatcap_frag},points:{uniforms:rh([rC.points,rC.fog]),vertexShader:rA.points_vert,fragmentShader:rA.points_frag},dashed:{uniforms:rh([rC.common,rC.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:rA.linedashed_vert,fragmentShader:rA.linedashed_frag},depth:{uniforms:rh([rC.common,rC.displacementmap]),vertexShader:rA.depth_vert,fragmentShader:rA.depth_frag},normal:{uniforms:rh([rC.common,rC.bumpmap,rC.normalmap,rC.displacementmap,{opacity:{value:1}}]),vertexShader:rA.meshnormal_vert,fragmentShader:rA.meshnormal_frag},sprite:{uniforms:rh([rC.sprite,rC.fog]),vertexShader:rA.sprite_vert,fragmentShader:rA.sprite_frag},background:{uniforms:{uvTransform:{value:new ef},t2D:{value:null}},vertexShader:rA.background_vert,fragmentShader:rA.background_frag},cube:{uniforms:rh([rC.envmap,{opacity:{value:1}}]),vertexShader:rA.cube_vert,fragmentShader:rA.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:rA.equirect_vert,fragmentShader:rA.equirect_frag},distanceRGBA:{uniforms:rh([rC.common,rC.displacementmap,{referencePosition:{value:new eS},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:rA.distanceRGBA_vert,fragmentShader:rA.distanceRGBA_frag},shadow:{uniforms:rh([rC.lights,rC.fog,{color:{value:new tU(0)},opacity:{value:1}}]),vertexShader:rA.shadow_vert,fragmentShader:rA.shadow_frag}};function rL(e,t,r,n,i){let s,a;let o=new tU(0),l=0,h=null,c=0,u=null;function d(e,t){r.buffers.color.setClear(e.r,e.g,e.b,t,i)}return{getClearColor:function(){return o},setClearColor:function(e,t=1){o.set(e),d(o,l=t)},getClearAlpha:function(){return l},setClearAlpha:function(e){d(o,l=e)},render:function(r,i){let p=!1,f=!0===i.isScene?i.background:null;f&&f.isTexture&&(f=t.get(f));let m=e.xr,g=m.getSession&&m.getSession();g&&"additive"===g.environmentBlendMode&&(f=null),null===f?d(o,l):f&&f.isColor&&(d(f,1),p=!0),(e.autoClear||p)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),f&&(f.isCubeTexture||306===f.mapping)?(void 0===a&&((a=new rs(new ro(1,1,1),new ru({name:"BackgroundCubeMaterial",uniforms:rl(rR.cube.uniforms),vertexShader:rR.cube.vertexShader,fragmentShader:rR.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),a.geometry.deleteAttribute("uv"),a.onBeforeRender=function(e,t,r){this.matrixWorld.copyPosition(r.matrixWorld)},Object.defineProperty(a.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(a)),a.material.uniforms.envMap.value=f,a.material.uniforms.flipEnvMap.value=f.isCubeTexture&&!1===f.isRenderTargetTexture?-1:1,(h!==f||c!==f.version||u!==e.toneMapping)&&(a.material.needsUpdate=!0,h=f,c=f.version,u=e.toneMapping),r.unshift(a,a.geometry,a.material,0,0,null)):f&&f.isTexture&&(void 0===s&&((s=new rs(new rE(2,2),new ru({name:"BackgroundMaterial",uniforms:rl(rR.background.uniforms),vertexShader:rR.background.vertexShader,fragmentShader:rR.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(s.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(s)),s.material.uniforms.t2D.value=f,!0===f.matrixAutoUpdate&&f.updateMatrix(),s.material.uniforms.uvTransform.value.copy(f.matrix),(h!==f||c!==f.version||u!==e.toneMapping)&&(s.material.needsUpdate=!0,h=f,c=f.version,u=e.toneMapping),r.unshift(s,s.geometry,s.material,0,0,null))}}}function rI(e,t,r,n){let i=e.getParameter(34921),s=n.isWebGL2?null:t.get("OES_vertex_array_object"),a=n.isWebGL2||null!==s,o={},l=d(null),h=l;function c(t){return n.isWebGL2?e.bindVertexArray(t):s.bindVertexArrayOES(t)}function u(t){return n.isWebGL2?e.deleteVertexArray(t):s.deleteVertexArrayOES(t)}function d(e){let t=[],r=[],n=[];for(let e=0;e<i;e++)t[e]=0,r[e]=0,n[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:r,attributeDivisors:n,object:e,attributes:{},index:null}}function p(){let e=h.newAttributes;for(let t=0,r=e.length;t<r;t++)e[t]=0}function f(e){m(e,0)}function m(r,i){let s=h.newAttributes,a=h.enabledAttributes,o=h.attributeDivisors;s[r]=1,0===a[r]&&(e.enableVertexAttribArray(r),a[r]=1),o[r]!==i&&((n.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](r,i),o[r]=i)}function g(){let t=h.newAttributes,r=h.enabledAttributes;for(let n=0,i=r.length;n<i;n++)r[n]!==t[n]&&(e.disableVertexAttribArray(n),r[n]=0)}function v(t,r,i,s,a,o){!0===n.isWebGL2&&(5124===i||5125===i)?e.vertexAttribIPointer(t,r,i,a,o):e.vertexAttribPointer(t,r,i,s,a,o)}function y(){x(),h!==l&&c((h=l).object)}function x(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(i,l,u,y,x){let _=!1;if(a){let t=function(t,r,i){let a=!0===i.wireframe,l=o[t.id];void 0===l&&(l={},o[t.id]=l);let h=l[r.id];void 0===h&&(h={},l[r.id]=h);let c=h[a];return void 0===c&&(c=d(n.isWebGL2?e.createVertexArray():s.createVertexArrayOES()),h[a]=c),c}(y,u,l);h!==t&&c((h=t).object),(_=function(e,t){let r=h.attributes,n=e.attributes,i=0;for(let e in n){let t=r[e],s=n[e];if(void 0===t||t.attribute!==s||t.data!==s.data)return!0;i++}return h.attributesNum!==i||h.index!==t}(y,x))&&function(e,t){let r={},n=e.attributes,i=0;for(let e in n){let t=n[e],s={};s.attribute=t,t.data&&(s.data=t.data),r[e]=s,i++}h.attributes=r,h.attributesNum=i,h.index=t}(y,x)}else{let e=!0===l.wireframe;(h.geometry!==y.id||h.program!==u.id||h.wireframe!==e)&&(h.geometry=y.id,h.program=u.id,h.wireframe=e,_=!0)}!0===i.isInstancedMesh&&(_=!0),null!==x&&r.update(x,34963),_&&(function(i,s,a,o){if(!1===n.isWebGL2&&(i.isInstancedMesh||o.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;p();let l=o.attributes,h=a.getAttributes(),c=s.defaultAttributeValues;for(let t in h){let n=h[t];if(n.location>=0){let s=l[t];if(void 0===s&&("instanceMatrix"===t&&i.instanceMatrix&&(s=i.instanceMatrix),"instanceColor"===t&&i.instanceColor&&(s=i.instanceColor)),void 0!==s){let t=s.normalized,a=s.itemSize,l=r.get(s);if(void 0===l)continue;let h=l.buffer,c=l.type,u=l.bytesPerElement;if(s.isInterleavedBufferAttribute){let r=s.data,l=r.stride,d=s.offset;if(r&&r.isInstancedInterleavedBuffer){for(let e=0;e<n.locationSize;e++)m(n.location+e,r.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=r.meshPerAttribute*r.count)}else for(let e=0;e<n.locationSize;e++)f(n.location+e);e.bindBuffer(34962,h);for(let e=0;e<n.locationSize;e++)v(n.location+e,a/n.locationSize,c,t,l*u,(d+a/n.locationSize*e)*u)}else{if(s.isInstancedBufferAttribute){for(let e=0;e<n.locationSize;e++)m(n.location+e,s.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=s.meshPerAttribute*s.count)}else for(let e=0;e<n.locationSize;e++)f(n.location+e);e.bindBuffer(34962,h);for(let e=0;e<n.locationSize;e++)v(n.location+e,a/n.locationSize,c,t,a*u,a/n.locationSize*e*u)}}else if(void 0!==c){let r=c[t];if(void 0!==r)switch(r.length){case 2:e.vertexAttrib2fv(n.location,r);break;case 3:e.vertexAttrib3fv(n.location,r);break;case 4:e.vertexAttrib4fv(n.location,r);break;default:e.vertexAttrib1fv(n.location,r)}}}}g()}(i,l,u,y),null!==x&&e.bindBuffer(34963,r.get(x).buffer))},reset:y,resetDefaultState:x,dispose:function(){for(let e in y(),o){let t=o[e];for(let e in t){let r=t[e];for(let e in r)u(r[e].object),delete r[e];delete t[e]}delete o[e]}},releaseStatesOfGeometry:function(e){if(void 0===o[e.id])return;let t=o[e.id];for(let e in t){let r=t[e];for(let e in r)u(r[e].object),delete r[e];delete t[e]}delete o[e.id]},releaseStatesOfProgram:function(e){for(let t in o){let r=o[t];if(void 0===r[e.id])continue;let n=r[e.id];for(let e in n)u(n[e].object),delete n[e];delete r[e.id]}},initAttributes:p,enableAttribute:f,disableUnusedAttributes:g}}function rP(e,t,r,n){let i;let s=n.isWebGL2;this.setMode=function(e){i=e},this.render=function(t,n){e.drawArrays(i,t,n),r.update(n,i,1)},this.renderInstances=function(n,a,o){let l,h;if(0!==o){if(s)l=e,h="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),h="drawArraysInstancedANGLE",null===l){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}l[h](i,n,a,o),r.update(a,i,o)}}}function rk(e,t,r){let n;function i(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}let s="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext,a=void 0!==r.precision?r.precision:"highp",o=i(a);o!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",o,"instead."),a=o);let l=s||t.has("WEBGL_draw_buffers"),h=!0===r.logarithmicDepthBuffer,c=e.getParameter(34930),u=e.getParameter(35660),d=e.getParameter(3379),p=e.getParameter(34076),f=e.getParameter(34921),m=e.getParameter(36347),g=e.getParameter(36348),v=e.getParameter(36349),y=u>0,x=s||t.has("OES_texture_float"),_=s?e.getParameter(36183):0;return{isWebGL2:s,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==n)return n;if(!0===t.has("EXT_texture_filter_anisotropic")){let r=t.get("EXT_texture_filter_anisotropic");n=e.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n},getMaxPrecision:i,precision:a,logarithmicDepthBuffer:h,maxTextures:c,maxVertexTextures:u,maxTextureSize:d,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:y,floatFragmentTextures:x,floatVertexTextures:y&&x,maxSamples:_}}function rD(e){let t=this,r=null,n=0,i=!1,s=!1,a=new r_,o=new ef,l={value:null,needsUpdate:!1};function h(){l.value!==r&&(l.value=r,l.needsUpdate=n>0),t.numPlanes=n,t.numIntersection=0}function c(e,r,n,i){let s=null!==e?e.length:0,h=null;if(0!==s){if(h=l.value,!0!==i||null===h){let t=n+4*s,i=r.matrixWorldInverse;o.getNormalMatrix(i),(null===h||h.length<t)&&(h=new Float32Array(t));for(let t=0,r=n;t!==s;++t,r+=4)a.copy(e[t]).applyMatrix4(i,o),a.normal.toArray(h,r),h[r+3]=a.constant}l.value=h,l.needsUpdate=!0}return t.numPlanes=s,t.numIntersection=0,h}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,s){let a=0!==e.length||t||0!==n||i;return i=t,r=c(e,s,0),n=e.length,a},this.beginShadows=function(){s=!0,c(null)},this.endShadows=function(){s=!1,h()},this.setState=function(t,a,o){let u=t.clippingPlanes,d=t.clipIntersection,p=t.clipShadows,f=e.get(t);if(i&&null!==u&&0!==u.length&&(!s||p)){let e=s?0:n,t=4*e,i=f.clippingState||null;l.value=i,i=c(u,a,t,o);for(let e=0;e!==t;++e)i[e]=r[e];f.clippingState=i,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}else s?c(null):h()}}function rU(e){let t=new WeakMap;function r(e,t){return 303===t?e.mapping=301:304===t&&(e.mapping=302),e}function n(e){let r=e.target;r.removeEventListener("dispose",n);let i=t.get(r);void 0!==i&&(t.delete(r),i.dispose())}return{get:function(i){if(i&&i.isTexture&&!1===i.isRenderTargetTexture){let s=i.mapping;if(303===s||304===s){if(t.has(i))return r(t.get(i).texture,i.mapping);{let s=i.image;if(!s||!(s.height>0))return null;{let a=e.getRenderTarget(),o=new rg(s.height/2);return o.fromEquirectangularTexture(e,i),t.set(i,o),e.setRenderTarget(a),i.addEventListener("dispose",n),r(o.texture,i.mapping)}}}}return i},dispose:function(){t=new WeakMap}}}rR.physical={uniforms:rh([rR.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new ep(1,1)},clearcoatNormalMap:{value:null},sheenTint:{value:new tU(0)},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new ep},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationTint:{value:new tU(0)},specularIntensity:{value:0},specularIntensityMap:{value:null},specularTint:{value:new tU(1,1,1)},specularTintMap:{value:null}}]),vertexShader:rA.meshphysical_vert,fragmentShader:rA.meshphysical_frag};class rO extends rd{constructor(e=-1,t=1,r=1,n=-1,i=.1,s=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=r,this.bottom=n,this.near=i,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,r,n,i,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2,i=r-e,s=r+e,a=n+t,o=n-t;if(null!==this.view&&this.view.enabled){let e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=e*this.view.offsetX,s=i+e*this.view.width,a-=t*this.view.offsetY,o=a-t*this.view.height}this.projectionMatrix.makeOrthographic(i,s,a,o,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}rO.prototype.isOrthographicCamera=!0;class rN extends ru{constructor(e){super(e),this.type="RawShaderMaterial"}}rN.prototype.isRawShaderMaterial=!0;const rF=[.125,.215,.35,.446,.526,.582],rB=5+rF.length,rz={3e3:0,3001:1,3002:2,3004:3,3005:4,3006:5,3007:6},rG=new rO,{_lodPlanes:rH,_sizeLods:rV,_sigmas:rW}=function(){let e=[],t=[],r=[],n=8;for(let i=0;i<rB;i++){let s=Math.pow(2,n);t.push(s);let a=1/s;i>4?a=rF[i-8+4-1]:0==i&&(a=0),r.push(a);let o=1/(s-1),l=-o/2,h=1+o/2,c=[l,l,h,l,h,h,l,l,h,h,l,h],u=new Float32Array(108),d=new Float32Array(72),p=new Float32Array(36);for(let e=0;e<6;e++){let t=e%3*2/3-1,r=e>2?0:-1,n=[t,r,0,t+2/3,r,0,t+2/3,r+1,0,t,r,0,t+2/3,r+1,0,t,r+1,0];u.set(n,18*e),d.set(c,12*e);let i=[e,e,e,e,e,e];p.set(i,6*e)}let f=new t$;f.setAttribute("position",new tB(u,3)),f.setAttribute("uv",new tB(d,2)),f.setAttribute("faceIndex",new tB(p,1)),e.push(f),n>4&&n--}return{_lodPlanes:e,_sizeLods:t,_sigmas:r}}(),rj=new tU;let rq=null;const rX=(1+Math.sqrt(5))/2,rY=1/rX,rJ=[new eS(1,1,1),new eS(-1,1,1),new eS(1,1,-1),new eS(-1,1,-1),new eS(0,rX,rY),new eS(0,rX,-rY),new eS(rY,0,rX),new eS(-rY,0,rX),new eS(rX,rY,0),new eS(-rX,rY,0)];class rZ{constructor(e){var t;this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=(t=20,new rN({name:"SphericalGaussianBlur",defines:{n:20},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:new Float32Array(20)},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:new eS(0,1,0)},inputEncoding:{value:rz[3e3]},outputEncoding:{value:rz[3e3]}},vertexShader:r1(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			${r2()}

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:0,depthTest:!1,depthWrite:!1})),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,r=.1,n=100){rq=this._renderer.getRenderTarget();let i=this._allocateTargets();return this._sceneToCubeUV(e,r,n,i),t>0&&this._blur(i,0,0,t),this._applyPMREM(i),this._cleanup(i),i}fromEquirectangular(e){return this._fromTexture(e)}fromCubemap(e){return this._fromTexture(e)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=r0(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=rQ(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let e=0;e<rH.length;e++)rH[e].dispose()}_cleanup(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(rq),e.scissorTest=!1,rK(e,0,0,e.width,e.height)}_fromTexture(e){rq=this._renderer.getRenderTarget();let t=this._allocateTargets(e);return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t}_allocateTargets(e){let t={magFilter:1003,minFilter:1003,generateMipmaps:!1,type:1009,format:1023,encoding:void 0!==e&&1009===e.type&&(3e3===e.encoding||3001===e.encoding||3007===e.encoding)?e.encoding:3002,depthBuffer:!1},r=r$(t);return r.depthBuffer=!e,this._pingPongRenderTarget=r$(t),r}_compileMaterial(e){let t=new rs(rH[0],e);this._renderer.compile(t,rG)}_sceneToCubeUV(e,t,r,n){let i=new rp(90,1,t,r),s=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,h=o.outputEncoding,c=o.toneMapping;o.getClearColor(rj),o.toneMapping=0,o.outputEncoding=3e3,o.autoClear=!1;let u=new tO({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),d=new rs(new ro,u),p=!1,f=e.background;f?f.isColor&&(u.color.copy(f),e.background=null,p=!0):(u.color.copy(rj),p=!0);for(let t=0;t<6;t++){let r=t%3;0==r?(i.up.set(0,s[t],0),i.lookAt(a[t],0,0)):1==r?(i.up.set(0,0,s[t]),i.lookAt(0,a[t],0)):(i.up.set(0,s[t],0),i.lookAt(0,0,a[t])),rK(n,256*r,t>2?256:0,256,256),o.setRenderTarget(n),p&&o.render(d,i),o.render(e,i)}d.geometry.dispose(),d.material.dispose(),o.toneMapping=c,o.outputEncoding=h,o.autoClear=l,e.background=f}_textureToCubeUV(e,t){let r=this._renderer;e.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=r0()):null==this._equirectShader&&(this._equirectShader=rQ());let n=e.isCubeTexture?this._cubemapShader:this._equirectShader,i=new rs(rH[0],n),s=n.uniforms;s.envMap.value=e,e.isCubeTexture||s.texelSize.value.set(1/e.image.width,1/e.image.height),s.inputEncoding.value=rz[e.encoding],s.outputEncoding.value=rz[t.texture.encoding],rK(t,0,0,768,512),r.setRenderTarget(t),r.render(i,rG)}_applyPMREM(e){let t=this._renderer,r=t.autoClear;t.autoClear=!1;for(let t=1;t<rB;t++){let r=Math.sqrt(rW[t]*rW[t]-rW[t-1]*rW[t-1]),n=rJ[(t-1)%rJ.length];this._blur(e,t-1,t,r,n)}t.autoClear=r}_blur(e,t,r,n,i){let s=this._pingPongRenderTarget;this._halfBlur(e,s,t,r,n,"latitudinal",i),this._halfBlur(s,e,r,r,n,"longitudinal",i)}_halfBlur(e,t,r,n,i,s,a){let o=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");let h=new rs(rH[n],l),c=l.uniforms,u=rV[r]-1,d=isFinite(i)?Math.PI/(2*u):2*Math.PI/39,p=i/d,f=isFinite(i)?1+Math.floor(3*p):20;f>20&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);let m=[],g=0;for(let e=0;e<20;++e){let t=e/p,r=Math.exp(-t*t/2);m.push(r),0==e?g+=r:e<f&&(g+=2*r)}for(let e=0;e<m.length;e++)m[e]=m[e]/g;c.envMap.value=e.texture,c.samples.value=f,c.weights.value=m,c.latitudinal.value="latitudinal"===s,a&&(c.poleAxis.value=a),c.dTheta.value=d,c.mipInt.value=8-r,c.inputEncoding.value=rz[e.texture.encoding],c.outputEncoding.value=rz[e.texture.encoding];let v=rV[n];rK(t,3*Math.max(0,256-2*v),(0===n?0:512)+2*v*(n>4?n-8+4:0),3*v,2*v),o.setRenderTarget(t),o.render(h,rG)}}function r$(e){let t=new e_(768,768,e);return t.texture.mapping=306,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function rK(e,t,r,n,i){e.viewport.set(t,r,n,i),e.scissor.set(t,r,n,i)}function rQ(){return new rN({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:new ep(1,1)},inputEncoding:{value:rz[3e3]},outputEncoding:{value:rz[3e3]}},vertexShader:r1(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform vec2 texelSize;

			${r2()}

			#include <common>

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				vec2 f = fract( uv / texelSize - 0.5 );
				uv -= f * texelSize;
				vec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x += texelSize.x;
				vec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.y += texelSize.y;
				vec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x -= texelSize.x;
				vec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;

				vec3 tm = mix( tl, tr, f.x );
				vec3 bm = mix( bl, br, f.x );
				gl_FragColor.rgb = mix( tm, bm, f.y );

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:0,depthTest:!1,depthWrite:!1})}function r0(){return new rN({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:rz[3e3]},outputEncoding:{value:rz[3e3]}},vertexShader:r1(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			${r2()}

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;
				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:0,depthTest:!1,depthWrite:!1})}function r1(){return`

		precision mediump float;
		precision mediump int;

		attribute vec3 position;
		attribute vec2 uv;
		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function r2(){return`

		uniform int inputEncoding;
		uniform int outputEncoding;

		#include <encodings_pars_fragment>

		vec4 inputTexelToLinear( vec4 value ) {

			if ( inputEncoding == 0 ) {

				return value;

			} else if ( inputEncoding == 1 ) {

				return sRGBToLinear( value );

			} else if ( inputEncoding == 2 ) {

				return RGBEToLinear( value );

			} else if ( inputEncoding == 3 ) {

				return RGBMToLinear( value, 7.0 );

			} else if ( inputEncoding == 4 ) {

				return RGBMToLinear( value, 16.0 );

			} else if ( inputEncoding == 5 ) {

				return RGBDToLinear( value, 256.0 );

			} else {

				return GammaToLinear( value, 2.2 );

			}

		}

		vec4 linearToOutputTexel( vec4 value ) {

			if ( outputEncoding == 0 ) {

				return value;

			} else if ( outputEncoding == 1 ) {

				return LinearTosRGB( value );

			} else if ( outputEncoding == 2 ) {

				return LinearToRGBE( value );

			} else if ( outputEncoding == 3 ) {

				return LinearToRGBM( value, 7.0 );

			} else if ( outputEncoding == 4 ) {

				return LinearToRGBM( value, 16.0 );

			} else if ( outputEncoding == 5 ) {

				return LinearToRGBD( value, 256.0 );

			} else {

				return LinearToGamma( value, 2.2 );

			}

		}

		vec4 envMapTexelToLinear( vec4 color ) {

			return inputTexelToLinear( color );

		}
	`}function r3(e){let t=new WeakMap,r=null;function n(e){let r=e.target;r.removeEventListener("dispose",n);let i=t.get(r);void 0!==i&&(t.delete(r),i.dispose())}return{get:function(i){if(i&&i.isTexture&&!1===i.isRenderTargetTexture){let s=i.mapping,a=303===s||304===s,o=301===s||302===s;if(a||o){if(t.has(i))return t.get(i).texture;{let s=i.image;if(!(a&&s&&s.height>0||o&&s&&function(e){let t=0;for(let r=0;r<6;r++)void 0!==e[r]&&t++;return 6===t}(s)))return null;{let s=e.getRenderTarget();null===r&&(r=new rZ(e));let o=a?r.fromEquirectangular(i):r.fromCubemap(i);return t.set(i,o),e.setRenderTarget(s),i.addEventListener("dispose",n),o.texture}}}}return i},dispose:function(){t=new WeakMap,null!==r&&(r.dispose(),r=null)}}}function r4(e){let t={};function r(r){let n;if(void 0!==t[r])return t[r];switch(r){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(r)}return t[r]=n,n}return{has:function(e){return null!==r(e)},init:function(e){e.isWebGL2?r("EXT_color_buffer_float"):(r("WEBGL_depth_texture"),r("OES_texture_float"),r("OES_texture_half_float"),r("OES_texture_half_float_linear"),r("OES_standard_derivatives"),r("OES_element_index_uint"),r("OES_vertex_array_object"),r("ANGLE_instanced_arrays")),r("OES_texture_float_linear"),r("EXT_color_buffer_half_float")},get:function(e){let t=r(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function r5(e,t,r,n){let i={},s=new WeakMap;function a(e){let o=e.target;for(let e in null!==o.index&&t.remove(o.index),o.attributes)t.remove(o.attributes[e]);o.removeEventListener("dispose",a),delete i[o.id];let l=s.get(o);l&&(t.remove(l),s.delete(o)),n.releaseStatesOfGeometry(o),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,r.memory.geometries--}function o(e){let r=[],n=e.index,i=e.attributes.position,a=0;if(null!==n){let e=n.array;a=n.version;for(let t=0,n=e.length;t<n;t+=3){let n=e[t+0],i=e[t+1],s=e[t+2];r.push(n,i,i,s,s,n)}}else{let e=i.array;a=i.version;for(let t=0,n=e.length/3-1;t<n;t+=3){let e=t+0,n=t+1,i=t+2;r.push(e,n,n,i,i,e)}}let o=new(tV(r)>65535?tG:tz)(r,1);o.version=a;let l=s.get(e);l&&t.remove(l),s.set(e,o)}return{get:function(e,t){return!0===i[t.id]||(t.addEventListener("dispose",a),i[t.id]=!0,r.memory.geometries++),t},update:function(e){let r=e.attributes;for(let e in r)t.update(r[e],34962);let n=e.morphAttributes;for(let e in n){let r=n[e];for(let e=0,n=r.length;e<n;e++)t.update(r[e],34962)}},getWireframeAttribute:function(e){let t=s.get(e);if(t){let r=e.index;null!==r&&t.version<r.version&&o(e)}else o(e);return s.get(e)}}}function r6(e,t,r,n){let i,s,a;let o=n.isWebGL2;this.setMode=function(e){i=e},this.setIndex=function(e){s=e.type,a=e.bytesPerElement},this.render=function(t,n){e.drawElements(i,n,s,t*a),r.update(n,i,1)},this.renderInstances=function(n,l,h){let c,u;if(0!==h){if(o)c=e,u="drawElementsInstanced";else if(c=t.get("ANGLE_instanced_arrays"),u="drawElementsInstancedANGLE",null===c){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}c[u](i,l,s,n*a,h),r.update(l,i,h)}}}function r8(e){let t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,r,n){switch(t.calls++,r){case 4:t.triangles+=e/3*n;break;case 1:t.lines+=e/2*n;break;case 3:t.lines+=n*(e-1);break;case 2:t.lines+=n*e;break;case 0:t.points+=n*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r)}}}}function r7(e,t){return e[0]-t[0]}function r9(e,t){return Math.abs(t[1])-Math.abs(e[1])}function ne(e){let t={},r=new Float32Array(8),n=[];for(let e=0;e<8;e++)n[e]=[e,0];return{update:function(i,s,a,o){let l=i.morphTargetInfluences,h=void 0===l?0:l.length,c=t[s.id];if(void 0===c||c.length!==h){c=[];for(let e=0;e<h;e++)c[e]=[e,0];t[s.id]=c}for(let e=0;e<h;e++){let t=c[e];t[0]=e,t[1]=l[e]}c.sort(r9);for(let e=0;e<8;e++)e<h&&c[e][1]?(n[e][0]=c[e][0],n[e][1]=c[e][1]):(n[e][0]=Number.MAX_SAFE_INTEGER,n[e][1]=0);n.sort(r7);let u=s.morphAttributes.position,d=s.morphAttributes.normal,p=0;for(let e=0;e<8;e++){let t=n[e],i=t[0],a=t[1];i!==Number.MAX_SAFE_INTEGER&&a?(u&&s.getAttribute("morphTarget"+e)!==u[i]&&s.setAttribute("morphTarget"+e,u[i]),d&&s.getAttribute("morphNormal"+e)!==d[i]&&s.setAttribute("morphNormal"+e,d[i]),r[e]=a,p+=a):(u&&!0===s.hasAttribute("morphTarget"+e)&&s.deleteAttribute("morphTarget"+e),d&&!0===s.hasAttribute("morphNormal"+e)&&s.deleteAttribute("morphNormal"+e),r[e]=0)}let f=s.morphTargetsRelative?1:1-p;o.getUniforms().setValue(e,"morphTargetBaseInfluence",f),o.getUniforms().setValue(e,"morphTargetInfluences",r)}}}function nt(e,t,r,n){let i=new WeakMap;function s(e){let t=e.target;t.removeEventListener("dispose",s),r.remove(t.instanceMatrix),null!==t.instanceColor&&r.remove(t.instanceColor)}return{update:function(e){let a=n.render.frame,o=e.geometry,l=t.get(e,o);return i.get(l)!==a&&(t.update(l),i.set(l,a)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",s)&&e.addEventListener("dispose",s),r.update(e.instanceMatrix,34962),null!==e.instanceColor&&r.update(e.instanceColor,34962)),l},dispose:function(){i=new WeakMap}}}class nr extends ev{constructor(e=null,t=1,r=1,n=1){super(null),this.image={data:e,width:t,height:r,depth:n},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}nr.prototype.isDataTexture2DArray=!0;class nn extends ev{constructor(e=null,t=1,r=1,n=1){super(null),this.image={data:e,width:t,height:r,depth:n},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}nn.prototype.isDataTexture3D=!0;const ni=new ev,ns=new nr,na=new nn,no=new rm,nl=[],nh=[],nc=new Float32Array(16),nu=new Float32Array(9),nd=new Float32Array(4);function np(e,t,r){let n=e[0];if(n<=0||n>0)return e;let i=t*r,s=nl[i];if(void 0===s&&(s=new Float32Array(i),nl[i]=s),0!==t){n.toArray(s,0);for(let n=1,i=0;n!==t;++n)i+=r,e[n].toArray(s,i)}return s}function nf(e,t){if(e.length!==t.length)return!1;for(let r=0,n=e.length;r<n;r++)if(e[r]!==t[r])return!1;return!0}function nm(e,t){for(let r=0,n=t.length;r<n;r++)e[r]=t[r]}function ng(e,t){let r=nh[t];void 0===r&&(r=new Int32Array(t),nh[t]=r);for(let n=0;n!==t;++n)r[n]=e.allocateTextureUnit();return r}function nv(e,t){let r=this.cache;r[0]!==t&&(e.uniform1f(this.addr,t),r[0]=t)}function ny(e,t){let r=this.cache;if(void 0!==t.x)(r[0]!==t.x||r[1]!==t.y)&&(e.uniform2f(this.addr,t.x,t.y),r[0]=t.x,r[1]=t.y);else{if(nf(r,t))return;e.uniform2fv(this.addr,t),nm(r,t)}}function nx(e,t){let r=this.cache;if(void 0!==t.x)(r[0]!==t.x||r[1]!==t.y||r[2]!==t.z)&&(e.uniform3f(this.addr,t.x,t.y,t.z),r[0]=t.x,r[1]=t.y,r[2]=t.z);else if(void 0!==t.r)(r[0]!==t.r||r[1]!==t.g||r[2]!==t.b)&&(e.uniform3f(this.addr,t.r,t.g,t.b),r[0]=t.r,r[1]=t.g,r[2]=t.b);else{if(nf(r,t))return;e.uniform3fv(this.addr,t),nm(r,t)}}function n_(e,t){let r=this.cache;if(void 0!==t.x)(r[0]!==t.x||r[1]!==t.y||r[2]!==t.z||r[3]!==t.w)&&(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=t.w);else{if(nf(r,t))return;e.uniform4fv(this.addr,t),nm(r,t)}}function nb(e,t){let r=this.cache,n=t.elements;if(void 0===n){if(nf(r,t))return;e.uniformMatrix2fv(this.addr,!1,t),nm(r,t)}else{if(nf(r,n))return;nd.set(n),e.uniformMatrix2fv(this.addr,!1,nd),nm(r,n)}}function nw(e,t){let r=this.cache,n=t.elements;if(void 0===n){if(nf(r,t))return;e.uniformMatrix3fv(this.addr,!1,t),nm(r,t)}else{if(nf(r,n))return;nu.set(n),e.uniformMatrix3fv(this.addr,!1,nu),nm(r,n)}}function nS(e,t){let r=this.cache,n=t.elements;if(void 0===n){if(nf(r,t))return;e.uniformMatrix4fv(this.addr,!1,t),nm(r,t)}else{if(nf(r,n))return;nc.set(n),e.uniformMatrix4fv(this.addr,!1,nc),nm(r,n)}}function nM(e,t){let r=this.cache;r[0]!==t&&(e.uniform1i(this.addr,t),r[0]=t)}function nT(e,t){let r=this.cache;nf(r,t)||(e.uniform2iv(this.addr,t),nm(r,t))}function nE(e,t){let r=this.cache;nf(r,t)||(e.uniform3iv(this.addr,t),nm(r,t))}function nA(e,t){let r=this.cache;nf(r,t)||(e.uniform4iv(this.addr,t),nm(r,t))}function nC(e,t){let r=this.cache;r[0]!==t&&(e.uniform1ui(this.addr,t),r[0]=t)}function nR(e,t){let r=this.cache;nf(r,t)||(e.uniform2uiv(this.addr,t),nm(r,t))}function nL(e,t){let r=this.cache;nf(r,t)||(e.uniform3uiv(this.addr,t),nm(r,t))}function nI(e,t){let r=this.cache;nf(r,t)||(e.uniform4uiv(this.addr,t),nm(r,t))}function nP(e,t,r){let n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i),r.safeSetTexture2D(t||ni,i)}function nk(e,t,r){let n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i),r.setTexture3D(t||na,i)}function nD(e,t,r){let n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i),r.safeSetTextureCube(t||no,i)}function nU(e,t,r){let n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i),r.setTexture2DArray(t||ns,i)}function nO(e,t){e.uniform1fv(this.addr,t)}function nN(e,t){let r=np(t,this.size,2);e.uniform2fv(this.addr,r)}function nF(e,t){let r=np(t,this.size,3);e.uniform3fv(this.addr,r)}function nB(e,t){let r=np(t,this.size,4);e.uniform4fv(this.addr,r)}function nz(e,t){let r=np(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,r)}function nG(e,t){let r=np(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,r)}function nH(e,t){let r=np(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,r)}function nV(e,t){e.uniform1iv(this.addr,t)}function nW(e,t){e.uniform2iv(this.addr,t)}function nj(e,t){e.uniform3iv(this.addr,t)}function nq(e,t){e.uniform4iv(this.addr,t)}function nX(e,t){e.uniform1uiv(this.addr,t)}function nY(e,t){e.uniform2uiv(this.addr,t)}function nJ(e,t){e.uniform3uiv(this.addr,t)}function nZ(e,t){e.uniform4uiv(this.addr,t)}function n$(e,t,r){let n=t.length,i=ng(r,n);e.uniform1iv(this.addr,i);for(let e=0;e!==n;++e)r.safeSetTexture2D(t[e]||ni,i[e])}function nK(e,t,r){let n=t.length,i=ng(r,n);e.uniform1iv(this.addr,i);for(let e=0;e!==n;++e)r.safeSetTextureCube(t[e]||no,i[e])}function nQ(e,t,r){this.id=e,this.addr=r,this.cache=[],this.setValue=function(e){switch(e){case 5126:return nv;case 35664:return ny;case 35665:return nx;case 35666:return n_;case 35674:return nb;case 35675:return nw;case 35676:return nS;case 5124:case 35670:return nM;case 35667:case 35671:return nT;case 35668:case 35672:return nE;case 35669:case 35673:return nA;case 5125:return nC;case 36294:return nR;case 36295:return nL;case 36296:return nI;case 35678:case 36198:case 36298:case 36306:case 35682:return nP;case 35679:case 36299:case 36307:return nk;case 35680:case 36300:case 36308:case 36293:return nD;case 36289:case 36303:case 36311:case 36292:return nU}}(t.type)}function n0(e,t,r){this.id=e,this.addr=r,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return nO;case 35664:return nN;case 35665:return nF;case 35666:return nB;case 35674:return nz;case 35675:return nG;case 35676:return nH;case 5124:case 35670:return nV;case 35667:case 35671:return nW;case 35668:case 35672:return nj;case 35669:case 35673:return nq;case 5125:return nX;case 36294:return nY;case 36295:return nJ;case 36296:return nZ;case 35678:case 36198:case 36298:case 36306:case 35682:return n$;case 35680:case 36300:case 36308:case 36293:return nK}}(t.type)}function n1(e){this.id=e,this.seq=[],this.map={}}n0.prototype.updateCache=function(e){let t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),nm(t,e)},n1.prototype.setValue=function(e,t,r){let n=this.seq;for(let i=0,s=n.length;i!==s;++i){let s=n[i];s.setValue(e,t[s.id],r)}};const n2=/(\w+)(\])?(\[|\.)?/g;function n3(e,t){e.seq.push(t),e.map[t.id]=t}function n4(e,t){this.seq=[],this.map={};let r=e.getProgramParameter(t,35718);for(let n=0;n<r;++n){let r=e.getActiveUniform(t,n),i=e.getUniformLocation(t,r.name);!function(e,t,r){let n=e.name,i=n.length;for(n2.lastIndex=0;;){let s=n2.exec(n),a=n2.lastIndex,o=s[1],l="]"===s[2],h=s[3];if(l&&(o|=0),void 0===h||"["===h&&a+2===i){n3(r,void 0===h?new nQ(o,e,t):new n0(o,e,t));break}{let e=r.map[o];void 0===e&&n3(r,e=new n1(o)),r=e}}}(r,i,this)}}function n5(e,t,r){let n=e.createShader(t);return e.shaderSource(n,r),e.compileShader(n),n}n4.prototype.setValue=function(e,t,r,n){let i=this.map[t];void 0!==i&&i.setValue(e,r,n)},n4.prototype.setOptional=function(e,t,r){let n=t[r];void 0!==n&&this.setValue(e,r,n)},n4.upload=function(e,t,r,n){for(let i=0,s=t.length;i!==s;++i){let s=t[i],a=r[s.id];!1!==a.needsUpdate&&s.setValue(e,a.value,n)}},n4.seqWithValue=function(e,t){let r=[];for(let n=0,i=e.length;n!==i;++n){let i=e[n];i.id in t&&r.push(i)}return r};let n6=0;function n8(e){switch(e){case 3e3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function n7(e,t,r){let n=e.getShaderParameter(t,35713),i=e.getShaderInfoLog(t).trim();return n&&""===i?"":r.toUpperCase()+"\n\n"+i+"\n\n"+function(e){let t=e.split("\n");for(let e=0;e<t.length;e++)t[e]=e+1+": "+t[e];return t.join("\n")}(e.getShaderSource(t))}function n9(e,t){let r=n8(t);return"vec4 "+e+"( vec4 value ) { return "+r[0]+"ToLinear"+r[1]+"; }"}function ie(e){return""!==e}function it(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function ir(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const ii=/^[ \t]*#include +<([\w\d./]+)>/gm;function is(e){return e.replace(ii,ia)}function ia(e,t){let r=rA[t];if(void 0===r)throw Error("Can not resolve #include <"+t+">");return is(r)}const io=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,il=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function ih(e){return e.replace(il,iu).replace(io,ic)}function ic(e,t,r,n){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),iu(e,t,r,n)}function iu(e,t,r,n){let i="";for(let e=parseInt(t);e<parseInt(r);e++)i+=n.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return i}function id(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function ip(e,t,r,n){let i,s,a,o,l;let h=e.getContext(),c=r.defines,u=r.vertexShader,d=r.fragmentShader,p=(l="SHADOWMAP_TYPE_BASIC",1===r.shadowMapType?l="SHADOWMAP_TYPE_PCF":2===r.shadowMapType?l="SHADOWMAP_TYPE_PCF_SOFT":3===r.shadowMapType&&(l="SHADOWMAP_TYPE_VSM"),l),f=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case 301:case 302:t="ENVMAP_TYPE_CUBE";break;case 306:case 307:t="ENVMAP_TYPE_CUBE_UV"}return t}(r),m=function(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case 302:case 307:t="ENVMAP_MODE_REFRACTION"}return t}(r),g=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(r),v=e.gammaFactor>0?e.gammaFactor:1,y=r.isWebGL2?"":[r.extensionDerivatives||r.envMapCubeUV||r.bumpMap||r.tangentSpaceNormalMap||r.clearcoatNormalMap||r.flatShading||"physical"===r.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(r.extensionFragDepth||r.logarithmicDepthBuffer)&&r.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",r.extensionDrawBuffers&&r.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(r.extensionShaderTextureLOD||r.envMap||r.transmission)&&r.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(ie).join("\n"),x=function(e){let t=[];for(let r in e){let n=e[r];!1!==n&&t.push("#define "+r+" "+n)}return t.join("\n")}(c),_=h.createProgram(),b=r.glslVersion?"#version "+r.glslVersion+"\n":"";r.isRawShaderMaterial?((i=[x].filter(ie).join("\n")).length>0&&(i+="\n"),(s=[y,x].filter(ie).join("\n")).length>0&&(s+="\n")):(i=[id(r),"#define SHADER_NAME "+r.shaderName,x,r.instancing?"#define USE_INSTANCING":"",r.instancingColor?"#define USE_INSTANCING_COLOR":"",r.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+v,"#define MAX_BONES "+r.maxBones,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp2?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+m:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.normalMap&&r.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",r.normalMap&&r.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",r.clearcoatMap?"#define USE_CLEARCOATMAP":"",r.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",r.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",r.displacementMap&&r.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",r.specularTintMap?"#define USE_SPECULARTINTMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.transmission?"#define USE_TRANSMISSION":"",r.transmissionMap?"#define USE_TRANSMISSIONMAP":"",r.thicknessMap?"#define USE_THICKNESSMAP":"",r.vertexTangents?"#define USE_TANGENT":"",r.vertexColors?"#define USE_COLOR":"",r.vertexAlphas?"#define USE_COLOR_ALPHA":"",r.vertexUvs?"#define USE_UV":"",r.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",r.flatShading?"#define FLAT_SHADED":"",r.skinning?"#define USE_SKINNING":"",r.useVertexTexture?"#define BONE_TEXTURE":"",r.morphTargets?"#define USE_MORPHTARGETS":"",r.morphNormals&&!1===r.flatShading?"#define USE_MORPHNORMALS":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+p:"",r.sizeAttenuation?"#define USE_SIZEATTENUATION":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&r.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif","\n"].filter(ie).join("\n"),s=[y,id(r),"#define SHADER_NAME "+r.shaderName,x,"#define GAMMA_FACTOR "+v,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp2?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.matcap?"#define USE_MATCAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+f:"",r.envMap?"#define "+m:"",r.envMap?"#define "+g:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.normalMap&&r.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",r.normalMap&&r.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",r.clearcoat?"#define USE_CLEARCOAT":"",r.clearcoatMap?"#define USE_CLEARCOATMAP":"",r.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",r.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",r.specularTintMap?"#define USE_SPECULARTINTMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.alphaTest?"#define USE_ALPHATEST":"",r.sheenTint?"#define USE_SHEEN":"",r.transmission?"#define USE_TRANSMISSION":"",r.transmissionMap?"#define USE_TRANSMISSIONMAP":"",r.thicknessMap?"#define USE_THICKNESSMAP":"",r.vertexTangents?"#define USE_TANGENT":"",r.vertexColors||r.instancingColor?"#define USE_COLOR":"",r.vertexAlphas?"#define USE_COLOR_ALPHA":"",r.vertexUvs?"#define USE_UV":"",r.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",r.gradientMap?"#define USE_GRADIENTMAP":"",r.flatShading?"#define FLAT_SHADED":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+p:"",r.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",r.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&r.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(r.extensionShaderTextureLOD||r.envMap)&&r.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==r.toneMapping?"#define TONE_MAPPING":"",0!==r.toneMapping?rA.tonemapping_pars_fragment:"",0!==r.toneMapping?function(e,t){let r;switch(t){case 1:r="Linear";break;case 2:r="Reinhard";break;case 3:r="OptimizedCineon";break;case 4:r="ACESFilmic";break;case 5:r="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),r="Linear"}return"vec3 "+e+"( vec3 color ) { return "+r+"ToneMapping( color ); }"}("toneMapping",r.toneMapping):"",r.dithering?"#define DITHERING":"",1022===r.format?"#define OPAQUE":"",rA.encodings_pars_fragment,r.map?n9("mapTexelToLinear",r.mapEncoding):"",r.matcap?n9("matcapTexelToLinear",r.matcapEncoding):"",r.envMap?n9("envMapTexelToLinear",r.envMapEncoding):"",r.emissiveMap?n9("emissiveMapTexelToLinear",r.emissiveMapEncoding):"",r.specularTintMap?n9("specularTintMapTexelToLinear",r.specularTintMapEncoding):"",r.lightMap?n9("lightMapTexelToLinear",r.lightMapEncoding):"",function(e,t){let r=n8(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+r[0]+r[1]+"; }"}("linearToOutputTexel",r.outputEncoding),r.depthPacking?"#define DEPTH_PACKING "+r.depthPacking:"","\n"].filter(ie).join("\n")),u=ir(u=it(u=is(u),r),r),d=ir(d=it(d=is(d),r),r),u=ih(u),d=ih(d),r.isWebGL2&&!0!==r.isRawShaderMaterial&&(b="#version 300 es\n",i="#define attribute in\n#define varying out\n#define texture2D texture\n"+i,s=["#define varying in",r.glslVersion===Q?"":"out highp vec4 pc_fragColor;",r.glslVersion===Q?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+s);let w=b+i+u,S=b+s+d,T=n5(h,35633,w),E=n5(h,35632,S);if(h.attachShader(_,T),h.attachShader(_,E),void 0!==r.index0AttributeName?h.bindAttribLocation(_,0,r.index0AttributeName):!0===r.morphTargets&&h.bindAttribLocation(_,0,"position"),h.linkProgram(_),e.debug.checkShaderErrors){let e=h.getProgramInfoLog(_).trim(),t=h.getShaderInfoLog(T).trim(),r=h.getShaderInfoLog(E).trim(),n=!0,a=!0;if(!1===h.getProgramParameter(_,35714)){n=!1;let t=n7(h,T,"vertex"),r=n7(h,E,"fragment");console.error("THREE.WebGLProgram: Shader Error "+h.getError()+" - VALIDATE_STATUS "+h.getProgramParameter(_,35715)+"\n\nProgram Info Log: "+e+"\n"+t+"\n"+r)}else""!==e?console.warn("THREE.WebGLProgram: Program Info Log:",e):(""===t||""===r)&&(a=!1);a&&(this.diagnostics={runnable:n,programLog:e,vertexShader:{log:t,prefix:i},fragmentShader:{log:r,prefix:s}})}return h.deleteShader(T),h.deleteShader(E),this.getUniforms=function(){return void 0===a&&(a=new n4(h,_)),a},this.getAttributes=function(){return void 0===o&&(o=function(e,t){let r={},n=e.getProgramParameter(t,35721);for(let i=0;i<n;i++){let n=e.getActiveAttrib(t,i),s=n.name,a=1;35674===n.type&&(a=2),35675===n.type&&(a=3),35676===n.type&&(a=4),r[s]={type:n.type,location:e.getAttribLocation(t,s),locationSize:a}}return r}(h,_)),o},this.destroy=function(){n.releaseStatesOfProgram(this),h.deleteProgram(_),this.program=void 0},this.name=r.shaderName,this.id=n6++,this.cacheKey=t,this.usedTimes=1,this.program=_,this.vertexShader=T,this.fragmentShader=E,this}function im(e,t,r,n,i,s,a){let o=[],l=i.isWebGL2,h=i.logarithmicDepthBuffer,c=i.floatVertexTextures,u=i.maxVertexUniforms,d=i.vertexTextures,p=i.precision,f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},m=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoat","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","specularIntensityMap","specularTintMap","specularTintMapEncoding","roughnessMap","metalnessMap","gradientMap","alphaMap","alphaTest","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","format","sheenTint","transmission","transmissionMap","thicknessMap"];function g(e){let t;return e&&e.isTexture?t=e.encoding:e&&e.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=e.texture.encoding):t=3e3,t}return{getParameters:function(s,o,m,v,y){let x,_;let b=v.fog,w=s.isMeshStandardMaterial?v.environment:null,S=(s.isMeshStandardMaterial?r:t).get(s.envMap||w),T=f[s.type],E=y.isSkinnedMesh?function(e){let t=e.skeleton.bones;if(c)return 1024;{let e=Math.min(Math.floor((u-20)/4),t.length);return e<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+e+"."),0):e}}(y):0;if(null!==s.precision&&(p=i.getMaxPrecision(s.precision))!==s.precision&&console.warn("THREE.WebGLProgram.getParameters:",s.precision,"not supported, using",p,"instead."),T){let e=rR[T];x=e.vertexShader,_=e.fragmentShader}else x=s.vertexShader,_=s.fragmentShader;let A=e.getRenderTarget(),C=s.alphaTest>0,R=s.clearcoat>0;return{isWebGL2:l,shaderID:T,shaderName:s.type,vertexShader:x,fragmentShader:_,defines:s.defines,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:p,instancing:!0===y.isInstancedMesh,instancingColor:!0===y.isInstancedMesh&&null!==y.instanceColor,supportsVertexTextures:d,outputEncoding:null!==A?g(A.texture):e.outputEncoding,map:!!s.map,mapEncoding:g(s.map),matcap:!!s.matcap,matcapEncoding:g(s.matcap),envMap:!!S,envMapMode:S&&S.mapping,envMapEncoding:g(S),envMapCubeUV:!!S&&(306===S.mapping||307===S.mapping),lightMap:!!s.lightMap,lightMapEncoding:g(s.lightMap),aoMap:!!s.aoMap,emissiveMap:!!s.emissiveMap,emissiveMapEncoding:g(s.emissiveMap),bumpMap:!!s.bumpMap,normalMap:!!s.normalMap,objectSpaceNormalMap:1===s.normalMapType,tangentSpaceNormalMap:0===s.normalMapType,clearcoat:R,clearcoatMap:R&&!!s.clearcoatMap,clearcoatRoughnessMap:R&&!!s.clearcoatRoughnessMap,clearcoatNormalMap:R&&!!s.clearcoatNormalMap,displacementMap:!!s.displacementMap,roughnessMap:!!s.roughnessMap,metalnessMap:!!s.metalnessMap,specularMap:!!s.specularMap,specularIntensityMap:!!s.specularIntensityMap,specularTintMap:!!s.specularTintMap,specularTintMapEncoding:g(s.specularTintMap),alphaMap:!!s.alphaMap,alphaTest:C,gradientMap:!!s.gradientMap,sheenTint:!!s.sheenTint&&(s.sheenTint.r>0||s.sheenTint.g>0||s.sheenTint.b>0),transmission:s.transmission>0,transmissionMap:!!s.transmissionMap,thicknessMap:!!s.thicknessMap,combine:s.combine,vertexTangents:!!s.normalMap&&!!y.geometry&&!!y.geometry.attributes.tangent,vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!y.geometry&&!!y.geometry.attributes.color&&4===y.geometry.attributes.color.itemSize,vertexUvs:!!s.map||!!s.bumpMap||!!s.normalMap||!!s.specularMap||!!s.alphaMap||!!s.emissiveMap||!!s.roughnessMap||!!s.metalnessMap||!!s.clearcoatMap||!!s.clearcoatRoughnessMap||!!s.clearcoatNormalMap||!!s.displacementMap||!!s.transmissionMap||!!s.thicknessMap||!!s.specularIntensityMap||!!s.specularTintMap,uvsVertexOnly:!(s.map||s.bumpMap||s.normalMap||s.specularMap||s.alphaMap||s.emissiveMap||s.roughnessMap||s.metalnessMap||s.clearcoatNormalMap||s.transmission>0||s.transmissionMap||s.thicknessMap||s.specularIntensityMap||s.specularTintMap)&&!!s.displacementMap,fog:!!b,useFog:s.fog,fogExp2:b&&b.isFogExp2,flatShading:!!s.flatShading,sizeAttenuation:s.sizeAttenuation,logarithmicDepthBuffer:h,skinning:!0===y.isSkinnedMesh&&E>0,maxBones:E,useVertexTexture:c,morphTargets:!!y.geometry&&!!y.geometry.morphAttributes.position,morphNormals:!!y.geometry&&!!y.geometry.morphAttributes.normal,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,format:s.format,dithering:s.dithering,shadowMapEnabled:e.shadowMap.enabled&&m.length>0,shadowMapType:e.shadowMap.type,toneMapping:s.toneMapped?e.toneMapping:0,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:s.premultipliedAlpha,doubleSided:2===s.side,flipSided:1===s.side,depthPacking:void 0!==s.depthPacking&&s.depthPacking,index0AttributeName:s.index0AttributeName,extensionDerivatives:s.extensions&&s.extensions.derivatives,extensionFragDepth:s.extensions&&s.extensions.fragDepth,extensionDrawBuffers:s.extensions&&s.extensions.drawBuffers,extensionShaderTextureLOD:s.extensions&&s.extensions.shaderTextureLOD,rendererExtensionFragDepth:l||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:l||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:l||n.has("EXT_shader_texture_lod"),customProgramCacheKey:s.customProgramCacheKey()}},getProgramCacheKey:function(t){let r=[];if(t.shaderID?r.push(t.shaderID):(r.push(t.fragmentShader),r.push(t.vertexShader)),void 0!==t.defines)for(let e in t.defines)r.push(e),r.push(t.defines[e]);if(!1===t.isRawShaderMaterial){for(let e=0;e<m.length;e++)r.push(t[m[e]]);r.push(e.outputEncoding),r.push(e.gammaFactor)}return r.push(t.customProgramCacheKey),r.join()},getUniforms:function(e){let t;let r=f[e.type];if(r){let e=rR[r];t=rc.clone(e.uniforms)}else t=e.uniforms;return t},acquireProgram:function(t,r){let n;for(let e=0,t=o.length;e<t;e++){let t=o[e];if(t.cacheKey===r){n=t,++n.usedTimes;break}}return void 0===n&&(n=new ip(e,r,t,s),o.push(n)),n},releaseProgram:function(e){if(0==--e.usedTimes){let t=o.indexOf(e);o[t]=o[o.length-1],o.pop(),e.destroy()}},programs:o}}function ig(){let e=new WeakMap;return{get:function(t){let r=e.get(t);return void 0===r&&(r={},e.set(t,r)),r},remove:function(t){e.delete(t)},update:function(t,r,n){e.get(t)[r]=n},dispose:function(){e=new WeakMap}}}function iv(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function iy(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function ix(e){let t=[],r=0,n=[],i=[],s=[],a={id:-1};function o(n,i,s,o,l,h){let c=t[r],u=e.get(s);return void 0===c?(c={id:n.id,object:n,geometry:i,material:s,program:u.program||a,groupOrder:o,renderOrder:n.renderOrder,z:l,group:h},t[r]=c):(c.id=n.id,c.object=n,c.geometry=i,c.material=s,c.program=u.program||a,c.groupOrder=o,c.renderOrder=n.renderOrder,c.z=l,c.group=h),r++,c}return{opaque:n,transmissive:i,transparent:s,init:function(){r=0,n.length=0,i.length=0,s.length=0},push:function(e,t,r,a,l,h){let c=o(e,t,r,a,l,h);r.transmission>0?i.push(c):!0===r.transparent?s.push(c):n.push(c)},unshift:function(e,t,r,a,l,h){let c=o(e,t,r,a,l,h);r.transmission>0?i.unshift(c):!0===r.transparent?s.unshift(c):n.unshift(c)},finish:function(){for(let e=r,n=t.length;e<n;e++){let r=t[e];if(null===r.id)break;r.id=null,r.object=null,r.geometry=null,r.material=null,r.program=null,r.group=null}},sort:function(e,t){n.length>1&&n.sort(e||iv),i.length>1&&i.sort(t||iy),s.length>1&&s.sort(t||iy)}}}function i_(e){let t=new WeakMap;return{get:function(r,n){let i;return!1===t.has(r)?(i=new ix(e),t.set(r,[i])):n>=t.get(r).length?(i=new ix(e),t.get(r).push(i)):i=t.get(r)[n],i},dispose:function(){t=new WeakMap}}}function ib(){let e={};return{get:function(t){let r;if(void 0!==e[t.id])return e[t.id];switch(t.type){case"DirectionalLight":r={direction:new eS,color:new tU};break;case"SpotLight":r={position:new eS,direction:new eS,color:new tU,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":r={position:new eS,color:new tU,distance:0,decay:0};break;case"HemisphereLight":r={direction:new eS,skyColor:new tU,groundColor:new tU};break;case"RectAreaLight":r={color:new tU,position:new eS,halfWidth:new eS,halfHeight:new eS}}return e[t.id]=r,r}}}let iw=0;function iS(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function iM(e,t){let r=new ib,n=function(){let e={};return{get:function(t){let r;if(void 0!==e[t.id])return e[t.id];switch(t.type){case"DirectionalLight":case"SpotLight":r={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ep};break;case"PointLight":r={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ep,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=r,r}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let e=0;e<9;e++)i.probe.push(new eS);let s=new eS,a=new e0,o=new e0;return{setup:function(s,a){let o=0,l=0,h=0;for(let e=0;e<9;e++)i.probe[e].set(0,0,0);let c=0,u=0,d=0,p=0,f=0,m=0,g=0,v=0;s.sort(iS);let y=!0!==a?Math.PI:1;for(let e=0,t=s.length;e<t;e++){let t=s[e],a=t.color,x=t.intensity,_=t.distance,b=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)o+=a.r*x*y,l+=a.g*x*y,h+=a.b*x*y;else if(t.isLightProbe)for(let e=0;e<9;e++)i.probe[e].addScaledVector(t.sh.coefficients[e],x);else if(t.isDirectionalLight){let e=r.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*y),t.castShadow){let e=t.shadow,r=n.get(t);r.shadowBias=e.bias,r.shadowNormalBias=e.normalBias,r.shadowRadius=e.radius,r.shadowMapSize=e.mapSize,i.directionalShadow[c]=r,i.directionalShadowMap[c]=b,i.directionalShadowMatrix[c]=t.shadow.matrix,m++}i.directional[c]=e,c++}else if(t.isSpotLight){let e=r.get(t);if(e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(a).multiplyScalar(x*y),e.distance=_,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,t.castShadow){let e=t.shadow,r=n.get(t);r.shadowBias=e.bias,r.shadowNormalBias=e.normalBias,r.shadowRadius=e.radius,r.shadowMapSize=e.mapSize,i.spotShadow[d]=r,i.spotShadowMap[d]=b,i.spotShadowMatrix[d]=t.shadow.matrix,v++}i.spot[d]=e,d++}else if(t.isRectAreaLight){let e=r.get(t);e.color.copy(a).multiplyScalar(x),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),i.rectArea[p]=e,p++}else if(t.isPointLight){let e=r.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*y),e.distance=t.distance,e.decay=t.decay,t.castShadow){let e=t.shadow,r=n.get(t);r.shadowBias=e.bias,r.shadowNormalBias=e.normalBias,r.shadowRadius=e.radius,r.shadowMapSize=e.mapSize,r.shadowCameraNear=e.camera.near,r.shadowCameraFar=e.camera.far,i.pointShadow[u]=r,i.pointShadowMap[u]=b,i.pointShadowMatrix[u]=t.shadow.matrix,g++}i.point[u]=e,u++}else if(t.isHemisphereLight){let e=r.get(t);e.skyColor.copy(t.color).multiplyScalar(x*y),e.groundColor.copy(t.groundColor).multiplyScalar(x*y),i.hemi[f]=e,f++}}p>0&&(t.isWebGL2?(i.rectAreaLTC1=rC.LTC_FLOAT_1,i.rectAreaLTC2=rC.LTC_FLOAT_2):!0===e.has("OES_texture_float_linear")?(i.rectAreaLTC1=rC.LTC_FLOAT_1,i.rectAreaLTC2=rC.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(i.rectAreaLTC1=rC.LTC_HALF_1,i.rectAreaLTC2=rC.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=o,i.ambient[1]=l,i.ambient[2]=h;let x=i.hash;(x.directionalLength!==c||x.pointLength!==u||x.spotLength!==d||x.rectAreaLength!==p||x.hemiLength!==f||x.numDirectionalShadows!==m||x.numPointShadows!==g||x.numSpotShadows!==v)&&(i.directional.length=c,i.spot.length=d,i.rectArea.length=p,i.point.length=u,i.hemi.length=f,i.directionalShadow.length=m,i.directionalShadowMap.length=m,i.pointShadow.length=g,i.pointShadowMap.length=g,i.spotShadow.length=v,i.spotShadowMap.length=v,i.directionalShadowMatrix.length=m,i.pointShadowMatrix.length=g,i.spotShadowMatrix.length=v,x.directionalLength=c,x.pointLength=u,x.spotLength=d,x.rectAreaLength=p,x.hemiLength=f,x.numDirectionalShadows=m,x.numPointShadows=g,x.numSpotShadows=v,i.version=iw++)},setupView:function(e,t){let r=0,n=0,l=0,h=0,c=0,u=t.matrixWorldInverse;for(let t=0,d=e.length;t<d;t++){let d=e[t];if(d.isDirectionalLight){let e=i.directional[r];e.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(s),e.direction.transformDirection(u),r++}else if(d.isSpotLight){let e=i.spot[l];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(u),e.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(s),e.direction.transformDirection(u),l++}else if(d.isRectAreaLight){let e=i.rectArea[h];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(u),o.identity(),a.copy(d.matrixWorld),a.premultiply(u),o.extractRotation(a),e.halfWidth.set(.5*d.width,0,0),e.halfHeight.set(0,.5*d.height,0),e.halfWidth.applyMatrix4(o),e.halfHeight.applyMatrix4(o),h++}else if(d.isPointLight){let e=i.point[n];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(u),n++}else if(d.isHemisphereLight){let e=i.hemi[c];e.direction.setFromMatrixPosition(d.matrixWorld),e.direction.transformDirection(u),e.direction.normalize(),c++}}},state:i}}function iT(e,t){let r=new iM(e,t),n=[],i=[];return{init:function(){n.length=0,i.length=0},state:{lightsArray:n,shadowsArray:i,lights:r},setupLights:function(e){r.setup(n,e)},setupLightsView:function(e){r.setupView(n,e)},pushLight:function(e){n.push(e)},pushShadow:function(e){i.push(e)}}}function iE(e,t){let r=new WeakMap;return{get:function(n,i=0){let s;return!1===r.has(n)?(s=new iT(e,t),r.set(n,[s])):i>=r.get(n).length?(s=new iT(e,t),r.get(n).push(s)):s=r.get(n)[i],s},dispose:function(){r=new WeakMap}}}class iA extends tC{constructor(e){super(),this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}iA.prototype.isMeshDepthMaterial=!0;class iC extends tC{constructor(e){super(),this.type="MeshDistanceMaterial",this.referencePosition=new eS,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function iR(e,t,r){let n=new rS,i=new ep,s=new ep,a=new ex,o=new iA({depthPacking:3201}),l=new iC,h={},c=r.maxTextureSize,u={0:1,1:0,2:2},d=new ru({uniforms:{shadow_pass:{value:null},resolution:{value:new ep},radius:{value:4},samples:{value:8}},vertexShader:"void main() {\n	gl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\nuniform float samples;\n#include <packing>\nvoid main() {\n	float mean = 0.0;\n	float squared_mean = 0.0;\n	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n	for ( float i = 0.0; i < samples; i ++ ) {\n		float uvOffset = uvStart + i * uvStride;\n		#ifdef HORIZONTAL_PASS\n			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n			mean += distribution.x;\n			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n		#else\n			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n			mean += depth;\n			squared_mean += depth * depth;\n		#endif\n	}\n	mean = mean / samples;\n	squared_mean = squared_mean / samples;\n	float std_dev = sqrt( squared_mean - mean * mean );\n	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=d.clone();p.defines.HORIZONTAL_PASS=1;let f=new t$;f.setAttribute("position",new tB(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let m=new rs(f,d),g=this;function v(t,r,n,i,s,a,c){let d=null,p=!0===i.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(d=void 0!==p?p:!0===i.isPointLight?l:o,e.localClippingEnabled&&!0===n.clipShadows&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0){let e=d.uuid,t=n.uuid,r=h[e];void 0===r&&(r={},h[e]=r);let i=r[t];void 0===i&&(i=d.clone(),r[t]=i),d=i}return d.visible=n.visible,d.wireframe=n.wireframe,3===c?d.side=null!==n.shadowSide?n.shadowSide:n.side:d.side=null!==n.shadowSide?n.shadowSide:u[n.side],d.alphaMap=n.alphaMap,d.alphaTest=n.alphaTest,d.clipShadows=n.clipShadows,d.clippingPlanes=n.clippingPlanes,d.clipIntersection=n.clipIntersection,d.displacementMap=n.displacementMap,d.displacementScale=n.displacementScale,d.displacementBias=n.displacementBias,d.wireframeLinewidth=n.wireframeLinewidth,d.linewidth=n.linewidth,!0===i.isPointLight&&!0===d.isMeshDistanceMaterial&&(d.referencePosition.setFromMatrixPosition(i.matrixWorld),d.nearDistance=s,d.farDistance=a),d}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(r,o,l){if(!1===g.enabled||!1===g.autoUpdate&&!1===g.needsUpdate||0===r.length)return;let h=e.getRenderTarget(),u=e.getActiveCubeFace(),f=e.getActiveMipmapLevel(),y=e.state;y.setBlending(0),y.buffers.color.setClear(1,1,1,1),y.buffers.depth.setTest(!0),y.setScissorTest(!1);for(let h=0,u=r.length;h<u;h++){let u=r[h],f=u.shadow;if(void 0===f){console.warn("THREE.WebGLShadowMap:",u,"has no shadow.");continue}if(!1===f.autoUpdate&&!1===f.needsUpdate)continue;i.copy(f.mapSize);let g=f.getFrameExtents();if(i.multiply(g),s.copy(f.mapSize),(i.x>c||i.y>c)&&(i.x>c&&(s.x=Math.floor(c/g.x),i.x=s.x*g.x,f.mapSize.x=s.x),i.y>c&&(s.y=Math.floor(c/g.y),i.y=s.y*g.y,f.mapSize.y=s.y)),null===f.map&&!f.isPointLightShadow&&3===this.type){let e={minFilter:1006,magFilter:1006,format:1023};f.map=new e_(i.x,i.y,e),f.map.texture.name=u.name+".shadowMap",f.mapPass=new e_(i.x,i.y,e),f.camera.updateProjectionMatrix()}if(null===f.map){let e={minFilter:1003,magFilter:1003,format:1023};f.map=new e_(i.x,i.y,e),f.map.texture.name=u.name+".shadowMap",f.camera.updateProjectionMatrix()}e.setRenderTarget(f.map),e.clear();let x=f.getViewportCount();for(let r=0;r<x;r++){let i=f.getViewport(r);a.set(s.x*i.x,s.y*i.y,s.x*i.z,s.y*i.w),y.viewport(a),f.updateMatrices(u,r),n=f.getFrustum(),function r(i,s,a,o,l){if(!1===i.visible)return;if(i.layers.test(s.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&3===l)&&(!i.frustumCulled||n.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,i.matrixWorld);let r=t.update(i),n=i.material;if(Array.isArray(n)){let t=r.groups;for(let s=0,h=t.length;s<h;s++){let h=t[s],c=n[h.materialIndex];if(c&&c.visible){let t=v(i,r,c,o,a.near,a.far,l);e.renderBufferDirect(a,null,r,t,i,h)}}}else if(n.visible){let t=v(i,r,n,o,a.near,a.far,l);e.renderBufferDirect(a,null,r,t,i,null)}}let h=i.children;for(let e=0,t=h.length;e<t;e++)r(h[e],s,a,o,l)}(o,l,f.camera,u,this.type)}f.isPointLightShadow||3!==this.type||function(r,n){let i=t.update(m);d.uniforms.shadow_pass.value=r.map.texture,d.uniforms.resolution.value=r.mapSize,d.uniforms.radius.value=r.radius,d.uniforms.samples.value=r.blurSamples,e.setRenderTarget(r.mapPass),e.clear(),e.renderBufferDirect(n,null,i,d,m,null),p.uniforms.shadow_pass.value=r.mapPass.texture,p.uniforms.resolution.value=r.mapSize,p.uniforms.radius.value=r.radius,p.uniforms.samples.value=r.blurSamples,e.setRenderTarget(r.map),e.clear(),e.renderBufferDirect(n,null,i,p,m,null)}(f,l),f.needsUpdate=!1}g.needsUpdate=!1,e.setRenderTarget(h,u,f)}}function iL(e,t,r){let n=r.isWebGL2,i=new function(){let t=!1,r=new ex,n=null,i=new ex(0,0,0,0);return{setMask:function(r){n===r||t||(e.colorMask(r,r,r,r),n=r)},setLocked:function(e){t=e},setClear:function(t,n,s,a,o){!0===o&&(t*=a,n*=a,s*=a),r.set(t,n,s,a),!1===i.equals(r)&&(e.clearColor(t,n,s,a),i.copy(r))},reset:function(){t=!1,n=null,i.set(-1,0,0,0)}}},s=new function(){let t=!1,r=null,n=null,i=null;return{setTest:function(e){e?N(2929):F(2929)},setMask:function(n){r===n||t||(e.depthMask(n),r=n)},setFunc:function(t){if(n!==t){if(t)switch(t){case 0:e.depthFunc(512);break;case 1:e.depthFunc(519);break;case 2:e.depthFunc(513);break;case 3:default:e.depthFunc(515);break;case 4:e.depthFunc(514);break;case 5:e.depthFunc(518);break;case 6:e.depthFunc(516);break;case 7:e.depthFunc(517)}else e.depthFunc(515);n=t}},setLocked:function(e){t=e},setClear:function(t){i!==t&&(e.clearDepth(t),i=t)},reset:function(){t=!1,r=null,n=null,i=null}}},a=new function(){let t=!1,r=null,n=null,i=null,s=null,a=null,o=null,l=null,h=null;return{setTest:function(e){t||(e?N(2960):F(2960))},setMask:function(n){r===n||t||(e.stencilMask(n),r=n)},setFunc:function(t,r,a){(n!==t||i!==r||s!==a)&&(e.stencilFunc(t,r,a),n=t,i=r,s=a)},setOp:function(t,r,n){(a!==t||o!==r||l!==n)&&(e.stencilOp(t,r,n),a=t,o=r,l=n)},setLocked:function(e){t=e},setClear:function(t){h!==t&&(e.clearStencil(t),h=t)},reset:function(){t=!1,r=null,n=null,i=null,s=null,a=null,o=null,l=null,h=null}}},o={},l=null,h={},c=null,u=!1,d=null,p=null,f=null,m=null,g=null,v=null,y=null,x=!1,_=null,b=null,w=null,S=null,T=null,E=e.getParameter(35661),A=!1,C=e.getParameter(7938);-1!==C.indexOf("WebGL")?A=parseFloat(/^WebGL (\d)/.exec(C)[1])>=1:-1!==C.indexOf("OpenGL ES")&&(A=parseFloat(/^OpenGL ES (\d)/.exec(C)[1])>=2);let R=null,L={},I=e.getParameter(3088),P=e.getParameter(2978),k=new ex().fromArray(I),D=new ex().fromArray(P);function U(t,r,n){let i=new Uint8Array(4),s=e.createTexture();e.bindTexture(t,s),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(let t=0;t<n;t++)e.texImage2D(r+t,0,6408,1,1,0,6408,5121,i);return s}let O={};function N(t){!0!==o[t]&&(e.enable(t),o[t]=!0)}function F(t){!1!==o[t]&&(e.disable(t),o[t]=!1)}O[3553]=U(3553,3553,1),O[34067]=U(34067,34069,6),i.setClear(0,0,0,1),s.setClear(1),a.setClear(0),N(2929),s.setFunc(3),H(!1),V(1),N(2884),G(0);let B={100:32774,101:32778,102:32779};if(n)B[103]=32775,B[104]=32776;else{let e=t.get("EXT_blend_minmax");null!==e&&(B[103]=e.MIN_EXT,B[104]=e.MAX_EXT)}let z={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function G(t,r,n,i,s,a,o,l){if(0===t){!0===u&&(F(3042),u=!1);return}if(!1===u&&(N(3042),u=!0),5!==t){if(t!==d||l!==x){if((100!==p||100!==g)&&(e.blendEquation(32774),p=100,g=100),l)switch(t){case 1:e.blendFuncSeparate(1,771,1,771);break;case 2:e.blendFunc(1,1);break;case 3:e.blendFuncSeparate(0,0,769,771);break;case 4:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(770,771,1,771);break;case 2:e.blendFunc(770,1);break;case 3:e.blendFunc(0,769);break;case 4:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}f=null,m=null,v=null,y=null,d=t,x=l}return}s=s||r,a=a||n,o=o||i,(r!==p||s!==g)&&(e.blendEquationSeparate(B[r],B[s]),p=r,g=s),(n!==f||i!==m||a!==v||o!==y)&&(e.blendFuncSeparate(z[n],z[i],z[a],z[o]),f=n,m=i,v=a,y=o),d=t,x=null}function H(t){_!==t&&(t?e.frontFace(2304):e.frontFace(2305),_=t)}function V(t){0!==t?(N(2884),t!==b&&(1===t?e.cullFace(1029):2===t?e.cullFace(1028):e.cullFace(1032))):F(2884),b=t}function W(t,r,n){t?(N(32823),(S!==r||T!==n)&&(e.polygonOffset(r,n),S=r,T=n)):F(32823)}function j(t){void 0===t&&(t=33984+E-1),R!==t&&(e.activeTexture(t),R=t)}return{buffers:{color:i,depth:s,stencil:a},enable:N,disable:F,bindFramebuffer:function(t,r){return null===r&&null!==l&&(r=l),h[t]!==r&&(e.bindFramebuffer(t,r),h[t]=r,n&&(36009===t&&(h[36160]=r),36160===t&&(h[36009]=r)),!0)},bindXRFramebuffer:function(t){t!==l&&(e.bindFramebuffer(36160,t),l=t)},useProgram:function(t){return c!==t&&(e.useProgram(t),c=t,!0)},setBlending:G,setMaterial:function(e,t){2===e.side?F(2884):N(2884);let r=1===e.side;t&&(r=!r),H(r),1===e.blending&&!1===e.transparent?G(0):G(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),s.setFunc(e.depthFunc),s.setTest(e.depthTest),s.setMask(e.depthWrite),i.setMask(e.colorWrite);let n=e.stencilWrite;a.setTest(n),n&&(a.setMask(e.stencilWriteMask),a.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),a.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),W(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?N(32926):F(32926)},setFlipSided:H,setCullFace:V,setLineWidth:function(t){t!==w&&(A&&e.lineWidth(t),w=t)},setPolygonOffset:W,setScissorTest:function(e){e?N(3089):F(3089)},activeTexture:j,bindTexture:function(t,r){null===R&&j();let n=L[R];void 0===n&&(n={type:void 0,texture:void 0},L[R]=n),(n.type!==t||n.texture!==r)&&(e.bindTexture(t,r||O[t]),n.type=t,n.texture=r)},unbindTexture:function(){let t=L[R];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===k.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),k.copy(t))},viewport:function(t){!1===D.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),D.copy(t))},reset:function(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),!0===n&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),o={},R=null,L={},l=null,h={},c=null,u=!1,d=null,p=null,f=null,m=null,g=null,v=null,y=null,x=!1,_=null,b=null,w=null,S=null,T=null,k.set(0,0,e.canvas.width,e.canvas.height),D.set(0,0,e.canvas.width,e.canvas.height),i.reset(),s.reset(),a.reset()}}}function iI(e,t,r,n,i,s,a){let o;let l=i.isWebGL2,h=i.maxTextures,c=i.maxCubemapSize,u=i.maxTextureSize,d=i.maxSamples,p=new WeakMap,f=!1;try{f="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function m(e,t){return f?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function g(e,t,r,n){let i=1;if((e.width>n||e.height>n)&&(i=n/Math.max(e.width,e.height)),i<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){let n=t?eu:Math.floor,s=n(i*e.width),a=n(i*e.height);void 0===o&&(o=m(s,a));let l=r?m(s,a):o;return l.width=s,l.height=a,l.getContext("2d").drawImage(e,0,0,s,a),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+s+"x"+a+")."),l}"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+").")}return e}function v(e){return eh(e.width)&&eh(e.height)}function y(e,t){return e.generateMipmaps&&t&&1003!==e.minFilter&&1006!==e.minFilter}function x(t,r,i,s,a=1){e.generateMipmap(t),n.get(r).__maxMipLevel=Math.log2(Math.max(i,s,a))}function _(r,n,i){if(!1===l)return n;if(null!==r){if(void 0!==e[r])return e[r];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+r+"'")}let s=n;return 6403===n&&(5126===i&&(s=33326),5131===i&&(s=33325),5121===i&&(s=33321)),6407===n&&(5126===i&&(s=34837),5131===i&&(s=34843),5121===i&&(s=32849)),6408===n&&(5126===i&&(s=34836),5131===i&&(s=34842),5121===i&&(s=32856)),(33325===s||33326===s||34842===s||34836===s)&&t.get("EXT_color_buffer_float"),s}function b(e){return 1003===e||1004===e||1005===e?9728:9729}function w(t){let r=t.target;r.removeEventListener("dispose",w),function(t){let r=n.get(t);void 0!==r.__webglInit&&(e.deleteTexture(r.__webglTexture),n.remove(t))}(r),r.isVideoTexture&&p.delete(r),a.memory.textures--}function S(t){let r=t.target;r.removeEventListener("dispose",S),function(t){let r=t.texture,i=n.get(t),s=n.get(r);if(t){if(void 0!==s.__webglTexture&&(e.deleteTexture(s.__webglTexture),a.memory.textures--),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++)e.deleteFramebuffer(i.__webglFramebuffer[t]),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer[t]);else e.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer),i.__webglMultisampledFramebuffer&&e.deleteFramebuffer(i.__webglMultisampledFramebuffer),i.__webglColorRenderbuffer&&e.deleteRenderbuffer(i.__webglColorRenderbuffer),i.__webglDepthRenderbuffer&&e.deleteRenderbuffer(i.__webglDepthRenderbuffer);if(t.isWebGLMultipleRenderTargets)for(let t=0,i=r.length;t<i;t++){let i=n.get(r[t]);i.__webglTexture&&(e.deleteTexture(i.__webglTexture),a.memory.textures--),n.remove(r[t])}n.remove(r),n.remove(t)}}(r)}let T=0;function E(e,t){let i=n.get(e);if(e.isVideoTexture&&function(e){let t=a.render.frame;p.get(e)!==t&&(p.set(e,t),e.update())}(e),e.version>0&&i.__version!==e.version){let r=e.image;if(void 0===r)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else if(!1===r.complete)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{P(i,e,t);return}}r.activeTexture(33984+t),r.bindTexture(3553,i.__webglTexture)}function A(t,i){let a=n.get(t);if(t.version>0&&a.__version!==t.version){!function(t,n,i){let a;if(6!==n.image.length)return;I(t,n),r.activeTexture(33984+i),r.bindTexture(34067,t.__webglTexture),e.pixelStorei(37440,n.flipY),e.pixelStorei(37441,n.premultiplyAlpha),e.pixelStorei(3317,n.unpackAlignment),e.pixelStorei(37443,0);let o=n&&(n.isCompressedTexture||n.image[0].isCompressedTexture),h=n.image[0]&&n.image[0].isDataTexture,u=[];for(let e=0;e<6;e++)o||h?u[e]=h?n.image[e].image:n.image[e]:u[e]=g(n.image[e],!1,!0,c);let d=u[0],p=v(d)||l,f=s.convert(n.format),m=s.convert(n.type),b=_(n.internalFormat,f,m);if(L(34067,n,p),o){for(let e=0;e<6;e++){a=u[e].mipmaps;for(let t=0;t<a.length;t++){let i=a[t];1023!==n.format&&1022!==n.format?null!==f?r.compressedTexImage2D(34069+e,t,b,i.width,i.height,0,i.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):r.texImage2D(34069+e,t,b,i.width,i.height,0,f,m,i.data)}}t.__maxMipLevel=a.length-1}else{a=n.mipmaps;for(let e=0;e<6;e++)if(h){r.texImage2D(34069+e,0,b,u[e].width,u[e].height,0,f,m,u[e].data);for(let t=0;t<a.length;t++){let n=a[t].image[e].image;r.texImage2D(34069+e,t+1,b,n.width,n.height,0,f,m,n.data)}}else{r.texImage2D(34069+e,0,b,f,m,u[e]);for(let t=0;t<a.length;t++){let n=a[t];r.texImage2D(34069+e,t+1,b,f,m,n.image[e])}}t.__maxMipLevel=a.length}y(n,p)&&x(34067,n,d.width,d.height),t.__version=n.version,n.onUpdate&&n.onUpdate(n)}(a,t,i);return}r.activeTexture(33984+i),r.bindTexture(34067,a.__webglTexture)}let C={1e3:10497,1001:33071,1002:33648},R={1003:9728,1004:9984,1005:9986,1006:9729,1007:9985,1008:9987};function L(r,s,a){if(a?(e.texParameteri(r,10242,C[s.wrapS]),e.texParameteri(r,10243,C[s.wrapT]),(32879===r||35866===r)&&e.texParameteri(r,32882,C[s.wrapR]),e.texParameteri(r,10240,R[s.magFilter]),e.texParameteri(r,10241,R[s.minFilter])):(e.texParameteri(r,10242,33071),e.texParameteri(r,10243,33071),(32879===r||35866===r)&&e.texParameteri(r,32882,33071),(1001!==s.wrapS||1001!==s.wrapT)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(r,10240,b(s.magFilter)),e.texParameteri(r,10241,b(s.minFilter)),1003!==s.minFilter&&1006!==s.minFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){let a=t.get("EXT_texture_filter_anisotropic");(1015!==s.type||!1!==t.has("OES_texture_float_linear"))&&(!1!==l||1016!==s.type||!1!==t.has("OES_texture_half_float_linear"))&&(s.anisotropy>1||n.get(s).__currentAnisotropy)&&(e.texParameterf(r,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,i.getMaxAnisotropy())),n.get(s).__currentAnisotropy=s.anisotropy)}}function I(t,r){void 0===t.__webglInit&&(t.__webglInit=!0,r.addEventListener("dispose",w),t.__webglTexture=e.createTexture(),a.memory.textures++)}function P(t,n,i){let a,o=3553;n.isDataTexture2DArray&&(o=35866),n.isDataTexture3D&&(o=32879),I(t,n),r.activeTexture(33984+i),r.bindTexture(o,t.__webglTexture),e.pixelStorei(37440,n.flipY),e.pixelStorei(37441,n.premultiplyAlpha),e.pixelStorei(3317,n.unpackAlignment),e.pixelStorei(37443,0);let h=!l&&(1001!==n.wrapS||1001!==n.wrapT||1003!==n.minFilter&&1006!==n.minFilter)&&!1===v(n.image),c=g(n.image,h,!1,u),d=v(c)||l,p=s.convert(n.format),f=s.convert(n.type),m=_(n.internalFormat,p,f);L(o,n,d);let b=n.mipmaps;if(n.isDepthTexture)m=6402,l?m=1015===n.type?36012:1014===n.type?33190:1020===n.type?35056:33189:1015===n.type&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),1026===n.format&&6402===m&&1012!==n.type&&1014!==n.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=1012,f=s.convert(n.type)),1027===n.format&&6402===m&&(m=34041,1020!==n.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=1020,f=s.convert(n.type))),r.texImage2D(3553,0,m,c.width,c.height,0,p,f,null);else if(n.isDataTexture){if(b.length>0&&d){for(let e=0,t=b.length;e<t;e++)a=b[e],r.texImage2D(3553,e,m,a.width,a.height,0,p,f,a.data);n.generateMipmaps=!1,t.__maxMipLevel=b.length-1}else r.texImage2D(3553,0,m,c.width,c.height,0,p,f,c.data),t.__maxMipLevel=0}else if(n.isCompressedTexture){for(let e=0,t=b.length;e<t;e++)a=b[e],1023!==n.format&&1022!==n.format?null!==p?r.compressedTexImage2D(3553,e,m,a.width,a.height,0,a.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):r.texImage2D(3553,e,m,a.width,a.height,0,p,f,a.data);t.__maxMipLevel=b.length-1}else if(n.isDataTexture2DArray)r.texImage3D(35866,0,m,c.width,c.height,c.depth,0,p,f,c.data),t.__maxMipLevel=0;else if(n.isDataTexture3D)r.texImage3D(32879,0,m,c.width,c.height,c.depth,0,p,f,c.data),t.__maxMipLevel=0;else if(b.length>0&&d){for(let e=0,t=b.length;e<t;e++)a=b[e],r.texImage2D(3553,e,m,p,f,a);n.generateMipmaps=!1,t.__maxMipLevel=b.length-1}else r.texImage2D(3553,0,m,p,f,c),t.__maxMipLevel=0;y(n,d)&&x(o,n,c.width,c.height),t.__version=n.version,n.onUpdate&&n.onUpdate(n)}function k(t,i,a,o,l){let h=s.convert(a.format),c=s.convert(a.type),u=_(a.internalFormat,h,c);32879===l||35866===l?r.texImage3D(l,0,u,i.width,i.height,i.depth,0,h,c,null):r.texImage2D(l,0,u,i.width,i.height,0,h,c,null),r.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,o,l,n.get(a).__webglTexture,0),r.bindFramebuffer(36160,null)}function D(t,r,n){if(e.bindRenderbuffer(36161,t),r.depthBuffer&&!r.stencilBuffer){let i=33189;if(n){let t=r.depthTexture;t&&t.isDepthTexture&&(1015===t.type?i=36012:1014===t.type&&(i=33190));let n=U(r);e.renderbufferStorageMultisample(36161,n,i,r.width,r.height)}else e.renderbufferStorage(36161,i,r.width,r.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(r.depthBuffer&&r.stencilBuffer){if(n){let t=U(r);e.renderbufferStorageMultisample(36161,t,35056,r.width,r.height)}else e.renderbufferStorage(36161,34041,r.width,r.height);e.framebufferRenderbuffer(36160,33306,36161,t)}else{let t=!0===r.isWebGLMultipleRenderTargets?r.texture[0]:r.texture,i=s.convert(t.format),a=s.convert(t.type),o=_(t.internalFormat,i,a);if(n){let t=U(r);e.renderbufferStorageMultisample(36161,t,o,r.width,r.height)}else e.renderbufferStorage(36161,o,r.width,r.height)}e.bindRenderbuffer(36161,null)}function U(e){return l&&e.isWebGLMultisampleRenderTarget?Math.min(d,e.samples):0}let O=!1,N=!1;this.allocateTextureUnit=function(){let e=T;return e>=h&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+h),T+=1,e},this.resetTextureUnits=function(){T=0},this.setTexture2D=E,this.setTexture2DArray=function(e,t){let i=n.get(e);if(e.version>0&&i.__version!==e.version){P(i,e,t);return}r.activeTexture(33984+t),r.bindTexture(35866,i.__webglTexture)},this.setTexture3D=function(e,t){let i=n.get(e);if(e.version>0&&i.__version!==e.version){P(i,e,t);return}r.activeTexture(33984+t),r.bindTexture(32879,i.__webglTexture)},this.setTextureCube=A,this.setupRenderTarget=function(t){let o=t.texture,h=n.get(t),c=n.get(o);t.addEventListener("dispose",S),!0!==t.isWebGLMultipleRenderTargets&&(c.__webglTexture=e.createTexture(),c.__version=o.version,a.memory.textures++);let u=!0===t.isWebGLCubeRenderTarget,d=!0===t.isWebGLMultipleRenderTargets,p=!0===t.isWebGLMultisampleRenderTarget,f=o.isDataTexture3D||o.isDataTexture2DArray,m=v(t)||l;if(l&&1022===o.format&&(1015===o.type||1016===o.type)&&(o.format=1023,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),u){h.__webglFramebuffer=[];for(let t=0;t<6;t++)h.__webglFramebuffer[t]=e.createFramebuffer()}else if(h.__webglFramebuffer=e.createFramebuffer(),d){if(i.drawBuffers){let r=t.texture;for(let t=0,i=r.length;t<i;t++){let i=n.get(r[t]);void 0===i.__webglTexture&&(i.__webglTexture=e.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.")}else if(p){if(l){h.__webglMultisampledFramebuffer=e.createFramebuffer(),h.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,h.__webglColorRenderbuffer);let n=s.convert(o.format),i=s.convert(o.type),a=_(o.internalFormat,n,i),l=U(t);e.renderbufferStorageMultisample(36161,l,a,t.width,t.height),r.bindFramebuffer(36160,h.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,h.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(h.__webglDepthRenderbuffer=e.createRenderbuffer(),D(h.__webglDepthRenderbuffer,t,!0)),r.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}if(u){r.bindTexture(34067,c.__webglTexture),L(34067,o,m);for(let e=0;e<6;e++)k(h.__webglFramebuffer[e],t,o,36064,34069+e);y(o,m)&&x(34067,o,t.width,t.height),r.unbindTexture()}else if(d){let e=t.texture;for(let i=0,s=e.length;i<s;i++){let s=e[i],a=n.get(s);r.bindTexture(3553,a.__webglTexture),L(3553,s,m),k(h.__webglFramebuffer,t,s,36064+i,3553),y(s,m)&&x(3553,s,t.width,t.height)}r.unbindTexture()}else{let e=3553;f&&(l?e=o.isDataTexture3D?32879:35866:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),r.bindTexture(e,c.__webglTexture),L(e,o,m),k(h.__webglFramebuffer,t,o,36064,e),y(o,m)&&x(e,o,t.width,t.height,t.depth),r.unbindTexture()}t.depthBuffer&&function(t){let i=n.get(t),s=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(s)throw Error("target.depthTexture not supported in Cube render targets");!function(t,i){if(i&&i.isWebGLCubeRenderTarget)throw Error("Depth Texture with cube render targets is not supported");if(r.bindFramebuffer(36160,t),!(i.depthTexture&&i.depthTexture.isDepthTexture))throw Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),E(i.depthTexture,0);let s=n.get(i.depthTexture).__webglTexture;if(1026===i.depthTexture.format)e.framebufferTexture2D(36160,36096,3553,s,0);else if(1027===i.depthTexture.format)e.framebufferTexture2D(36160,33306,3553,s,0);else throw Error("Unknown depthTexture format")}(i.__webglFramebuffer,t)}else if(s){i.__webglDepthbuffer=[];for(let n=0;n<6;n++)r.bindFramebuffer(36160,i.__webglFramebuffer[n]),i.__webglDepthbuffer[n]=e.createRenderbuffer(),D(i.__webglDepthbuffer[n],t,!1)}else r.bindFramebuffer(36160,i.__webglFramebuffer),i.__webglDepthbuffer=e.createRenderbuffer(),D(i.__webglDepthbuffer,t,!1);r.bindFramebuffer(36160,null)}(t)},this.updateRenderTargetMipmap=function(e){let t=v(e)||l,i=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture];for(let s=0,a=i.length;s<a;s++){let a=i[s];if(y(a,t)){let t=e.isWebGLCubeRenderTarget?34067:3553,i=n.get(a).__webglTexture;r.bindTexture(t,i),x(t,a,e.width,e.height),r.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget){if(l){let i=t.width,s=t.height,a=16384;t.depthBuffer&&(a|=256),t.stencilBuffer&&(a|=1024);let o=n.get(t);r.bindFramebuffer(36008,o.__webglMultisampledFramebuffer),r.bindFramebuffer(36009,o.__webglFramebuffer),e.blitFramebuffer(0,0,i,s,0,0,i,s,a,9728),r.bindFramebuffer(36008,null),r.bindFramebuffer(36009,o.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===O&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),O=!0),e=e.texture),E(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===N&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),N=!0),e=e.texture),A(e,t)}}function iP(e,t,r){let n=r.isWebGL2;return{convert:function(e){let r;if(1009===e)return 5121;if(1017===e)return 32819;if(1018===e)return 32820;if(1019===e)return 33635;if(1010===e)return 5120;if(1011===e)return 5122;if(1012===e)return 5123;if(1013===e)return 5124;if(1014===e)return 5125;if(1015===e)return 5126;if(1016===e)return n?5131:null!==(r=t.get("OES_texture_half_float"))?r.HALF_FLOAT_OES:null;if(1021===e)return 6406;if(1022===e)return 6407;if(1023===e)return 6408;if(1024===e)return 6409;if(1025===e)return 6410;if(1026===e)return 6402;if(1027===e)return 34041;if(1028===e)return 6403;if(1029===e)return 36244;if(1030===e)return 33319;if(1031===e)return 33320;if(1032===e)return 36248;if(1033===e)return 36249;if(33776===e||33777===e||33778===e||33779===e){if(null===(r=t.get("WEBGL_compressed_texture_s3tc")))return null;if(33776===e)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===e)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===e)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===e)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===e||35841===e||35842===e||35843===e){if(null===(r=t.get("WEBGL_compressed_texture_pvrtc")))return null;if(35840===e)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===e)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===e)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===e)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===e)return null!==(r=t.get("WEBGL_compressed_texture_etc1"))?r.COMPRESSED_RGB_ETC1_WEBGL:null;if((37492===e||37496===e)&&null!==(r=t.get("WEBGL_compressed_texture_etc"))){if(37492===e)return r.COMPRESSED_RGB8_ETC2;if(37496===e)return r.COMPRESSED_RGBA8_ETC2_EAC}return 37808===e||37809===e||37810===e||37811===e||37812===e||37813===e||37814===e||37815===e||37816===e||37817===e||37818===e||37819===e||37820===e||37821===e||37840===e||37841===e||37842===e||37843===e||37844===e||37845===e||37846===e||37847===e||37848===e||37849===e||37850===e||37851===e||37852===e||37853===e?null!==(r=t.get("WEBGL_compressed_texture_astc"))?e:null:36492===e?null!==(r=t.get("EXT_texture_compression_bptc"))?e:null:1020===e?n?34042:null!==(r=t.get("WEBGL_depth_texture"))?r.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}iC.prototype.isMeshDistanceMaterial=!0;class ik extends rp{constructor(e=[]){super(),this.cameras=e}}ik.prototype.isArrayCamera=!0;class iD extends tm{constructor(){super(),this.type="Group"}}iD.prototype.isGroup=!0;const iU={type:"move"};class iO{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new iD,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new iD,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new eS,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new eS),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new iD,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new eS,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new eS),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,r){let n=null,i=null,s=null,a=this._targetRay,o=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(null!==a&&null!==(n=t.getPose(e.targetRaySpace,r))&&(a.matrix.fromArray(n.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),n.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(n.linearVelocity)):a.hasLinearVelocity=!1,n.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(n.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(iU)),l&&e.hand){for(let n of(s=!0,e.hand.values())){let e=t.getJointPose(n,r);if(void 0===l.joints[n.jointName]){let e=new iD;e.matrixAutoUpdate=!1,e.visible=!1,l.joints[n.jointName]=e,l.add(e)}let i=l.joints[n.jointName];null!==e&&(i.matrix.fromArray(e.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.jointRadius=e.radius),i.visible=null!==e}let n=l.joints["index-finger-tip"],i=l.joints["thumb-tip"],a=n.position.distanceTo(i.position);l.inputState.pinching&&a>.025?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&a<=.015&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==o&&e.gripSpace&&null!==(i=t.getPose(e.gripSpace,r))&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1)}return null!==a&&(a.visible=null!==n),null!==o&&(o.visible=null!==i),null!==l&&(l.visible=null!==s),this}}class iN extends ee{constructor(e,t){super();let r=this,n=e.state,i=null,s=1,a=null,o="local-floor",l=null,h=null,c=null,u=null,d=null,p=!1,f=null,m=null,g=null,v=null,y=null,x=null,_=[],b=new Map,w=new rp;w.layers.enable(1),w.viewport=new ex;let S=new rp;S.layers.enable(2),S.viewport=new ex;let T=[w,S],E=new ik;E.layers.enable(1),E.layers.enable(2);let A=null,C=null;function R(e){let t=b.get(e.inputSource);t&&t.dispatchEvent({type:e.type,data:e.inputSource})}function L(){b.forEach(function(e,t){e.disconnect(t)}),b.clear(),A=null,C=null,n.bindXRFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),c&&t.deleteFramebuffer(c),f&&t.deleteFramebuffer(f),m&&t.deleteRenderbuffer(m),g&&t.deleteRenderbuffer(g),c=null,f=null,m=null,g=null,d=null,u=null,h=null,i=null,O.stop(),r.isPresenting=!1,r.dispatchEvent({type:"sessionend"})}function I(e){let t=i.inputSources;for(let e=0;e<_.length;e++)b.set(t[e],_[e]);for(let t=0;t<e.removed.length;t++){let r=e.removed[t],n=b.get(r);n&&(n.dispatchEvent({type:"disconnected",data:r}),b.delete(r))}for(let t=0;t<e.added.length;t++){let r=e.added[t],n=b.get(r);n&&n.dispatchEvent({type:"connected",data:r})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=_[e];return void 0===t&&(t=new iO,_[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=_[e];return void 0===t&&(t=new iO,_[e]=t),t.getGripSpace()},this.getHand=function(e){let t=_[e];return void 0===t&&(t=new iO,_[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){s=e,!0===r.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){o=e,!0===r.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return a},this.getBaseLayer=function(){return null!==u?u:d},this.getBinding=function(){return h},this.getFrame=function(){return v},this.getSession=function(){return i},this.setSession=async function(e){if(null!==(i=e)){i.addEventListener("select",R),i.addEventListener("selectstart",R),i.addEventListener("selectend",R),i.addEventListener("squeeze",R),i.addEventListener("squeezestart",R),i.addEventListener("squeezeend",R),i.addEventListener("end",L),i.addEventListener("inputsourceschange",I);let e=t.getContextAttributes();if(!0!==e.xrCompatible&&await t.makeXRCompatible(),void 0===i.renderState.layers){let r={antialias:e.antialias,alpha:e.alpha,depth:e.depth,stencil:e.stencil,framebufferScaleFactor:s};d=new XRWebGLLayer(i,t,r),i.updateRenderState({baseLayer:d})}else if(t instanceof WebGLRenderingContext){let r={antialias:!0,alpha:e.alpha,depth:e.depth,stencil:e.stencil,framebufferScaleFactor:s};d=new XRWebGLLayer(i,t,r),i.updateRenderState({layers:[d]})}else{p=e.antialias;let r=null;e.depth&&(x=256,e.stencil&&(x|=1024),y=e.stencil?33306:36096,r=e.stencil?35056:33190);let a={colorFormat:e.alpha?32856:32849,depthFormat:r,scaleFactor:s};u=(h=new XRWebGLBinding(i,t)).createProjectionLayer(a),c=t.createFramebuffer(),i.updateRenderState({layers:[u]}),p&&(f=t.createFramebuffer(),m=t.createRenderbuffer(),t.bindRenderbuffer(36161,m),t.renderbufferStorageMultisample(36161,4,32856,u.textureWidth,u.textureHeight),n.bindFramebuffer(36160,f),t.framebufferRenderbuffer(36160,36064,36161,m),t.bindRenderbuffer(36161,null),null!==r&&(g=t.createRenderbuffer(),t.bindRenderbuffer(36161,g),t.renderbufferStorageMultisample(36161,4,r,u.textureWidth,u.textureHeight),t.framebufferRenderbuffer(36160,y,36161,g),t.bindRenderbuffer(36161,null)),n.bindFramebuffer(36160,null))}a=await i.requestReferenceSpace(o),O.setContext(i),O.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}};let P=new eS,k=new eS;function D(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===i)return;E.near=S.near=w.near=e.near,E.far=S.far=w.far=e.far,(A!==E.near||C!==E.far)&&(i.updateRenderState({depthNear:E.near,depthFar:E.far}),A=E.near,C=E.far);let t=e.parent,r=E.cameras;D(E,t);for(let e=0;e<r.length;e++)D(r[e],t);E.matrixWorld.decompose(E.position,E.quaternion,E.scale),e.position.copy(E.position),e.quaternion.copy(E.quaternion),e.scale.copy(E.scale),e.matrix.copy(E.matrix),e.matrixWorld.copy(E.matrixWorld);let n=e.children;for(let e=0,t=n.length;e<t;e++)n[e].updateMatrixWorld(!0);2===r.length?function(e,t,r){P.setFromMatrixPosition(t.matrixWorld),k.setFromMatrixPosition(r.matrixWorld);let n=P.distanceTo(k),i=t.projectionMatrix.elements,s=r.projectionMatrix.elements,a=i[14]/(i[10]-1),o=i[14]/(i[10]+1),l=(i[9]+1)/i[5],h=(i[9]-1)/i[5],c=(i[8]-1)/i[0],u=(s[8]+1)/s[0],d=n/(-c+u),p=-(d*c);t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(p),e.translateZ(d),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();let f=a+d,m=o+d;e.projectionMatrix.makePerspective(a*c-p,a*u+(n-p),l*o/m*f,h*o/m*f,f,m)}(E,w,S):E.projectionMatrix.copy(w.projectionMatrix)},this.getCamera=function(){return E},this.getFoveation=function(){return null!==u?u.fixedFoveation:null!==d?d.fixedFoveation:void 0},this.setFoveation=function(e){null!==u&&(u.fixedFoveation=e),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=e)};let U=null,O=new rM;O.setAnimationLoop(function(e,r){if(l=r.getViewerPose(a),v=r,null!==l){let e=l.views;null!==d&&n.bindXRFramebuffer(d.framebuffer);let r=!1;e.length!==E.cameras.length&&(E.cameras.length=0,r=!0);for(let i=0;i<e.length;i++){let s=e[i],a=null;if(null!==d)a=d.getViewport(s);else{let e=h.getViewSubImage(u,s);n.bindXRFramebuffer(c),void 0!==e.depthStencilTexture&&t.framebufferTexture2D(36160,y,3553,e.depthStencilTexture,0),t.framebufferTexture2D(36160,36064,3553,e.colorTexture,0),a=e.viewport}let o=T[i];o.matrix.fromArray(s.transform.matrix),o.projectionMatrix.fromArray(s.projectionMatrix),o.viewport.set(a.x,a.y,a.width,a.height),0===i&&E.matrix.copy(o.matrix),!0===r&&E.cameras.push(o)}p&&(n.bindXRFramebuffer(f),null!==x&&t.clear(x))}let s=i.inputSources;for(let e=0;e<_.length;e++){let t=_[e],n=s[e];t.update(n,r,a)}if(U&&U(e,r),p){let e=u.textureWidth,r=u.textureHeight;n.bindFramebuffer(36008,f),n.bindFramebuffer(36009,c),t.invalidateFramebuffer(36008,[y]),t.invalidateFramebuffer(36009,[y]),t.blitFramebuffer(0,0,e,r,0,0,e,r,16384,9728),t.invalidateFramebuffer(36008,[36064]),n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,null),n.bindFramebuffer(36160,f)}v=null}),this.setAnimationLoop=function(e){U=e},this.dispose=function(){}}}function iF(e){function t(t,r){let n,i;t.opacity.value=r.opacity,r.color&&t.diffuse.value.copy(r.color),r.emissive&&t.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),r.map&&(t.map.value=r.map),r.alphaMap&&(t.alphaMap.value=r.alphaMap),r.specularMap&&(t.specularMap.value=r.specularMap),r.alphaTest>0&&(t.alphaTest.value=r.alphaTest);let s=e.get(r).envMap;if(s){t.envMap.value=s,t.flipEnvMap.value=s.isCubeTexture&&!1===s.isRenderTargetTexture?-1:1,t.reflectivity.value=r.reflectivity,t.ior.value=r.ior,t.refractionRatio.value=r.refractionRatio;let n=e.get(s).__maxMipLevel;void 0!==n&&(t.maxMipLevel.value=n)}r.lightMap&&(t.lightMap.value=r.lightMap,t.lightMapIntensity.value=r.lightMapIntensity),r.aoMap&&(t.aoMap.value=r.aoMap,t.aoMapIntensity.value=r.aoMapIntensity),r.map?n=r.map:r.specularMap?n=r.specularMap:r.displacementMap?n=r.displacementMap:r.normalMap?n=r.normalMap:r.bumpMap?n=r.bumpMap:r.roughnessMap?n=r.roughnessMap:r.metalnessMap?n=r.metalnessMap:r.alphaMap?n=r.alphaMap:r.emissiveMap?n=r.emissiveMap:r.clearcoatMap?n=r.clearcoatMap:r.clearcoatNormalMap?n=r.clearcoatNormalMap:r.clearcoatRoughnessMap?n=r.clearcoatRoughnessMap:r.specularIntensityMap?n=r.specularIntensityMap:r.specularTintMap?n=r.specularTintMap:r.transmissionMap?n=r.transmissionMap:r.thicknessMap&&(n=r.thicknessMap),void 0!==n&&(n.isWebGLRenderTarget&&(n=n.texture),!0===n.matrixAutoUpdate&&n.updateMatrix(),t.uvTransform.value.copy(n.matrix)),r.aoMap?i=r.aoMap:r.lightMap&&(i=r.lightMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uv2Transform.value.copy(i.matrix))}function r(t,r){t.roughness.value=r.roughness,t.metalness.value=r.metalness,r.roughnessMap&&(t.roughnessMap.value=r.roughnessMap),r.metalnessMap&&(t.metalnessMap.value=r.metalnessMap),r.emissiveMap&&(t.emissiveMap.value=r.emissiveMap),r.bumpMap&&(t.bumpMap.value=r.bumpMap,t.bumpScale.value=r.bumpScale,1===r.side&&(t.bumpScale.value*=-1)),r.normalMap&&(t.normalMap.value=r.normalMap,t.normalScale.value.copy(r.normalScale),1===r.side&&t.normalScale.value.negate()),r.displacementMap&&(t.displacementMap.value=r.displacementMap,t.displacementScale.value=r.displacementScale,t.displacementBias.value=r.displacementBias),e.get(r).envMap&&(t.envMapIntensity.value=r.envMapIntensity)}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,n,i,s,a){let o,l;n.isMeshBasicMaterial?t(e,n):n.isMeshLambertMaterial?(t(e,n),n.emissiveMap&&(e.emissiveMap.value=n.emissiveMap)):n.isMeshToonMaterial?(t(e,n),n.gradientMap&&(e.gradientMap.value=n.gradientMap),n.emissiveMap&&(e.emissiveMap.value=n.emissiveMap),n.bumpMap&&(e.bumpMap.value=n.bumpMap,e.bumpScale.value=n.bumpScale,1===n.side&&(e.bumpScale.value*=-1)),n.normalMap&&(e.normalMap.value=n.normalMap,e.normalScale.value.copy(n.normalScale),1===n.side&&e.normalScale.value.negate()),n.displacementMap&&(e.displacementMap.value=n.displacementMap,e.displacementScale.value=n.displacementScale,e.displacementBias.value=n.displacementBias)):n.isMeshPhongMaterial?(t(e,n),e.specular.value.copy(n.specular),e.shininess.value=Math.max(n.shininess,1e-4),n.emissiveMap&&(e.emissiveMap.value=n.emissiveMap),n.bumpMap&&(e.bumpMap.value=n.bumpMap,e.bumpScale.value=n.bumpScale,1===n.side&&(e.bumpScale.value*=-1)),n.normalMap&&(e.normalMap.value=n.normalMap,e.normalScale.value.copy(n.normalScale),1===n.side&&e.normalScale.value.negate()),n.displacementMap&&(e.displacementMap.value=n.displacementMap,e.displacementScale.value=n.displacementScale,e.displacementBias.value=n.displacementBias)):n.isMeshStandardMaterial?(t(e,n),n.isMeshPhysicalMaterial?(r(e,n),e.ior.value=n.ior,n.sheenTint&&e.sheenTint.value.copy(n.sheenTint),n.clearcoat>0&&(e.clearcoat.value=n.clearcoat,e.clearcoatRoughness.value=n.clearcoatRoughness,n.clearcoatMap&&(e.clearcoatMap.value=n.clearcoatMap),n.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=n.clearcoatRoughnessMap),n.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(n.clearcoatNormalScale),e.clearcoatNormalMap.value=n.clearcoatNormalMap,1===n.side&&e.clearcoatNormalScale.value.negate())),n.transmission>0&&(e.transmission.value=n.transmission,e.transmissionSamplerMap.value=a.texture,e.transmissionSamplerSize.value.set(a.width,a.height),n.transmissionMap&&(e.transmissionMap.value=n.transmissionMap),e.thickness.value=n.thickness,n.thicknessMap&&(e.thicknessMap.value=n.thicknessMap),e.attenuationDistance.value=n.attenuationDistance,e.attenuationTint.value.copy(n.attenuationTint)),e.specularIntensity.value=n.specularIntensity,e.specularTint.value.copy(n.specularTint),n.specularIntensityMap&&(e.specularIntensityMap.value=n.specularIntensityMap),n.specularTintMap&&(e.specularTintMap.value=n.specularTintMap)):r(e,n)):n.isMeshMatcapMaterial?(t(e,n),n.matcap&&(e.matcap.value=n.matcap),n.bumpMap&&(e.bumpMap.value=n.bumpMap,e.bumpScale.value=n.bumpScale,1===n.side&&(e.bumpScale.value*=-1)),n.normalMap&&(e.normalMap.value=n.normalMap,e.normalScale.value.copy(n.normalScale),1===n.side&&e.normalScale.value.negate()),n.displacementMap&&(e.displacementMap.value=n.displacementMap,e.displacementScale.value=n.displacementScale,e.displacementBias.value=n.displacementBias)):n.isMeshDepthMaterial?(t(e,n),n.displacementMap&&(e.displacementMap.value=n.displacementMap,e.displacementScale.value=n.displacementScale,e.displacementBias.value=n.displacementBias)):n.isMeshDistanceMaterial?(t(e,n),n.displacementMap&&(e.displacementMap.value=n.displacementMap,e.displacementScale.value=n.displacementScale,e.displacementBias.value=n.displacementBias),e.referencePosition.value.copy(n.referencePosition),e.nearDistance.value=n.nearDistance,e.farDistance.value=n.farDistance):n.isMeshNormalMaterial?(t(e,n),n.bumpMap&&(e.bumpMap.value=n.bumpMap,e.bumpScale.value=n.bumpScale,1===n.side&&(e.bumpScale.value*=-1)),n.normalMap&&(e.normalMap.value=n.normalMap,e.normalScale.value.copy(n.normalScale),1===n.side&&e.normalScale.value.negate()),n.displacementMap&&(e.displacementMap.value=n.displacementMap,e.displacementScale.value=n.displacementScale,e.displacementBias.value=n.displacementBias)):n.isLineBasicMaterial?(e.diffuse.value.copy(n.color),e.opacity.value=n.opacity,n.isLineDashedMaterial&&(e.dashSize.value=n.dashSize,e.totalSize.value=n.dashSize+n.gapSize,e.scale.value=n.scale)):n.isPointsMaterial?(e.diffuse.value.copy(n.color),e.opacity.value=n.opacity,e.size.value=n.size*i,e.scale.value=.5*s,n.map&&(e.map.value=n.map),n.alphaMap&&(e.alphaMap.value=n.alphaMap),n.alphaTest>0&&(e.alphaTest.value=n.alphaTest),n.map?o=n.map:n.alphaMap&&(o=n.alphaMap),void 0!==o&&(!0===o.matrixAutoUpdate&&o.updateMatrix(),e.uvTransform.value.copy(o.matrix))):n.isSpriteMaterial?(e.diffuse.value.copy(n.color),e.opacity.value=n.opacity,e.rotation.value=n.rotation,n.map&&(e.map.value=n.map),n.alphaMap&&(e.alphaMap.value=n.alphaMap),n.alphaTest>0&&(e.alphaTest.value=n.alphaTest),n.map?l=n.map:n.alphaMap&&(l=n.alphaMap),void 0!==l&&(!0===l.matrixAutoUpdate&&l.updateMatrix(),e.uvTransform.value.copy(l.matrix))):n.isShadowMaterial?(e.color.value.copy(n.color),e.opacity.value=n.opacity):n.isShaderMaterial&&(n.uniformsNeedUpdate=!1)}}}function iB(e={}){let t,r,n,i,s,a,o,l,h,c,u,d,p,f,m,g,v,y,x,_,b,w,S;let T=void 0!==e.canvas?e.canvas:function(){let e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return e.style.display="block",e}(),E=void 0!==e.context?e.context:null,A=void 0!==e.alpha&&e.alpha,C=void 0===e.depth||e.depth,R=void 0===e.stencil||e.stencil,L=void 0!==e.antialias&&e.antialias,I=void 0===e.premultipliedAlpha||e.premultipliedAlpha,P=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,k=void 0!==e.powerPreference?e.powerPreference:"default",D=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat,U=null,O=null,N=[],F=[];this.domElement=T,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=3e3,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;let B=this,z=!1,G=0,H=0,V=null,W=-1,j=null,q=new ex,X=new ex,Y=null,J=T.width,Z=T.height,$=1,K=null,Q=null,ee=new ex(0,0,J,Z),et=new ex(0,0,J,Z),er=!1,en=[],ei=new rS,es=!1,ea=!1,eo=null,el=new e0,eh=new eS,ec={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function eu(){return null===V?$:1}let ed=E;function ep(e,t){for(let r=0;r<e.length;r++){let n=e[r],i=T.getContext(n,t);if(null!==i)return i}return null}try{if(T.addEventListener("webglcontextlost",eg,!1),T.addEventListener("webglcontextrestored",ev,!1),null===ed){let e=["webgl2","webgl","experimental-webgl"];if(!0===B.isWebGL1Renderer&&e.shift(),ed=ep(e,{alpha:A,depth:C,stencil:R,antialias:L,premultipliedAlpha:I,preserveDrawingBuffer:P,powerPreference:k,failIfMajorPerformanceCaveat:D}),null===ed){if(ep(e))throw Error("Error creating WebGL context with your selected attributes.");throw Error("Error creating WebGL context.")}}void 0===ed.getShaderPrecisionFormat&&(ed.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function ef(){t=new r4(ed),r=new rk(ed,t,e),t.init(r),w=new iP(ed,t,r),n=new iL(ed,t,r),en[0]=1029,i=new r8(ed),s=new ig,a=new iI(ed,t,n,s,r,w,i),o=new rU(B),l=new r3(B),h=new rT(ed,r),S=new rI(ed,t,h,r),c=new r5(ed,h,i,S),u=new nt(ed,c,h,i),x=new ne(ed),g=new rD(s),d=new im(B,o,l,t,r,S,g),p=new iF(s),f=new i_(s),m=new iE(t,r),y=new rL(B,o,n,u,I),v=new iR(B,u,r),_=new rP(ed,t,i,r),b=new r6(ed,t,i,r),i.programs=d.programs,B.capabilities=r,B.extensions=t,B.properties=s,B.renderLists=f,B.shadowMap=v,B.state=n,B.info=i}ef();let em=new iN(B,ed);function eg(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),z=!0}function ev(){console.log("THREE.WebGLRenderer: Context Restored."),z=!1;let e=i.autoReset,t=v.enabled,r=v.autoUpdate,n=v.needsUpdate,s=v.type;ef(),i.autoReset=e,v.enabled=t,v.autoUpdate=r,v.needsUpdate=n,v.type=s}function ey(e){let t=e.target;t.removeEventListener("dispose",ey),function(e){let t=s.get(e).programs;void 0!==t&&t.forEach(function(e){d.releaseProgram(e)})}(t),s.remove(t)}this.xr=em,this.getContext=function(){return ed},this.getContextAttributes=function(){return ed.getContextAttributes()},this.forceContextLoss=function(){let e=t.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){let e=t.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return $},this.setPixelRatio=function(e){void 0!==e&&($=e,this.setSize(J,Z,!1))},this.getSize=function(e){return e.set(J,Z)},this.setSize=function(e,t,r){if(em.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}J=e,Z=t,T.width=Math.floor(e*$),T.height=Math.floor(t*$),!1!==r&&(T.style.width=e+"px",T.style.height=t+"px"),this.setViewport(0,0,e,t)},this.getDrawingBufferSize=function(e){return e.set(J*$,Z*$).floor()},this.setDrawingBufferSize=function(e,t,r){J=e,Z=t,$=r,T.width=Math.floor(e*r),T.height=Math.floor(t*r),this.setViewport(0,0,e,t)},this.getCurrentViewport=function(e){return e.copy(q)},this.getViewport=function(e){return e.copy(ee)},this.setViewport=function(e,t,r,i){e.isVector4?ee.set(e.x,e.y,e.z,e.w):ee.set(e,t,r,i),n.viewport(q.copy(ee).multiplyScalar($).floor())},this.getScissor=function(e){return e.copy(et)},this.setScissor=function(e,t,r,i){e.isVector4?et.set(e.x,e.y,e.z,e.w):et.set(e,t,r,i),n.scissor(X.copy(et).multiplyScalar($).floor())},this.getScissorTest=function(){return er},this.setScissorTest=function(e){n.setScissorTest(er=e)},this.setOpaqueSort=function(e){K=e},this.setTransparentSort=function(e){Q=e},this.getClearColor=function(e){return e.copy(y.getClearColor())},this.setClearColor=function(){y.setClearColor.apply(y,arguments)},this.getClearAlpha=function(){return y.getClearAlpha()},this.setClearAlpha=function(){y.setClearAlpha.apply(y,arguments)},this.clear=function(e,t,r){let n=0;(void 0===e||e)&&(n|=16384),(void 0===t||t)&&(n|=256),(void 0===r||r)&&(n|=1024),ed.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){T.removeEventListener("webglcontextlost",eg,!1),T.removeEventListener("webglcontextrestored",ev,!1),f.dispose(),m.dispose(),s.dispose(),o.dispose(),l.dispose(),u.dispose(),S.dispose(),em.dispose(),em.removeEventListener("sessionstart",eM),em.removeEventListener("sessionend",eT),eo&&(eo.dispose(),eo=null),eE.stop()},this.renderBufferImmediate=function(e,t){S.initAttributes();let r=s.get(e);e.hasPositions&&!r.position&&(r.position=ed.createBuffer()),e.hasNormals&&!r.normal&&(r.normal=ed.createBuffer()),e.hasUvs&&!r.uv&&(r.uv=ed.createBuffer()),e.hasColors&&!r.color&&(r.color=ed.createBuffer());let n=t.getAttributes();e.hasPositions&&(ed.bindBuffer(34962,r.position),ed.bufferData(34962,e.positionArray,35048),S.enableAttribute(n.position.location),ed.vertexAttribPointer(n.position.location,3,5126,!1,0,0)),e.hasNormals&&(ed.bindBuffer(34962,r.normal),ed.bufferData(34962,e.normalArray,35048),S.enableAttribute(n.normal.location),ed.vertexAttribPointer(n.normal.location,3,5126,!1,0,0)),e.hasUvs&&(ed.bindBuffer(34962,r.uv),ed.bufferData(34962,e.uvArray,35048),S.enableAttribute(n.uv.location),ed.vertexAttribPointer(n.uv.location,2,5126,!1,0,0)),e.hasColors&&(ed.bindBuffer(34962,r.color),ed.bufferData(34962,e.colorArray,35048),S.enableAttribute(n.color.location),ed.vertexAttribPointer(n.color.location,3,5126,!1,0,0)),S.disableUnusedAttributes(),ed.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,r,i,s,a){let o;null===t&&(t=ec);let l=s.isMesh&&0>s.matrixWorld.determinant(),u=eI(e,t,i,s);n.setMaterial(i,l);let d=r.index,p=r.attributes.position;if(null===d){if(void 0===p||0===p.count)return}else if(0===d.count)return;let f=1;!0===i.wireframe&&(d=c.getWireframeAttribute(r),f=2),(void 0!==r.morphAttributes.position||void 0!==r.morphAttributes.normal)&&x.update(s,r,i,u),S.setup(s,i,u,r,d);let m=_;null!==d&&(o=h.get(d),(m=b).setIndex(o));let g=null!==d?d.count:p.count,v=r.drawRange.start*f,y=r.drawRange.count*f,w=null!==a?a.start*f:0,T=null!==a?a.count*f:1/0,E=Math.max(v,w),A=Math.max(0,Math.min(g,v+y,w+T)-1-E+1);if(0!==A){if(s.isMesh)!0===i.wireframe?(n.setLineWidth(i.wireframeLinewidth*eu()),m.setMode(1)):m.setMode(4);else if(s.isLine){let e=i.linewidth;void 0===e&&(e=1),n.setLineWidth(e*eu()),s.isLineSegments?m.setMode(1):s.isLineLoop?m.setMode(2):m.setMode(3)}else s.isPoints?m.setMode(0):s.isSprite&&m.setMode(4);if(s.isInstancedMesh)m.renderInstances(E,A,s.count);else if(r.isInstancedBufferGeometry){let e=Math.min(r.instanceCount,r._maxInstanceCount);m.renderInstances(E,A,e)}else m.render(E,A)}},this.compile=function(e,t){(O=m.get(e)).init(),F.push(O),e.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(O.pushLight(e),e.castShadow&&O.pushShadow(e))}),O.setupLights(B.physicallyCorrectLights),e.traverse(function(t){let r=t.material;if(r){if(Array.isArray(r))for(let n=0;n<r.length;n++)eR(r[n],e,t);else eR(r,e,t)}}),F.pop(),O=null};let ew=null;function eM(){eE.stop()}function eT(){eE.start()}let eE=new rM;function eA(e,t,i,s){let o=e.opaque,l=e.transmissive,h=e.transparent;O.setupLightsView(i),l.length>0&&function(e,t,n){null===eo&&(eo=new(!0===L&&!0===r.isWebGL2?eb:e_)(1024,1024,{generateMipmaps:!0,type:null!==w.convert(1016)?1016:1009,minFilter:1008,magFilter:1003,wrapS:1001,wrapT:1001}));let i=B.getRenderTarget();B.setRenderTarget(eo),B.clear();let s=B.toneMapping;B.toneMapping=0,eC(e,t,n),B.toneMapping=s,a.updateMultisampleRenderTarget(eo),a.updateRenderTargetMipmap(eo),B.setRenderTarget(i)}(o,t,i),s&&n.viewport(q.copy(s)),o.length>0&&eC(o,t,i),l.length>0&&eC(l,t,i),h.length>0&&eC(h,t,i)}function eC(e,t,r){let i=!0===t.isScene?t.overrideMaterial:null;for(let s=0,a=e.length;s<a;s++){let a=e[s],o=a.object,l=a.geometry,h=null===i?a.material:i,c=a.group;o.layers.test(r.layers)&&function(e,t,r,i,s,a){if(e.onBeforeRender(B,t,r,i,s,a),e.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){let i=eI(r,t,s,e);n.setMaterial(s),S.reset(),function(e,t){e.render(function(e){B.renderBufferImmediate(e,t)})}(e,i)}else!0===s.transparent&&2===s.side?(s.side=1,s.needsUpdate=!0,B.renderBufferDirect(r,t,i,s,e,a),s.side=0,s.needsUpdate=!0,B.renderBufferDirect(r,t,i,s,e,a),s.side=2):B.renderBufferDirect(r,t,i,s,e,a);e.onAfterRender(B,t,r,i,s,a)}(o,t,r,l,h,c)}}function eR(e,t,r){!0!==t.isScene&&(t=ec);let n=s.get(e),i=O.state.lights,a=O.state.shadowsArray,h=i.state.version,c=d.getParameters(e,i.state,a,t,r),u=d.getProgramCacheKey(c),p=n.programs;n.environment=e.isMeshStandardMaterial?t.environment:null,n.fog=t.fog,n.envMap=(e.isMeshStandardMaterial?l:o).get(e.envMap||n.environment),void 0===p&&(e.addEventListener("dispose",ey),p=new Map,n.programs=p);let f=p.get(u);if(void 0!==f){if(n.currentProgram===f&&n.lightsStateVersion===h)return eL(e,c),f}else c.uniforms=d.getUniforms(e),e.onBuild(c,B),e.onBeforeCompile(c,B),f=d.acquireProgram(c,u),p.set(u,f),n.uniforms=c.uniforms;let m=n.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(m.clippingPlanes=g.uniform),eL(e,c),n.needsLights=e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights,n.lightsStateVersion=h,n.needsLights&&(m.ambientLightColor.value=i.state.ambient,m.lightProbe.value=i.state.probe,m.directionalLights.value=i.state.directional,m.directionalLightShadows.value=i.state.directionalShadow,m.spotLights.value=i.state.spot,m.spotLightShadows.value=i.state.spotShadow,m.rectAreaLights.value=i.state.rectArea,m.ltc_1.value=i.state.rectAreaLTC1,m.ltc_2.value=i.state.rectAreaLTC2,m.pointLights.value=i.state.point,m.pointLightShadows.value=i.state.pointShadow,m.hemisphereLights.value=i.state.hemi,m.directionalShadowMap.value=i.state.directionalShadowMap,m.directionalShadowMatrix.value=i.state.directionalShadowMatrix,m.spotShadowMap.value=i.state.spotShadowMap,m.spotShadowMatrix.value=i.state.spotShadowMatrix,m.pointShadowMap.value=i.state.pointShadowMap,m.pointShadowMatrix.value=i.state.pointShadowMatrix);let v=f.getUniforms(),y=n4.seqWithValue(v.seq,m);return n.currentProgram=f,n.uniformsList=y,f}function eL(e,t){let r=s.get(e);r.outputEncoding=t.outputEncoding,r.instancing=t.instancing,r.skinning=t.skinning,r.morphTargets=t.morphTargets,r.morphNormals=t.morphNormals,r.numClippingPlanes=t.numClippingPlanes,r.numIntersection=t.numClipIntersection,r.vertexAlphas=t.vertexAlphas,r.vertexTangents=t.vertexTangents}function eI(e,t,i,h){var c;!0!==t.isScene&&(t=ec),a.resetTextureUnits();let u=t.fog,d=i.isMeshStandardMaterial?t.environment:null,f=null===V?B.outputEncoding:V.texture.encoding,m=(i.isMeshStandardMaterial?l:o).get(i.envMap||d),v=!0===i.vertexColors&&!!h.geometry&&!!h.geometry.attributes.color&&4===h.geometry.attributes.color.itemSize,y=!!h.geometry&&!!h.geometry.attributes.tangent,x=!!h.geometry&&!!h.geometry.morphAttributes.position,_=!!h.geometry&&!!h.geometry.morphAttributes.normal,b=s.get(i),w=O.state.lights;if(!0===es&&(!0===ea||e!==j)){let t=e===j&&i.id===W;g.setState(i,e,t)}let S=!1;i.version===b.__version?b.needsLights&&b.lightsStateVersion!==w.state.version?S=!0:b.outputEncoding!==f?S=!0:h.isInstancedMesh&&!1===b.instancing?S=!0:h.isInstancedMesh||!0!==b.instancing?h.isSkinnedMesh&&!1===b.skinning?S=!0:h.isSkinnedMesh||!0!==b.skinning?b.envMap!==m?S=!0:i.fog&&b.fog!==u?S=!0:void 0!==b.numClippingPlanes&&(b.numClippingPlanes!==g.numPlanes||b.numIntersection!==g.numIntersection)?S=!0:b.vertexAlphas!==v?S=!0:b.vertexTangents!==y?S=!0:b.morphTargets!==x?S=!0:b.morphNormals!==_&&(S=!0):S=!0:S=!0:(S=!0,b.__version=i.version);let T=b.currentProgram;!0===S&&(T=eR(i,t,h));let E=!1,A=!1,C=!1,R=T.getUniforms(),L=b.uniforms;if(n.useProgram(T.program)&&(E=!0,A=!0,C=!0),i.id!==W&&(W=i.id,A=!0),E||j!==e){if(R.setValue(ed,"projectionMatrix",e.projectionMatrix),r.logarithmicDepthBuffer&&R.setValue(ed,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),j!==e&&(j=e,A=!0,C=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshStandardMaterial||i.envMap){let t=R.map.cameraPosition;void 0!==t&&t.setValue(ed,eh.setFromMatrixPosition(e.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&R.setValue(ed,"isOrthographic",!0===e.isOrthographicCamera),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.isShadowMaterial||h.isSkinnedMesh)&&R.setValue(ed,"viewMatrix",e.matrixWorldInverse)}if(h.isSkinnedMesh){R.setOptional(ed,h,"bindMatrix"),R.setOptional(ed,h,"bindMatrixInverse");let e=h.skeleton;e&&(r.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),R.setValue(ed,"boneTexture",e.boneTexture,a),R.setValue(ed,"boneTextureSize",e.boneTextureSize)):R.setOptional(ed,e,"boneMatrices"))}return(A||b.receiveShadow!==h.receiveShadow)&&(b.receiveShadow=h.receiveShadow,R.setValue(ed,"receiveShadow",h.receiveShadow)),A&&(R.setValue(ed,"toneMappingExposure",B.toneMappingExposure),b.needsLights&&(c=C,L.ambientLightColor.needsUpdate=c,L.lightProbe.needsUpdate=c,L.directionalLights.needsUpdate=c,L.directionalLightShadows.needsUpdate=c,L.pointLights.needsUpdate=c,L.pointLightShadows.needsUpdate=c,L.spotLights.needsUpdate=c,L.spotLightShadows.needsUpdate=c,L.rectAreaLights.needsUpdate=c,L.hemisphereLights.needsUpdate=c),u&&i.fog&&p.refreshFogUniforms(L,u),p.refreshMaterialUniforms(L,i,$,Z,eo),n4.upload(ed,b.uniformsList,L,a)),i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(n4.upload(ed,b.uniformsList,L,a),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&R.setValue(ed,"center",h.center),R.setValue(ed,"modelViewMatrix",h.modelViewMatrix),R.setValue(ed,"normalMatrix",h.normalMatrix),R.setValue(ed,"modelMatrix",h.matrixWorld),T}eE.setAnimationLoop(function(e){ew&&ew(e)}),"undefined"!=typeof window&&eE.setContext(window),this.setAnimationLoop=function(e){ew=e,em.setAnimationLoop(e),null===e?eE.stop():eE.start()},em.addEventListener("sessionstart",eM),em.addEventListener("sessionend",eT),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(!0===z)return;!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===em.enabled&&!0===em.isPresenting&&(!0===em.cameraAutoUpdate&&em.updateCamera(t),t=em.getCamera()),!0===e.isScene&&e.onBeforeRender(B,e,t,V),(O=m.get(e,F.length)).init(),F.push(O),el.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),ei.setFromProjectionMatrix(el),ea=this.localClippingEnabled,es=g.init(this.clippingPlanes,ea,t),(U=f.get(e,N.length)).init(),N.push(U),function e(t,r,n,s){if(!1===t.visible)return;if(t.layers.test(r.layers)){if(t.isGroup)n=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(r);else if(t.isLight)O.pushLight(t),t.castShadow&&O.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||ei.intersectsSprite(t)){s&&eh.setFromMatrixPosition(t.matrixWorld).applyMatrix4(el);let e=u.update(t),r=t.material;r.visible&&U.push(t,e,r,n,eh.z,null)}}else if(t.isImmediateRenderObject)s&&eh.setFromMatrixPosition(t.matrixWorld).applyMatrix4(el),U.push(t,null,t.material,n,eh.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==i.render.frame&&(t.skeleton.update(),t.skeleton.frame=i.render.frame),!t.frustumCulled||ei.intersectsObject(t))){s&&eh.setFromMatrixPosition(t.matrixWorld).applyMatrix4(el);let e=u.update(t),r=t.material;if(Array.isArray(r)){let i=e.groups;for(let s=0,a=i.length;s<a;s++){let a=i[s],o=r[a.materialIndex];o&&o.visible&&U.push(t,e,o,n,eh.z,a)}}else r.visible&&U.push(t,e,r,n,eh.z,null)}}let a=t.children;for(let t=0,i=a.length;t<i;t++)e(a[t],r,n,s)}(e,t,0,B.sortObjects),U.finish(),!0===B.sortObjects&&U.sort(K,Q),!0===es&&g.beginShadows();let r=O.state.shadowsArray;if(v.render(r,e,t),!0===es&&g.endShadows(),!0===this.info.autoReset&&this.info.reset(),y.render(U,e),O.setupLights(B.physicallyCorrectLights),t.isArrayCamera){let r=t.cameras;for(let t=0,n=r.length;t<n;t++){let n=r[t];eA(U,e,n,n.viewport)}}else eA(U,e,t);null!==V&&(a.updateMultisampleRenderTarget(V),a.updateRenderTargetMipmap(V)),!0===e.isScene&&e.onAfterRender(B,e,t),n.buffers.depth.setTest(!0),n.buffers.depth.setMask(!0),n.buffers.color.setMask(!0),n.setPolygonOffset(!1),S.resetDefaultState(),W=-1,j=null,F.pop(),O=F.length>0?F[F.length-1]:null,N.pop(),U=N.length>0?N[N.length-1]:null},this.getActiveCubeFace=function(){return G},this.getActiveMipmapLevel=function(){return H},this.getRenderTarget=function(){return V},this.setRenderTarget=function(e,i=0,o=0){V=e,G=i,H=o,e&&void 0===s.get(e).__webglFramebuffer&&a.setupRenderTarget(e);let l=null,h=!1,c=!1;if(e){let t=e.texture;(t.isDataTexture3D||t.isDataTexture2DArray)&&(c=!0);let r=s.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(l=r[i],h=!0):l=e.isWebGLMultisampleRenderTarget?s.get(e).__webglMultisampledFramebuffer:r,q.copy(e.viewport),X.copy(e.scissor),Y=e.scissorTest}else q.copy(ee).multiplyScalar($).floor(),X.copy(et).multiplyScalar($).floor(),Y=er;if(n.bindFramebuffer(36160,l)&&r.drawBuffers){let n=!1;if(e){if(e.isWebGLMultipleRenderTargets){let t=e.texture;if(en.length!==t.length||36064!==en[0]){for(let e=0,r=t.length;e<r;e++)en[e]=36064+e;en.length=t.length,n=!0}}else(1!==en.length||36064!==en[0])&&(en[0]=36064,en.length=1,n=!0)}else(1!==en.length||1029!==en[0])&&(en[0]=1029,en.length=1,n=!0);n&&(r.isWebGL2?ed.drawBuffers(en):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(en))}if(n.viewport(q),n.scissor(X),n.setScissorTest(Y),h){let t=s.get(e.texture);ed.framebufferTexture2D(36160,36064,34069+i,t.__webglTexture,o)}else if(c){let t=s.get(e.texture);ed.framebufferTextureLayer(36160,36064,t.__webglTexture,o||0,i||0)}W=-1},this.readRenderTargetPixels=function(e,i,a,o,l,h,c){if(!(e&&e.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let u=s.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==c&&(u=u[c]),u){n.bindFramebuffer(36160,u);try{let n=e.texture,s=n.format,c=n.type;if(1023!==s&&w.convert(s)!==ed.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}let u=1016===c&&(t.has("EXT_color_buffer_half_float")||r.isWebGL2&&t.has("EXT_color_buffer_float"));if(1009!==c&&w.convert(c)!==ed.getParameter(35738)&&!(1015===c&&(r.isWebGL2||t.has("OES_texture_float")||t.has("WEBGL_color_buffer_float")))&&!u){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}36053===ed.checkFramebufferStatus(36160)?i>=0&&i<=e.width-o&&a>=0&&a<=e.height-l&&ed.readPixels(i,a,o,l,w.convert(s),w.convert(c),h):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{let e=null!==V?s.get(V).__webglFramebuffer:null;n.bindFramebuffer(36160,e)}}},this.copyFramebufferToTexture=function(e,t,i=0){let s=Math.pow(2,-i),o=Math.floor(t.image.width*s),l=Math.floor(t.image.height*s),h=w.convert(t.format);r.isWebGL2&&(6407===h&&(h=32849),6408===h&&(h=32856)),a.setTexture2D(t,0),ed.copyTexImage2D(3553,i,h,e.x,e.y,o,l,0),n.unbindTexture()},this.copyTextureToTexture=function(e,t,r,i=0){let s=t.image.width,o=t.image.height,l=w.convert(r.format),h=w.convert(r.type);a.setTexture2D(r,0),ed.pixelStorei(37440,r.flipY),ed.pixelStorei(37441,r.premultiplyAlpha),ed.pixelStorei(3317,r.unpackAlignment),t.isDataTexture?ed.texSubImage2D(3553,i,e.x,e.y,s,o,l,h,t.image.data):t.isCompressedTexture?ed.compressedTexSubImage2D(3553,i,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,l,t.mipmaps[0].data):ed.texSubImage2D(3553,i,e.x,e.y,l,h,t.image),0===i&&r.generateMipmaps&&ed.generateMipmap(3553),n.unbindTexture()},this.copyTextureToTexture3D=function(e,t,r,i,s=0){let o;if(B.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}let l=e.max.x-e.min.x+1,h=e.max.y-e.min.y+1,c=e.max.z-e.min.z+1,u=w.convert(i.format),d=w.convert(i.type);if(i.isDataTexture3D)a.setTexture3D(i,0),o=32879;else if(i.isDataTexture2DArray)a.setTexture2DArray(i,0),o=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}ed.pixelStorei(37440,i.flipY),ed.pixelStorei(37441,i.premultiplyAlpha),ed.pixelStorei(3317,i.unpackAlignment);let p=ed.getParameter(3314),f=ed.getParameter(32878),m=ed.getParameter(3316),g=ed.getParameter(3315),v=ed.getParameter(32877),y=r.isCompressedTexture?r.mipmaps[0]:r.image;ed.pixelStorei(3314,y.width),ed.pixelStorei(32878,y.height),ed.pixelStorei(3316,e.min.x),ed.pixelStorei(3315,e.min.y),ed.pixelStorei(32877,e.min.z),r.isDataTexture||r.isDataTexture3D?ed.texSubImage3D(o,s,t.x,t.y,t.z,l,h,c,u,d,y.data):r.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),ed.compressedTexSubImage3D(o,s,t.x,t.y,t.z,l,h,c,u,y.data)):ed.texSubImage3D(o,s,t.x,t.y,t.z,l,h,c,u,d,y),ed.pixelStorei(3314,p),ed.pixelStorei(32878,f),ed.pixelStorei(3316,m),ed.pixelStorei(3315,g),ed.pixelStorei(32877,v),0===s&&i.generateMipmaps&&ed.generateMipmap(o),n.unbindTexture()},this.initTexture=function(e){a.setTexture2D(e,0),n.unbindTexture()},this.resetState=function(){G=0,H=0,V=null,n.reset(),S.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}(class extends iB{}).prototype.isWebGL1Renderer=!0;class iz{constructor(e,t=25e-5){this.name="",this.color=new tU(e),this.density=t}clone(){return new iz(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}iz.prototype.isFogExp2=!0;class iG{constructor(e,t=1,r=1e3){this.name="",this.color=new tU(e),this.near=t,this.far=r}clone(){return new iG(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}iG.prototype.isFog=!0;class iH extends tm{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){let t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}iH.prototype.isScene=!0;class iV{constructor(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=es()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,r){e*=this.stride,r*=t.stride;for(let n=0,i=this.stride;n<i;n++)this.array[e+n]=t.array[r+n];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=es()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(t,this.stride);return r.setUsage(this.usage),r}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=es()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}iV.prototype.isInterleavedBuffer=!0;const iW=new eS;class ij{constructor(e,t,r,n=!1){this.name="",this.data=e,this.itemSize=t,this.offset=r,this.normalized=!0===n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,r=this.data.count;t<r;t++)iW.x=this.getX(t),iW.y=this.getY(t),iW.z=this.getZ(t),iW.applyMatrix4(e),this.setXYZ(t,iW.x,iW.y,iW.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)iW.x=this.getX(t),iW.y=this.getY(t),iW.z=this.getZ(t),iW.applyNormalMatrix(e),this.setXYZ(t,iW.x,iW.y,iW.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)iW.x=this.getX(t),iW.y=this.getY(t),iW.z=this.getZ(t),iW.transformDirection(e),this.setXYZ(t,iW.x,iW.y,iW.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this}setXYZ(e,t,r,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=n,this}setXYZW(e,t,r,n,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=n,this.data.array[e+3]=i,this}clone(e){if(void 0!==e)return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new ij(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized);{console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");let e=[];for(let t=0;t<this.count;t++){let r=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[r+t])}return new tB(new this.array.constructor(e),this.itemSize,this.normalized)}}toJSON(e){if(void 0!==e)return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized};{console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");let e=[];for(let t=0;t<this.count;t++){let r=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[r+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}}}ij.prototype.isInterleavedBufferAttribute=!0;class iq extends tC{constructor(e){super(),this.type="SpriteMaterial",this.color=new tU(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}iq.prototype.isSpriteMaterial=!0;const iX=new eS,iY=new eS,iJ=new eS,iZ=new ep,i$=new ep,iK=new e0,iQ=new eS,i0=new eS,i1=new eS,i2=new ep,i3=new ep,i4=new ep;function i5(e,t,r,n,i,s){iZ.subVectors(e,r).addScalar(.5).multiply(n),void 0!==i?(i$.x=s*iZ.x-i*iZ.y,i$.y=i*iZ.x+s*iZ.y):i$.copy(iZ),e.copy(t),e.x+=i$.x,e.y+=i$.y,e.applyMatrix4(iK)}(class extends tm{constructor(e){if(super(),this.type="Sprite",void 0===t){t=new t$;let e=new iV(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);t.setIndex([0,1,2,0,2,3]),t.setAttribute("position",new ij(e,3,0,!1)),t.setAttribute("uv",new ij(e,2,3,!1))}this.geometry=t,this.material=void 0!==e?e:new iq,this.center=new ep(.5,.5)}raycast(e,t){let r,n;null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),iY.setFromMatrixScale(this.matrixWorld),iK.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),iJ.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&iY.multiplyScalar(-iJ.z);let i=this.material.rotation;0!==i&&(n=Math.cos(i),r=Math.sin(i));let s=this.center;i5(iQ.set(-.5,-.5,0),iJ,s,iY,r,n),i5(i0.set(.5,-.5,0),iJ,s,iY,r,n),i5(i1.set(.5,.5,0),iJ,s,iY,r,n),i2.set(0,0),i3.set(1,0),i4.set(1,1);let a=e.ray.intersectTriangle(iQ,i0,i1,!1,iX);if(null===a&&(i5(i0.set(-.5,.5,0),iJ,s,iY,r,n),i3.set(0,1),null===(a=e.ray.intersectTriangle(iQ,i1,i0,!1,iX))))return;let o=e.ray.origin.distanceTo(iX);o<e.near||o>e.far||t.push({distance:o,point:iX.clone(),uv:tE.getUV(iX,iQ,i0,i1,i2,i3,i4,new ep),face:null,object:this})}copy(e){return super.copy(e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}).prototype.isSprite=!0;const i6=new eS,i8=new ex,i7=new ex,i9=new eS,se=new e0;class st extends rs{constructor(e,t){super(e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new e0,this.bindMatrixInverse=new e0}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){let e=new ex,t=this.geometry.attributes.skinWeight;for(let r=0,n=t.count;r<n;r++){e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.w=t.getW(r);let n=1/e.manhattanLength();n!==1/0?e.multiplyScalar(n):e.set(1,0,0,0),t.setXYZW(r,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){let r=this.skeleton,n=this.geometry;i8.fromBufferAttribute(n.attributes.skinIndex,e),i7.fromBufferAttribute(n.attributes.skinWeight,e),i6.fromBufferAttribute(n.attributes.position,e).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){let n=i7.getComponent(e);if(0!==n){let i=i8.getComponent(e);se.multiplyMatrices(r.bones[i].matrixWorld,r.boneInverses[i]),t.addScaledVector(i9.copy(i6).applyMatrix4(se),n)}}return t.applyMatrix4(this.bindMatrixInverse)}}st.prototype.isSkinnedMesh=!0;class sr extends tm{constructor(){super(),this.type="Bone"}}sr.prototype.isBone=!0;class sn extends ev{constructor(e=null,t=1,r=1,n,i,s,a,o,l=1003,h=1003,c,u){super(null,s,a,o,l,h,n,i,c,u),this.image={data:e,width:t,height:r},this.magFilter=l,this.minFilter=h,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}sn.prototype.isDataTexture=!0;const si=new e0,ss=new e0;class sa{constructor(e=[],t=[]){this.uuid=es(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){let e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new e0)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){let t=new e0;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){let t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){let t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){let e=this.bones,t=this.boneInverses,r=this.boneMatrices,n=this.boneTexture;for(let n=0,i=e.length;n<i;n++){let i=e[n]?e[n].matrixWorld:ss;si.multiplyMatrices(i,t[n]),si.toArray(r,16*n)}null!==n&&(n.needsUpdate=!0)}clone(){return new sa(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length),t=new Float32Array((e=Math.max(e=ec(e),4))*e*4);t.set(this.boneMatrices);let r=new sn(t,e,e,1023,1015);return this.boneMatrices=t,this.boneTexture=r,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,r=this.bones.length;t<r;t++){let r=this.bones[t];if(r.name===e)return r}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let r=0,n=e.bones.length;r<n;r++){let n=e.bones[r],i=t[n];void 0===i&&(console.warn("THREE.Skeleton: No bone found with UUID:",n),i=new sr),this.bones.push(i),this.boneInverses.push(new e0().fromArray(e.boneInverses[r]))}return this.init(),this}toJSON(){let e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;let t=this.bones,r=this.boneInverses;for(let n=0,i=t.length;n<i;n++){let i=t[n];e.bones.push(i.uuid);let s=r[n];e.boneInverses.push(s.toArray())}return e}}class so extends tB{constructor(e,t,r,n=1){"number"==typeof r&&(n=r,r=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(e,t,r),this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){let e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}so.prototype.isInstancedBufferAttribute=!0;const sl=new e0,sh=new e0,sc=[],su=new rs;(class extends rs{constructor(e,t,r){super(e,t),this.instanceMatrix=new so(new Float32Array(16*r),16),this.instanceColor=null,this.count=r,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){let r=this.matrixWorld,n=this.count;if(su.geometry=this.geometry,su.material=this.material,void 0!==su.material)for(let i=0;i<n;i++){this.getMatrixAt(i,sl),sh.multiplyMatrices(r,sl),su.matrixWorld=sh,su.raycast(e,sc);for(let e=0,r=sc.length;e<r;e++){let r=sc[e];r.instanceId=i,r.object=this,t.push(r)}sc.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new so(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}).prototype.isInstancedMesh=!0;class sd extends tC{constructor(e){super(),this.type="LineBasicMaterial",this.color=new tU(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this}}sd.prototype.isLineBasicMaterial=!0;const sp=new eS,sf=new eS,sm=new e0,sg=new eQ,sv=new ej;class sy extends tm{constructor(e=new t$,t=new sd){super(),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){let e=this.geometry;if(e.isBufferGeometry){if(null===e.index){let t=e.attributes.position,r=[0];for(let e=1,n=t.count;e<n;e++)sp.fromBufferAttribute(t,e-1),sf.fromBufferAttribute(t,e),r[e]=r[e-1],r[e]+=sp.distanceTo(sf);e.setAttribute("lineDistance",new tH(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.")}else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,t){let r=this.geometry,n=this.matrixWorld,i=e.params.Line.threshold,s=r.drawRange;if(null===r.boundingSphere&&r.computeBoundingSphere(),sv.copy(r.boundingSphere),sv.applyMatrix4(n),sv.radius+=i,!1===e.ray.intersectsSphere(sv))return;sm.copy(n).invert(),sg.copy(e.ray).applyMatrix4(sm);let a=i/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=new eS,h=new eS,c=new eS,u=new eS,d=this.isLineSegments?2:1;if(r.isBufferGeometry){let n=r.index,i=r.attributes.position;if(null!==n){let r=Math.max(0,s.start),a=Math.min(n.count,s.start+s.count);for(let s=r,p=a-1;s<p;s+=d){let r=n.getX(s),a=n.getX(s+1);if(l.fromBufferAttribute(i,r),h.fromBufferAttribute(i,a),sg.distanceSqToSegment(l,h,u,c)>o)continue;u.applyMatrix4(this.matrixWorld);let d=e.ray.origin.distanceTo(u);d<e.near||d>e.far||t.push({distance:d,point:c.clone().applyMatrix4(this.matrixWorld),index:s,face:null,faceIndex:null,object:this})}}else{let r=Math.max(0,s.start),n=Math.min(i.count,s.start+s.count);for(let s=r,a=n-1;s<a;s+=d){if(l.fromBufferAttribute(i,s),h.fromBufferAttribute(i,s+1),sg.distanceSqToSegment(l,h,u,c)>o)continue;u.applyMatrix4(this.matrixWorld);let r=e.ray.origin.distanceTo(u);r<e.near||r>e.far||t.push({distance:r,point:c.clone().applyMatrix4(this.matrixWorld),index:s,face:null,faceIndex:null,object:this})}}}else r.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){let e=this.geometry;if(e.isBufferGeometry){let t=e.morphAttributes,r=Object.keys(t);if(r.length>0){let e=t[r[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,r=e.length;t<r;t++){let r=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=t}}}}else{let t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}sy.prototype.isLine=!0;const sx=new eS,s_=new eS;class sb extends sy{constructor(e,t){super(e,t),this.type="LineSegments"}computeLineDistances(){let e=this.geometry;if(e.isBufferGeometry){if(null===e.index){let t=e.attributes.position,r=[];for(let e=0,n=t.count;e<n;e+=2)sx.fromBufferAttribute(t,e),s_.fromBufferAttribute(t,e+1),r[e]=0===e?0:r[e-1],r[e+1]=r[e]+sx.distanceTo(s_);e.setAttribute("lineDistance",new tH(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.")}else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}sb.prototype.isLineSegments=!0;class sw extends sy{constructor(e,t){super(e,t),this.type="LineLoop"}}sw.prototype.isLineLoop=!0;class sS extends tC{constructor(e){super(),this.type="PointsMaterial",this.color=new tU(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this}}sS.prototype.isPointsMaterial=!0;const sM=new e0,sT=new eQ,sE=new ej,sA=new eS;class sC extends tm{constructor(e=new t$,t=new sS){super(),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){let r=this.geometry,n=this.matrixWorld,i=e.params.Points.threshold,s=r.drawRange;if(null===r.boundingSphere&&r.computeBoundingSphere(),sE.copy(r.boundingSphere),sE.applyMatrix4(n),sE.radius+=i,!1===e.ray.intersectsSphere(sE))return;sM.copy(n).invert(),sT.copy(e.ray).applyMatrix4(sM);let a=i/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a;if(r.isBufferGeometry){let i=r.index,a=r.attributes.position;if(null!==i){let r=Math.max(0,s.start),l=Math.min(i.count,s.start+s.count);for(let s=r;s<l;s++){let r=i.getX(s);sA.fromBufferAttribute(a,r),sR(sA,r,o,n,e,t,this)}}else{let r=Math.max(0,s.start),i=Math.min(a.count,s.start+s.count);for(let s=r;s<i;s++)sA.fromBufferAttribute(a,s),sR(sA,s,o,n,e,t,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){let e=this.geometry;if(e.isBufferGeometry){let t=e.morphAttributes,r=Object.keys(t);if(r.length>0){let e=t[r[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,r=e.length;t<r;t++){let r=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=t}}}}else{let t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function sR(e,t,r,n,i,s,a){let o=sT.distanceSqToPoint(e);if(o<r){let r=new eS;sT.closestPointToPoint(e,r),r.applyMatrix4(n);let l=i.ray.origin.distanceTo(r);if(l<i.near||l>i.far)return;s.push({distance:l,distanceToRay:Math.sqrt(o),point:r,index:t,face:null,object:a})}}sC.prototype.isPoints=!0,(class extends ev{constructor(e,t,r,n,i,s,a,o,l){super(e,t,r,n,i,s,a,o,l),this.format=void 0!==a?a:1022,this.minFilter=void 0!==s?s:1006,this.magFilter=void 0!==i?i:1006,this.generateMipmaps=!1;let h=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(function t(){h.needsUpdate=!0,e.requestVideoFrameCallback(t)})}clone(){return new this.constructor(this.image).copy(this)}update(){let e=this.image;!1=="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}).prototype.isVideoTexture=!0,(class extends ev{constructor(e,t,r,n,i,s,a,o,l,h,c,u){super(null,s,a,o,l,h,n,i,c,u),this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}).prototype.isCompressedTexture=!0,(class extends ev{constructor(e,t,r,n,i,s,a,o,l){super(e,t,r,n,i,s,a,o,l),this.needsUpdate=!0}}).prototype.isCanvasTexture=!0,(class extends ev{constructor(e,t,r,n,i,s,a,o,l,h){if(1026!==(h=void 0!==h?h:1026)&&1027!==h)throw Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===r&&1026===h&&(r=1012),void 0===r&&1027===h&&(r=1020),super(null,n,i,s,a,o,h,r,l),this.image={width:e,height:t},this.magFilter=void 0!==a?a:1003,this.minFilter=void 0!==o?o:1003,this.flipY=!1,this.generateMipmaps=!1}}).prototype.isDepthTexture=!0;class sL extends t${constructor(e=1,t=8,r=0,n=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:n},t=Math.max(3,t);let i=[],s=[],a=[],o=[],l=new eS,h=new ep;s.push(0,0,0),a.push(0,0,1),o.push(.5,.5);for(let i=0,c=3;i<=t;i++,c+=3){let u=r+i/t*n;l.x=e*Math.cos(u),l.y=e*Math.sin(u),s.push(l.x,l.y,l.z),a.push(0,0,1),h.x=(s[c]/e+1)/2,h.y=(s[c+1]/e+1)/2,o.push(h.x,h.y)}for(let e=1;e<=t;e++)i.push(e,e+1,0);this.setIndex(i),this.setAttribute("position",new tH(s,3)),this.setAttribute("normal",new tH(a,3)),this.setAttribute("uv",new tH(o,2))}static fromJSON(e){return new sL(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class sI extends t${constructor(e=1,t=1,r=1,n=8,i=1,s=!1,a=0,o=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:n,heightSegments:i,openEnded:s,thetaStart:a,thetaLength:o};let l=this;n=Math.floor(n),i=Math.floor(i);let h=[],c=[],u=[],d=[],p=0,f=[],m=r/2,g=0;function v(r){let i=p,s=new ep,f=new eS,v=0,y=!0===r?e:t,x=!0===r?1:-1;for(let e=1;e<=n;e++)c.push(0,m*x,0),u.push(0,x,0),d.push(.5,.5),p++;let _=p;for(let e=0;e<=n;e++){let t=e/n*o+a,r=Math.cos(t),i=Math.sin(t);f.x=y*i,f.y=m*x,f.z=y*r,c.push(f.x,f.y,f.z),u.push(0,x,0),s.x=.5*r+.5,s.y=.5*i*x+.5,d.push(s.x,s.y),p++}for(let e=0;e<n;e++){let t=i+e,n=_+e;!0===r?h.push(n,n+1,t):h.push(n+1,n,t),v+=3}l.addGroup(g,v,!0===r?1:2),g+=v}(function(){let s=new eS,v=new eS,y=0,x=(t-e)/r;for(let l=0;l<=i;l++){let h=[],g=l/i,y=g*(t-e)+e;for(let e=0;e<=n;e++){let t=e/n,i=t*o+a,l=Math.sin(i),f=Math.cos(i);v.x=y*l,v.y=-g*r+m,v.z=y*f,c.push(v.x,v.y,v.z),s.set(l,x,f).normalize(),u.push(s.x,s.y,s.z),d.push(t,1-g),h.push(p++)}f.push(h)}for(let e=0;e<n;e++)for(let t=0;t<i;t++){let r=f[t][e],n=f[t+1][e],i=f[t+1][e+1],s=f[t][e+1];h.push(r,n,s),h.push(n,i,s),y+=6}l.addGroup(g,y,0),g+=y})(),!1===s&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(h),this.setAttribute("position",new tH(c,3)),this.setAttribute("normal",new tH(u,3)),this.setAttribute("uv",new tH(d,2))}static fromJSON(e){return new sI(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class sP extends sI{constructor(e=1,t=1,r=8,n=1,i=!1,s=0,a=2*Math.PI){super(0,e,t,r,n,i,s,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:n,openEnded:i,thetaStart:s,thetaLength:a}}static fromJSON(e){return new sP(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class sk extends t${constructor(e,t,r=1,n=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:n};let i=[],s=[];function a(e){i.push(e.x,e.y,e.z)}function o(t,r){let n=3*t;r.x=e[n+0],r.y=e[n+1],r.z=e[n+2]}function l(e,t,r,n){n<0&&1===e.x&&(s[t]=e.x-1),0===r.x&&0===r.z&&(s[t]=n/2/Math.PI+.5)}function h(e){return Math.atan2(e.z,-e.x)}(function(e){let r=new eS,n=new eS,i=new eS;for(let s=0;s<t.length;s+=3)o(t[s+0],r),o(t[s+1],n),o(t[s+2],i),function(e,t,r,n){let i=n+1,s=[];for(let n=0;n<=i;n++){s[n]=[];let a=e.clone().lerp(r,n/i),o=t.clone().lerp(r,n/i),l=i-n;for(let e=0;e<=l;e++)0===e&&n===i?s[n][e]=a:s[n][e]=a.clone().lerp(o,e/l)}for(let e=0;e<i;e++)for(let t=0;t<2*(i-e)-1;t++){let r=Math.floor(t/2);t%2==0?(a(s[e][r+1]),a(s[e+1][r]),a(s[e][r])):(a(s[e][r+1]),a(s[e+1][r+1]),a(s[e+1][r]))}}(r,n,i,e)})(n),function(e){let t=new eS;for(let r=0;r<i.length;r+=3)t.x=i[r+0],t.y=i[r+1],t.z=i[r+2],t.normalize().multiplyScalar(e),i[r+0]=t.x,i[r+1]=t.y,i[r+2]=t.z}(r),function(){let e=new eS;for(let t=0;t<i.length;t+=3){e.x=i[t+0],e.y=i[t+1],e.z=i[t+2];let r=h(e)/2/Math.PI+.5,n=Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5;s.push(r,1-n)}(function(){let e=new eS,t=new eS,r=new eS,n=new eS,a=new ep,o=new ep,c=new ep;for(let u=0,d=0;u<i.length;u+=9,d+=6){e.set(i[u+0],i[u+1],i[u+2]),t.set(i[u+3],i[u+4],i[u+5]),r.set(i[u+6],i[u+7],i[u+8]),a.set(s[d+0],s[d+1]),o.set(s[d+2],s[d+3]),c.set(s[d+4],s[d+5]),n.copy(e).add(t).add(r).divideScalar(3);let p=h(n);l(a,d+0,e,p),l(o,d+2,t,p),l(c,d+4,r,p)}})(),function(){for(let e=0;e<s.length;e+=6){let t=s[e+0],r=s[e+2],n=s[e+4],i=Math.max(t,r,n),a=Math.min(t,r,n);i>.9&&a<.1&&(t<.2&&(s[e+0]+=1),r<.2&&(s[e+2]+=1),n<.2&&(s[e+4]+=1))}}()}(),this.setAttribute("position",new tH(i,3)),this.setAttribute("normal",new tH(i.slice(),3)),this.setAttribute("uv",new tH(s,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(e){return new sk(e.vertices,e.indices,e.radius,e.details)}}class sD extends sk{constructor(e=1,t=0){let r=(1+Math.sqrt(5))/2,n=1/r;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new sD(e.radius,e.detail)}}new eS,new eS,new eS,new tE;class sU{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){let r=this.getUtoTmapping(e);return this.getPoint(r,t)}getPoints(e=5){let t=[];for(let r=0;r<=e;r++)t.push(this.getPoint(r/e));return t}getSpacedPoints(e=5){let t=[];for(let r=0;r<=e;r++)t.push(this.getPointAt(r/e));return t}getLength(){let e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let t=[],r,n=this.getPoint(0),i=0;t.push(0);for(let s=1;s<=e;s++)t.push(i+=(r=this.getPoint(s/e)).distanceTo(n)),n=r;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){let r;let n=this.getLengths(),i=0,s=n.length;r=t||e*n[s-1];let a=0,o=s-1,l;for(;a<=o;)if((l=n[i=Math.floor(a+(o-a)/2)]-r)<0)a=i+1;else if(l>0)o=i-1;else{o=i;break}if(n[i=o]===r)return i/(s-1);let h=n[i],c=n[i+1];return(i+(r-h)/(c-h))/(s-1)}getTangent(e,t){let r=e-1e-4,n=e+1e-4;r<0&&(r=0),n>1&&(n=1);let i=this.getPoint(r),s=this.getPoint(n),a=t||(i.isVector2?new ep:new eS);return a.copy(s).sub(i).normalize(),a}getTangentAt(e,t){let r=this.getUtoTmapping(e);return this.getTangent(r,t)}computeFrenetFrames(e,t){let r=new eS,n=[],i=[],s=[],a=new eS,o=new e0;for(let t=0;t<=e;t++){let r=t/e;n[t]=this.getTangentAt(r,new eS),n[t].normalize()}i[0]=new eS,s[0]=new eS;let l=Number.MAX_VALUE,h=Math.abs(n[0].x),c=Math.abs(n[0].y),u=Math.abs(n[0].z);h<=l&&(l=h,r.set(1,0,0)),c<=l&&(l=c,r.set(0,1,0)),u<=l&&r.set(0,0,1),a.crossVectors(n[0],r).normalize(),i[0].crossVectors(n[0],a),s[0].crossVectors(n[0],i[0]);for(let t=1;t<=e;t++){if(i[t]=i[t-1].clone(),s[t]=s[t-1].clone(),a.crossVectors(n[t-1],n[t]),a.length()>Number.EPSILON){a.normalize();let e=Math.acos(ea(n[t-1].dot(n[t]),-1,1));i[t].applyMatrix4(o.makeRotationAxis(a,e))}s[t].crossVectors(n[t],i[t])}if(!0===t){let t=Math.acos(ea(i[0].dot(i[e]),-1,1));t/=e,n[0].dot(a.crossVectors(i[0],i[e]))>0&&(t=-t);for(let r=1;r<=e;r++)i[r].applyMatrix4(o.makeRotationAxis(n[r],t*r)),s[r].crossVectors(n[r],i[r])}return{tangents:n,normals:i,binormals:s}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){let e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class sO extends sU{constructor(e=0,t=0,r=1,n=1,i=0,s=2*Math.PI,a=!1,o=0){super(),this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=r,this.yRadius=n,this.aStartAngle=i,this.aEndAngle=s,this.aClockwise=a,this.aRotation=o}getPoint(e,t){let r=t||new ep,n=2*Math.PI,i=this.aEndAngle-this.aStartAngle,s=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=n;for(;i>n;)i-=n;i<Number.EPSILON&&(i=s?0:n),!0!==this.aClockwise||s||(i===n?i=-n:i-=n);let a=this.aStartAngle+e*i,o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){let e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),r=o-this.aX,n=l-this.aY;o=r*e-n*t+this.aX,l=r*t+n*e+this.aY}return r.set(o,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){let e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}sO.prototype.isEllipseCurve=!0;class sN extends sO{constructor(e,t,r,n,i,s){super(e,t,r,r,n,i,s),this.type="ArcCurve"}}function sF(){let e=0,t=0,r=0,n=0;function i(i,s,a,o){e=i,t=a,r=-3*i+3*s-2*a-o,n=2*i-2*s+a+o}return{initCatmullRom:function(e,t,r,n,s){i(t,r,s*(r-e),s*(n-t))},initNonuniformCatmullRom:function(e,t,r,n,s,a,o){let l=(t-e)/s-(r-e)/(s+a)+(r-t)/a,h=(r-t)/a-(n-t)/(a+o)+(n-r)/o;i(t,r,l*=a,h*=a)},calc:function(i){let s=i*i;return e+t*i+r*s+s*i*n}}}sN.prototype.isArcCurve=!0;const sB=new eS,sz=new sF,sG=new sF,sH=new sF;class sV extends sU{constructor(e=[],t=!1,r="centripetal",n=.5){super(),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=r,this.tension=n}getPoint(e,t=new eS){let r,n;let i=this.points,s=i.length,a=(s-(this.closed?0:1))*e,o=Math.floor(a),l=a-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/s)+1)*s:0===l&&o===s-1&&(o=s-2,l=1),this.closed||o>0?r=i[(o-1)%s]:(sB.subVectors(i[0],i[1]).add(i[0]),r=sB);let h=i[o%s],c=i[(o+1)%s];if(this.closed||o+2<s?n=i[(o+2)%s]:(sB.subVectors(i[s-1],i[s-2]).add(i[s-1]),n=sB),"centripetal"===this.curveType||"chordal"===this.curveType){let e="chordal"===this.curveType?.5:.25,t=Math.pow(r.distanceToSquared(h),e),i=Math.pow(h.distanceToSquared(c),e),s=Math.pow(c.distanceToSquared(n),e);i<1e-4&&(i=1),t<1e-4&&(t=i),s<1e-4&&(s=i),sz.initNonuniformCatmullRom(r.x,h.x,c.x,n.x,t,i,s),sG.initNonuniformCatmullRom(r.y,h.y,c.y,n.y,t,i,s),sH.initNonuniformCatmullRom(r.z,h.z,c.z,n.z,t,i,s)}else"catmullrom"===this.curveType&&(sz.initCatmullRom(r.x,h.x,c.x,n.x,this.tension),sG.initCatmullRom(r.y,h.y,c.y,n.y,this.tension),sH.initCatmullRom(r.z,h.z,c.z,n.z,this.tension));return t.set(sz.calc(l),sG.calc(l),sH.calc(l)),t}copy(e){super.copy(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){let r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,r=this.points.length;t<r;t++){let r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){let r=e.points[t];this.points.push(new eS().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function sW(e,t,r,n,i){let s=(n-t)*.5,a=(i-r)*.5,o=e*e;return e*o*(2*r-2*n+s+a)+(-3*r+3*n-2*s-a)*o+s*e+r}function sj(e,t,r,n){return function(e,t){let r=1-e;return r*r*t}(e,t)+2*(1-e)*e*r+e*e*n}function sq(e,t,r,n,i){return function(e,t){let r=1-e;return r*r*r*t}(e,t)+function(e,t){let r=1-e;return 3*r*r*e*t}(e,r)+3*(1-e)*e*e*n+e*e*e*i}sV.prototype.isCatmullRomCurve3=!0;class sX extends sU{constructor(e=new ep,t=new ep,r=new ep,n=new ep){super(),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=r,this.v3=n}getPoint(e,t=new ep){let r=this.v0,n=this.v1,i=this.v2,s=this.v3;return t.set(sq(e,r.x,n.x,i.x,s.x),sq(e,r.y,n.y,i.y,s.y)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}sX.prototype.isCubicBezierCurve=!0;class sY extends sU{constructor(e=new eS,t=new eS,r=new eS,n=new eS){super(),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=r,this.v3=n}getPoint(e,t=new eS){let r=this.v0,n=this.v1,i=this.v2,s=this.v3;return t.set(sq(e,r.x,n.x,i.x,s.x),sq(e,r.y,n.y,i.y,s.y),sq(e,r.z,n.z,i.z,s.z)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}sY.prototype.isCubicBezierCurve3=!0;class sJ extends sU{constructor(e=new ep,t=new ep){super(),this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new ep){return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){let r=t||new ep;return r.copy(this.v2).sub(this.v1).normalize(),r}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}sJ.prototype.isLineCurve=!0;class sZ extends sU{constructor(e=new ep,t=new ep,r=new ep){super(),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new ep){let r=this.v0,n=this.v1,i=this.v2;return t.set(sj(e,r.x,n.x,i.x),sj(e,r.y,n.y,i.y)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}sZ.prototype.isQuadraticBezierCurve=!0;class s$ extends sU{constructor(e=new eS,t=new eS,r=new eS){super(),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new eS){let r=this.v0,n=this.v1,i=this.v2;return t.set(sj(e,r.x,n.x,i.x),sj(e,r.y,n.y,i.y),sj(e,r.z,n.z,i.z)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}s$.prototype.isQuadraticBezierCurve3=!0;class sK extends sU{constructor(e=[]){super(),this.type="SplineCurve",this.points=e}getPoint(e,t=new ep){let r=this.points,n=(r.length-1)*e,i=Math.floor(n),s=n-i,a=r[0===i?i:i-1],o=r[i],l=r[i>r.length-2?r.length-1:i+1],h=r[i>r.length-3?r.length-1:i+2];return t.set(sW(s,a.x,o.x,l.x,h.x),sW(s,a.y,o.y,l.y,h.y)),t}copy(e){super.copy(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){let r=e.points[t];this.points.push(r.clone())}return this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,r=this.points.length;t<r;t++){let r=this.points[t];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){let r=e.points[t];this.points.push(new ep().fromArray(r))}return this}}sK.prototype.isSplineCurve=!0;var sQ=Object.freeze({__proto__:null,ArcCurve:sN,CatmullRomCurve3:sV,CubicBezierCurve:sX,CubicBezierCurve3:sY,EllipseCurve:sO,LineCurve:sJ,LineCurve3:class extends sU{constructor(e=new eS,t=new eS){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new eS){return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},QuadraticBezierCurve:sZ,QuadraticBezierCurve3:s$,SplineCurve:sK});const s0=function(e,t,r=2){let n,i,s,a,o,l,h;let c=t&&t.length,u=c?t[0]*r:e.length,d=s1(e,0,u,r,!0),p=[];if(!d||d.next===d.prev)return p;if(c&&(d=function(e,t,r,n){let i,s,a,o,l;let h=[];for(i=0,s=t.length;i<s;i++)a=t[i]*n,o=i<s-1?t[i+1]*n:e.length,(l=s1(e,a,o,n,!1))===l.next&&(l.steiner=!0),h.push(function(e){let t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e)return r}(l));for(h.sort(s3),i=0;i<h.length;i++)(function(e,t){if(t=function(e,t){let r=t,n=e.x,i=e.y,s=-1/0,a;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){let e=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(e<=n&&e>s){if(s=e,e===n){if(i===r.y)return r;if(i===r.next.y)return r.next}a=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t)if(!a)return null;if(n===s)return a;let o=a,l=a.x,h=a.y,c=1/0,u;r=a;do{var d,p;n>=r.x&&r.x>=l&&n!==r.x&&s5(i<h?n:s,i,l,h,i<h?s:n,i,r.x,r.y)&&(u=Math.abs(i-r.y)/(n-r.x),at(r,e)&&(u<c||u===c&&(r.x>a.x||r.x===a.x&&(d=a,p=r,0>s6(d.prev,d,p.prev)&&0>s6(p.next,d,d.next))))&&(a=r,c=u)),r=r.next}while(r!==o)return a}(e,t)){let r=ar(t,e);s2(t,t.next),s2(r,r.next)}})(h[i],r),r=s2(r,r.next);return r}(e,t,d,r)),e.length>80*r){n=s=e[0],i=a=e[1];for(let t=r;t<u;t+=r)o=e[t],l=e[t+1],o<n&&(n=o),l<i&&(i=l),o>s&&(s=o),l>a&&(a=l);h=0!==(h=Math.max(s-n,a-i))?1/h:0}return function e(t,r,n,i,s,a,o){if(!t)return;!o&&a&&function(e,t,r,n){let i=e;do null===i.z&&(i.z=s4(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==e)i.prevZ.nextZ=null,i.prevZ=null,function(e){let t,r,n,i,s,a,o,l,h=1;do{for(r=e,e=null,s=null,a=0;r;){for(a++,n=r,o=0,t=0;t<h&&(o++,n=n.nextZ);t++);for(l=h;o>0||l>0&&n;)0!==o&&(0===l||!n||r.z<=n.z)?(i=r,r=r.nextZ,o--):(i=n,n=n.nextZ,l--),s?s.nextZ=i:e=i,i.prevZ=s,s=i;r=n}s.nextZ=null,h*=2}while(a>1)}(i)}(t,i,s,a);let l=t,h,c;for(;t.prev!==t.next;){if(h=t.prev,c=t.next,a?function(e,t,r,n){let i=e.prev,s=e.next;if(s6(i,e,s)>=0)return!1;let a=i.x<e.x?i.x<s.x?i.x:s.x:e.x<s.x?e.x:s.x,o=i.y<e.y?i.y<s.y?i.y:s.y:e.y<s.y?e.y:s.y,l=i.x>e.x?i.x>s.x?i.x:s.x:e.x>s.x?e.x:s.x,h=i.y>e.y?i.y>s.y?i.y:s.y:e.y>s.y?e.y:s.y,c=s4(a,o,t,r,n),u=s4(l,h,t,r,n),d=e.prevZ,p=e.nextZ;for(;d&&d.z>=c&&p&&p.z<=u;){if(d!==e.prev&&d!==e.next&&s5(i.x,i.y,e.x,e.y,s.x,s.y,d.x,d.y)&&s6(d.prev,d,d.next)>=0||(d=d.prevZ,p!==e.prev&&p!==e.next&&s5(i.x,i.y,e.x,e.y,s.x,s.y,p.x,p.y)&&s6(p.prev,p,p.next)>=0))return!1;p=p.nextZ}for(;d&&d.z>=c;){if(d!==e.prev&&d!==e.next&&s5(i.x,i.y,e.x,e.y,s.x,s.y,d.x,d.y)&&s6(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;p&&p.z<=u;){if(p!==e.prev&&p!==e.next&&s5(i.x,i.y,e.x,e.y,s.x,s.y,p.x,p.y)&&s6(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}(t,i,s,a):function(e){let t=e.prev,r=e.next;if(s6(t,e,r)>=0)return!1;let n=e.next.next;for(;n!==e.prev;){if(s5(t.x,t.y,e.x,e.y,r.x,r.y,n.x,n.y)&&s6(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}(t)){r.push(h.i/n),r.push(t.i/n),r.push(c.i/n),ai(t),t=c.next,l=c.next;continue}if((t=c)===l){o?1===o?e(t=function(e,t,r){let n=e;do{let i=n.prev,s=n.next.next;!s8(i,s)&&s7(i,n,n.next,s)&&at(i,s)&&at(s,i)&&(t.push(i.i/r),t.push(n.i/r),t.push(s.i/r),ai(n),ai(n.next),n=e=s),n=n.next}while(n!==e)return s2(n)}(s2(t),r,n),r,n,i,s,a,2):2===o&&function(t,r,n,i,s,a){let o=t;do{let t=o.next.next;for(;t!==o.prev;){var l,h;if(o.i!==t.i&&(l=o,h=t,l.next.i!==h.i&&l.prev.i!==h.i&&!function(e,t){let r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&s7(r,r.next,e,t))return!0;r=r.next}while(r!==e)return!1}(l,h)&&(at(l,h)&&at(h,l)&&function(e,t){let r=e,n=!1,i=(e.x+t.x)/2,s=(e.y+t.y)/2;do r.y>s!=r.next.y>s&&r.next.y!==r.y&&i<(r.next.x-r.x)*(s-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next;while(r!==e)return n}(l,h)&&(s6(l.prev,l,h.prev)||s6(l,h.prev,h))||s8(l,h)&&s6(l.prev,l,l.next)>0&&s6(h.prev,h,h.next)>0))){let l=ar(o,t);o=s2(o,o.next),l=s2(l,l.next),e(o,r,n,i,s,a),e(l,r,n,i,s,a);return}t=t.next}o=o.next}while(o!==t)}(t,r,n,i,s,a):e(s2(t),r,n,i,s,a,1);break}}}(d,p,r,n,i,h),p};function s1(e,t,r,n,i){let s,a;if(i===function(e,t,r,n){let i=0;for(let s=t,a=r-n;s<r;s+=n)i+=(e[a]-e[s])*(e[s+1]+e[a+1]),a=s;return i}(e,t,r,n)>0)for(s=t;s<r;s+=n)a=an(s,e[s],e[s+1],a);else for(s=r-n;s>=t;s-=n)a=an(s,e[s],e[s+1],a);return a&&s8(a,a.next)&&(ai(a),a=a.next),a}function s2(e,t){if(!e)return e;t||(t=e);let r=e,n;do if(n=!1,!r.steiner&&(s8(r,r.next)||0===s6(r.prev,r,r.next))){if(ai(r),(r=t=r.prev)===r.next)break;n=!0}else r=r.next;while(n||r!==t)return t}function s3(e,t){return e.x-t.x}function s4(e,t,r,n,i){return(e=((e=((e=((e=((e=32767*(e-r)*i)|e<<8)&16711935)|e<<4)&252645135)|e<<2)&858993459)|e<<1)&1431655765)|(t=((t=((t=((t=((t=32767*(t-n)*i)|t<<8)&16711935)|t<<4)&252645135)|t<<2)&858993459)|t<<1)&1431655765)<<1}function s5(e,t,r,n,i,s,a,o){return(i-a)*(t-o)-(e-a)*(s-o)>=0&&(e-a)*(n-o)-(r-a)*(t-o)>=0&&(r-a)*(s-o)-(i-a)*(n-o)>=0}function s6(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function s8(e,t){return e.x===t.x&&e.y===t.y}function s7(e,t,r,n){let i=ae(s6(e,t,r)),s=ae(s6(e,t,n)),a=ae(s6(r,n,e)),o=ae(s6(r,n,t));return!!(i!==s&&a!==o||0===i&&s9(e,r,t)||0===s&&s9(e,n,t)||0===a&&s9(r,e,n)||0===o&&s9(r,t,n))}function s9(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function ae(e){return e>0?1:e<0?-1:0}function at(e,t){return 0>s6(e.prev,e,e.next)?s6(e,t,e.next)>=0&&s6(e,e.prev,t)>=0:0>s6(e,t,e.prev)||0>s6(e,e.next,t)}function ar(e,t){let r=new as(e.i,e.x,e.y),n=new as(t.i,t.x,t.y),i=e.next,s=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,s.next=n,n.prev=s,n}function an(e,t,r,n){let i=new as(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function ai(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function as(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class aa{static area(e){let t=e.length,r=0;for(let n=t-1,i=0;i<t;n=i++)r+=e[n].x*e[i].y-e[i].x*e[n].y;return .5*r}static isClockWise(e){return 0>aa.area(e)}static triangulateShape(e,t){let r=[],n=[],i=[];ao(e),al(r,e);let s=e.length;t.forEach(ao);for(let e=0;e<t.length;e++)n.push(s),s+=t[e].length,al(r,t[e]);let a=s0(r,n);for(let e=0;e<a.length;e+=3)i.push(a.slice(e,e+3));return i}}function ao(e){let t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function al(e,t){for(let r=0;r<t.length;r++)e.push(t[r].x),e.push(t[r].y)}class ah extends t${constructor(e,t){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];let r=this,n=[],i=[];for(let s=0,a=e.length;s<a;s++)!function(e){let s,a,o,l;let h=[],c=void 0!==t.curveSegments?t.curveSegments:12,u=void 0!==t.steps?t.steps:1,d=void 0!==t.depth?t.depth:100,p=void 0===t.bevelEnabled||t.bevelEnabled,f=void 0!==t.bevelThickness?t.bevelThickness:6,m=void 0!==t.bevelSize?t.bevelSize:f-2,g=void 0!==t.bevelOffset?t.bevelOffset:0,v=void 0!==t.bevelSegments?t.bevelSegments:3,y=t.extrudePath,x=void 0!==t.UVGenerator?t.UVGenerator:ac;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),d=t.amount);let _,b=!1;y&&(_=y.getSpacedPoints(u),b=!0,p=!1,s=y.computeFrenetFrames(u,!1),a=new eS,o=new eS,l=new eS),p||(v=0,f=0,m=0,g=0);let w=e.extractPoints(c),S=w.shape,T=w.holes;if(!aa.isClockWise(S)){S=S.reverse();for(let e=0,t=T.length;e<t;e++){let t=T[e];aa.isClockWise(t)&&(T[e]=t.reverse())}}let E=aa.triangulateShape(S,T),A=S;for(let e=0,t=T.length;e<t;e++){let t=T[e];S=S.concat(t)}function C(e,t,r){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(r).add(e)}let R=S.length,L=E.length;function I(e,t,r){let n,i,s;let a=e.x-t.x,o=e.y-t.y,l=r.x-e.x,h=r.y-e.y,c=a*a+o*o;if(Math.abs(a*h-o*l)>Number.EPSILON){let u=Math.sqrt(c),d=Math.sqrt(l*l+h*h),p=t.x-o/u,f=t.y+a/u,m=((r.x-h/d-p)*h-(r.y+l/d-f)*l)/(a*h-o*l),g=(n=p+a*m-e.x)*n+(i=f+o*m-e.y)*i;if(g<=2)return new ep(n,i);s=Math.sqrt(g/2)}else{let e=!1;a>Number.EPSILON?l>Number.EPSILON&&(e=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(o)===Math.sign(h)&&(e=!0),e?(n=-o,i=a,s=Math.sqrt(c)):(n=a,i=o,s=Math.sqrt(c/2))}return new ep(n/s,i/s)}let P=[];for(let e=0,t=A.length,r=t-1,n=e+1;e<t;e++,r++,n++)r===t&&(r=0),n===t&&(n=0),P[e]=I(A[e],A[r],A[n]);let k=[],D,U=P.concat();for(let e=0,t=T.length;e<t;e++){let t=T[e];D=[];for(let e=0,r=t.length,n=r-1,i=e+1;e<r;e++,n++,i++)n===r&&(n=0),i===r&&(i=0),D[e]=I(t[e],t[n],t[i]);k.push(D),U=U.concat(D)}for(let e=0;e<v;e++){let t=e/v,r=f*Math.cos(t*Math.PI/2),n=m*Math.sin(t*Math.PI/2)+g;for(let e=0,t=A.length;e<t;e++){let t=C(A[e],P[e],n);F(t.x,t.y,-r)}for(let e=0,t=T.length;e<t;e++){let t=T[e];D=k[e];for(let e=0,i=t.length;e<i;e++){let i=C(t[e],D[e],n);F(i.x,i.y,-r)}}}let O=m+g;for(let e=0;e<R;e++){let t=p?C(S[e],U[e],O):S[e];b?(o.copy(s.normals[0]).multiplyScalar(t.x),a.copy(s.binormals[0]).multiplyScalar(t.y),l.copy(_[0]).add(o).add(a),F(l.x,l.y,l.z)):F(t.x,t.y,0)}for(let e=1;e<=u;e++)for(let t=0;t<R;t++){let r=p?C(S[t],U[t],O):S[t];b?(o.copy(s.normals[e]).multiplyScalar(r.x),a.copy(s.binormals[e]).multiplyScalar(r.y),l.copy(_[e]).add(o).add(a),F(l.x,l.y,l.z)):F(r.x,r.y,d/u*e)}for(let e=v-1;e>=0;e--){let t=e/v,r=f*Math.cos(t*Math.PI/2),n=m*Math.sin(t*Math.PI/2)+g;for(let e=0,t=A.length;e<t;e++){let t=C(A[e],P[e],n);F(t.x,t.y,d+r)}for(let e=0,t=T.length;e<t;e++){let t=T[e];D=k[e];for(let e=0,i=t.length;e<i;e++){let i=C(t[e],D[e],n);b?F(i.x,i.y+_[u-1].y,_[u-1].x+r):F(i.x,i.y,d+r)}}}function N(e,t){let i=e.length;for(;--i>=0;){let s=i,a=i-1;a<0&&(a=e.length-1);for(let e=0,i=u+2*v;e<i;e++){let i=R*e,o=R*(e+1);!function(e,t,i,s){z(e),z(t),z(s),z(t),z(i),z(s);let a=n.length/3,o=x.generateSideWallUV(r,n,a-6,a-3,a-2,a-1);G(o[0]),G(o[1]),G(o[3]),G(o[1]),G(o[2]),G(o[3])}(t+s+i,t+a+i,t+a+o,t+s+o)}}}function F(e,t,r){h.push(e),h.push(t),h.push(r)}function B(e,t,i){z(e),z(t),z(i);let s=n.length/3,a=x.generateTopUV(r,n,s-3,s-2,s-1);G(a[0]),G(a[1]),G(a[2])}function z(e){n.push(h[3*e+0]),n.push(h[3*e+1]),n.push(h[3*e+2])}function G(e){i.push(e.x),i.push(e.y)}(function(){let e=n.length/3;if(p){let e=0*R;for(let t=0;t<L;t++){let r=E[t];B(r[2]+e,r[1]+e,r[0]+e)}e=R*(u+2*v);for(let t=0;t<L;t++){let r=E[t];B(r[0]+e,r[1]+e,r[2]+e)}}else{for(let e=0;e<L;e++){let t=E[e];B(t[2],t[1],t[0])}for(let e=0;e<L;e++){let t=E[e];B(t[0]+R*u,t[1]+R*u,t[2]+R*u)}}r.addGroup(e,n.length/3-e,0)})(),function(){let e=n.length/3,t=0;N(A,0),t+=A.length;for(let e=0,r=T.length;e<r;e++){let r=T[e];N(r,t),t+=r.length}r.addGroup(e,n.length/3-e,1)}()}(e[s]);this.setAttribute("position",new tH(n,3)),this.setAttribute("uv",new tH(i,2)),this.computeVertexNormals()}toJSON(){let e=super.toJSON();return function(e,t,r){if(r.shapes=[],Array.isArray(e))for(let t=0,n=e.length;t<n;t++){let n=e[t];r.shapes.push(n.uuid)}else r.shapes.push(e.uuid);return void 0!==t.extrudePath&&(r.options.extrudePath=t.extrudePath.toJSON()),r}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){let r=[];for(let n=0,i=e.shapes.length;n<i;n++){let i=t[e.shapes[n]];r.push(i)}let n=e.options.extrudePath;return void 0!==n&&(e.options.extrudePath=new sQ[n.type]().fromJSON(n)),new ah(r,e.options)}}const ac={generateTopUV:function(e,t,r,n,i){let s=t[3*r],a=t[3*r+1],o=t[3*n],l=t[3*n+1],h=t[3*i],c=t[3*i+1];return[new ep(s,a),new ep(o,l),new ep(h,c)]},generateSideWallUV:function(e,t,r,n,i,s){let a=t[3*r],o=t[3*r+1],l=t[3*r+2],h=t[3*n],c=t[3*n+1],u=t[3*n+2],d=t[3*i],p=t[3*i+1],f=t[3*i+2],m=t[3*s],g=t[3*s+1],v=t[3*s+2];return Math.abs(o-c)<Math.abs(a-h)?[new ep(a,1-l),new ep(h,1-u),new ep(d,1-f),new ep(m,1-v)]:[new ep(o,1-l),new ep(c,1-u),new ep(p,1-f),new ep(g,1-v)]}};class au extends sk{constructor(e=1,t=0){let r=(1+Math.sqrt(5))/2;super([-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new au(e.radius,e.detail)}}class ad extends t${constructor(e,t=12,r=0,n=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:n},t=Math.floor(t),n=ea(n,0,2*Math.PI);let i=[],s=[],a=[],o=1/t,l=new eS,h=new ep;for(let i=0;i<=t;i++){let c=r+i*o*n,u=Math.sin(c),d=Math.cos(c);for(let r=0;r<=e.length-1;r++)l.x=e[r].x*u,l.y=e[r].y,l.z=e[r].x*d,s.push(l.x,l.y,l.z),h.x=i/t,h.y=r/(e.length-1),a.push(h.x,h.y)}for(let r=0;r<t;r++)for(let t=0;t<e.length-1;t++){let n=t+r*e.length,s=n+e.length,a=n+e.length+1,o=n+1;i.push(n,s,o),i.push(s,a,o)}if(this.setIndex(i),this.setAttribute("position",new tH(s,3)),this.setAttribute("uv",new tH(a,2)),this.computeVertexNormals(),n===2*Math.PI){let r=this.attributes.normal.array,n=new eS,i=new eS,s=new eS,a=t*e.length*3;for(let t=0,o=0;t<e.length;t++,o+=3)n.x=r[o+0],n.y=r[o+1],n.z=r[o+2],i.x=r[a+o+0],i.y=r[a+o+1],i.z=r[a+o+2],s.addVectors(n,i).normalize(),r[o+0]=r[a+o+0]=s.x,r[o+1]=r[a+o+1]=s.y,r[o+2]=r[a+o+2]=s.z}}static fromJSON(e){return new ad(e.points,e.segments,e.phiStart,e.phiLength)}}class ap extends sk{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new ap(e.radius,e.detail)}}class af extends t${constructor(e=.5,t=1,r=8,n=1,i=0,s=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:s},r=Math.max(3,r);let a=[],o=[],l=[],h=[],c=e,u=(t-e)/(n=Math.max(1,n)),d=new eS,p=new ep;for(let e=0;e<=n;e++){for(let e=0;e<=r;e++){let n=i+e/r*s;d.x=c*Math.cos(n),d.y=c*Math.sin(n),o.push(d.x,d.y,d.z),l.push(0,0,1),p.x=(d.x/t+1)/2,p.y=(d.y/t+1)/2,h.push(p.x,p.y)}c+=u}for(let e=0;e<n;e++){let t=e*(r+1);for(let e=0;e<r;e++){let n=e+t,i=n+r+1,s=n+r+2,o=n+1;a.push(n,i,o),a.push(i,s,o)}}this.setIndex(a),this.setAttribute("position",new tH(o,3)),this.setAttribute("normal",new tH(l,3)),this.setAttribute("uv",new tH(h,2))}static fromJSON(e){return new af(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class am extends t${constructor(e,t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};let r=[],n=[],i=[],s=[],a=0,o=0;if(!1===Array.isArray(e))l(e);else for(let t=0;t<e.length;t++)l(e[t]),this.addGroup(a,o,t),a+=o,o=0;function l(e){let a=n.length/3,l=e.extractPoints(t),h=l.shape,c=l.holes;!1===aa.isClockWise(h)&&(h=h.reverse());for(let e=0,t=c.length;e<t;e++){let t=c[e];!0===aa.isClockWise(t)&&(c[e]=t.reverse())}let u=aa.triangulateShape(h,c);for(let e=0,t=c.length;e<t;e++){let t=c[e];h=h.concat(t)}for(let e=0,t=h.length;e<t;e++){let t=h[e];n.push(t.x,t.y,0),i.push(0,0,1),s.push(t.x,t.y)}for(let e=0,t=u.length;e<t;e++){let t=u[e],n=t[0]+a,i=t[1]+a,s=t[2]+a;r.push(n,i,s),o+=3}}this.setIndex(r),this.setAttribute("position",new tH(n,3)),this.setAttribute("normal",new tH(i,3)),this.setAttribute("uv",new tH(s,2))}toJSON(){let e=super.toJSON();return function(e,t){if(t.shapes=[],Array.isArray(e))for(let r=0,n=e.length;r<n;r++){let n=e[r];t.shapes.push(n.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}static fromJSON(e,t){let r=[];for(let n=0,i=e.shapes.length;n<i;n++){let i=t[e.shapes[n]];r.push(i)}return new am(r,e.curveSegments)}}class ag extends t${constructor(e=1,t=32,r=16,n=0,i=2*Math.PI,s=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:n,phiLength:i,thetaStart:s,thetaLength:a},t=Math.max(3,Math.floor(t)),r=Math.max(2,Math.floor(r));let o=Math.min(s+a,Math.PI),l=0,h=[],c=new eS,u=new eS,d=[],p=[],f=[],m=[];for(let d=0;d<=r;d++){let g=[],v=d/r,y=0;0==d&&0==s?y=.5/t:d==r&&o==Math.PI&&(y=-.5/t);for(let r=0;r<=t;r++){let o=r/t;c.x=-e*Math.cos(n+o*i)*Math.sin(s+v*a),c.y=e*Math.cos(s+v*a),c.z=e*Math.sin(n+o*i)*Math.sin(s+v*a),p.push(c.x,c.y,c.z),u.copy(c).normalize(),f.push(u.x,u.y,u.z),m.push(o+y,1-v),g.push(l++)}h.push(g)}for(let e=0;e<r;e++)for(let n=0;n<t;n++){let t=h[e][n+1],i=h[e][n],a=h[e+1][n],l=h[e+1][n+1];(0!==e||s>0)&&d.push(t,i,l),(e!==r-1||o<Math.PI)&&d.push(i,a,l)}this.setIndex(d),this.setAttribute("position",new tH(p,3)),this.setAttribute("normal",new tH(f,3)),this.setAttribute("uv",new tH(m,2))}static fromJSON(e){return new ag(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class av extends sk{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new av(e.radius,e.detail)}}class ay extends t${constructor(e=1,t=.4,r=8,n=6,i=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:n,arc:i},r=Math.floor(r),n=Math.floor(n);let s=[],a=[],o=[],l=[],h=new eS,c=new eS,u=new eS;for(let s=0;s<=r;s++)for(let d=0;d<=n;d++){let p=d/n*i,f=s/r*Math.PI*2;c.x=(e+t*Math.cos(f))*Math.cos(p),c.y=(e+t*Math.cos(f))*Math.sin(p),c.z=t*Math.sin(f),a.push(c.x,c.y,c.z),h.x=e*Math.cos(p),h.y=e*Math.sin(p),u.subVectors(c,h).normalize(),o.push(u.x,u.y,u.z),l.push(d/n),l.push(s/r)}for(let e=1;e<=r;e++)for(let t=1;t<=n;t++){let r=(n+1)*e+t-1,i=(n+1)*(e-1)+t-1,a=(n+1)*(e-1)+t,o=(n+1)*e+t;s.push(r,i,o),s.push(i,a,o)}this.setIndex(s),this.setAttribute("position",new tH(a,3)),this.setAttribute("normal",new tH(o,3)),this.setAttribute("uv",new tH(l,2))}static fromJSON(e){return new ay(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class ax extends t${constructor(e=1,t=.4,r=64,n=8,i=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:n,p:i,q:s},r=Math.floor(r),n=Math.floor(n);let a=[],o=[],l=[],h=[],c=new eS,u=new eS,d=new eS,p=new eS,f=new eS,m=new eS,g=new eS;for(let a=0;a<=r;++a){let y=a/r*i*Math.PI*2;v(y,i,s,e,d),v(y+.01,i,s,e,p),m.subVectors(p,d),g.addVectors(p,d),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let e=0;e<=n;++e){let i=e/n*Math.PI*2,s=-t*Math.cos(i),p=t*Math.sin(i);c.x=d.x+(s*g.x+p*f.x),c.y=d.y+(s*g.y+p*f.y),c.z=d.z+(s*g.z+p*f.z),o.push(c.x,c.y,c.z),u.subVectors(c,d).normalize(),l.push(u.x,u.y,u.z),h.push(a/r),h.push(e/n)}}for(let e=1;e<=r;e++)for(let t=1;t<=n;t++){let r=(n+1)*(e-1)+(t-1),i=(n+1)*e+(t-1),s=(n+1)*e+t,o=(n+1)*(e-1)+t;a.push(r,i,o),a.push(i,s,o)}function v(e,t,r,n,i){let s=r/t*e,a=Math.cos(s);i.x=n*(2+a)*.5*Math.cos(e),i.y=n*(2+a)*Math.sin(e)*.5,i.z=n*Math.sin(s)*.5}this.setIndex(a),this.setAttribute("position",new tH(o,3)),this.setAttribute("normal",new tH(l,3)),this.setAttribute("uv",new tH(h,2))}static fromJSON(e){return new ax(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class a_ extends t${constructor(e,t=64,r=1,n=8,i=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:n,closed:i};let s=e.computeFrenetFrames(t,i);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;let a=new eS,o=new eS,l=new ep,h=new eS,c=[],u=[],d=[],p=[];function f(i){h=e.getPointAt(i/t,h);let l=s.normals[i],d=s.binormals[i];for(let e=0;e<=n;e++){let t=e/n*Math.PI*2,i=Math.sin(t),s=-Math.cos(t);o.x=s*l.x+i*d.x,o.y=s*l.y+i*d.y,o.z=s*l.z+i*d.z,o.normalize(),u.push(o.x,o.y,o.z),a.x=h.x+r*o.x,a.y=h.y+r*o.y,a.z=h.z+r*o.z,c.push(a.x,a.y,a.z)}}(function(){for(let e=0;e<t;e++)f(e);f(!1===i?t:0),function(){for(let e=0;e<=t;e++)for(let r=0;r<=n;r++)l.x=e/t,l.y=r/n,d.push(l.x,l.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=n;t++){let r=(n+1)*(e-1)+(t-1),i=(n+1)*e+(t-1),s=(n+1)*e+t,a=(n+1)*(e-1)+t;p.push(r,i,a),p.push(i,s,a)}}()})(),this.setIndex(p),this.setAttribute("position",new tH(c,3)),this.setAttribute("normal",new tH(u,3)),this.setAttribute("uv",new tH(d,2))}toJSON(){let e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new a_(new sQ[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}(class extends tC{constructor(e){super(),this.type="ShadowMaterial",this.color=new tU(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}).prototype.isShadowMaterial=!0;class ab extends tC{constructor(e){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new tU(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new tU(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ep(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}ab.prototype.isMeshStandardMaterial=!0;class aw extends ab{constructor(e){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new ep(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return ea(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.sheenTint=new tU(0),this.transmission=0,this.transmissionMap=null,this.thickness=.01,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationTint=new tU(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularTint=new tU(1,1,1),this.specularTintMap=null,this._clearcoat=0,this._transmission=0,this.setValues(e)}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.sheenTint.copy(e.sheenTint),this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationTint.copy(e.attenuationTint),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularTint.copy(e.specularTint),this.specularTintMap=e.specularTintMap,this}}aw.prototype.isMeshPhysicalMaterial=!0,(class extends tC{constructor(e){super(),this.type="MeshPhongMaterial",this.color=new tU(16777215),this.specular=new tU(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new tU(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ep(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}).prototype.isMeshPhongMaterial=!0,(class extends tC{constructor(e){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new tU(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new tU(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ep(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}).prototype.isMeshToonMaterial=!0,(class extends tC{constructor(e){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ep(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}).prototype.isMeshNormalMaterial=!0,(class extends tC{constructor(e){super(),this.type="MeshLambertMaterial",this.color=new tU(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new tU(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}).prototype.isMeshLambertMaterial=!0,(class extends tC{constructor(e){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new tU(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ep(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this}}).prototype.isMeshMatcapMaterial=!0,(class extends sd{constructor(e){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}).prototype.isLineDashedMaterial=!0;const aS={arraySlice:function(e,t,r){return aS.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==r?r:e.length)):e.slice(t,r)},convertArray:function(e,t,r){return e&&(r||e.constructor!==t)?"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e):e},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){let t=e.length,r=Array(t);for(let e=0;e!==t;++e)r[e]=e;return r.sort(function(t,r){return e[t]-e[r]}),r},sortedArray:function(e,t,r){let n=e.length,i=new e.constructor(n);for(let s=0,a=0;a!==n;++s){let n=r[s]*t;for(let r=0;r!==t;++r)i[a++]=e[n+r]}return i},flattenJSON:function(e,t,r,n){let i=1,s=e[0];for(;void 0!==s&&void 0===s[n];)s=e[i++];if(void 0===s)return;let a=s[n];if(void 0!==a){if(Array.isArray(a))do void 0!==(a=s[n])&&(t.push(s.time),r.push.apply(r,a)),s=e[i++];while(void 0!==s)else if(void 0!==a.toArray)do void 0!==(a=s[n])&&(t.push(s.time),a.toArray(r,r.length)),s=e[i++];while(void 0!==s)else do void 0!==(a=s[n])&&(t.push(s.time),r.push(a)),s=e[i++];while(void 0!==s)}},subclip:function(e,t,r,n,i=30){let s=e.clone();s.name=t;let a=[];for(let e=0;e<s.tracks.length;++e){let t=s.tracks[e],o=t.getValueSize(),l=[],h=[];for(let e=0;e<t.times.length;++e){let s=t.times[e]*i;if(!(s<r)&&!(s>=n)){l.push(t.times[e]);for(let r=0;r<o;++r)h.push(t.values[e*o+r])}}0!==l.length&&(t.times=aS.convertArray(l,t.times.constructor),t.values=aS.convertArray(h,t.values.constructor),a.push(t))}s.tracks=a;let o=1/0;for(let e=0;e<s.tracks.length;++e)o>s.tracks[e].times[0]&&(o=s.tracks[e].times[0]);for(let e=0;e<s.tracks.length;++e)s.tracks[e].shift(-1*o);return s.resetDuration(),s},makeClipAdditive:function(e,t=0,r=e,n=30){n<=0&&(n=30);let i=r.tracks.length,s=t/n;for(let t=0;t<i;++t){let n;let i=r.tracks[t],a=i.ValueTypeName;if("bool"===a||"string"===a)continue;let o=e.tracks.find(function(e){return e.name===i.name&&e.ValueTypeName===a});if(void 0===o)continue;let l=0,h=i.getValueSize();i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(l=h/3);let c=0,u=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=u/3);let d=i.times.length-1;if(s<=i.times[0]){let e=l,t=h-l;n=aS.arraySlice(i.values,e,t)}else if(s>=i.times[d]){let e=d*h+l,t=e+h-l;n=aS.arraySlice(i.values,e,t)}else{let e=i.createInterpolant(),t=l,r=h-l;e.evaluate(s),n=aS.arraySlice(e.resultBuffer,t,r)}"quaternion"===a&&new ew().fromArray(n).normalize().conjugate().toArray(n);let p=o.times.length;for(let e=0;e<p;++e){let t=e*u+c;if("quaternion"===a)ew.multiplyQuaternionsFlat(o.values,t,n,0,o.values,t);else{let e=u-2*c;for(let r=0;r<e;++r)o.values[t+r]-=n[r]}}}return e.blendMode=2501,e}};class aM{constructor(e,t,r,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new t.constructor(r),this.sampleValues=t,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(e){let t=this.parameterPositions,r=this._cachedIndex,n=t[r],i=t[r-1];e:{t:{let s;r:{n:if(!(e<n)){for(let s=r+2;;){if(void 0===n){if(e<i)break n;return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,e,i)}if(r===s)break;if(i=n,e<(n=t[++r]))break t}s=t.length;break r}if(!(e>=i)){let a=t[1];e<a&&(r=2,i=a);for(let s=r-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,e,n);if(r===s)break;if(n=i,e>=(i=t[--r-1]))break t}s=r,r=0;break r}break e}for(;r<s;){let n=r+s>>>1;e<t[n]?s=n:r=n+1}if(n=t[r],void 0===(i=t[r-1]))return this._cachedIndex=0,this.beforeStart_(0,e,n);if(void 0===n)return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,i,e)}this._cachedIndex=r,this.intervalChanged_(r,i,n)}return this.interpolate_(r,i,e,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){let t=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=e*n;for(let e=0;e!==n;++e)t[e]=r[i+e];return t}interpolate_(){throw Error("call to abstract method")}intervalChanged_(){}}aM.prototype.beforeStart_=aM.prototype.copySampleValue_,aM.prototype.afterEnd_=aM.prototype.copySampleValue_;class aT extends aM{constructor(e,t,r,n){super(e,t,r,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(e,t,r){let n=this.parameterPositions,i=e-2,s=e+1,a=n[i],o=n[s];if(void 0===a)switch(this.getSettings_().endingStart){case 2401:i=e,a=2*t-r;break;case 2402:i=n.length-2,a=t+n[i]-n[i+1];break;default:i=e,a=r}if(void 0===o)switch(this.getSettings_().endingEnd){case 2401:s=e,o=2*r-t;break;case 2402:s=1,o=r+n[1]-n[0];break;default:s=e-1,o=t}let l=(r-t)*.5,h=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(o-r),this._offsetPrev=i*h,this._offsetNext=s*h}interpolate_(e,t,r,n){let i=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,h=this._offsetPrev,c=this._offsetNext,u=this._weightPrev,d=this._weightNext,p=(r-t)/(n-t),f=p*p,m=f*p,g=-u*m+2*u*f-u*p,v=(1+u)*m+(-1.5-2*u)*f+(-.5+u)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,x=d*m-d*f;for(let e=0;e!==a;++e)i[e]=g*s[h+e]+v*s[l+e]+y*s[o+e]+x*s[c+e];return i}}class aE extends aM{constructor(e,t,r,n){super(e,t,r,n)}interpolate_(e,t,r,n){let i=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,h=(r-t)/(n-t),c=1-h;for(let e=0;e!==a;++e)i[e]=s[l+e]*c+s[o+e]*h;return i}}class aA extends aM{constructor(e,t,r,n){super(e,t,r,n)}interpolate_(e){return this.copySampleValue_(e-1)}}class aC{constructor(e,t,r,n){if(void 0===e)throw Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=aS.convertArray(t,this.TimeBufferType),this.values=aS.convertArray(r,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(e){let t;let r=e.constructor;if(r.toJSON!==this.toJSON)t=r.toJSON(e);else{t={name:e.name,times:aS.convertArray(e.times,Array),values:aS.convertArray(e.values,Array)};let r=e.getInterpolation();r!==e.DefaultInterpolation&&(t.interpolation=r)}return t.type=e.ValueTypeName,t}InterpolantFactoryMethodDiscrete(e){return new aA(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new aE(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new aT(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case 2300:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){let t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw Error(t)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){let t=this.times;for(let r=0,n=t.length;r!==n;++r)t[r]+=e}return this}scale(e){if(1!==e){let t=this.times;for(let r=0,n=t.length;r!==n;++r)t[r]*=e}return this}trim(e,t){let r=this.times,n=r.length,i=0,s=n-1;for(;i!==n&&r[i]<e;)++i;for(;-1!==s&&r[s]>t;)--s;if(++s,0!==i||s!==n){i>=s&&(i=(s=Math.max(s,1))-1);let e=this.getValueSize();this.times=aS.arraySlice(r,i,s),this.values=aS.arraySlice(this.values,i*e,s*e)}return this}validate(){let e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);let r=this.times,n=this.values,i=r.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let s=null;for(let t=0;t!==i;t++){let n=r[t];if("number"==typeof n&&isNaN(n)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,n),e=!1;break}if(null!==s&&s>n){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,n,s),e=!1;break}s=n}if(void 0!==n&&aS.isTypedArray(n))for(let t=0,r=n.length;t!==r;++t){let r=n[t];if(isNaN(r)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,r),e=!1;break}}return e}optimize(){let e=aS.arraySlice(this.times),t=aS.arraySlice(this.values),r=this.getValueSize(),n=2302===this.getInterpolation(),i=e.length-1,s=1;for(let a=1;a<i;++a){let i=!1,o=e[a];if(o!==e[a+1]&&(1!==a||o!==e[0])){if(n)i=!0;else{let e=a*r,n=e-r,s=e+r;for(let a=0;a!==r;++a){let r=t[e+a];if(r!==t[n+a]||r!==t[s+a]){i=!0;break}}}}if(i){if(a!==s){e[s]=e[a];let n=a*r,i=s*r;for(let e=0;e!==r;++e)t[i+e]=t[n+e]}++s}}if(i>0){e[s]=e[i];for(let e=i*r,n=s*r,a=0;a!==r;++a)t[n+a]=t[e+a];++s}return s!==e.length?(this.times=aS.arraySlice(e,0,s),this.values=aS.arraySlice(t,0,s*r)):(this.times=e,this.values=t),this}clone(){let e=aS.arraySlice(this.times,0),t=aS.arraySlice(this.values,0),r=new this.constructor(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}aC.prototype.TimeBufferType=Float32Array,aC.prototype.ValueBufferType=Float32Array,aC.prototype.DefaultInterpolation=2301;class aR extends aC{}aR.prototype.ValueTypeName="bool",aR.prototype.ValueBufferType=Array,aR.prototype.DefaultInterpolation=2300,aR.prototype.InterpolantFactoryMethodLinear=void 0,aR.prototype.InterpolantFactoryMethodSmooth=void 0;class aL extends aC{}aL.prototype.ValueTypeName="color";class aI extends aC{}aI.prototype.ValueTypeName="number";class aP extends aM{constructor(e,t,r,n){super(e,t,r,n)}interpolate_(e,t,r,n){let i=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=(r-t)/(n-t),l=e*a;for(let e=l+a;l!==e;l+=4)ew.slerpFlat(i,0,s,l-a,s,l,o);return i}}class ak extends aC{InterpolantFactoryMethodLinear(e){return new aP(this.times,this.values,this.getValueSize(),e)}}ak.prototype.ValueTypeName="quaternion",ak.prototype.DefaultInterpolation=2301,ak.prototype.InterpolantFactoryMethodSmooth=void 0;class aD extends aC{}aD.prototype.ValueTypeName="string",aD.prototype.ValueBufferType=Array,aD.prototype.DefaultInterpolation=2300,aD.prototype.InterpolantFactoryMethodLinear=void 0,aD.prototype.InterpolantFactoryMethodSmooth=void 0;class aU extends aC{}aU.prototype.ValueTypeName="vector";class aO{constructor(e,t=-1,r,n=2500){this.name=e,this.tracks=r,this.duration=t,this.blendMode=n,this.uuid=es(),this.duration<0&&this.resetDuration()}static parse(e){let t=[],r=e.tracks,n=1/(e.fps||1);for(let e=0,i=r.length;e!==i;++e)t.push((function(e){if(void 0===e.type)throw Error("THREE.KeyframeTrack: track type undefined, can not parse");let t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return aI;case"vector":case"vector2":case"vector3":case"vector4":return aU;case"color":return aL;case"quaternion":return ak;case"bool":case"boolean":return aR;case"string":return aD}throw Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){let t=[],r=[];aS.flattenJSON(e.keys,t,r,"value"),e.times=t,e.values=r}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)})(r[e]).scale(n));let i=new this(e.name,e.duration,t,e.blendMode);return i.uuid=e.uuid,i}static toJSON(e){let t=[],r=e.tracks,n={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,n=r.length;e!==n;++e)t.push(aC.toJSON(r[e]));return n}static CreateFromMorphTargetSequence(e,t,r,n){let i=t.length,s=[];for(let e=0;e<i;e++){let a=[],o=[];a.push((e+i-1)%i,e,(e+1)%i),o.push(0,1,0);let l=aS.getKeyframeOrder(a);a=aS.sortedArray(a,1,l),o=aS.sortedArray(o,1,l),n||0!==a[0]||(a.push(i),o.push(o[0])),s.push(new aI(".morphTargetInfluences["+t[e].name+"]",a,o).scale(1/r))}return new this(e,-1,s)}static findByName(e,t){let r=e;Array.isArray(e)||(r=e.geometry&&e.geometry.animations||e.animations);for(let e=0;e<r.length;e++)if(r[e].name===t)return r[e];return null}static CreateClipsFromMorphTargetSequences(e,t,r){let n={},i=/^([\w-]*?)([\d]+)$/;for(let t=0,r=e.length;t<r;t++){let r=e[t],s=r.name.match(i);if(s&&s.length>1){let e=s[1],t=n[e];t||(n[e]=t=[]),t.push(r)}}let s=[];for(let e in n)s.push(this.CreateFromMorphTargetSequence(e,n[e],t,r));return s}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let r=function(e,t,r,n,i){if(0!==r.length){let s=[],a=[];aS.flattenJSON(r,s,a,n),0!==s.length&&i.push(new e(t,s,a))}},n=[],i=e.name||"default",s=e.fps||30,a=e.blendMode,o=e.length||-1,l=e.hierarchy||[];for(let e=0;e<l.length;e++){let i=l[e].keys;if(i&&0!==i.length){if(i[0].morphTargets){let e;let t={};for(e=0;e<i.length;e++)if(i[e].morphTargets)for(let r=0;r<i[e].morphTargets.length;r++)t[i[e].morphTargets[r]]=-1;for(let r in t){let t=[],s=[];for(let n=0;n!==i[e].morphTargets.length;++n){let n=i[e];t.push(n.time),s.push(n.morphTarget===r?1:0)}n.push(new aI(".morphTargetInfluence["+r+"]",t,s))}o=t.length*(s||1)}else{let s=".bones["+t[e].name+"]";r(aU,s+".position",i,"pos",n),r(ak,s+".quaternion",i,"rot",n),r(aU,s+".scale",i,"scl",n)}}}return 0===n.length?null:new this(i,o,n,a)}resetDuration(){let e=this.tracks,t=0;for(let r=0,n=e.length;r!==n;++r){let e=this.tracks[r];t=Math.max(t,e.times[e.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){let e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}const aN={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]}},aF=new class{constructor(e,t,r){let n;let i=this,s=!1,a=0,o=0,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(e){o++,!1===s&&void 0!==i.onStart&&i.onStart(e,a,o),s=!0},this.itemEnd=function(e){a++,void 0!==i.onProgress&&i.onProgress(e,a,o),a===o&&(s=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return n?n(e):e},this.setURLModifier=function(e){return n=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){let t=l.indexOf(e);return -1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,r=l.length;t<r;t+=2){let r=l[t],n=l[t+1];if(r.global&&(r.lastIndex=0),r.test(e))return n}return null}}};class aB{constructor(e){this.manager=void 0!==e?e:aF,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){let r=this;return new Promise(function(n,i){r.load(e,n,t,i)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const az={};class aG extends aB{constructor(e){super(e)}load(e,t,r,n){let i;void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);let s=this,a=aN.get(e);if(void 0!==a)return s.manager.itemStart(e),setTimeout(function(){t&&t(a),s.manager.itemEnd(e)},0),a;if(void 0!==az[e]){az[e].push({onLoad:t,onProgress:r,onError:n});return}let o=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(o){let r=o[1],i=!!o[2],a=o[3];a=decodeURIComponent(a),i&&(a=atob(a));try{let n;let i=(this.responseType||"").toLowerCase();switch(i){case"arraybuffer":case"blob":let o=new Uint8Array(a.length);for(let e=0;e<a.length;e++)o[e]=a.charCodeAt(e);n="blob"===i?new Blob([o.buffer],{type:r}):o.buffer;break;case"document":n=new DOMParser().parseFromString(a,r);break;case"json":n=JSON.parse(a);break;default:n=a}setTimeout(function(){t&&t(n),s.manager.itemEnd(e)},0)}catch(t){setTimeout(function(){n&&n(t),s.manager.itemError(e),s.manager.itemEnd(e)},0)}}else{for(let a in az[e]=[],az[e].push({onLoad:t,onProgress:r,onError:n}),(i=new XMLHttpRequest).open("GET",e,!0),i.addEventListener("load",function(t){let r=this.response,n=az[e];if(delete az[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),aN.add(e,r);for(let e=0,t=n.length;e<t;e++){let t=n[e];t.onLoad&&t.onLoad(r)}s.manager.itemEnd(e)}else{for(let e=0,r=n.length;e<r;e++){let r=n[e];r.onError&&r.onError(t)}s.manager.itemError(e),s.manager.itemEnd(e)}},!1),i.addEventListener("progress",function(t){let r=az[e];for(let e=0,n=r.length;e<n;e++){let n=r[e];n.onProgress&&n.onProgress(t)}},!1),i.addEventListener("error",function(t){let r=az[e];delete az[e];for(let e=0,n=r.length;e<n;e++){let n=r[e];n.onError&&n.onError(t)}s.manager.itemError(e),s.manager.itemEnd(e)},!1),i.addEventListener("abort",function(t){let r=az[e];delete az[e];for(let e=0,n=r.length;e<n;e++){let n=r[e];n.onError&&n.onError(t)}s.manager.itemError(e),s.manager.itemEnd(e)},!1),void 0!==this.responseType&&(i.responseType=this.responseType),void 0!==this.withCredentials&&(i.withCredentials=this.withCredentials),i.overrideMimeType&&i.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)i.setRequestHeader(a,this.requestHeader[a]);i.send(null)}return s.manager.itemStart(e),i}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class aH extends aB{constructor(e){super(e)}load(e,t,r,n){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);let i=this,s=aN.get(e);if(void 0!==s)return i.manager.itemStart(e),setTimeout(function(){t&&t(s),i.manager.itemEnd(e)},0),s;let a=document.createElementNS("http://www.w3.org/1999/xhtml","img");function o(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1),aN.add(e,this),t&&t(this),i.manager.itemEnd(e)}function l(t){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1),n&&n(t),i.manager.itemError(e),i.manager.itemEnd(e)}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),i.manager.itemStart(e),a.src=e,a}}class aV extends aB{constructor(e){super(e)}load(e,t,r,n){let i=new rm,s=new aH(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let a=0;for(let r=0;r<e.length;++r)!function(r){s.load(e[r],function(e){i.images[r]=e,6==++a&&(i.needsUpdate=!0,t&&t(i))},void 0,n)}(r);return i}}class aW extends aB{constructor(e){super(e)}load(e,t,r,n){let i=new ev,s=new aH(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,function(r){i.image=r;let n=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);i.format=n?1022:1023,i.needsUpdate=!0,void 0!==t&&t(i)},r,n),i}}class aj extends sU{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){let e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new sJ(t,e))}getPoint(e){let t=e*this.getLength(),r=this.getCurveLengths(),n=0;for(;n<r.length;){if(r[n]>=t){let e=r[n]-t,i=this.curves[n],s=i.getLength(),a=0===s?0:1-e/s;return i.getPointAt(a)}n++}return null}getLength(){let e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let e=[],t=0;for(let r=0,n=this.curves.length;r<n;r++)e.push(t+=this.curves[r].getLength());return this.cacheLengths=e,e}getSpacedPoints(e=40){let t=[];for(let r=0;r<=e;r++)t.push(this.getPoint(r/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){let t;let r=[];for(let n=0,i=this.curves;n<i.length;n++){let s=i[n],a=s&&s.isEllipseCurve?2*e:s&&(s.isLineCurve||s.isLineCurve3)?1:s&&s.isSplineCurve?e*s.points.length:e,o=s.getPoints(a);for(let e=0;e<o.length;e++){let n=o[e];t&&t.equals(n)||(r.push(n),t=n)}}return this.autoClose&&r.length>1&&!r[r.length-1].equals(r[0])&&r.push(r[0]),r}copy(e){super.copy(e),this.curves=[];for(let t=0,r=e.curves.length;t<r;t++){let r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}toJSON(){let e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,r=this.curves.length;t<r;t++){let r=this.curves[t];e.curves.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,r=e.curves.length;t<r;t++){let r=e.curves[t];this.curves.push(new sQ[r.type]().fromJSON(r))}return this}}class aq extends aj{constructor(e){super(),this.type="Path",this.currentPoint=new ep,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){let r=new sJ(this.currentPoint.clone(),new ep(e,t));return this.curves.push(r),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,r,n){let i=new sZ(this.currentPoint.clone(),new ep(e,t),new ep(r,n));return this.curves.push(i),this.currentPoint.set(r,n),this}bezierCurveTo(e,t,r,n,i,s){let a=new sX(this.currentPoint.clone(),new ep(e,t),new ep(r,n),new ep(i,s));return this.curves.push(a),this.currentPoint.set(i,s),this}splineThru(e){let t=new sK([this.currentPoint.clone()].concat(e));return this.curves.push(t),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,r,n,i,s){let a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(e+a,t+o,r,n,i,s),this}absarc(e,t,r,n,i,s){return this.absellipse(e,t,r,r,n,i,s),this}ellipse(e,t,r,n,i,s,a,o){let l=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(e+l,t+h,r,n,i,s,a,o),this}absellipse(e,t,r,n,i,s,a,o){let l=new sO(e,t,r,n,i,s,a,o);if(this.curves.length>0){let e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);let h=l.getPoint(1);return this.currentPoint.copy(h),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){let e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class aX extends aq{constructor(e){super(e),this.uuid=es(),this.type="Shape",this.holes=[]}getPointsHoles(e){let t=[];for(let r=0,n=this.holes.length;r<n;r++)t[r]=this.holes[r].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,r=e.holes.length;t<r;t++){let r=e.holes[t];this.holes.push(r.clone())}return this}toJSON(){let e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,r=this.holes.length;t<r;t++){let r=this.holes[t];e.holes.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,r=e.holes.length;t<r;t++){let r=e.holes[t];this.holes.push(new aq().fromJSON(r))}return this}}class aY extends tm{constructor(e,t=1){super(),this.type="Light",this.color=new tU(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){let t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}aY.prototype.isLight=!0,(class extends aY{constructor(e,t,r){super(e,r),this.type="HemisphereLight",this.position.copy(tm.DefaultUp),this.updateMatrix(),this.groundColor=new tU(t)}copy(e){return aY.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}).prototype.isHemisphereLight=!0;const aJ=new e0,aZ=new eS,a$=new eS;class aK{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ep(512,512),this.map=null,this.mapPass=null,this.matrix=new e0,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new rS,this._frameExtents=new ep(1,1),this._viewportCount=1,this._viewports=[new ex(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){let t=this.camera,r=this.matrix;aZ.setFromMatrixPosition(e.matrixWorld),t.position.copy(aZ),a$.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(a$),t.updateMatrixWorld(),aJ.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(aJ),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(t.projectionMatrix),r.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class aQ extends aK{constructor(){super(new rp(50,1,.5,500)),this.focus=1}updateMatrices(e){let t=this.camera,r=2*ei*e.angle*this.focus,n=this.mapSize.width/this.mapSize.height,i=e.distance||t.far;(r!==t.fov||n!==t.aspect||i!==t.far)&&(t.fov=r,t.aspect=n,t.far=i,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}aQ.prototype.isSpotLightShadow=!0;class a0 extends aY{constructor(e,t,r=0,n=Math.PI/3,i=0,s=1){super(e,t),this.type="SpotLight",this.position.copy(tm.DefaultUp),this.updateMatrix(),this.target=new tm,this.distance=r,this.angle=n,this.penumbra=i,this.decay=s,this.shadow=new aQ}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}a0.prototype.isSpotLight=!0;const a1=new e0,a2=new eS,a3=new eS;class a4 extends aK{constructor(){super(new rp(90,1,.5,500)),this._frameExtents=new ep(4,2),this._viewportCount=6,this._viewports=[new ex(2,1,1,1),new ex(0,1,1,1),new ex(3,1,1,1),new ex(1,1,1,1),new ex(3,0,1,1),new ex(1,0,1,1)],this._cubeDirections=[new eS(1,0,0),new eS(-1,0,0),new eS(0,0,1),new eS(0,0,-1),new eS(0,1,0),new eS(0,-1,0)],this._cubeUps=[new eS(0,1,0),new eS(0,1,0),new eS(0,1,0),new eS(0,1,0),new eS(0,0,1),new eS(0,0,-1)]}updateMatrices(e,t=0){let r=this.camera,n=this.matrix,i=e.distance||r.far;i!==r.far&&(r.far=i,r.updateProjectionMatrix()),a2.setFromMatrixPosition(e.matrixWorld),r.position.copy(a2),a3.copy(r.position),a3.add(this._cubeDirections[t]),r.up.copy(this._cubeUps[t]),r.lookAt(a3),r.updateMatrixWorld(),n.makeTranslation(-a2.x,-a2.y,-a2.z),a1.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(a1)}}a4.prototype.isPointLightShadow=!0;class a5 extends aY{constructor(e,t,r=0,n=1){super(e,t),this.type="PointLight",this.distance=r,this.decay=n,this.shadow=new a4}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}a5.prototype.isPointLight=!0;class a6 extends aK{constructor(){super(new rO(-5,5,5,-5,.5,500))}}a6.prototype.isDirectionalLightShadow=!0;class a8 extends aY{constructor(e,t){super(e,t),this.type="DirectionalLight",this.position.copy(tm.DefaultUp),this.updateMatrix(),this.target=new tm,this.shadow=new a6}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}a8.prototype.isDirectionalLight=!0;class a7 extends aY{constructor(e,t){super(e,t),this.type="AmbientLight"}}a7.prototype.isAmbientLight=!0,(class extends aY{constructor(e,t,r=10,n=10){super(e,t),this.type="RectAreaLight",this.width=r,this.height=n}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){let t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}).prototype.isRectAreaLight=!0;class a9{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new eS)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){let r=e.x,n=e.y,i=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.282095),t.addScaledVector(s[1],.488603*n),t.addScaledVector(s[2],.488603*i),t.addScaledVector(s[3],.488603*r),t.addScaledVector(s[4],r*n*1.092548),t.addScaledVector(s[5],n*i*1.092548),t.addScaledVector(s[6],.315392*(3*i*i-1)),t.addScaledVector(s[7],r*i*1.092548),t.addScaledVector(s[8],.546274*(r*r-n*n)),t}getIrradianceAt(e,t){let r=e.x,n=e.y,i=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.886227),t.addScaledVector(s[1],1.023328*n),t.addScaledVector(s[2],1.023328*i),t.addScaledVector(s[3],1.023328*r),t.addScaledVector(s[4],.858086*r*n),t.addScaledVector(s[5],.858086*n*i),t.addScaledVector(s[6],.743125*i*i-.247708),t.addScaledVector(s[7],.858086*r*i),t.addScaledVector(s[8],.429043*(r*r-n*n)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let r=0;r<9;r++)this.coefficients[r].addScaledVector(e.coefficients[r],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let r=0;r<9;r++)this.coefficients[r].lerp(e.coefficients[r],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){let r=this.coefficients;for(let n=0;n<9;n++)r[n].fromArray(e,t+3*n);return this}toArray(e=[],t=0){let r=this.coefficients;for(let n=0;n<9;n++)r[n].toArray(e,t+3*n);return e}static getBasisAt(e,t){let r=e.x,n=e.y,i=e.z;t[0]=.282095,t[1]=.488603*n,t[2]=.488603*i,t[3]=.488603*r,t[4]=1.092548*r*n,t[5]=1.092548*n*i,t[6]=.315392*(3*i*i-1),t[7]=1.092548*r*i,t[8]=.546274*(r*r-n*n)}}a9.prototype.isSphericalHarmonics3=!0;class oe extends aY{constructor(e=new a9,t=1){super(void 0,t),this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){let t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}oe.prototype.isLightProbe=!0;class ot{static decodeText(e){if("undefined"!=typeof TextDecoder)return new TextDecoder().decode(e);let t="";for(let r=0,n=e.length;r<n;r++)t+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(t))}catch(e){return t}}static extractUrlBase(e){let t=e.lastIndexOf("/");return -1===t?"./":e.substr(0,t+1)}}class or extends t${constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){let e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}or.prototype.isInstancedBufferGeometry=!0;class on extends aB{constructor(e){super(e),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,r,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);let i=this,s=aN.get(e);if(void 0!==s)return i.manager.itemStart(e),setTimeout(function(){t&&t(s),i.manager.itemEnd(e)},0),s;let a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader,fetch(e,a).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,Object.assign(i.options,{colorSpaceConversion:"none"}))}).then(function(r){aN.add(e,r),t&&t(r),i.manager.itemEnd(e)}).catch(function(t){n&&n(t),i.manager.itemError(e),i.manager.itemEnd(e)}),i.manager.itemStart(e)}}on.prototype.isImageBitmapLoader=!0;class oi{constructor(){this.type="ShapePath",this.color=new tU,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new aq,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,r,n){return this.currentPath.quadraticCurveTo(e,t,r,n),this}bezierCurveTo(e,t,r,n,i,s){return this.currentPath.bezierCurveTo(e,t,r,n,i,s),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e,t){let r,n,i,s,a;function o(e){let t=[];for(let r=0,n=e.length;r<n;r++){let n=e[r],i=new aX;i.curves=n.curves,t.push(i)}return t}let l=aa.isClockWise,h=this.subPaths;if(0===h.length)return[];if(!0===t)return o(h);let c=[];if(1===h.length)return n=h[0],(i=new aX).curves=n.curves,c.push(i),c;let u=!l(h[0].getPoints());u=e?!u:u;let d=[],p=[],f=[],m=0;p[0]=void 0,f[m]=[];for(let t=0,i=h.length;t<i;t++)r=l(s=(n=h[t]).getPoints()),(r=e?!r:r)?(!u&&p[m]&&m++,p[m]={s:new aX,p:s},p[m].s.curves=n.curves,u&&m++,f[m]=[]):f[m].push({h:n,p:s[0]});if(!p[0])return o(h);if(p.length>1){let e=!1,t=[];for(let e=0,t=p.length;e<t;e++)d[e]=[];for(let r=0,n=p.length;r<n;r++){let n=f[r];for(let i=0;i<n.length;i++){let s=n[i],a=!0;for(let n=0;n<p.length;n++)(function(e,t){let r=t.length,n=!1;for(let i=r-1,s=0;s<r;i=s++){let r=t[i],a=t[s],o=a.x-r.x,l=a.y-r.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(r=t[s],o=-o,a=t[i],l=-l),e.y<r.y||e.y>a.y)continue;if(e.y===r.y){if(e.x===r.x)return!0}else{let t=l*(e.x-r.x)-o*(e.y-r.y);if(0===t)return!0;if(t<0)continue;n=!n}}else{if(e.y!==r.y)continue;if(a.x<=e.x&&e.x<=r.x||r.x<=e.x&&e.x<=a.x)return!0}}return n})(s.p,p[n].p)&&(r!==n&&t.push({froms:r,tos:n,hole:i}),a?(a=!1,d[n].push(s)):e=!0);a&&d[r].push(s)}}t.length>0&&!e&&(f=d)}for(let e=0,t=p.length;e<t;e++){i=p[e].s,c.push(i),a=f[e];for(let e=0,t=a.length;e<t;e++)i.holes.push(a[e].h)}return c}}(class{constructor(e){this.type="Font",this.data=e}generateShapes(e,t=100){let r=[],n=function(e,t,r){let n=Array.from(e),i=t/r.resolution,s=(r.boundingBox.yMax-r.boundingBox.yMin+r.underlineThickness)*i,a=[],o=0,l=0;for(let e=0;e<n.length;e++){let t=n[e];if("\n"===t)o=0,l-=s;else{let e=function(e,t,r,n,i){let s,a,o,l,h,c,u,d;let p=i.glyphs[e]||i.glyphs["?"];if(!p){console.error('THREE.Font: character "'+e+'" does not exists in font family '+i.familyName+".");return}let f=new oi;if(p.o){let e=p._cachedOutline||(p._cachedOutline=p.o.split(" "));for(let i=0,p=e.length;i<p;)switch(e[i++]){case"m":s=e[i++]*t+r,a=e[i++]*t+n,f.moveTo(s,a);break;case"l":s=e[i++]*t+r,a=e[i++]*t+n,f.lineTo(s,a);break;case"q":o=e[i++]*t+r,l=e[i++]*t+n,h=e[i++]*t+r,c=e[i++]*t+n,f.quadraticCurveTo(h,c,o,l);break;case"b":o=e[i++]*t+r,l=e[i++]*t+n,h=e[i++]*t+r,c=e[i++]*t+n,u=e[i++]*t+r,d=e[i++]*t+n,f.bezierCurveTo(h,c,u,d,o,l)}}return{offsetX:p.ha*t,path:f}}(t,i,o,l,r);o+=e.offsetX,a.push(e.path)}}return a}(e,t,this.data);for(let e=0,t=n.length;e<t;e++)Array.prototype.push.apply(r,n[e].toShapes());return r}}).prototype.isFont=!0;const os={getContext:function(){return void 0===r&&(r=new(window.AudioContext||window.webkitAudioContext)),r}};class oa extends aB{constructor(e){super(e)}load(e,t,r,n){let i=this,s=new aG(this.manager);s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,function(r){try{let e=r.slice(0);os.getContext().decodeAudioData(e,function(e){t(e)})}catch(t){n?n(t):console.error(t),i.manager.itemError(e)}},r,n)}}(class extends oe{constructor(e,t,r=1){super(void 0,r);let n=new tU().set(e),i=new tU().set(t),s=new eS(n.r,n.g,n.b),a=new eS(i.r,i.g,i.b),o=Math.sqrt(Math.PI);this.sh.coefficients[0].copy(s).add(a).multiplyScalar(o),this.sh.coefficients[1].copy(s).sub(a).multiplyScalar(o*Math.sqrt(.75))}}).prototype.isHemisphereLightProbe=!0,(class extends oe{constructor(e,t=1){super(void 0,t);let r=new tU().set(e);this.sh.coefficients[0].set(r.r,r.g,r.b).multiplyScalar(2*Math.sqrt(Math.PI))}}).prototype.isAmbientLightProbe=!0;class oo{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=ol(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let t=ol();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function ol(){return("undefined"==typeof performance?Date:performance).now()}const oh=new eS,oc=new ew,ou=new eS,od=new eS;class op extends tm{constructor(){super(),this.type="AudioListener",this.context=os.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new oo}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);let t=this.context.listener,r=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(oh,oc,ou),od.set(0,0,-1).applyQuaternion(oc),t.positionX){let e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(oh.x,e),t.positionY.linearRampToValueAtTime(oh.y,e),t.positionZ.linearRampToValueAtTime(oh.z,e),t.forwardX.linearRampToValueAtTime(od.x,e),t.forwardY.linearRampToValueAtTime(od.y,e),t.forwardZ.linearRampToValueAtTime(od.z,e),t.upX.linearRampToValueAtTime(r.x,e),t.upY.linearRampToValueAtTime(r.y,e),t.upZ.linearRampToValueAtTime(r.z,e)}else t.setPosition(oh.x,oh.y,oh.z),t.setOrientation(od.x,od.y,od.z,r.x,r.y,r.z)}}class of extends tm{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying){console.warn("THREE.Audio: Audio is already playing.");return}if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;let t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const om=new eS,og=new ew,ov=new eS,oy=new eS;class ox extends of{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,r){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=r,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(om,og,ov),oy.set(0,0,1).applyQuaternion(og);let t=this.panner;if(t.positionX){let e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(om.x,e),t.positionY.linearRampToValueAtTime(om.y,e),t.positionZ.linearRampToValueAtTime(om.z,e),t.orientationX.linearRampToValueAtTime(oy.x,e),t.orientationY.linearRampToValueAtTime(oy.y,e),t.orientationZ.linearRampToValueAtTime(oy.z,e)}else t.setPosition(om.x,om.y,om.z),t.setOrientation(oy.x,oy.y,oy.z)}}class o_{constructor(e,t,r){let n,i,s;switch(this.binding=e,this.valueSize=r,t){case"quaternion":n=this._slerp,i=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*r),this._workIndex=5;break;case"string":case"bool":n=this._select,i=this._select,s=this._setAdditiveIdentityOther,this.buffer=Array(5*r);break;default:n=this._lerp,i=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*r)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=i,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){let r=this.buffer,n=this.valueSize,i=e*n+n,s=this.cumulativeWeight;if(0===s){for(let e=0;e!==n;++e)r[i+e]=r[e];s=t}else{s+=t;let e=t/s;this._mixBufferRegion(r,i,0,e,n)}this.cumulativeWeight=s}accumulateAdditive(e){let t=this.buffer,r=this.valueSize,n=r*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,n,0,e,r),this.cumulativeWeightAdditive+=e}apply(e){let t=this.valueSize,r=this.buffer,n=e*t+t,i=this.cumulativeWeight,s=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){let e=t*this._origIndex;this._mixBufferRegion(r,n,e,1-i,t)}s>0&&this._mixBufferRegionAdditive(r,n,this._addIndex*t,1,t);for(let e=t,i=t+t;e!==i;++e)if(r[e]!==r[e+t]){a.setValue(r,n);break}}saveOriginalState(){let e=this.binding,t=this.buffer,r=this.valueSize,n=r*this._origIndex;e.getValue(t,n);for(let e=r;e!==n;++e)t[e]=t[n+e%r];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){let e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){let e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let r=e;r<t;r++)this.buffer[r]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){let e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let r=0;r<this.valueSize;r++)this.buffer[t+r]=this.buffer[e+r]}_select(e,t,r,n,i){if(n>=.5)for(let n=0;n!==i;++n)e[t+n]=e[r+n]}_slerp(e,t,r,n){ew.slerpFlat(e,t,e,t,e,r,n)}_slerpAdditive(e,t,r,n,i){let s=this._workIndex*i;ew.multiplyQuaternionsFlat(e,s,e,t,e,r),ew.slerpFlat(e,t,e,t,e,s,n)}_lerp(e,t,r,n,i){let s=1-n;for(let a=0;a!==i;++a){let i=t+a;e[i]=e[i]*s+e[r+a]*n}}_lerpAdditive(e,t,r,n,i){for(let s=0;s!==i;++s){let i=t+s;e[i]=e[i]+e[r+s]*n}}}const ob="\\[\\]\\.:\\/",ow=RegExp("["+ob+"]","g"),oS="[^"+ob+"]",oM="[^"+ob.replace("\\.","")+"]",oT=/((?:WC+[\/:])*)/.source.replace("WC",oS),oE=RegExp("^"+oT+/(WCOD+)?/.source.replace("WCOD",oM)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",oS)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",oS)+"$"),oA=["material","materials","bones"];class oC{constructor(e,t,r){this.path=t,this.parsedPath=r||oC.parseTrackName(t),this.node=oC.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,r){return e&&e.isAnimationObjectGroup?new oC.Composite(e,t,r):new oC(e,t,r)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(ow,"")}static parseTrackName(e){let t=oE.exec(e);if(!t)throw Error("PropertyBinding: Cannot parse trackName: "+e);let r={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},n=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){let e=r.nodeName.substring(n+1);-1!==oA.indexOf(e)&&(r.nodeName=r.nodeName.substring(0,n),r.objectName=e)}if(null===r.propertyName||0===r.propertyName.length)throw Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r}static findNode(e,t){if(!t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){let r=e.skeleton.getBoneByName(t);if(void 0!==r)return r}if(e.children){let r=function(e){for(let n=0;n<e.length;n++){let i=e[n];if(i.name===t||i.uuid===t)return i;let s=r(i.children);if(s)return s}return null},n=r(e.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){let r=this.resolvedProperty;for(let n=0,i=r.length;n!==i;++n)e[t++]=r[n]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){let r=this.resolvedProperty;for(let n=0,i=r.length;n!==i;++n)r[n]=e[t++]}_setValue_array_setNeedsUpdate(e,t){let r=this.resolvedProperty;for(let n=0,i=r.length;n!==i;++n)r[n]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){let r=this.resolvedProperty;for(let n=0,i=r.length;n!==i;++n)r[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node,t=this.parsedPath,r=t.objectName,n=t.propertyName,i=t.propertyIndex;if(e||(e=oC.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(r){let n=t.objectIndex;switch(r){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===n){n=t;break}break;default:if(void 0===e[r]){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[r]}if(void 0!==n){if(void 0===e[n]){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[n]}}let s=e[n];if(void 0===s){console.error("THREE.PropertyBinding: Trying to update property for track: "+t.nodeName+"."+n+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?a=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===n){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}void 0!==e.morphTargetDictionary[i]&&(i=e.morphTargetDictionary[i])}else{console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);return}}o=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=i}else void 0!==s.fromArray&&void 0!==s.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(o=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=n;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}oC.Composite=class{constructor(e,t,r){let n=r||oC.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}getValue(e,t){this.bind();let r=this._targetGroup.nCachedObjects_,n=this._bindings[r];void 0!==n&&n.getValue(e,t)}setValue(e,t){let r=this._bindings;for(let n=this._targetGroup.nCachedObjects_,i=r.length;n!==i;++n)r[n].setValue(e,t)}bind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].bind()}unbind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].unbind()}},oC.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},oC.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},oC.prototype.GetterByBindingType=[oC.prototype._getValue_direct,oC.prototype._getValue_array,oC.prototype._getValue_arrayElement,oC.prototype._getValue_toArray],oC.prototype.SetterByBindingTypeAndVersioning=[[oC.prototype._setValue_direct,oC.prototype._setValue_direct_setNeedsUpdate,oC.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[oC.prototype._setValue_array,oC.prototype._setValue_array_setNeedsUpdate,oC.prototype._setValue_array_setMatrixWorldNeedsUpdate],[oC.prototype._setValue_arrayElement,oC.prototype._setValue_arrayElement_setNeedsUpdate,oC.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[oC.prototype._setValue_fromArray,oC.prototype._setValue_fromArray_setNeedsUpdate,oC.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]],(class{constructor(){this.uuid=es(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;let e={};this._indicesByUUID=e;for(let t=0,r=arguments.length;t!==r;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};let t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){let e=this._objects,t=this._indicesByUUID,r=this._paths,n=this._parsedPaths,i=this._bindings,s=i.length,a,o=e.length,l=this.nCachedObjects_;for(let h=0,c=arguments.length;h!==c;++h){let c=arguments[h],u=c.uuid,d=t[u];if(void 0===d){d=o++,t[u]=d,e.push(c);for(let e=0;e!==s;++e)i[e].push(new oC(c,r[e],n[e]))}else if(d<l){a=e[d];let o=--l,h=e[o];t[h.uuid]=d,e[d]=h,t[u]=o,e[o]=c;for(let e=0;e!==s;++e){let t=i[e],s=t[o],a=t[d];t[d]=s,void 0===a&&(a=new oC(c,r[e],n[e])),t[o]=a}}else e[d]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){let e=this._objects,t=this._indicesByUUID,r=this._bindings,n=r.length,i=this.nCachedObjects_;for(let s=0,a=arguments.length;s!==a;++s){let a=arguments[s],o=a.uuid,l=t[o];if(void 0!==l&&l>=i){let s=i++,h=e[s];t[h.uuid]=l,e[l]=h,t[o]=s,e[s]=a;for(let e=0;e!==n;++e){let t=r[e],n=t[s],i=t[l];t[l]=n,t[s]=i}}}this.nCachedObjects_=i}uncache(){let e=this._objects,t=this._indicesByUUID,r=this._bindings,n=r.length,i=this.nCachedObjects_,s=e.length;for(let a=0,o=arguments.length;a!==o;++a){let o=arguments[a],l=o.uuid,h=t[l];if(void 0!==h){if(delete t[l],h<i){let a=--i,o=e[a],l=--s,c=e[l];t[o.uuid]=h,e[h]=o,t[c.uuid]=a,e[a]=c,e.pop();for(let e=0;e!==n;++e){let t=r[e],n=t[a],i=t[l];t[h]=n,t[a]=i,t.pop()}}else{let i=--s,a=e[i];i>0&&(t[a.uuid]=h),e[h]=a,e.pop();for(let e=0;e!==n;++e){let t=r[e];t[h]=t[i],t.pop()}}}}this.nCachedObjects_=i}subscribe_(e,t){let r=this._bindingsIndicesByPath,n=r[e],i=this._bindings;if(void 0!==n)return i[n];let s=this._paths,a=this._parsedPaths,o=this._objects,l=o.length,h=this.nCachedObjects_,c=Array(l);n=i.length,r[e]=n,s.push(e),a.push(t),i.push(c);for(let r=h,n=o.length;r!==n;++r){let n=o[r];c[r]=new oC(n,e,t)}return c}unsubscribe_(e){let t=this._bindingsIndicesByPath,r=t[e];if(void 0!==r){let n=this._paths,i=this._parsedPaths,s=this._bindings,a=s.length-1,o=s[a];t[e[a]]=r,s[r]=o,s.pop(),i[r]=i[a],i.pop(),n[r]=n[a],n.pop()}}}).prototype.isAnimationObjectGroup=!0;class oR{constructor(e,t,r=null,n=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=r,this.blendMode=n;let i=t.tracks,s=i.length,a=Array(s),o={endingStart:2400,endingEnd:2400};for(let e=0;e!==s;++e){let t=i[e].createInterpolant(null);a[e]=t,t.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,r){if(e.fadeOut(t),this.fadeIn(t),r){let r=this._clip.duration,n=e._clip.duration;e.warp(1,n/r,t),this.warp(r/n,1,t)}return this}crossFadeTo(e,t,r){return e.crossFadeFrom(this,t,r)}stopFading(){let e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,r){let n=this._mixer,i=n.time,s=this.timeScale,a=this._timeScaleInterpolant;null===a&&(a=n._lendControlInterpolant(),this._timeScaleInterpolant=a);let o=a.parameterPositions,l=a.sampleValues;return o[0]=i,o[1]=i+r,l[0]=e/s,l[1]=t/s,this}stopWarping(){let e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,r,n){if(!this.enabled){this._updateWeight(e);return}let i=this._startTime;if(null!==i){let n=(e-i)*r;if(n<0||0===r)return;this._startTime=null,t=r*n}t*=this._updateTimeScale(e);let s=this._updateTime(t),a=this._updateWeight(e);if(a>0){let e=this._interpolants,t=this._propertyBindings;if(2501===this.blendMode)for(let r=0,n=e.length;r!==n;++r)e[r].evaluate(s),t[r].accumulateAdditive(a);else for(let r=0,i=e.length;r!==i;++r)e[r].evaluate(s),t[r].accumulate(n,a)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;let r=this._weightInterpolant;if(null!==r){let n=r.evaluate(e)[0];t*=n,e>r.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;let r=this._timeScaleInterpolant;null!==r&&(t*=r.evaluate(e)[0],e>r.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){let t=this._clip.duration,r=this.loop,n=this.time+e,i=this._loopCount,s=2202===r;if(0===e)return -1===i?n:s&&(1&i)==1?t-n:n;if(2200===r){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));i:{if(n>=t)n=t;else if(n<0)n=0;else{this.time=n;break i}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===i&&(e>=0?(i=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),n>=t||n<0){let r=Math.floor(n/t);n-=t*r,i+=Math.abs(r);let a=this.repetitions-i;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=e>0?t:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===a){let t=e<0;this._setEndings(t,!t,s)}else this._setEndings(!1,!1,s);this._loopCount=i,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:r})}}else this.time=n;if(s&&(1&i)==1)return t-n}return n}_setEndings(e,t,r){let n=this._interpolantSettings;r?(n.endingStart=2401,n.endingEnd=2401):(e?n.endingStart=this.zeroSlopeAtStart?2401:2400:n.endingStart=2402,t?n.endingEnd=this.zeroSlopeAtEnd?2401:2400:n.endingEnd=2402)}_scheduleFading(e,t,r){let n=this._mixer,i=n.time,s=this._weightInterpolant;null===s&&(s=n._lendControlInterpolant(),this._weightInterpolant=s);let a=s.parameterPositions,o=s.sampleValues;return a[0]=i,o[0]=t,a[1]=i+e,o[1]=r,this}}(class extends ee{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){let r=e._localRoot||this._root,n=e._clip.tracks,i=n.length,s=e._propertyBindings,a=e._interpolants,o=r.uuid,l=this._bindingsByRootAndName,h=l[o];void 0===h&&(h={},l[o]=h);for(let e=0;e!==i;++e){let i=n[e],l=i.name,c=h[l];if(void 0!==c)s[e]=c;else{if(void 0!==(c=s[e])){null===c._cacheIndex&&(++c.referenceCount,this._addInactiveBinding(c,o,l));continue}let n=t&&t._propertyBindings[e].binding.parsedPath;c=new o_(oC.create(r,l,n),i.ValueTypeName,i.getValueSize()),++c.referenceCount,this._addInactiveBinding(c,o,l),s[e]=c}a[e].resultBuffer=c.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){let t=(e._localRoot||this._root).uuid,r=e._clip.uuid,n=this._actionsByClip[r];this._bindAction(e,n&&n.knownActions[0]),this._addInactiveAction(e,r,t)}let t=e._propertyBindings;for(let e=0,r=t.length;e!==r;++e){let r=t[e];0==r.useCount++&&(this._lendBinding(r),r.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){let t=e._propertyBindings;for(let e=0,r=t.length;e!==r;++e){let r=t[e];0==--r.useCount&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){let t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,r){let n=this._actions,i=this._actionsByClip,s=i[t];if(void 0===s)s={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=s;else{let t=s.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=n.length,n.push(e),s.actionByRoot[r]=e}_removeInactiveAction(e){let t=this._actions,r=t[t.length-1],n=e._cacheIndex;r._cacheIndex=n,t[n]=r,t.pop(),e._cacheIndex=null;let i=e._clip.uuid,s=this._actionsByClip,a=s[i],o=a.knownActions,l=o[o.length-1],h=e._byClipCacheIndex;l._byClipCacheIndex=h,o[h]=l,o.pop(),e._byClipCacheIndex=null;let c=a.actionByRoot,u=(e._localRoot||this._root).uuid;delete c[u],0===o.length&&delete s[i],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){let t=e._propertyBindings;for(let e=0,r=t.length;e!==r;++e){let r=t[e];0==--r.referenceCount&&this._removeInactiveBinding(r)}}_lendAction(e){let t=this._actions,r=e._cacheIndex,n=this._nActiveActions++,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i}_takeBackAction(e){let t=this._actions,r=e._cacheIndex,n=--this._nActiveActions,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i}_addInactiveBinding(e,t,r){let n=this._bindingsByRootAndName,i=this._bindings,s=n[t];void 0===s&&(s={},n[t]=s),s[r]=e,e._cacheIndex=i.length,i.push(e)}_removeInactiveBinding(e){let t=this._bindings,r=e.binding,n=r.rootNode.uuid,i=r.path,s=this._bindingsByRootAndName,a=s[n],o=t[t.length-1],l=e._cacheIndex;o._cacheIndex=l,t[l]=o,t.pop(),delete a[i],0===Object.keys(a).length&&delete s[n]}_lendBinding(e){let t=this._bindings,r=e._cacheIndex,n=this._nActiveBindings++,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i}_takeBackBinding(e){let t=this._bindings,r=e._cacheIndex,n=--this._nActiveBindings,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i}_lendControlInterpolant(){let e=this._controlInterpolants,t=this._nActiveControlInterpolants++,r=e[t];return void 0===r&&((r=new aE(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,e[t]=r),r}_takeBackControlInterpolant(e){let t=this._controlInterpolants,r=e.__cacheIndex,n=--this._nActiveControlInterpolants,i=t[n];e.__cacheIndex=n,t[n]=e,i.__cacheIndex=r,t[r]=i}clipAction(e,t,r){let n=t||this._root,i=n.uuid,s="string"==typeof e?aO.findByName(n,e):e,a=null!==s?s.uuid:e,o=this._actionsByClip[a],l=null;if(void 0===r&&(r=null!==s?s.blendMode:2500),void 0!==o){let e=o.actionByRoot[i];if(void 0!==e&&e.blendMode===r)return e;l=o.knownActions[0],null===s&&(s=l._clip)}if(null===s)return null;let h=new oR(this,s,t,r);return this._bindAction(h,l),this._addInactiveAction(h,a,i),h}existingAction(e,t){let r=t||this._root,n=r.uuid,i="string"==typeof e?aO.findByName(r,e):e,s=i?i.uuid:e,a=this._actionsByClip[s];return void 0!==a&&a.actionByRoot[n]||null}stopAllAction(){let e=this._actions,t=this._nActiveActions;for(let r=t-1;r>=0;--r)e[r].stop();return this}update(e){e*=this.timeScale;let t=this._actions,r=this._nActiveActions,n=this.time+=e,i=Math.sign(e),s=this._accuIndex^=1;for(let a=0;a!==r;++a)t[a]._update(n,e,i,s);let a=this._bindings,o=this._nActiveBindings;for(let e=0;e!==o;++e)a[e].apply(s);return this}setTime(e){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){let t=this._actions,r=e.uuid,n=this._actionsByClip,i=n[r];if(void 0!==i){let e=i.knownActions;for(let r=0,n=e.length;r!==n;++r){let n=e[r];this._deactivateAction(n);let i=n._cacheIndex,s=t[t.length-1];n._cacheIndex=null,n._byClipCacheIndex=null,s._cacheIndex=i,t[i]=s,t.pop(),this._removeInactiveBindingsForAction(n)}delete n[r]}}uncacheRoot(e){let t=e.uuid,r=this._actionsByClip;for(let e in r){let n=r[e].actionByRoot[t];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}let n=this._bindingsByRootAndName[t];if(void 0!==n)for(let e in n){let t=n[e];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(e,t){let r=this.existingAction(e,t);null!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}}).prototype._controlInterpolantsResultBuffer=new Float32Array(1);class oL{constructor(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new oL(void 0===this.value.clone?this.value:this.value.clone())}}(class extends iV{constructor(e,t,r=1){super(e,t),this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){let t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){let t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}).prototype.isInstancedInterleavedBuffer=!0,(class{constructor(e,t,r,n,i){this.buffer=e,this.type=t,this.itemSize=r,this.elementSize=n,this.count=i,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}).prototype.isGLBufferAttribute=!0;class oI{constructor(e,t,r=0,n=1/0){this.ray=new eQ(e,t),this.near=r,this.far=n,this.camera=null,this.layers=new tt,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!1,r=[]){return ok(e,this,r,t),r.sort(oP),r}intersectObjects(e,t=!1,r=[]){for(let n=0,i=e.length;n<i;n++)ok(e[n],this,r,t);return r.sort(oP),r}}function oP(e,t){return e.distance-t.distance}function ok(e,t,r,n){if(e.layers.test(t.layers)&&e.raycast(t,r),!0===n){let n=e.children;for(let e=0,i=n.length;e<i;e++)ok(n[e],t,r,!0)}}const oD=new ep;class oU{constructor(e=new ep(1/0,1/0),t=new ep(-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let r=oD.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x)&&!(e.x>this.max.x)&&!(e.y<this.min.y)&&!(e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x)&&!(e.min.x>this.max.x)&&!(e.max.y<this.min.y)&&!(e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return oD.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}oU.prototype.isBox2=!0;const oO=new eS,oN=new eS;(class extends tm{constructor(e){super(),this.material=e,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}}).prototype.isImmediateRenderObject=!0;const oF=new eS,oB=new e0,oz=new e0;new Int32Array(new Float32Array(1).buffer),sU.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(sU.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},aq.prototype.fromPoints=function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)},(class extends sb{constructor(e=10,t=10,r=4473924,n=8947848){r=new tU(r),n=new tU(n);let i=t/2,s=e/t,a=e/2,o=[],l=[];for(let e=0,h=0,c=-a;e<=t;e++,c+=s){o.push(-a,0,c,a,0,c),o.push(c,0,-a,c,0,a);let t=e===i?r:n;t.toArray(l,h),h+=3,t.toArray(l,h),h+=3,t.toArray(l,h),h+=3,t.toArray(l,h),h+=3}let h=new t$;h.setAttribute("position",new tH(o,3)),h.setAttribute("color",new tH(l,3)),super(h,new sd({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}).prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},(class extends sb{constructor(e){let t=function e(t){let r=[];t&&t.isBone&&r.push(t);for(let n=0;n<t.children.length;n++)r.push.apply(r,e(t.children[n]));return r}(e),r=new t$,n=[],i=[],s=new tU(0,0,1),a=new tU(0,1,0);for(let e=0;e<t.length;e++){let r=t[e];r.parent&&r.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),i.push(s.r,s.g,s.b),i.push(a.r,a.g,a.b))}r.setAttribute("position",new tH(n,3)),r.setAttribute("color",new tH(i,3)),super(r,new sd({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){let t=this.bones,r=this.geometry,n=r.getAttribute("position");oz.copy(this.root.matrixWorld).invert();for(let e=0,r=0;e<t.length;e++){let i=t[e];i.parent&&i.parent.isBone&&(oB.multiplyMatrices(oz,i.matrixWorld),oF.setFromMatrixPosition(oB),n.setXYZ(r,oF.x,oF.y,oF.z),oB.multiplyMatrices(oz,i.parent.matrixWorld),oF.setFromMatrixPosition(oB),n.setXYZ(r+1,oF.x,oF.y,oF.z),r+=2)}r.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}).prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},aB.prototype.extractUrlBase=function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),ot.extractUrlBase(e)},aB.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},oU.prototype.center=function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},oU.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},oU.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},oU.prototype.size=function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)},eE.prototype.center=function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},eE.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},eE.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},eE.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},eE.prototype.size=function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)},ej.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},rS.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},(class{constructor(e=new eS,t=new eS){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){oO.subVectors(e,this.start),oN.subVectors(this.end,this.start);let r=oN.dot(oN),n=oN.dot(oO)/r;return t&&(n=ea(n,0,1)),n}closestPointToPoint(e,t,r){let n=this.closestPointToPointParameter(e,t);return this.delta(r).multiplyScalar(n).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}).prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},ef.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},ef.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},ef.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},ef.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},ef.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},ef.prototype.getInverse=function(e){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},e0.prototype.extractPosition=function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},e0.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},e0.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new eS().setFromMatrixColumn(this,3)},e0.prototype.setRotationFromQuaternion=function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},e0.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},e0.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},e0.prototype.multiplyVector4=function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},e0.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},e0.prototype.rotateAxis=function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},e0.prototype.crossVector=function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},e0.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},e0.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},e0.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},e0.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},e0.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},e0.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},e0.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},e0.prototype.makeFrustum=function(e,t,r,n,i,s){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,n,r,i,s)},e0.prototype.getInverse=function(e){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},r_.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},ew.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},ew.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},eQ.prototype.isIntersectionBox=function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},eQ.prototype.isIntersectionPlane=function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},eQ.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},tE.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},tE.prototype.barycoordFromPoint=function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},tE.prototype.midpoint=function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},tE.prototypenormal=function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},tE.prototype.plane=function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)},tE.barycoordFromPoint=function(e,t,r,n,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),tE.getBarycoord(e,t,r,n,i)},tE.normal=function(e,t,r,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),tE.getNormal(e,t,r,n)},aX.prototype.extractAllPoints=function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},aX.prototype.extrude=function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new ah(this,e)},aX.prototype.makeGeometry=function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new am(this,e)},ep.prototype.fromAttribute=function(e,t,r){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},ep.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},ep.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},eS.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},eS.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},eS.prototype.getPositionFromMatrix=function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},eS.prototype.getScaleFromMatrix=function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},eS.prototype.getColumnFromMatrix=function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},eS.prototype.applyProjection=function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},eS.prototype.fromAttribute=function(e,t,r){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},eS.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},eS.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},ex.prototype.fromAttribute=function(e,t,r){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},ex.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},tm.prototype.getChildByName=function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},tm.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},tm.prototype.translate=function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},tm.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},tm.prototype.applyMatrix=function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(tm.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),rs.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(rs.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),st.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},rp.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(aY.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(tB.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),35048===this.usage},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(35048)}}}),tB.prototype.setDynamic=function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?35048:35044),this},tB.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},tB.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},t$.prototype.addIndex=function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},t$.prototype.addAttribute=function(e,t){return(console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute)?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new tB(arguments[1],arguments[2])))},t$.prototype.addDrawCall=function(e,t,r){void 0!==r&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},t$.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},t$.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},t$.prototype.removeAttribute=function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},t$.prototype.applyMatrix=function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(t$.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),iV.prototype.setDynamic=function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?35048:35044),this},iV.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},ah.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},ah.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},ah.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},iH.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},oL.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(tC.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new tU}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(ru.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),iB.prototype.clearTarget=function(e,t,r,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,r,n)},iB.prototype.animate=function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},iB.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},iB.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},iB.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},iB.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},iB.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},iB.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},iB.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},iB.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},iB.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},iB.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},iB.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},iB.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},iB.prototype.enableScissorTest=function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},iB.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},iB.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},iB.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},iB.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},iB.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},iB.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},iB.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},iB.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},iB.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},iB.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(iB.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?3001:3e3}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(iR.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(e_.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),of.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");let t=this;return new oa().load(e,function(e){t.setBuffer(e)}),this},(class{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0,t=this.getFrequencyData();for(let r=0;r<t.length;r++)e+=t[r];return e/t.length}}).prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},rf.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},rf.prototype.clear=function(e,t,r,n){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(e,t,r,n)},em.crossOrigin=void 0,em.loadTexture=function(e,t,r,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");let i=new aW;i.setCrossOrigin(this.crossOrigin);let s=i.load(e,r,void 0,n);return t&&(s.mapping=t),s},em.loadTextureCube=function(e,t,r,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");let i=new aV;i.setCrossOrigin(this.crossOrigin);let s=i.load(e,r,void 0,n);return t&&(s.mapping=t),s},em.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},em.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"132"}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="132");const oG=()=>new Map,oH=e=>{let t=oG();return e.forEach((e,r)=>{t.set(r,e)}),t},oV=(e,t,r)=>{let n=e.get(t);return void 0===n&&e.set(t,n=r()),n},oW=(e,t)=>{let r=[];for(let[n,i]of e)r.push(t(i,n));return r},oj=(e,t)=>{for(let[r,n]of e)if(t(n,r))return!0;return!1},oq=()=>new Set,oX=e=>e[e.length-1],oY=(e,t)=>{for(let r=0;r<t.length;r++)e.push(t[r])},oJ=Array.from,oZ=Array.isArray;class o${constructor(){this._observers=oG()}on(e,t){return oV(this._observers,e,oq).add(t),t}once(e,t){let r=(...n)=>{this.off(e,r),t(...n)};this.on(e,r)}off(e,t){let r=this._observers.get(e);void 0!==r&&(r.delete(t),0===r.size&&this._observers.delete(e))}emit(e,t){return oJ((this._observers.get(e)||oG()).values()).forEach(e=>e(...t))}destroy(){this._observers=oG()}}class oK{constructor(){this._observers=oG()}on(e,t){oV(this._observers,e,oq).add(t)}once(e,t){let r=(...n)=>{this.off(e,r),t(...n)};this.on(e,r)}off(e,t){let r=this._observers.get(e);void 0!==r&&(r.delete(t),0===r.size&&this._observers.delete(e))}emit(e,t){return oJ((this._observers.get(e)||oG()).values()).forEach(e=>e(...t))}destroy(){this._observers=oG()}}const oQ=Math.floor,o0=Math.abs,o1=Math.log10,o2=(e,t)=>e<t?e:t,o3=(e,t)=>e>t?e:t,o4=e=>0!==e?e<0:1/e<0,o5=Number.MAX_SAFE_INTEGER,o6=Number.isInteger||(e=>"number"==typeof e&&isFinite(e)&&oQ(e)===e),o8=String.fromCharCode;o8(65535);const o7=e=>e.toLowerCase(),o9=/^\s*/g,le=e=>e.replace(o9,""),lt=/([A-Z])/g,lr=(e,t)=>le(e.replace(lt,e=>`${t}${o7(e)}`)),ln="undefined"!=typeof TextEncoder?new TextEncoder:null,li=ln?e=>ln.encode(e):e=>{let t=unescape(encodeURIComponent(e)),r=t.length,n=new Uint8Array(r);for(let e=0;e<r;e++)n[e]=t.codePointAt(e);return n};let ls="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});ls&&1===ls.decode(new Uint8Array).length&&(ls=null);class la{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const lo=()=>new la,ll=e=>{let t=e.cpos;for(let r=0;r<e.bufs.length;r++)t+=e.bufs[r].length;return t},lh=e=>{let t=new Uint8Array(ll(e)),r=0;for(let n=0;n<e.bufs.length;n++){let i=e.bufs[n];t.set(i,r),r+=i.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),r),t},lc=(e,t)=>{let r=e.cbuf.length;r-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(2*o3(r,t)),e.cpos=0)},lu=(e,t)=>{let r=e.cbuf.length;e.cpos===r&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(2*r),e.cpos=0),e.cbuf[e.cpos++]=t},ld=(e,t)=>{for(;t>127;)lu(e,128|127&t),t=oQ(t/128);lu(e,127&t)},lp=(e,t)=>{let r=o4(t);for(r&&(t=-t),lu(e,(t>63?128:0)|(r?64:0)|63&t),t=oQ(t/64);t>0;)lu(e,(t>127?128:0)|127&t),t=oQ(t/128)},lf=new Uint8Array(3e4),lm=lf.length/3,lg=ln&&ln.encodeInto?(e,t)=>{if(t.length<lm){let r=ln.encodeInto(t,lf).written||0;ld(e,r);for(let t=0;t<r;t++)lu(e,lf[t])}else ly(e,li(t))}:(e,t)=>{let r=unescape(encodeURIComponent(t)),n=r.length;ld(e,n);for(let t=0;t<n;t++)lu(e,r.codePointAt(t))},lv=(e,t)=>{let r=e.cbuf.length,n=e.cpos,i=o2(r-n,t.length),s=t.length-i;e.cbuf.set(t.subarray(0,i),n),e.cpos+=i,s>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(o3(2*r,s)),e.cbuf.set(t.subarray(i)),e.cpos=s)},ly=(e,t)=>{ld(e,t.byteLength),lv(e,t)},lx=(e,t)=>{lc(e,t);let r=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,r},l_=(e,t)=>lx(e,4).setFloat32(0,t,!1),lb=(e,t)=>lx(e,8).setFloat64(0,t,!1),lw=(e,t)=>lx(e,8).setBigInt64(0,t,!1),lS=new DataView(new ArrayBuffer(4)),lM=e=>(lS.setFloat32(0,e),lS.getFloat32(0)===e),lT=(e,t)=>{switch(typeof t){case"string":lu(e,119),lg(e,t);break;case"number":o6(t)&&2147483647>=o0(t)?(lu(e,125),lp(e,t)):lM(t)?(lu(e,124),l_(e,t)):(lu(e,123),lb(e,t));break;case"bigint":lu(e,122),lw(e,t);break;case"object":if(null===t)lu(e,126);else if(oZ(t)){lu(e,117),ld(e,t.length);for(let r=0;r<t.length;r++)lT(e,t[r])}else if(t instanceof Uint8Array)lu(e,116),ly(e,t);else{lu(e,118);let r=Object.keys(t);ld(e,r.length);for(let n=0;n<r.length;n++){let i=r[n];lg(e,i),lT(e,t[i])}}break;case"boolean":lu(e,t?120:121);break;default:lu(e,127)}};class lE extends la{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&ld(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const lA=e=>{e.count>0&&(lp(e.encoder,1===e.count?e.s:-e.s),e.count>1&&ld(e.encoder,e.count-2))};class lC{constructor(){this.encoder=new la,this.s=0,this.count=0}write(e){this.s===e?this.count++:(lA(this),this.count=1,this.s=e)}toUint8Array(){return lA(this),lh(this.encoder)}}const lR=e=>{if(e.count>0){let t=2*e.diff+(1===e.count?0:1);lp(e.encoder,t),e.count>1&&ld(e.encoder,e.count-2)}};class lL{constructor(){this.encoder=new la,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(lR(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return lR(this),lh(this.encoder)}}class lI{constructor(){this.sarr=[],this.s="",this.lensE=new lC}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){let e=new la;return this.sarr.push(this.s),this.s="",lg(e,this.sarr.join("")),lv(e,this.lensE.toUint8Array()),lh(e)}}const lP=e=>Error(e),lk=()=>{throw lP("Method unimplemented")},lD=()=>{throw lP("Unexpected case")},lU=lP("Unexpected end of array"),lO=lP("Integer out of Range");class lN{constructor(e){this.arr=e,this.pos=0}}const lF=e=>new lN(e),lB=e=>e.pos!==e.arr.length,lz=(e,t)=>{let r=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,r},lG=e=>lz(e,lV(e)),lH=e=>e.arr[e.pos++],lV=e=>{let t=0,r=1,n=e.arr.length;for(;e.pos<n;){let n=e.arr[e.pos++];if(t+=(127&n)*r,r*=128,n<128)return t;if(t>o5)throw lO}throw lU},lW=e=>{let t=e.arr[e.pos++],r=63&t,n=64,i=(64&t)>0?-1:1;if((128&t)==0)return i*r;let s=e.arr.length;for(;e.pos<s;){if(r+=(127&(t=e.arr[e.pos++]))*n,n*=128,t<128)return i*r;if(r>o5)throw lO}throw lU},lj=ls?e=>ls.decode(lG(e)):e=>{let t=lV(e);if(0===t)return"";{let r=String.fromCodePoint(lH(e));if(--t<100)for(;t--;)r+=String.fromCodePoint(lH(e));else for(;t>0;){let n=t<1e4?t:1e4,i=e.arr.subarray(e.pos,e.pos+n);e.pos+=n,r+=String.fromCodePoint.apply(null,i),t-=n}return decodeURIComponent(escape(r))}},lq=(e,t)=>{let r=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,r},lX=[e=>void 0,e=>null,lW,e=>lq(e,4).getFloat32(0,!1),e=>lq(e,8).getFloat64(0,!1),e=>lq(e,8).getBigInt64(0,!1),e=>!1,e=>!0,lj,e=>{let t=lV(e),r={};for(let n=0;n<t;n++)r[lj(e)]=lY(e);return r},e=>{let t=lV(e),r=[];for(let n=0;n<t;n++)r.push(lY(e));return r},lG],lY=e=>lX[127-lH(e)](e);class lJ extends lN{constructor(e,t){super(e),this.reader=t,this.s=null,this.count=0}read(){return 0===this.count&&(this.s=this.reader(this),lB(this)?this.count=lV(this)+1:this.count=-1),this.count--,this.s}}class lZ extends lN{constructor(e){super(e),this.s=0,this.count=0}read(){if(0===this.count){this.s=lW(this);let e=o4(this.s);this.count=1,e&&(this.s=-this.s,this.count=lV(this)+2)}return this.count--,this.s}}class l$ extends lN{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(0===this.count){let e=lW(this);this.diff=oQ(e/2),this.count=1,1&e&&(this.count=lV(this)+2)}return this.s+=this.diff,this.count--,this.s}}class lK{constructor(e){this.decoder=new lZ(e),this.str=lj(this.decoder),this.spos=0}read(){let e=this.spos+this.decoder.read(),t=this.str.slice(this.spos,e);return this.spos=e,t}}crypto.subtle;const lQ=crypto.getRandomValues.bind(crypto),l0=Math.random,l1=()=>lQ(new Uint32Array(1))[0],l2=()=>"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(e^l1()&15>>e/4).toString(16)),l3=Date.now,l4=e=>new Promise(e);Promise.all.bind(Promise);const l5=e=>Promise.reject(e),l6=e=>Promise.resolve(e),l8=e=>void 0===e?null:e;let l7=new class{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}},l9=!0;try{"undefined"!=typeof localStorage&&localStorage&&(l7=localStorage,l9=!1)}catch(e){}const he=l7,ht=e=>l9||addEventListener("storage",e),hr=e=>l9||removeEventListener("storage",e),hn=Object.assign,hi=Object.keys,hs=(e,t)=>{for(let r in e)t(e[r],r)},ha=e=>hi(e).length,ho=e=>{for(let t in e)return!1;return!0},hl=(e,t)=>{for(let r in e)if(!t(e[r],r))return!1;return!0},hh=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),hc=(e,t)=>e===t||ha(e)===ha(t)&&hl(e,(e,r)=>(void 0!==e||hh(t,r))&&t[r]===e),hu=(e,t,r=0)=>{try{for(;r<e.length;r++)e[r](...t)}finally{r<e.length&&hu(e,t,r+1)}},hd=()=>{},hp=e=>e,hf=(e,t)=>e===t,hm=(e,t)=>{if(null==e||null==t)return hf(e,t);if(e.constructor!==t.constructor)return!1;if(e===t)return!0;switch(e.constructor){case ArrayBuffer:e=new Uint8Array(e),t=new Uint8Array(t);case Uint8Array:if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;break;case Set:if(e.size!==t.size)return!1;for(let r of e)if(!t.has(r))return!1;break;case Map:if(e.size!==t.size)return!1;for(let r of e.keys())if(!t.has(r)||!hm(e.get(r),t.get(r)))return!1;break;case Object:if(ha(e)!==ha(t))return!1;for(let r in e)if(!hh(e,r)||!hm(e[r],t[r]))return!1;break;case Array:if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!hm(e[r],t[r]))return!1;break;default:return!1}return!0};var hg={},hv=hg={};function hy(){throw Error("setTimeout has not been defined")}function hx(){throw Error("clearTimeout has not been defined")}function h_(e){if(E===setTimeout)return setTimeout(e,0);if((E===hy||!E)&&setTimeout)return E=setTimeout,setTimeout(e,0);try{return E(e,0)}catch(t){try{return E.call(null,e,0)}catch(t){return E.call(this,e,0)}}}!function(){try{E="function"==typeof setTimeout?setTimeout:hy}catch(e){E=hy}try{A="function"==typeof clearTimeout?clearTimeout:hx}catch(e){A=hx}}();var hb=[],hw=!1,hS=-1;function hM(){hw&&C&&(hw=!1,C.length?hb=C.concat(hb):hS=-1,hb.length&&hT())}function hT(){if(!hw){var e=h_(hM);hw=!0;for(var t=hb.length;t;){for(C=hb,hb=[];++hS<t;)C&&C[hS].run();hS=-1,t=hb.length}C=null,hw=!1,function(e){if(A===clearTimeout)return clearTimeout(e);if((A===hx||!A)&&clearTimeout)return A=clearTimeout,clearTimeout(e);try{A(e)}catch(t){try{return A.call(null,e)}catch(t){return A.call(this,e)}}}(e)}}function hE(e,t){this.fun=e,this.array=t}function hA(){}hv.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];hb.push(new hE(e,t)),1!==hb.length||hw||h_(hT)},hE.prototype.run=function(){this.fun.apply(null,this.array)},hv.title="browser",hv.browser=!0,hv.env={},hv.argv=[],hv.version="",hv.versions={},hv.on=hA,hv.addListener=hA,hv.once=hA,hv.off=hA,hv.removeListener=hA,hv.removeAllListeners=hA,hv.emit=hA,hv.prependListener=hA,hv.prependOnceListener=hA,hv.listeners=function(e){return[]},hv.binding=function(e){throw Error("process.binding is not supported")},hv.cwd=function(){return"/"},hv.chdir=function(e){throw Error("process.chdir is not supported")},hv.umask=function(){return 0};const hC=void 0!==hg&&hg.release&&/node|io\.js/.test(hg.release.name)&&"[object process]"===Object.prototype.toString.call(void 0!==hg?hg:0),hR="undefined"!=typeof window&&"undefined"!=typeof document&&!hC;"undefined"!=typeof navigator&&/Mac/.test(navigator.platform);const hL=[],hI=()=>{if(void 0===n){if(hC){n=oG();let e=hg.argv,t=null;for(let r=0;r<e.length;r++){let i=e[r];"-"===i[0]?(null!==t&&n.set(t,""),t=i):null!==t?(n.set(t,i),t=null):hL.push(i)}null!==t&&n.set(t,"")}else"object"==typeof location?(n=oG(),(location.search||"?").slice(1).split("&").forEach(e=>{if(0!==e.length){let[t,r]=e.split("=");n.set(`--${lr(t,"-")}`,r),n.set(`-${lr(t,"-")}`,r)}})):n=oG()}return n},hP=e=>hI().has(e),hk=e=>hC?l8(hg.env[e.toUpperCase().replaceAll("-","_")]):l8(he.getItem(e));hP("--"+(_="production"))||hk(_);const hD=hC&&["true","1","2"].includes(void 0),hU=!hP("no-colors")&&(!hC||hg.stdout.isTTY||hD)&&(!hC||hP("color")||hD||null!==hk("COLORTERM")||(hk("TERM")||"").includes("color"));R=function(e){var t,r,n=function(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var n=r===t?0:4-r%4;return[r,n]}(e),i=n[0],s=n[1],a=new hF((i+s)*3/4-s),o=0,l=s>0?i-4:i;for(r=0;r<l;r+=4)t=hN[e.charCodeAt(r)]<<18|hN[e.charCodeAt(r+1)]<<12|hN[e.charCodeAt(r+2)]<<6|hN[e.charCodeAt(r+3)],a[o++]=t>>16&255,a[o++]=t>>8&255,a[o++]=255&t;return 2===s&&(t=hN[e.charCodeAt(r)]<<2|hN[e.charCodeAt(r+1)]>>4,a[o++]=255&t),1===s&&(t=hN[e.charCodeAt(r)]<<10|hN[e.charCodeAt(r+1)]<<4|hN[e.charCodeAt(r+2)]>>2,a[o++]=t>>8&255,a[o++]=255&t),a},L=function(e){for(var t,r=e.length,n=r%3,i=[],s=0,a=r-n;s<a;s+=16383)i.push(function(e,t,r){for(var n,i=[],s=t;s<r;s+=3)i.push(hO[(n=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]))>>18&63]+hO[n>>12&63]+hO[n>>6&63]+hO[63&n]);return i.join("")}(e,s,s+16383>a?a:s+16383));return 1===n?i.push(hO[(t=e[r-1])>>2]+hO[t<<4&63]+"=="):2===n&&i.push(hO[(t=(e[r-2]<<8)+e[r-1])>>10]+hO[t>>4&63]+hO[t<<2&63]+"="),i.join("")};for(var hO=[],hN=[],hF="undefined"!=typeof Uint8Array?Uint8Array:Array,hB="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",hz=0,hG=hB.length;hz<hG;++hz)hO[hz]=hB[hz],hN[hB.charCodeAt(hz)]=hz;hN["-".charCodeAt(0)]=62,hN["_".charCodeAt(0)]=63,I=function(e,t,r,n,i){var s,a,o=8*i-n-1,l=(1<<o)-1,h=l>>1,c=-7,u=r?i-1:0,d=r?-1:1,p=e[t+u];for(u+=d,s=p&(1<<-c)-1,p>>=-c,c+=o;c>0;s=256*s+e[t+u],u+=d,c-=8);for(a=s&(1<<-c)-1,s>>=-c,c+=n;c>0;a=256*a+e[t+u],u+=d,c-=8);if(0===s)s=1-h;else{if(s===l)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,n),s-=h}return(p?-1:1)*a*Math.pow(2,s-n)},P=function(e,t,r,n,i,s){var a,o,l,h=8*s-i-1,c=(1<<h)-1,u=c>>1,d=23===i?5960464477539062e-23:0,p=n?0:s-1,f=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(isNaN(t=Math.abs(t))||t===1/0?(o=isNaN(t)?1:0,a=c):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),a+u>=1?t+=d/l:t+=d*Math.pow(2,1-u),t*l>=2&&(a++,l/=2),a+u>=c?(o=0,a=c):a+u>=1?(o=(t*l-1)*Math.pow(2,i),a+=u):(o=t*Math.pow(2,u-1)*Math.pow(2,i),a=0));i>=8;e[r+p]=255&o,p+=f,o/=256,i-=8);for(a=a<<i|o,h+=i;h>0;e[r+p]=255&a,p+=f,a/=256,h-=8);e[r+p-f]|=128*m};const hH="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function hV(e){if(e>2147483647)throw RangeError('The value "'+e+'" is invalid for option "size"');let t=new Uint8Array(e);return Object.setPrototypeOf(t,hW.prototype),t}function hW(e,t,r){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return hX(e)}return hj(e,t,r)}function hj(e,t,r){if("string"==typeof e)return function(e,t){if(("string"!=typeof t||""===t)&&(t="utf8"),!hW.isEncoding(t))throw TypeError("Unknown encoding: "+t);let r=0|h$(e,t),n=hV(r),i=n.write(e,t);return i!==r&&(n=n.slice(0,i)),n}(e,t);if(ArrayBuffer.isView(e))return function(e){if(cc(e,Uint8Array)){let t=new Uint8Array(e);return hJ(t.buffer,t.byteOffset,t.byteLength)}return hY(e)}(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(cc(e,ArrayBuffer)||e&&cc(e.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(cc(e,SharedArrayBuffer)||e&&cc(e.buffer,SharedArrayBuffer)))return hJ(e,t,r);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');let n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return hW.from(n,t,r);let i=function(e){var t;if(hW.isBuffer(e)){let t=0|hZ(e.length),r=hV(t);return 0===r.length||e.copy(r,0,0,t),r}return void 0!==e.length?"number"!=typeof e.length||(t=e.length)!=t?hV(0):hY(e):"Buffer"===e.type&&Array.isArray(e.data)?hY(e.data):void 0}(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return hW.from(e[Symbol.toPrimitive]("string"),t,r);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function hq(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function hX(e){return hq(e),hV(e<0?0:0|hZ(e))}function hY(e){let t=e.length<0?0:0|hZ(e.length),r=hV(t);for(let n=0;n<t;n+=1)r[n]=255&e[n];return r}function hJ(e,t,r){let n;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),hW.prototype),n}function hZ(e){if(e>=2147483647)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function h$(e,t){if(hW.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||cc(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);let r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;let i=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return co(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return cl(e).length;default:if(i)return n?-1:co(e).length;t=(""+t).toLowerCase(),i=!0}}function hK(e,t,r){let n=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===r||r>this.length)&&(r=this.length),r<=0||(r>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,r){let n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);let i="";for(let n=t;n<r;++n)i+=cu[e[n]];return i}(this,t,r);case"utf8":case"utf-8":return h2(this,t,r);case"ascii":return function(e,t,r){let n="";r=Math.min(e.length,r);for(let i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}(this,t,r);case"latin1":case"binary":return function(e,t,r){let n="";r=Math.min(e.length,r);for(let i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}(this,t,r);case"base64":var i,s;return i=t,s=r,0===i&&s===this.length?L(this):L(this.slice(i,s));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,r){let n=e.slice(t,r),i="";for(let e=0;e<n.length-1;e+=2)i+=String.fromCharCode(n[e]+256*n[e+1]);return i}(this,t,r);default:if(n)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function hQ(e,t,r){let n=e[t];e[t]=e[r],e[r]=n}function h0(e,t,r,n,i){var s;if(0===e.length)return -1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),(s=r=+r)!=s&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return -1;r=e.length-1}else if(r<0){if(!i)return -1;r=0}if("string"==typeof t&&(t=hW.from(t,n)),hW.isBuffer(t))return 0===t.length?-1:h1(e,t,r,n,i);if("number"==typeof t)return(t&=255,"function"==typeof Uint8Array.prototype.indexOf)?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):h1(e,[t],r,n,i);throw TypeError("val must be string, number or Buffer")}function h1(e,t,r,n,i){let s,a=1,o=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return -1;a=2,o/=2,l/=2,r/=2}function h(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){let n=-1;for(s=r;s<o;s++)if(h(e,s)===h(t,-1===n?0:s-n)){if(-1===n&&(n=s),s-n+1===l)return n*a}else -1!==n&&(s-=s-n),n=-1}else for(r+l>o&&(r=o-l),s=r;s>=0;s--){let r=!0;for(let n=0;n<l;n++)if(h(e,s+n)!==h(t,n)){r=!1;break}if(r)return s}return -1}function h2(e,t,r){r=Math.min(e.length,r);let n=[],i=t;for(;i<r;){let t=e[i],s=null,a=t>239?4:t>223?3:t>191?2:1;if(i+a<=r){let r,n,o,l;switch(a){case 1:t<128&&(s=t);break;case 2:(192&(r=e[i+1]))==128&&(l=(31&t)<<6|63&r)>127&&(s=l);break;case 3:r=e[i+1],n=e[i+2],(192&r)==128&&(192&n)==128&&(l=(15&t)<<12|(63&r)<<6|63&n)>2047&&(l<55296||l>57343)&&(s=l);break;case 4:r=e[i+1],n=e[i+2],o=e[i+3],(192&r)==128&&(192&n)==128&&(192&o)==128&&(l=(15&t)<<18|(63&r)<<12|(63&n)<<6|63&o)>65535&&l<1114112&&(s=l)}}null===s?(s=65533,a=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|1023&s),n.push(s),i+=a}return function(e){let t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=4096));return r}(n)}function h3(e,t,r){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>r)throw RangeError("Trying to access beyond buffer length")}function h4(e,t,r,n,i,s){if(!hW.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw RangeError('"value" argument is out of bounds');if(r+n>e.length)throw RangeError("Index out of range")}function h5(e,t,r,n,i){cn(t,n,i,e,r,7);let s=Number(t&BigInt(4294967295));e[r++]=s,s>>=8,e[r++]=s,s>>=8,e[r++]=s,s>>=8,e[r++]=s;let a=Number(t>>BigInt(32)&BigInt(4294967295));return e[r++]=a,a>>=8,e[r++]=a,a>>=8,e[r++]=a,a>>=8,e[r++]=a,r}function h6(e,t,r,n,i){cn(t,n,i,e,r,7);let s=Number(t&BigInt(4294967295));e[r+7]=s,s>>=8,e[r+6]=s,s>>=8,e[r+5]=s,s>>=8,e[r+4]=s;let a=Number(t>>BigInt(32)&BigInt(4294967295));return e[r+3]=a,a>>=8,e[r+2]=a,a>>=8,e[r+1]=a,a>>=8,e[r]=a,r+8}function h8(e,t,r,n,i,s){if(r+n>e.length||r<0)throw RangeError("Index out of range")}function h7(e,t,r,n,i){return t=+t,r>>>=0,i||h8(e,t,r,4,34028234663852886e22,-34028234663852886e22),P(e,t,r,n,23,4),r+4}function h9(e,t,r,n,i){return t=+t,r>>>=0,i||h8(e,t,r,8,17976931348623157e292,-17976931348623157e292),P(e,t,r,n,52,8),r+8}hW.TYPED_ARRAY_SUPPORT=function(){try{let e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),hW.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(hW.prototype,"parent",{enumerable:!0,get:function(){if(hW.isBuffer(this))return this.buffer}}),Object.defineProperty(hW.prototype,"offset",{enumerable:!0,get:function(){if(hW.isBuffer(this))return this.byteOffset}}),hW.poolSize=8192,hW.from=function(e,t,r){return hj(e,t,r)},Object.setPrototypeOf(hW.prototype,Uint8Array.prototype),Object.setPrototypeOf(hW,Uint8Array),hW.alloc=function(e,t,r){return(hq(e),e<=0)?hV(e):void 0!==t?"string"==typeof r?hV(e).fill(t,r):hV(e).fill(t):hV(e)},hW.allocUnsafe=function(e){return hX(e)},hW.allocUnsafeSlow=function(e){return hX(e)},hW.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==hW.prototype},hW.compare=function(e,t){if(cc(e,Uint8Array)&&(e=hW.from(e,e.offset,e.byteLength)),cc(t,Uint8Array)&&(t=hW.from(t,t.offset,t.byteLength)),!hW.isBuffer(e)||!hW.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let r=e.length,n=t.length;for(let i=0,s=Math.min(r,n);i<s;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},hW.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},hW.concat=function(e,t){let r;if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return hW.alloc(0);if(void 0===t)for(r=0,t=0;r<e.length;++r)t+=e[r].length;let n=hW.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){let t=e[r];if(cc(t,Uint8Array))i+t.length>n.length?(hW.isBuffer(t)||(t=hW.from(t)),t.copy(n,i)):Uint8Array.prototype.set.call(n,t,i);else if(hW.isBuffer(t))t.copy(n,i);else throw TypeError('"list" argument must be an Array of Buffers');i+=t.length}return n},hW.byteLength=h$,hW.prototype._isBuffer=!0,hW.prototype.swap16=function(){let e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)hQ(this,t,t+1);return this},hW.prototype.swap32=function(){let e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)hQ(this,t,t+3),hQ(this,t+1,t+2);return this},hW.prototype.swap64=function(){let e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)hQ(this,t,t+7),hQ(this,t+1,t+6),hQ(this,t+2,t+5),hQ(this,t+3,t+4);return this},hW.prototype.toString=function(){let e=this.length;return 0===e?"":0==arguments.length?h2(this,0,e):hK.apply(this,arguments)},hW.prototype.toLocaleString=hW.prototype.toString,hW.prototype.equals=function(e){if(!hW.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===hW.compare(this,e)},hW.prototype.inspect=function(){let e="";return e=this.toString("hex",0,50).replace(/(.{2})/g,"$1 ").trim(),this.length>50&&(e+=" ... "),"<Buffer "+e+">"},hH&&(hW.prototype[hH]=hW.prototype.inspect),hW.prototype.compare=function(e,t,r,n,i){if(cc(e,Uint8Array)&&(e=hW.from(e,e.offset,e.byteLength)),!hW.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return -1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,i>>>=0,this===e)return 0;let s=i-n,a=r-t,o=Math.min(s,a),l=this.slice(n,i),h=e.slice(t,r);for(let e=0;e<o;++e)if(l[e]!==h[e]){s=l[e],a=h[e];break}return s<a?-1:a<s?1:0},hW.prototype.includes=function(e,t,r){return -1!==this.indexOf(e,t,r)},hW.prototype.indexOf=function(e,t,r){return h0(this,e,t,r,!0)},hW.prototype.lastIndexOf=function(e,t,r){return h0(this,e,t,r,!1)},hW.prototype.write=function(e,t,r,n){var i,s,a,o,l,h,c,u;if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let d=this.length-t;if((void 0===r||r>d)&&(r=d),e.length>0&&(r<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");n||(n="utf8");let p=!1;for(;;)switch(n){case"hex":return function(e,t,r,n){let i;r=Number(r)||0;let s=e.length-r;n?(n=Number(n))>s&&(n=s):n=s;let a=t.length;for(n>a/2&&(n=a/2),i=0;i<n;++i){let n=parseInt(t.substr(2*i,2),16);if(n!=n)break;e[r+i]=n}return i}(this,e,t,r);case"utf8":case"utf-8":return i=t,s=r,ch(co(e,this.length-i),this,i,s);case"ascii":case"latin1":case"binary":return a=t,o=r,ch(function(e){let t=[];for(let r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(e),this,a,o);case"base64":return l=t,h=r,ch(cl(e),this,l,h);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return c=t,u=r,ch(function(e,t){let r,n;let i=[];for(let s=0;s<e.length&&!((t-=2)<0);++s)n=(r=e.charCodeAt(s))>>8,i.push(r%256),i.push(n);return i}(e,this.length-c),this,c,u);default:if(p)throw TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),p=!0}},hW.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},hW.prototype.slice=function(e,t){let r=this.length;e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);let n=this.subarray(e,t);return Object.setPrototypeOf(n,hW.prototype),n},hW.prototype.readUintLE=hW.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||h3(e,t,this.length);let n=this[e],i=1,s=0;for(;++s<t&&(i*=256);)n+=this[e+s]*i;return n},hW.prototype.readUintBE=hW.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||h3(e,t,this.length);let n=this[e+--t],i=1;for(;t>0&&(i*=256);)n+=this[e+--t]*i;return n},hW.prototype.readUint8=hW.prototype.readUInt8=function(e,t){return e>>>=0,t||h3(e,1,this.length),this[e]},hW.prototype.readUint16LE=hW.prototype.readUInt16LE=function(e,t){return e>>>=0,t||h3(e,2,this.length),this[e]|this[e+1]<<8},hW.prototype.readUint16BE=hW.prototype.readUInt16BE=function(e,t){return e>>>=0,t||h3(e,2,this.length),this[e]<<8|this[e+1]},hW.prototype.readUint32LE=hW.prototype.readUInt32LE=function(e,t){return e>>>=0,t||h3(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},hW.prototype.readUint32BE=hW.prototype.readUInt32BE=function(e,t){return e>>>=0,t||h3(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},hW.prototype.readBigUInt64LE=cd(function(e){ci(e>>>=0,"offset");let t=this[e],r=this[e+7];(void 0===t||void 0===r)&&cs(e,this.length-8);let n=t+256*this[++e]+65536*this[++e]+16777216*this[++e],i=this[++e]+256*this[++e]+65536*this[++e]+16777216*r;return BigInt(n)+(BigInt(i)<<BigInt(32))}),hW.prototype.readBigUInt64BE=cd(function(e){ci(e>>>=0,"offset");let t=this[e],r=this[e+7];(void 0===t||void 0===r)&&cs(e,this.length-8);let n=16777216*t+65536*this[++e]+256*this[++e]+this[++e],i=16777216*this[++e]+65536*this[++e]+256*this[++e]+r;return(BigInt(n)<<BigInt(32))+BigInt(i)}),hW.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||h3(e,t,this.length);let n=this[e],i=1,s=0;for(;++s<t&&(i*=256);)n+=this[e+s]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},hW.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||h3(e,t,this.length);let n=t,i=1,s=this[e+--n];for(;n>0&&(i*=256);)s+=this[e+--n]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*t)),s},hW.prototype.readInt8=function(e,t){return(e>>>=0,t||h3(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},hW.prototype.readInt16LE=function(e,t){e>>>=0,t||h3(e,2,this.length);let r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},hW.prototype.readInt16BE=function(e,t){e>>>=0,t||h3(e,2,this.length);let r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},hW.prototype.readInt32LE=function(e,t){return e>>>=0,t||h3(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},hW.prototype.readInt32BE=function(e,t){return e>>>=0,t||h3(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},hW.prototype.readBigInt64LE=cd(function(e){ci(e>>>=0,"offset");let t=this[e],r=this[e+7];return(void 0===t||void 0===r)&&cs(e,this.length-8),(BigInt(this[e+4]+256*this[e+5]+65536*this[e+6]+(r<<24))<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+16777216*this[++e])}),hW.prototype.readBigInt64BE=cd(function(e){ci(e>>>=0,"offset");let t=this[e],r=this[e+7];return(void 0===t||void 0===r)&&cs(e,this.length-8),(BigInt((t<<24)+65536*this[++e]+256*this[++e]+this[++e])<<BigInt(32))+BigInt(16777216*this[++e]+65536*this[++e]+256*this[++e]+r)}),hW.prototype.readFloatLE=function(e,t){return e>>>=0,t||h3(e,4,this.length),I(this,e,!0,23,4)},hW.prototype.readFloatBE=function(e,t){return e>>>=0,t||h3(e,4,this.length),I(this,e,!1,23,4)},hW.prototype.readDoubleLE=function(e,t){return e>>>=0,t||h3(e,8,this.length),I(this,e,!0,52,8)},hW.prototype.readDoubleBE=function(e,t){return e>>>=0,t||h3(e,8,this.length),I(this,e,!1,52,8)},hW.prototype.writeUintLE=hW.prototype.writeUIntLE=function(e,t,r,n){if(e=+e,t>>>=0,r>>>=0,!n){let n=Math.pow(2,8*r)-1;h4(this,e,t,r,n,0)}let i=1,s=0;for(this[t]=255&e;++s<r&&(i*=256);)this[t+s]=e/i&255;return t+r},hW.prototype.writeUintBE=hW.prototype.writeUIntBE=function(e,t,r,n){if(e=+e,t>>>=0,r>>>=0,!n){let n=Math.pow(2,8*r)-1;h4(this,e,t,r,n,0)}let i=r-1,s=1;for(this[t+i]=255&e;--i>=0&&(s*=256);)this[t+i]=e/s&255;return t+r},hW.prototype.writeUint8=hW.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||h4(this,e,t,1,255,0),this[t]=255&e,t+1},hW.prototype.writeUint16LE=hW.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||h4(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},hW.prototype.writeUint16BE=hW.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||h4(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},hW.prototype.writeUint32LE=hW.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||h4(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},hW.prototype.writeUint32BE=hW.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||h4(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},hW.prototype.writeBigUInt64LE=cd(function(e,t=0){return h5(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),hW.prototype.writeBigUInt64BE=cd(function(e,t=0){return h6(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),hW.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){let n=Math.pow(2,8*r-1);h4(this,e,t,r,n-1,-n)}let i=0,s=1,a=0;for(this[t]=255&e;++i<r&&(s*=256);)e<0&&0===a&&0!==this[t+i-1]&&(a=1),this[t+i]=(e/s>>0)-a&255;return t+r},hW.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){let n=Math.pow(2,8*r-1);h4(this,e,t,r,n-1,-n)}let i=r-1,s=1,a=0;for(this[t+i]=255&e;--i>=0&&(s*=256);)e<0&&0===a&&0!==this[t+i+1]&&(a=1),this[t+i]=(e/s>>0)-a&255;return t+r},hW.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||h4(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},hW.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||h4(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},hW.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||h4(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},hW.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||h4(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},hW.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||h4(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},hW.prototype.writeBigInt64LE=cd(function(e,t=0){return h5(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),hW.prototype.writeBigInt64BE=cd(function(e,t=0){return h6(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),hW.prototype.writeFloatLE=function(e,t,r){return h7(this,e,t,!0,r)},hW.prototype.writeFloatBE=function(e,t,r){return h7(this,e,t,!1,r)},hW.prototype.writeDoubleLE=function(e,t,r){return h9(this,e,t,!0,r)},hW.prototype.writeDoubleBE=function(e,t,r){return h9(this,e,t,!1,r)},hW.prototype.copy=function(e,t,r,n){if(!hW.isBuffer(e))throw TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw RangeError("Index out of range");if(n<0)throw RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);let i=n-r;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,r,n):Uint8Array.prototype.set.call(e,this.subarray(r,n),t),i},hW.prototype.fill=function(e,t,r,n){let i;if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw TypeError("encoding must be a string");if("string"==typeof n&&!hW.isEncoding(n))throw TypeError("Unknown encoding: "+n);if(1===e.length){let t=e.charCodeAt(0);("utf8"===n&&t<128||"latin1"===n)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw RangeError("Out of range index");if(r<=t)return this;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{let s=hW.isBuffer(e)?e:hW.from(e,n),a=s.length;if(0===a)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<r-t;++i)this[i+t]=s[i%a]}return this};const ce={};function ct(e,t,r){ce[e]=class extends r{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function cr(e){let t="",r=e.length,n="-"===e[0]?1:0;for(;r>=n+4;r-=3)t=`_${e.slice(r-3,r)}${t}`;return`${e.slice(0,r)}${t}`}function cn(e,t,r,n,i,s){if(e>r||e<t){let n;let i="bigint"==typeof t?"n":"";throw n=s>3?0===t||t===BigInt(0)?`>= 0${i} and < 2${i} ** ${(s+1)*8}${i}`:`>= -(2${i} ** ${(s+1)*8-1}${i}) and < 2 ** ${(s+1)*8-1}${i}`:`>= ${t}${i} and <= ${r}${i}`,new ce.ERR_OUT_OF_RANGE("value",n,e)}ci(i,"offset"),(void 0===n[i]||void 0===n[i+s])&&cs(i,n.length-(s+1))}function ci(e,t){if("number"!=typeof e)throw new ce.ERR_INVALID_ARG_TYPE(t,"number",e)}function cs(e,t,r){if(Math.floor(e)!==e)throw ci(e,r),new ce.ERR_OUT_OF_RANGE(r||"offset","an integer",e);if(t<0)throw new ce.ERR_BUFFER_OUT_OF_BOUNDS;throw new ce.ERR_OUT_OF_RANGE(r||"offset",`>= ${r?1:0} and <= ${t}`,e)}ct("ERR_BUFFER_OUT_OF_BOUNDS",function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),ct("ERR_INVALID_ARG_TYPE",function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`},TypeError),ct("ERR_OUT_OF_RANGE",function(e,t,r){let n=`The value of "${e}" is out of range.`,i=r;return Number.isInteger(r)&&Math.abs(r)>4294967296?i=cr(String(r)):"bigint"==typeof r&&(i=String(r),(r>BigInt(2)**BigInt(32)||r<-(BigInt(2)**BigInt(32)))&&(i=cr(i)),i+="n"),n+=` It must be ${t}. Received ${i}`},RangeError);const ca=/[^+/0-9A-Za-z-_]/g;function co(e,t){let r;t=t||1/0;let n=e.length,i=null,s=[];for(let a=0;a<n;++a){if((r=e.charCodeAt(a))>55295&&r<57344){if(!i){if(r>56319||a+1===n){(t-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&s.push(239,191,189),i=r;continue}r=(i-55296<<10|r-56320)+65536}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;s.push(r)}else if(r<2048){if((t-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else if(r<1114112){if((t-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}else throw Error("Invalid code point")}return s}function cl(e){return R(function(e){if((e=(e=e.split("=")[0]).trim().replace(ca,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function ch(e,t,r,n){let i;for(i=0;i<n&&!(i+r>=t.length)&&!(i>=e.length);++i)t[i+r]=e[i];return i}function cc(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}const cu=function(){let e="0123456789abcdef",t=Array(256);for(let r=0;r<16;++r){let n=16*r;for(let i=0;i<16;++i)t[n+i]=e[r]+e[i]}return t}();function cd(e){return"undefined"==typeof BigInt?cp:e}function cp(){throw Error("BigInt not supported")}const cf=e=>new Uint8Array(e),cm=(e,t,r)=>new Uint8Array(e,t,r),cg=e=>new Uint8Array(e),cv=hR?e=>{let t="";for(let r=0;r<e.byteLength;r++)t+=o8(e[r]);return btoa(t)}:e=>hW.from(e.buffer,e.byteOffset,e.byteLength).toString("base64"),cy=hR?e=>{let t=atob(e),r=cf(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r}:e=>{let t=hW.from(e,"base64");return cm(t.buffer,t.byteOffset,t.byteLength)},cx=e=>{let t=cf(e.byteLength);return t.set(e),t};class c_{constructor(e,t){this.left=e,this.right=t}}const cb=(e,t)=>new c_(e,t),cw="undefined"!=typeof document?document:{};"undefined"!=typeof DOMParser&&new DOMParser;const cS=e=>oW(e,(e,t)=>`${t}:${e};`).join("");cw.ELEMENT_NODE,cw.TEXT_NODE,cw.CDATA_SECTION_NODE,cw.COMMENT_NODE,cw.DOCUMENT_NODE,cw.DOCUMENT_TYPE_NODE,cw.DOCUMENT_FRAGMENT_NODE;const cM=JSON.stringify,cT=e=>class{constructor(e){this._=e}destroy(){e(this._)}};cT(clearTimeout),cT(clearInterval),cT(e=>"undefined"!=typeof requestAnimationFrame&&cancelAnimationFrame(e)),cT(e=>"undefined"!=typeof cancelIdleCallback&&cancelIdleCallback(e));const cE=Symbol,cA=cE(),cC=cE(),cR=cE(),cL=cE(),cI=cE(),cP=cE(),ck=cE(),cD=cE(),cU=cE(),cO=[cI,ck,cD,cR];let cN=0,cF=l3();const cB={[cA]:cb("font-weight","bold"),[cC]:cb("font-weight","normal"),[cR]:cb("color","blue"),[cI]:cb("color","green"),[cL]:cb("color","grey"),[cP]:cb("color","red"),[ck]:cb("color","purple"),[cD]:cb("color","orange"),[cU]:cb("color","black")},cz=hU?e=>{1===e.length&&e[0]?.constructor===Function&&(e=e[0]());let t=[],r=[],n=oG(),i=[],s=0;for(;s<e.length;s++){let i=e[s],a=cB[i];if(void 0!==a)n.set(a.left,a.right);else{if(void 0===i)break;if(i.constructor===String||i.constructor===Number){let e=cS(n);s>0||e.length>0?(t.push("%c"+i),r.push(e)):t.push(i)}else break}}for(s>0&&(i=r).unshift(t.join(""));s<e.length;s++){let t=e[s];t instanceof Symbol||i.push(t)}return i}:e=>{1===e.length&&e[0]?.constructor===Function&&(e=e[0]());let t=[],r=[],n=0;for(;n<e.length;n++){let i=e[n];void 0===i?t.push("undefined"):i.constructor===String||i.constructor===Number?t.push(i):i.constructor===Object&&r.push(JSON.stringify(i))}return r},cG=(...e)=>{console.log(...cz(e)),cH.forEach(t=>t.print(e))},cH=oq(),cV=e=>({[Symbol.iterator](){return this},next:e}),cW=(e,t)=>cV(()=>{let r;do r=e.next();while(!r.done&&!t(r.value))return r}),cj=(e,t)=>cV(()=>{let{done:r,value:n}=e.next();return{done:r,value:r?void 0:t(n)}});class cq{constructor(e,t){this.clock=e,this.len=t}}class cX{constructor(){this.clients=new Map}}const cY=(e,t,r)=>t.clients.forEach((t,n)=>{let i=e.doc.store.clients.get(n);for(let n=0;n<t.length;n++){let s=t[n];uH(e,i,s.clock,s.len,r)}}),cJ=(e,t)=>{let r=0,n=e.length-1;for(;r<=n;){let i=oQ((r+n)/2),s=e[i],a=s.clock;if(a<=t){if(t<a+s.len)return i;r=i+1}else n=i-1}return null},cZ=(e,t)=>{let r=e.clients.get(t.client);return void 0!==r&&null!==cJ(r,t.clock)},c$=e=>{e.clients.forEach(e=>{let t,r;for(e.sort((e,t)=>e.clock-t.clock),t=1,r=1;t<e.length;t++){let n=e[r-1],i=e[t];n.clock+n.len>=i.clock?n.len=o3(n.len,i.clock+i.len-n.clock):(r<t&&(e[r]=i),r++)}e.length=r})},cK=e=>{let t=new cX;for(let r=0;r<e.length;r++)e[r].clients.forEach((n,i)=>{if(!t.clients.has(i)){let s=n.slice();for(let t=r+1;t<e.length;t++)oY(s,e[t].clients.get(i)||[]);t.clients.set(i,s)}});return c$(t),t},cQ=(e,t,r,n)=>{oV(e.clients,t,()=>[]).push(new cq(r,n))},c0=()=>new cX,c1=e=>{let t=c0();return e.clients.forEach((e,r)=>{let n=[];for(let t=0;t<e.length;t++){let r=e[t];if(r.deleted){let i=r.id.clock,s=r.length;if(t+1<e.length)for(let r=e[t+1];t+1<e.length&&r.deleted;r=e[++t+1])s+=r.length;n.push(new cq(i,s))}}n.length>0&&t.clients.set(r,n)}),t},c2=(e,t)=>{ld(e.restEncoder,t.clients.size),oJ(t.clients.entries()).sort((e,t)=>t[0]-e[0]).forEach(([t,r])=>{e.resetDsCurVal(),ld(e.restEncoder,t);let n=r.length;ld(e.restEncoder,n);for(let t=0;t<n;t++){let n=r[t];e.writeDsClock(n.clock),e.writeDsLen(n.len)}})},c3=e=>{let t=new cX,r=lV(e.restDecoder);for(let n=0;n<r;n++){e.resetDsCurVal();let r=lV(e.restDecoder),n=lV(e.restDecoder);if(n>0){let i=oV(t.clients,r,()=>[]);for(let t=0;t<n;t++)i.push(new cq(e.readDsClock(),e.readDsLen()))}}return t},c4=(e,t,r)=>{let n=new cX,i=lV(e.restDecoder);for(let s=0;s<i;s++){e.resetDsCurVal();let i=lV(e.restDecoder),s=lV(e.restDecoder),a=r.clients.get(i)||[],o=uD(r,i);for(let r=0;r<s;r++){let r=e.readDsClock(),s=r+e.readDsLen();if(r<o){o<s&&cQ(n,i,o,s-o);let e=uO(a,r),l=a[e];for(!l.deleted&&l.id.clock<r&&(a.splice(e+1,0,pd(t,l,r-l.id.clock)),e++);e<a.length;)if((l=a[e++]).id.clock<s)l.deleted||(s<l.id.clock+l.length&&a.splice(e,0,pd(t,l,s-l.id.clock)),l.delete(t));else break}else cQ(n,i,r,s-r)}}if(n.clients.size>0){let e=new un;return ld(e.restEncoder,0),c2(e,n),e.toUint8Array()}return null};class c5 extends o${constructor({guid:e=l2(),collectionid:t=null,gc:r=!0,gcFilter:n=()=>!0,meta:i=null,autoLoad:s=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=n,this.clientID=l1(),this.guid=e,this.collectionid=t,this.share=new Map,this.store=new uP,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=s,this.meta=i,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=l4(e=>{this.on("load",()=>{this.isLoaded=!0,e(this)})});let o=()=>l4(e=>{let t=r=>{(void 0===r||!0===r)&&(this.off("sync",t),e())};this.on("sync",t)});this.on("sync",e=>{!1===e&&this.isSynced&&(this.whenSynced=o()),this.isSynced=void 0===e||!0===e,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=o()}load(){let e=this._item;null===e||this.shouldLoad||uZ(e.parent.doc,e=>{e.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(oJ(this.subdocs).map(e=>e.guid))}transact(e,t=null){return uZ(this,e,t)}get(e,t=dc){let r=oV(this.share,e,()=>{let e=new t;return e._integrate(this,null),e}),n=r.constructor;if(t!==dc&&n!==t){if(n===dc){let n=new t;n._map=r._map,r._map.forEach(e=>{for(;null!==e;e=e.left)e.parent=n}),n._start=r._start;for(let e=n._start;null!==e;e=e.right)e.parent=n;return n._length=r._length,this.share.set(e,n),n._integrate(this,null),n}throw Error(`Type with the name ${e} has already been defined with a different constructor`)}return r}getArray(e=""){return this.get(e,dL)}getText(e=""){return this.get(e,dJ)}getMap(e=""){return this.get(e,dP)}getXmlElement(e=""){return this.get(e,dK)}getXmlFragment(e=""){return this.get(e,d$)}toJSON(){let e={};return this.share.forEach((t,r)=>{e[r]=t.toJSON()}),e}destroy(){oJ(this.subdocs).forEach(e=>e.destroy());let e=this._item;if(null!==e){this._item=null;let t=e.content;t.doc=new c5({guid:this.guid,...t.opts,shouldLoad:!1}),t.doc._item=e,uZ(e.parent.doc,r=>{let n=t.doc;e.deleted||r.subdocsAdded.add(n),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class c6{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return lV(this.restDecoder)}readDsLen(){return lV(this.restDecoder)}}class c8 extends c6{readLeftID(){return uC(lV(this.restDecoder),lV(this.restDecoder))}readRightID(){return uC(lV(this.restDecoder),lV(this.restDecoder))}readClient(){return lV(this.restDecoder)}readInfo(){return lH(this.restDecoder)}readString(){return lj(this.restDecoder)}readParentInfo(){return 1===lV(this.restDecoder)}readTypeRef(){return lV(this.restDecoder)}readLen(){return lV(this.restDecoder)}readAny(){return lY(this.restDecoder)}readBuf(){return cx(lG(this.restDecoder))}readJSON(){return JSON.parse(lj(this.restDecoder))}readKey(){return lj(this.restDecoder)}}class c7{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=lV(this.restDecoder),this.dsCurrVal}readDsLen(){let e=lV(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class c9 extends c7{constructor(e){super(e),this.keys=[],lV(e),this.keyClockDecoder=new l$(lG(e)),this.clientDecoder=new lZ(lG(e)),this.leftClockDecoder=new l$(lG(e)),this.rightClockDecoder=new l$(lG(e)),this.infoDecoder=new lJ(lG(e),lH),this.stringDecoder=new lK(lG(e)),this.parentInfoDecoder=new lJ(lG(e),lH),this.typeRefDecoder=new lZ(lG(e)),this.lenDecoder=new lZ(lG(e))}readLeftID(){return new uE(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new uE(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return 1===this.parentInfoDecoder.read()}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return lY(this.restDecoder)}readBuf(){return lG(this.restDecoder)}readJSON(){return lY(this.restDecoder)}readKey(){let e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{let e=this.stringDecoder.read();return this.keys.push(e),e}}}class ue{constructor(){this.restEncoder=lo()}toUint8Array(){return lh(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){ld(this.restEncoder,e)}writeDsLen(e){ld(this.restEncoder,e)}}class ut extends ue{writeLeftID(e){ld(this.restEncoder,e.client),ld(this.restEncoder,e.clock)}writeRightID(e){ld(this.restEncoder,e.client),ld(this.restEncoder,e.clock)}writeClient(e){ld(this.restEncoder,e)}writeInfo(e){lu(this.restEncoder,e)}writeString(e){lg(this.restEncoder,e)}writeParentInfo(e){ld(this.restEncoder,e?1:0)}writeTypeRef(e){ld(this.restEncoder,e)}writeLen(e){ld(this.restEncoder,e)}writeAny(e){lT(this.restEncoder,e)}writeBuf(e){ly(this.restEncoder,e)}writeJSON(e){lg(this.restEncoder,JSON.stringify(e))}writeKey(e){lg(this.restEncoder,e)}}class ur{constructor(){this.restEncoder=lo(),this.dsCurrVal=0}toUint8Array(){return lh(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){let t=e-this.dsCurrVal;this.dsCurrVal=e,ld(this.restEncoder,t)}writeDsLen(e){0===e&&lD(),ld(this.restEncoder,e-1),this.dsCurrVal+=e}}class un extends ur{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new lL,this.clientEncoder=new lC,this.leftClockEncoder=new lL,this.rightClockEncoder=new lL,this.infoEncoder=new lE(lu),this.stringEncoder=new lI,this.parentInfoEncoder=new lE(lu),this.typeRefEncoder=new lC,this.lenEncoder=new lC}toUint8Array(){let e=lo();return ld(e,0),ly(e,this.keyClockEncoder.toUint8Array()),ly(e,this.clientEncoder.toUint8Array()),ly(e,this.leftClockEncoder.toUint8Array()),ly(e,this.rightClockEncoder.toUint8Array()),ly(e,lh(this.infoEncoder)),ly(e,this.stringEncoder.toUint8Array()),ly(e,lh(this.parentInfoEncoder)),ly(e,this.typeRefEncoder.toUint8Array()),ly(e,this.lenEncoder.toUint8Array()),lv(e,lh(this.restEncoder)),lh(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){lT(this.restEncoder,e)}writeBuf(e){ly(this.restEncoder,e)}writeJSON(e){lT(this.restEncoder,e)}writeKey(e){let t=this.keyMap.get(e);void 0===t?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(t)}}const ui=(e,t,r,n)=>{n=o3(n,t[0].id.clock);let i=uO(t,n);ld(e.restEncoder,t.length-i),e.writeClient(r),ld(e.restEncoder,n);let s=t[i];s.write(e,n-s.id.clock);for(let r=i+1;r<t.length;r++)t[r].write(e,0)},us=(e,t,r)=>{let n=new Map;r.forEach((e,r)=>{uD(t,r)>e&&n.set(r,e)}),uk(t).forEach((e,t)=>{r.has(t)||n.set(t,0)}),ld(e.restEncoder,n.size),oJ(n.entries()).sort((e,t)=>t[0]-e[0]).forEach(([r,n])=>{ui(e,t.clients.get(r),r,n)})},ua=(e,t)=>{let r=oG(),n=lV(e.restDecoder);for(let i=0;i<n;i++){let n=lV(e.restDecoder),i=Array(n),s=e.readClient(),a=lV(e.restDecoder);r.set(s,{i:0,refs:i});for(let r=0;r<n;r++){let n=e.readInfo();switch(31&n){case 0:{let t=e.readLen();i[r]=new d3(uC(s,a),t),a+=t;break}case 10:{let t=lV(e.restDecoder);i[r]=new pg(uC(s,a),t),a+=t;break}default:{let o=(192&n)==0,l=new pp(uC(s,a),null,(128&n)==128?e.readLeftID():null,null,(64&n)==64?e.readRightID():null,o?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,o&&(32&n)==32?e.readString():null,pf(e,n));i[r]=l,a+=l.length}}}}return r},uo=(e,t,r)=>{let n=[],i=oJ(r.keys()).sort((e,t)=>e-t);if(0===i.length)return null;let s=()=>{if(0===i.length)return null;let e=r.get(i[i.length-1]);for(;e.refs.length===e.i;){if(i.pop(),!(i.length>0))return null;e=r.get(i[i.length-1])}return e},a=s();if(null===a)return null;let o=new uP,l=new Map,h=(e,t)=>{let r=l.get(e);(null==r||r>t)&&l.set(e,t)},c=a.refs[a.i++],u=new Map,d=()=>{for(let e of n){let t=e.id.client,n=r.get(t);n?(n.i--,o.clients.set(t,n.refs.slice(n.i)),r.delete(t),n.i=0,n.refs=[]):o.clients.set(t,[e]),i=i.filter(e=>e!==t)}n.length=0};for(;;){if(c.constructor!==pg){let i=oV(u,c.id.client,()=>uD(t,c.id.client))-c.id.clock;if(i<0)n.push(c),h(c.id.client,c.id.clock-1),d();else{let s=c.getMissing(e,t);if(null!==s){n.push(c);let e=r.get(s)||{refs:[],i:0};if(e.refs.length===e.i)h(s,uD(t,s)),d();else{c=e.refs[e.i++];continue}}else(0===i||i<c.length)&&(c.integrate(e,i),u.set(c.id.client,c.id.clock+c.length))}}if(n.length>0)c=n.pop();else if(null!==a&&a.i<a.refs.length)c=a.refs[a.i++];else{if(null===(a=s()))break;c=a.refs[a.i++]}}if(o.clients.size>0){let e=new un;return us(e,o,new Map),ld(e.restEncoder,0),{missing:l,update:e.toUint8Array()}}return null},ul=(e,t)=>us(e,t.doc.store,t.beforeState),uh=(e,t,r,n=new c9(e))=>uZ(t,e=>{e.local=!1;let t=!1,r=e.doc,i=r.store,s=uo(e,i,ua(n,r)),a=i.pendingStructs;if(a){for(let[e,r]of a.missing)if(r<uD(i,e)){t=!0;break}if(s){for(let[e,t]of s.missing){let r=a.missing.get(e);(null==r||r>t)&&a.missing.set(e,t)}a.update=u1([a.update,s.update])}}else i.pendingStructs=s;let o=c4(n,e,i);if(i.pendingDs){let t=new c9(lF(i.pendingDs));lV(t.restDecoder);let r=c4(t,e,i);o&&r?i.pendingDs=u1([o,r]):i.pendingDs=o||r}else i.pendingDs=o;if(t){let t=i.pendingStructs.update;i.pendingStructs=null,uc(e.doc,t)}},r,!1),uc=(e,t,r,n=c9)=>{let i=lF(t);uh(i,e,r,new n(i))},uu=(e,t,r)=>uc(e,t,r,c8),ud=(e,t,r=new Map)=>{us(e,t.store,r),c2(e,c1(t.store))},up=(e,t=new Uint8Array([0]),r=new un)=>{ud(r,e,ug(t));let n=[r.toUint8Array()];if(e.store.pendingDs&&n.push(e.store.pendingDs),e.store.pendingStructs&&n.push(u2(e.store.pendingStructs.update,t)),n.length>1){if(r.constructor===ut)return uQ(n.map((e,t)=>0===t?e:u8(e)));if(r.constructor===un)return u1(n)}return n[0]},uf=(e,t)=>up(e,t,new ut),um=e=>{let t=new Map,r=lV(e.restDecoder);for(let n=0;n<r;n++){let r=lV(e.restDecoder),n=lV(e.restDecoder);t.set(r,n)}return t},ug=e=>um(new c6(lF(e))),uv=(e,t)=>(ld(e.restEncoder,t.size),oJ(t.entries()).sort((e,t)=>t[0]-e[0]).forEach(([t,r])=>{ld(e.restEncoder,t),ld(e.restEncoder,r)}),e),uy=(e,t)=>uv(e,uk(t.store)),ux=(e,t=new ur)=>(e instanceof Map?uv(t,e):uy(t,e),t.toUint8Array()),u_=e=>ux(e,new ue);class ub{constructor(){this.l=[]}}const uw=()=>new ub,uS=(e,t)=>e.l.push(t),uM=(e,t)=>{let r=e.l,n=r.length;e.l=r.filter(e=>t!==e),n===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},uT=(e,t,r)=>hu(e.l,[t,r]);class uE{constructor(e,t){this.client=e,this.clock=t}}const uA=(e,t)=>e===t||null!==e&&null!==t&&e.client===t.client&&e.clock===t.clock,uC=(e,t)=>new uE(e,t),uR=e=>{for(let[t,r]of e.doc.share.entries())if(r===e)return t;throw lD()};b=c0(),new class{constructor(e,t){this.ds=e,this.sv=t}}(b,new Map);const uL=(e,t)=>void 0===t?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!cZ(t.ds,e.id),uI=(e,t)=>{let r=oV(e.meta,uI,oq),n=e.doc.store;r.has(t)||(t.sv.forEach((t,r)=>{t<uD(n,r)&&uB(e,uC(r,t))}),cY(e,t.ds,e=>{}),r.add(t))};class uP{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const uk=e=>{let t=new Map;return e.clients.forEach((e,r)=>{let n=e[e.length-1];t.set(r,n.id.clock+n.length)}),t},uD=(e,t)=>{let r=e.clients.get(t);if(void 0===r)return 0;let n=r[r.length-1];return n.id.clock+n.length},uU=(e,t)=>{let r=e.clients.get(t.id.client);if(void 0===r)r=[],e.clients.set(t.id.client,r);else{let e=r[r.length-1];if(e.id.clock+e.length!==t.id.clock)throw lD()}r.push(t)},uO=(e,t)=>{let r=0,n=e.length-1,i=e[n],s=i.id.clock;if(s===t)return n;let a=oQ(t/(s+i.length-1)*n);for(;r<=n;){if((s=(i=e[a]).id.clock)<=t){if(t<s+i.length)return a;r=a+1}else n=a-1;a=oQ((r+n)/2)}throw lD()},uN=(e,t)=>{let r=e.clients.get(t.client);return r[uO(r,t.clock)]},uF=(e,t,r)=>{let n=uO(t,r),i=t[n];return i.id.clock<r&&i instanceof pp?(t.splice(n+1,0,pd(e,i,r-i.id.clock)),n+1):n},uB=(e,t)=>{let r=e.doc.store.clients.get(t.client);return r[uF(e,r,t.clock)]},uz=(e,t,r)=>{let n=t.clients.get(r.client),i=uO(n,r.clock),s=n[i];return r.clock!==s.id.clock+s.length-1&&s.constructor!==d3&&n.splice(i+1,0,pd(e,s,r.clock-s.id.clock+1)),s},uG=(e,t,r)=>{let n=e.clients.get(t.id.client);n[uO(n,t.id.clock)]=r},uH=(e,t,r,n,i)=>{let s;if(0===n)return;let a=r+n,o=uF(e,t,r);do a<(s=t[o++]).id.clock+s.length&&uF(e,t,a),i(s);while(o<t.length&&t[o].id.clock<a)};class uV{constructor(e,t,r){this.doc=e,this.deleteSet=new cX,this.beforeState=uk(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=t,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const uW=(e,t)=>!!(0!==t.deleteSet.clients.size||oj(t.afterState,(e,r)=>t.beforeState.get(r)!==e))&&(c$(t.deleteSet),ul(e,t),c2(e,t.deleteSet),!0),uj=(e,t,r)=>{let n=t._item;(null===n||n.id.clock<(e.beforeState.get(n.id.client)||0)&&!n.deleted)&&oV(e.changed,t,oq).add(r)},uq=(e,t)=>{let r=e[t],n=e[t-1],i=t;for(;i>0;r=n,n=e[--i-1]){if(n.deleted===r.deleted&&n.constructor===r.constructor&&n.mergeWith(r)){r instanceof pp&&null!==r.parentSub&&r.parent._map.get(r.parentSub)===r&&r.parent._map.set(r.parentSub,n);continue}break}let s=t-i;return s&&e.splice(t+1-s,s),s},uX=(e,t,r)=>{for(let[n,i]of e.clients.entries()){let e=t.clients.get(n);for(let n=i.length-1;n>=0;n--){let s=i[n],a=s.clock+s.len;for(let n=uO(e,s.clock),i=e[n];n<e.length&&i.id.clock<a;i=e[++n]){let i=e[n];if(s.clock+s.len<=i.id.clock)break;i instanceof pp&&i.deleted&&!i.keep&&r(i)&&i.gc(t,!1)}}}},uY=(e,t)=>{e.clients.forEach((e,r)=>{let n=t.clients.get(r);for(let t=e.length-1;t>=0;t--){let r=e[t],i=o2(n.length-1,1+uO(n,r.clock+r.len-1));for(let e=i,t=n[e];e>0&&t.id.clock>=r.clock;t=n[e])e-=1+uq(n,e)}})},uJ=(e,t)=>{if(t<e.length){let r=e[t],n=r.doc,i=n.store,s=r.deleteSet,a=r._mergeStructs;try{c$(s),r.afterState=uk(r.doc.store),n.emit("beforeObserverCalls",[r,n]);let e=[];r.changed.forEach((t,n)=>e.push(()=>{null!==n._item&&n._item.deleted||n._callObserver(r,t)})),e.push(()=>{r.changedParentTypes.forEach((e,t)=>{t._dEH.l.length>0&&(null===t._item||!t._item.deleted)&&((e=e.filter(e=>null===e.target._item||!e.target._item.deleted)).forEach(e=>{e.currentTarget=t,e._path=null}),e.sort((e,t)=>e.path.length-t.path.length),uT(t._dEH,e,r))})}),e.push(()=>n.emit("afterTransaction",[r,n])),hu(e,[]),r._needFormattingCleanup&&dq(r)}finally{n.gc&&uX(s,i,n.gcFilter),uY(s,i),r.afterState.forEach((e,t)=>{let n=r.beforeState.get(t)||0;if(n!==e){let e=i.clients.get(t),r=o3(uO(e,n),1);for(let t=e.length-1;t>=r;)t-=1+uq(e,t)}});for(let e=a.length-1;e>=0;e--){let{client:t,clock:r}=a[e].id,n=i.clients.get(t),s=uO(n,r);!(s+1<n.length&&uq(n,s+1)>1)&&s>0&&uq(n,s)}if(r.local||r.afterState.get(n.clientID)===r.beforeState.get(n.clientID)||(cG(cD,cA,"[yjs] ",cC,cP,"Changed the client-id because another client seems to be using it."),n.clientID=l1()),n.emit("afterTransactionCleanup",[r,n]),n._observers.has("update")){let e=new ut;uW(e,r)&&n.emit("update",[e.toUint8Array(),r.origin,n,r])}if(n._observers.has("updateV2")){let e=new un;uW(e,r)&&n.emit("updateV2",[e.toUint8Array(),r.origin,n,r])}let{subdocsAdded:o,subdocsLoaded:l,subdocsRemoved:h}=r;(o.size>0||h.size>0||l.size>0)&&(o.forEach(e=>{e.clientID=n.clientID,null==e.collectionid&&(e.collectionid=n.collectionid),n.subdocs.add(e)}),h.forEach(e=>n.subdocs.delete(e)),n.emit("subdocs",[{loaded:l,added:o,removed:h},n,r]),h.forEach(e=>e.destroy())),e.length<=t+1?(n._transactionCleanups=[],n.emit("afterAllTransactions",[n,e])):uJ(e,t+1)}}},uZ=(e,t,r=null,n=!0)=>{let i=e._transactionCleanups,s=!1,a=null;null===e._transaction&&(s=!0,e._transaction=new uV(e,r,n),i.push(e._transaction),1===i.length&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{a=t(e._transaction)}finally{if(s){let t=e._transaction===i[0];e._transaction=null,t&&uJ(i,0)}}return a};class u${constructor(e,t){this.gen=function*(e){let t=lV(e.restDecoder);for(let r=0;r<t;r++){let t=lV(e.restDecoder),r=e.readClient(),n=lV(e.restDecoder);for(let i=0;i<t;i++){let t=e.readInfo();if(10===t){let t=lV(e.restDecoder);yield new pg(uC(r,n),t),n+=t}else if((31&t)!=0){let i=(192&t)==0,s=new pp(uC(r,n),null,(128&t)==128?e.readLeftID():null,null,(64&t)==64?e.readRightID():null,i?e.readParentInfo()?e.readString():e.readLeftID():null,i&&(32&t)==32?e.readString():null,pf(e,t));yield s,n+=s.length}else{let t=e.readLen();yield new d3(uC(r,n),t),n+=t}}}}(e),this.curr=null,this.done=!1,this.filterSkips=t,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&null!==this.curr&&this.curr.constructor===pg)return this.curr}}class uK{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const uQ=e=>u1(e,c8,ut),u0=(e,t)=>{if(e.constructor===d3){let{client:r,clock:n}=e.id;return new d3(uC(r,n+t),e.length-t)}if(e.constructor===pg){let{client:r,clock:n}=e.id;return new pg(uC(r,n+t),e.length-t)}{let{client:r,clock:n}=e.id;return new pp(uC(r,n+t),null,uC(r,n+t-1),null,e.rightOrigin,e.parent,e.parentSub,e.content.splice(t))}},u1=(e,t=c9,r=un)=>{if(1===e.length)return e[0];let n=e.map(e=>new t(lF(e))),i=n.map(e=>new u$(e,!0)),s=null,a=new r,o=new uK(a);for(;(i=i.filter(e=>null!==e.curr)).sort((e,t)=>{if(e.curr.id.client!==t.curr.id.client)return t.curr.id.client-e.curr.id.client;{let r=e.curr.id.clock-t.curr.id.clock;return 0===r?e.curr.constructor===t.curr.constructor?0:e.curr.constructor===pg?1:-1:r}}),0!==i.length;){let e=i[0],t=e.curr.id.client;if(null!==s){let r=e.curr,n=!1;for(;null!==r&&r.id.clock+r.length<=s.struct.id.clock+s.struct.length&&r.id.client>=s.struct.id.client;)r=e.next(),n=!0;if(null===r||r.id.client!==t||n&&r.id.clock>s.struct.id.clock+s.struct.length)continue;if(t!==s.struct.id.client)u4(o,s.struct,s.offset),s={struct:r,offset:0},e.next();else if(s.struct.id.clock+s.struct.length<r.id.clock){if(s.struct.constructor===pg)s.struct.length=r.id.clock+r.length-s.struct.id.clock;else{u4(o,s.struct,s.offset);let e=r.id.clock-s.struct.id.clock-s.struct.length;s={struct:new pg(uC(t,s.struct.id.clock+s.struct.length),e),offset:0}}}else{let t=s.struct.id.clock+s.struct.length-r.id.clock;t>0&&(s.struct.constructor===pg?s.struct.length-=t:r=u0(r,t)),s.struct.mergeWith(r)||(u4(o,s.struct,s.offset),s={struct:r,offset:0},e.next())}}else s={struct:e.curr,offset:0},e.next();for(let r=e.curr;null!==r&&r.id.client===t&&r.id.clock===s.struct.id.clock+s.struct.length&&r.constructor!==pg;r=e.next())u4(o,s.struct,s.offset),s={struct:r,offset:0}}return null!==s&&(u4(o,s.struct,s.offset),s=null),u5(o),c2(a,cK(n.map(e=>c3(e)))),a.toUint8Array()},u2=(e,t,r=c9,n=un)=>{let i=ug(t),s=new n,a=new uK(s),o=new r(lF(e)),l=new u$(o,!1);for(;l.curr;){let e=l.curr,t=e.id.client,r=i.get(t)||0;if(l.curr.constructor===pg){l.next();continue}if(e.id.clock+e.length>r)for(u4(a,e,o3(r-e.id.clock,0)),l.next();l.curr&&l.curr.id.client===t;)u4(a,l.curr,0),l.next();else for(;l.curr&&l.curr.id.client===t&&l.curr.id.clock+l.curr.length<=r;)l.next()}return u5(a),c2(s,c3(o)),s.toUint8Array()},u3=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:lh(e.encoder.restEncoder)}),e.encoder.restEncoder=lo(),e.written=0)},u4=(e,t,r)=>{e.written>0&&e.currClient!==t.id.client&&u3(e),0===e.written&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),ld(e.encoder.restEncoder,t.id.clock+r)),t.write(e.encoder,r),e.written++},u5=e=>{u3(e);let t=e.encoder.restEncoder;ld(t,e.clientStructs.length);for(let r=0;r<e.clientStructs.length;r++){let n=e.clientStructs[r];ld(t,n.written),lv(t,n.restEncoder)}},u6=(e,t,r,n)=>{let i=new r(lF(e)),s=new u$(i,!1),a=new n,o=new uK(a);for(let e=s.curr;null!==e;e=s.next())u4(o,t(e),0);return u5(o),c2(a,c3(i)),a.toUint8Array()},u8=e=>u6(e,hp,c9,ut),u7="You must not compute changes after the event-handler fired.";class u9{constructor(e,t){this.target=e,this.currentTarget=e,this.transaction=t,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=de(this.currentTarget,this.target))}deletes(e){return cZ(this.transaction.deleteSet,e.id)}get keys(){if(null===this._keys){if(0===this.transaction.doc._transactionCleanups.length)throw lP(u7);let e=new Map,t=this.target;this.transaction.changed.get(t).forEach(r=>{if(null!==r){let n,i;let s=t._map.get(r);if(this.adds(s)){let e=s.left;for(;null!==e&&this.adds(e);)e=e.left;if(this.deletes(s)){if(!(null!==e&&this.deletes(e)))return;n="delete",i=oX(e.content.getContent())}else null!==e&&this.deletes(e)?(n="update",i=oX(e.content.getContent())):(n="add",i=void 0)}else{if(!this.deletes(s))return;n="delete",i=oX(s.content.getContent())}e.set(r,{action:n,oldValue:i})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(null===e){if(0===this.transaction.doc._transactionCleanups.length)throw lP(u7);let t=this.target,r=oq(),n=oq(),i=[];if(e={added:r,deleted:n,delta:i,keys:this.keys},this.transaction.changed.get(t).has(null)){let e=null,s=()=>{e&&i.push(e)};for(let i=t._start;null!==i;i=i.right)i.deleted?this.deletes(i)&&!this.adds(i)&&((null===e||void 0===e.delete)&&(s(),e={delete:0}),e.delete+=i.length,n.add(i)):this.adds(i)?((null===e||void 0===e.insert)&&(s(),e={insert:[]}),e.insert=e.insert.concat(i.content.getContent()),r.add(i)):((null===e||void 0===e.retain)&&(s(),e={retain:0}),e.retain+=i.length);null!==e&&void 0===e.retain&&s()}this._changes=e}return e}}const de=(e,t)=>{let r=[];for(;null!==t._item&&t!==e;){if(null!==t._item.parentSub)r.unshift(t._item.parentSub);else{let e=0,n=t._item.parent._start;for(;n!==t._item&&null!==n;)!n.deleted&&e++,n=n.right;r.unshift(e)}t=t._item.parent}return r};let dt=0;class dr{constructor(e,t){e.marker=!0,this.p=e,this.index=t,this.timestamp=dt++}}const dn=e=>{e.timestamp=dt++},di=(e,t,r)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=r,e.timestamp=dt++},ds=(e,t,r)=>{if(e.length>=80){let n=e.reduce((e,t)=>e.timestamp<t.timestamp?e:t);return di(n,t,r),n}{let n=new dr(t,r);return e.push(n),n}},da=(e,t)=>{if(null===e._start||0===t||null===e._searchMarker)return null;let r=0===e._searchMarker.length?null:e._searchMarker.reduce((e,r)=>o0(t-e.index)<o0(t-r.index)?e:r),n=e._start,i=0;for(null!==r&&(n=r.p,i=r.index,dn(r));null!==n.right&&i<t;){if(!n.deleted&&n.countable){if(t<i+n.length)break;i+=n.length}n=n.right}for(;null!==n.left&&i>t;)!(n=n.left).deleted&&n.countable&&(i-=n.length);for(;null!==n.left&&n.left.id.client===n.id.client&&n.left.id.clock+n.left.length===n.id.clock;)!(n=n.left).deleted&&n.countable&&(i-=n.length);return null!==r&&o0(r.index-i)<n.parent.length/80?(di(r,n,i),r):ds(e._searchMarker,n,i)},dl=(e,t,r)=>{for(let n=e.length-1;n>=0;n--){let i=e[n];if(r>0){let t=i.p;for(t.marker=!1;t&&(t.deleted||!t.countable);)(t=t.left)&&!t.deleted&&t.countable&&(i.index-=t.length);if(null===t||!0===t.marker){e.splice(n,1);continue}i.p=t,t.marker=!0}(t<i.index||r>0&&t===i.index)&&(i.index=o3(t,i.index+r))}},dh=(e,t,r)=>{let n=e,i=t.changedParentTypes;for(;oV(i,e,()=>[]).push(r),null!==e._item;)e=e._item.parent;uT(n._eH,r,t)};class dc{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=uw(),this._dEH=uw(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,t){this.doc=e,this._item=t}_copy(){throw lk()}clone(){throw lk()}_write(e){}get _first(){let e=this._start;for(;null!==e&&e.deleted;)e=e.right;return e}_callObserver(e,t){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){uS(this._eH,e)}observeDeep(e){uS(this._dEH,e)}unobserve(e){uM(this._eH,e)}unobserveDeep(e){uM(this._dEH,e)}toJSON(){}}const du=(e,t,r)=>{t<0&&(t=e._length+t),r<0&&(r=e._length+r);let n=r-t,i=[],s=e._start;for(;null!==s&&n>0;){if(s.countable&&!s.deleted){let e=s.content.getContent();if(e.length<=t)t-=e.length;else{for(let r=t;r<e.length&&n>0;r++)i.push(e[r]),n--;t=0}}s=s.right}return i},dd=e=>{let t=[],r=e._start;for(;null!==r;){if(r.countable&&!r.deleted){let e=r.content.getContent();for(let r=0;r<e.length;r++)t.push(e[r])}r=r.right}return t},dp=(e,t)=>{let r=0,n=e._start;for(;null!==n;){if(n.countable&&!n.deleted){let i=n.content.getContent();for(let n=0;n<i.length;n++)t(i[n],r++,e)}n=n.right}},df=(e,t)=>{let r=[];return dp(e,(n,i)=>{r.push(t(n,i,e))}),r},dm=e=>{let t=e._start,r=null,n=0;return{[Symbol.iterator](){return this},next:()=>{if(null===r){for(;null!==t&&t.deleted;)t=t.right;if(null===t)return{done:!0,value:void 0};r=t.content.getContent(),n=0,t=t.right}let e=r[n++];return r.length<=n&&(r=null),{done:!1,value:e}}}},dg=(e,t)=>{let r=da(e,t),n=e._start;for(null!==r&&(n=r.p,t-=r.index);null!==n;n=n.right)if(!n.deleted&&n.countable){if(t<n.length)return n.content.getContent()[t];t-=n.length}},dv=(e,t,r,n)=>{let i=r,s=e.doc,a=s.clientID,o=s.store,l=null===r?t._start:r.right,h=[],c=()=>{h.length>0&&((i=new pp(uC(a,uD(o,a)),i,i&&i.lastId,l,l&&l.id,t,null,new pt(h))).integrate(e,0),h=[])};n.forEach(r=>{if(null===r)h.push(r);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:h.push(r);break;default:switch(c(),r.constructor){case Uint8Array:case ArrayBuffer:(i=new pp(uC(a,uD(o,a)),i,i&&i.lastId,l,l&&l.id,t,null,new d4(new Uint8Array(r)))).integrate(e,0);break;case c5:(i=new pp(uC(a,uD(o,a)),i,i&&i.lastId,l,l&&l.id,t,null,new d8(r))).integrate(e,0);break;default:if(r instanceof dc)(i=new pp(uC(a,uD(o,a)),i,i&&i.lastId,l,l&&l.id,t,null,new pu(r))).integrate(e,0);else throw Error("Unexpected content type in insert operation")}}}),c()},dy=()=>lP("Length exceeded!"),dx=(e,t,r,n)=>{if(r>t._length)throw dy();if(0===r)return t._searchMarker&&dl(t._searchMarker,r,n.length),dv(e,t,null,n);let i=r,s=da(t,r),a=t._start;for(null!==s&&(a=s.p,0==(r-=s.index)&&(r+=(a=a.prev)&&a.countable&&!a.deleted?a.length:0));null!==a;a=a.right)if(!a.deleted&&a.countable){if(r<=a.length){r<a.length&&uB(e,uC(a.id.client,a.id.clock+r));break}r-=a.length}return t._searchMarker&&dl(t._searchMarker,i,n.length),dv(e,t,a,n)},d_=(e,t,r)=>{let n=(t._searchMarker||[]).reduce((e,t)=>t.index>e.index?t:e,{index:0,p:t._start}).p;if(n)for(;n.right;)n=n.right;return dv(e,t,n,r)},db=(e,t,r,n)=>{if(0===n)return;let i=r,s=n,a=da(t,r),o=t._start;for(null!==a&&(o=a.p,r-=a.index);null!==o&&r>0;o=o.right)!o.deleted&&o.countable&&(r<o.length&&uB(e,uC(o.id.client,o.id.clock+r)),r-=o.length);for(;n>0&&null!==o;)o.deleted||(n<o.length&&uB(e,uC(o.id.client,o.id.clock+n)),o.delete(e),n-=o.length),o=o.right;if(n>0)throw dy();t._searchMarker&&dl(t._searchMarker,i,-s+n)},dw=(e,t,r)=>{let n=t._map.get(r);void 0!==n&&n.delete(e)},dS=(e,t,r,n)=>{let i;let s=t._map.get(r)||null,a=e.doc,o=a.clientID;if(null==n)i=new pt([n]);else switch(n.constructor){case Number:case Object:case Boolean:case Array:case String:i=new pt([n]);break;case Uint8Array:i=new d4(n);break;case c5:i=new d8(n);break;default:if(n instanceof dc)i=new pu(n);else throw Error("Unexpected content type")}new pp(uC(o,uD(a.store,o)),s,s&&s.lastId,null,null,t,r,i).integrate(e,0)},dM=(e,t)=>{let r=e._map.get(t);return void 0===r||r.deleted?void 0:r.content.getContent()[r.length-1]},dT=e=>{let t={};return e._map.forEach((e,r)=>{e.deleted||(t[r]=e.content.getContent()[e.length-1])}),t},dE=(e,t)=>{let r=e._map.get(t);return void 0!==r&&!r.deleted},dA=(e,t)=>{let r={};return e._map.forEach((e,n)=>{let i=e;for(;null!==i&&(!t.sv.has(i.id.client)||i.id.clock>=(t.sv.get(i.id.client)||0));)i=i.left;null!==i&&uL(i,t)&&(r[n]=i.content.getContent()[i.length-1])}),r},dC=e=>cW(e.entries(),e=>!e[1].deleted);class dR extends u9{constructor(e,t){super(e,t),this._transaction=t}}class dL extends dc{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){let t=new dL;return t.push(e),t}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new dL}clone(){let e=new dL;return e.insert(0,this.toArray().map(e=>e instanceof dc?e.clone():e)),e}get length(){return null===this._prelimContent?this._length:this._prelimContent.length}_callObserver(e,t){super._callObserver(e,t),dh(this,e,new dR(this,e))}insert(e,t){null!==this.doc?uZ(this.doc,r=>{dx(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}push(e){null!==this.doc?uZ(this.doc,t=>{d_(t,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,t=1){null!==this.doc?uZ(this.doc,r=>{db(r,this,e,t)}):this._prelimContent.splice(e,t)}get(e){return dg(this,e)}toArray(){return dd(this)}slice(e=0,t=this.length){return du(this,e,t)}toJSON(){return this.map(e=>e instanceof dc?e.toJSON():e)}map(e){return df(this,e)}forEach(e){dp(this,e)}[Symbol.iterator](){return dm(this)}_write(e){e.writeTypeRef(pi)}}class dI extends u9{constructor(e,t,r){super(e,t),this.keysChanged=r}}class dP extends dc{constructor(e){super(),this._prelimContent=null,void 0===e?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,t){super._integrate(e,t),this._prelimContent.forEach((e,t)=>{this.set(t,e)}),this._prelimContent=null}_copy(){return new dP}clone(){let e=new dP;return this.forEach((t,r)=>{e.set(r,t instanceof dc?t.clone():t)}),e}_callObserver(e,t){dh(this,e,new dI(this,e,t))}toJSON(){let e={};return this._map.forEach((t,r)=>{if(!t.deleted){let n=t.content.getContent()[t.length-1];e[r]=n instanceof dc?n.toJSON():n}}),e}get size(){return[...dC(this._map)].length}keys(){return cj(dC(this._map),e=>e[0])}values(){return cj(dC(this._map),e=>e[1].content.getContent()[e[1].length-1])}entries(){return cj(dC(this._map),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this._map.forEach((t,r)=>{t.deleted||e(t.content.getContent()[t.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){null!==this.doc?uZ(this.doc,t=>{dw(t,this,e)}):this._prelimContent.delete(e)}set(e,t){return null!==this.doc?uZ(this.doc,r=>{dS(r,this,e,t)}):this._prelimContent.set(e,t),t}get(e){return dM(this,e)}has(e){return dE(this,e)}clear(){null!==this.doc?uZ(this.doc,e=>{this.forEach(function(t,r,n){dw(e,n,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(ps)}}const dk=(e,t)=>e===t||"object"==typeof e&&"object"==typeof t&&e&&t&&hc(e,t);class dD{constructor(e,t,r,n){this.left=e,this.right=t,this.index=r,this.currentAttributes=n}forward(){(null===this.right&&lD(),this.right.content.constructor===d9)?this.right.deleted||dF(this.currentAttributes,this.right.content):this.right.deleted||(this.index+=this.right.length),this.left=this.right,this.right=this.right.right}}const dU=(e,t,r)=>{for(;null!==t.right&&r>0;)t.right.content.constructor===d9?t.right.deleted||dF(t.currentAttributes,t.right.content):t.right.deleted||(r<t.right.length&&uB(e,uC(t.right.id.client,t.right.id.clock+r)),t.index+=t.right.length,r-=t.right.length),t.left=t.right,t.right=t.right.right;return t},dO=(e,t,r,n)=>{let i=new Map,s=n?da(t,r):null;return s?dU(e,new dD(s.p.left,s.p,s.index,i),r-s.index):dU(e,new dD(null,t._start,0,i),r)},dN=(e,t,r,n)=>{for(;null!==r.right&&(!0===r.right.deleted||r.right.content.constructor===d9&&dk(n.get(r.right.content.key),r.right.content.value));)r.right.deleted||n.delete(r.right.content.key),r.forward();let i=e.doc,s=i.clientID;n.forEach((n,a)=>{let o=r.left,l=r.right,h=new pp(uC(s,uD(i.store,s)),o,o&&o.lastId,l,l&&l.id,t,null,new d9(a,n));h.integrate(e,0),r.right=h,r.forward()})},dF=(e,t)=>{let{key:r,value:n}=t;null===n?e.delete(r):e.set(r,n)},dB=(e,t)=>{for(;null!==e.right&&(e.right.deleted||e.right.content.constructor===d9&&dk(t[e.right.content.key]??null,e.right.content.value));)e.forward()},dz=(e,t,r,n)=>{let i=e.doc,s=i.clientID,a=new Map;for(let o in n){let l=n[o],h=r.currentAttributes.get(o)??null;if(!dk(h,l)){a.set(o,h);let{left:n,right:c}=r;r.right=new pp(uC(s,uD(i.store,s)),n,n&&n.lastId,c,c&&c.id,t,null,new d9(o,l)),r.right.integrate(e,0),r.forward()}}return a},dG=(e,t,r,n,i)=>{r.currentAttributes.forEach((e,t)=>{void 0===i[t]&&(i[t]=null)});let s=e.doc,a=s.clientID;dB(r,i);let o=dz(e,t,r,i),l=n.constructor===String?new pr(n):n instanceof dc?new pu(n):new d7(n),{left:h,right:c,index:u}=r;t._searchMarker&&dl(t._searchMarker,r.index,l.getLength()),(c=new pp(uC(a,uD(s.store,a)),h,h&&h.lastId,c,c&&c.id,t,null,l)).integrate(e,0),r.right=c,r.index=u,r.forward(),dN(e,t,r,o)},dH=(e,t,r,n,i)=>{let s=e.doc,a=s.clientID;dB(r,i);let o=dz(e,t,r,i);for(;null!==r.right&&(n>0||o.size>0&&(r.right.deleted||r.right.content.constructor===d9));){if(!r.right.deleted){if(r.right.content.constructor===d9){let{key:t,value:s}=r.right.content,a=i[t];if(void 0!==a){if(dk(a,s))o.delete(t);else{if(0===n)break;o.set(t,s)}r.right.delete(e)}else r.currentAttributes.set(t,s)}else n<r.right.length&&uB(e,uC(r.right.id.client,r.right.id.clock+n)),n-=r.right.length}r.forward()}if(n>0){let i="";for(;n>0;n--)i+="\n";r.right=new pp(uC(a,uD(s.store,a)),r.left,r.left&&r.left.lastId,r.right,r.right&&r.right.id,t,null,new pr(i)),r.right.integrate(e,0),r.forward()}dN(e,t,r,o)},dV=(e,t,r,n,i)=>{let s=t,a=oG();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===d9){let e=s.content;a.set(e.key,e)}s=s.right}let o=0,l=!1;for(;t!==s;){if(r===t&&(l=!0),!t.deleted){let r=t.content;if(r.constructor===d9){let{key:s,value:h}=r,c=n.get(s)??null;a.get(s)===r&&c!==h||(t.delete(e),o++,l||(i.get(s)??null)!==h||c===h||(null===c?i.delete(s):i.set(s,c))),l||t.deleted||dF(i,r)}}t=t.right}return o},dW=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;let r=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===d9){let n=t.content.key;r.has(n)?t.delete(e):r.add(n)}t=t.left}},dj=e=>{let t=0;return uZ(e.doc,r=>{let n=e._start,i=e._start,s=oG(),a=oH(s);for(;i;)!1===i.deleted&&(i.content.constructor===d9?dF(a,i.content):(t+=dV(r,n,i,s,a),s=oH(a),n=i)),i=i.right}),t},dq=e=>{let t=new Set,r=e.doc;for(let[n,i]of e.afterState.entries()){let s=e.beforeState.get(n)||0;i!==s&&uH(e,r.store.clients.get(n),s,i,e=>{e.deleted||e.content.constructor!==d9||e.constructor===d3||t.add(e.parent)})}uZ(r,r=>{for(let n of(cY(e,e.deleteSet,e=>{if(e instanceof d3||!e.parent._hasFormatting||t.has(e.parent))return;let n=e.parent;e.content.constructor===d9?t.add(n):dW(r,e)}),t))dj(n)})},dX=(e,t,r)=>{let n=r,i=oH(t.currentAttributes),s=t.right;for(;r>0&&null!==t.right;){if(!1===t.right.deleted)switch(t.right.content.constructor){case pu:case d7:case pr:r<t.right.length&&uB(e,uC(t.right.id.client,t.right.id.clock+r)),r-=t.right.length,t.right.delete(e)}t.forward()}s&&dV(e,s,t.right,i,t.currentAttributes);let a=(t.left||t.right).parent;return a._searchMarker&&dl(a._searchMarker,t.index,-n+r),t};class dY extends u9{constructor(e,t,r){super(e,t),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(e=>{null===e?this.childListChanged=!0:this.keysChanged.add(e)})}get changes(){if(null===this._changes){let e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(null===this._delta){let e=this.target.doc,t=[];uZ(e,e=>{let r=new Map,n=new Map,i=this.target._start,s=null,a={},o="",l=0,h=0,c=()=>{if(null!==s){let e=null;switch(s){case"delete":h>0&&(e={delete:h}),h=0;break;case"insert":("object"==typeof o||o.length>0)&&(e={insert:o},r.size>0&&(e.attributes={},r.forEach((t,r)=>{null!==t&&(e.attributes[r]=t)}))),o="";break;case"retain":l>0&&(e={retain:l},ho(a)||(e.attributes=hn({},a))),l=0}e&&t.push(e),s=null}};for(;null!==i;){switch(i.content.constructor){case pu:case d7:this.adds(i)?this.deletes(i)||(c(),s="insert",o=i.content.getContent()[0],c()):this.deletes(i)?("delete"!==s&&(c(),s="delete"),h+=1):i.deleted||("retain"!==s&&(c(),s="retain"),l+=1);break;case pr:this.adds(i)?this.deletes(i)||("insert"!==s&&(c(),s="insert"),o+=i.content.str):this.deletes(i)?("delete"!==s&&(c(),s="delete"),h+=i.length):i.deleted||("retain"!==s&&(c(),s="retain"),l+=i.length);break;case d9:{let{key:t,value:o}=i.content;if(this.adds(i))this.deletes(i)||(dk(r.get(t)??null,o)?null!==o&&i.delete(e):("retain"===s&&c(),dk(o,n.get(t)??null)?delete a[t]:a[t]=o));else if(this.deletes(i)){n.set(t,o);let e=r.get(t)??null;dk(e,o)||("retain"===s&&c(),a[t]=e)}else if(!i.deleted){n.set(t,o);let r=a[t];void 0!==r&&(dk(r,o)?null!==r&&i.delete(e):("retain"===s&&c(),null===o?delete a[t]:a[t]=o))}i.deleted||("insert"===s&&c(),dF(r,i.content))}}i=i.right}for(c();t.length>0;){let e=t[t.length-1];if(void 0!==e.retain&&void 0===e.attributes)t.pop();else break}}),this._delta=t}return this._delta}}class dJ extends dc{constructor(e){super(),this._pending=void 0!==e?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this._length}_integrate(e,t){super._integrate(e,t);try{this._pending.forEach(e=>e())}catch(e){console.error(e)}this._pending=null}_copy(){return new dJ}clone(){let e=new dJ;return e.applyDelta(this.toDelta()),e}_callObserver(e,t){super._callObserver(e,t);let r=new dY(this,e,t);dh(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){let e="",t=this._start;for(;null!==t;)!t.deleted&&t.countable&&t.content.constructor===pr&&(e+=t.content.str),t=t.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:t=!0}={}){null!==this.doc?uZ(this.doc,r=>{let n=new dD(null,this._start,0,new Map);for(let i=0;i<e.length;i++){let s=e[i];if(void 0!==s.insert){let a=t||"string"!=typeof s.insert||i!==e.length-1||null!==n.right||"\n"!==s.insert.slice(-1)?s.insert:s.insert.slice(0,-1);("string"!=typeof a||a.length>0)&&dG(r,this,n,a,s.attributes||{})}else void 0!==s.retain?dH(r,this,n,s.retain,s.attributes||{}):void 0!==s.delete&&dX(r,n,s.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,t,r){let n=[],i=new Map,s=this.doc,a="",o=this._start;function l(){if(a.length>0){let e={},t=!1;i.forEach((r,n)=>{t=!0,e[n]=r});let r={insert:a};t&&(r.attributes=e),n.push(r),a=""}}let h=()=>{for(;null!==o;){if(uL(o,e)||void 0!==t&&uL(o,t))switch(o.content.constructor){case pr:{let n=i.get("ychange");void 0===e||uL(o,e)?void 0===t||uL(o,t)?void 0!==n&&(l(),i.delete("ychange")):(void 0===n||n.user!==o.id.client||"added"!==n.type)&&(l(),i.set("ychange",r?r("added",o.id):{type:"added"})):(void 0===n||n.user!==o.id.client||"removed"!==n.type)&&(l(),i.set("ychange",r?r("removed",o.id):{type:"removed"})),a+=o.content.str;break}case pu:case d7:{l();let e={insert:o.content.getContent()[0]};if(i.size>0){let t={};e.attributes=t,i.forEach((e,r)=>{t[r]=e})}n.push(e);break}case d9:uL(o,e)&&(l(),dF(i,o.content))}o=o.right}l()};return e||t?uZ(s,r=>{e&&uI(r,e),t&&uI(r,t),h()},"cleanup"):h(),n}insert(e,t,r){if(t.length<=0)return;let n=this.doc;null!==n?uZ(n,n=>{let i=dO(n,this,e,!r);r||(r={},i.currentAttributes.forEach((e,t)=>{r[t]=e})),dG(n,this,i,t,r)}):this._pending.push(()=>this.insert(e,t,r))}insertEmbed(e,t,r){let n=this.doc;null!==n?uZ(n,n=>{let i=dO(n,this,e,!r);dG(n,this,i,t,r||{})}):this._pending.push(()=>this.insertEmbed(e,t,r||{}))}delete(e,t){if(0===t)return;let r=this.doc;null!==r?uZ(r,r=>{dX(r,dO(r,this,e,!0),t)}):this._pending.push(()=>this.delete(e,t))}format(e,t,r){if(0===t)return;let n=this.doc;null!==n?uZ(n,n=>{let i=dO(n,this,e,!1);null!==i.right&&dH(n,this,i,t,r)}):this._pending.push(()=>this.format(e,t,r))}removeAttribute(e){null!==this.doc?uZ(this.doc,t=>{dw(t,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,t){null!==this.doc?uZ(this.doc,r=>{dS(r,this,e,t)}):this._pending.push(()=>this.setAttribute(e,t))}getAttribute(e){return dM(this,e)}getAttributes(){return dT(this)}_write(e){e.writeTypeRef(pa)}}class dZ{constructor(e,t=()=>!0){this._filter=t,this._root=e,this._currentNode=e._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let e=this._currentNode,t=e&&e.content&&e.content.type;if(null!==e&&(!this._firstCall||e.deleted||!this._filter(t)))do if(t=e.content.type,e.deleted||t.constructor!==dK&&t.constructor!==d$||null===t._start)for(;null!==e;){if(null!==e.right){e=e.right;break}e=e.parent===this._root?null:e.parent._item}else e=t._start;while(null!==e&&(e.deleted||!this._filter(e.content.type)))return(this._firstCall=!1,null===e)?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class d$ extends dc{constructor(){super(),this._prelimContent=[]}get firstChild(){let e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new d$}clone(){let e=new d$;return e.insert(0,this.toArray().map(e=>e instanceof dc?e.clone():e)),e}get length(){return null===this._prelimContent?this._length:this._prelimContent.length}createTreeWalker(e){return new dZ(this,e)}querySelector(e){e=e.toUpperCase();let t=new dZ(this,t=>t.nodeName&&t.nodeName.toUpperCase()===e).next();return t.done?null:t.value}querySelectorAll(e){return e=e.toUpperCase(),oJ(new dZ(this,t=>t.nodeName&&t.nodeName.toUpperCase()===e))}_callObserver(e,t){dh(this,e,new dQ(this,t,e))}toString(){return df(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,t={},r){let n=e.createDocumentFragment();return void 0!==r&&r._createAssociation(n,this),dp(this,i=>{n.insertBefore(i.toDOM(e,t,r),null)}),n}insert(e,t){null!==this.doc?uZ(this.doc,r=>{dx(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}insertAfter(e,t){if(null!==this.doc)uZ(this.doc,r=>{dv(r,this,e&&e instanceof dc?e._item:e,t)});else{let r=this._prelimContent,n=null===e?0:r.findIndex(t=>t===e)+1;if(0===n&&null!==e)throw lP("Reference item not found");r.splice(n,0,...t)}}delete(e,t=1){null!==this.doc?uZ(this.doc,r=>{db(r,this,e,t)}):this._prelimContent.splice(e,t)}toArray(){return dd(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return dg(this,e)}slice(e=0,t=this.length){return du(this,e,t)}forEach(e){dp(this,e)}_write(e){e.writeTypeRef(pl)}}class dK extends d${constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){let e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){let e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,t){super._integrate(e,t),this._prelimAttrs.forEach((e,t)=>{this.setAttribute(t,e)}),this._prelimAttrs=null}_copy(){return new dK(this.nodeName)}clone(){let e=new dK(this.nodeName);return hs(this.getAttributes(),(t,r)=>{"string"==typeof t&&e.setAttribute(r,t)}),e.insert(0,this.toArray().map(e=>e instanceof dc?e.clone():e)),e}toString(){let e=this.getAttributes(),t=[],r=[];for(let t in e)r.push(t);r.sort();let n=r.length;for(let i=0;i<n;i++){let n=r[i];t.push(n+'="'+e[n]+'"')}let i=this.nodeName.toLocaleLowerCase(),s=t.length>0?" "+t.join(" "):"";return`<${i}${s}>${super.toString()}</${i}>`}removeAttribute(e){null!==this.doc?uZ(this.doc,t=>{dw(t,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,t){null!==this.doc?uZ(this.doc,r=>{dS(r,this,e,t)}):this._prelimAttrs.set(e,t)}getAttribute(e){return dM(this,e)}hasAttribute(e){return dE(this,e)}getAttributes(e){return e?dA(this,e):dT(this)}toDOM(e=document,t={},r){let n=e.createElement(this.nodeName),i=this.getAttributes();for(let e in i){let t=i[e];"string"==typeof t&&n.setAttribute(e,t)}return dp(this,i=>{n.appendChild(i.toDOM(e,t,r))}),void 0!==r&&r._createAssociation(n,this),n}_write(e){e.writeTypeRef(po),e.writeKey(this.nodeName)}}class dQ extends u9{constructor(e,t,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,t.forEach(e=>{null===e?this.childListChanged=!0:this.attributesChanged.add(e)})}}class d0 extends dP{constructor(e){super(),this.hookName=e}_copy(){return new d0(this.hookName)}clone(){let e=new d0(this.hookName);return this.forEach((t,r)=>{e.set(r,t)}),e}toDOM(e=document,t={},r){let n;let i=t[this.hookName];return(n=void 0!==i?i.createDom(this):document.createElement(this.hookName)).setAttribute("data-yjs-hook",this.hookName),void 0!==r&&r._createAssociation(n,this),n}_write(e){e.writeTypeRef(ph),e.writeKey(this.hookName)}}class d1 extends dJ{get nextSibling(){let e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){let e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new d1}clone(){let e=new d1;return e.applyDelta(this.toDelta()),e}toDOM(e=document,t,r){let n=e.createTextNode(this.toString());return void 0!==r&&r._createAssociation(n,this),n}toString(){return this.toDelta().map(e=>{let t=[];for(let r in e.attributes){let n=[];for(let t in e.attributes[r])n.push({key:t,value:e.attributes[r][t]});n.sort((e,t)=>e.key<t.key?-1:1),t.push({nodeName:r,attrs:n})}t.sort((e,t)=>e.nodeName<t.nodeName?-1:1);let r="";for(let e=0;e<t.length;e++){let n=t[e];r+=`<${n.nodeName}`;for(let e=0;e<n.attrs.length;e++){let t=n.attrs[e];r+=` ${t.key}="${t.value}"`}r+=">"}r+=e.insert;for(let e=t.length-1;e>=0;e--)r+=`</${t[e].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(pc)}}class d2{constructor(e,t){this.id=e,this.length=t}get deleted(){throw lk()}mergeWith(e){return!1}write(e,t,r){throw lk()}integrate(e,t){throw lk()}}class d3 extends d2{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor===e.constructor&&(this.length+=e.length,!0)}integrate(e,t){t>0&&(this.id.clock+=t,this.length-=t),uU(e.doc.store,this)}write(e,t){e.writeInfo(0),e.writeLen(this.length-t)}getMissing(e,t){return null}}class d4{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new d4(this.content)}splice(e){throw lk()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeBuf(this.content)}getRef(){return 3}}class d5{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new d5(this.len)}splice(e){let t=new d5(this.len-e);return this.len=e,t}mergeWith(e){return this.len+=e.len,!0}integrate(e,t){cQ(e.deleteSet,t.id.client,t.id.clock,this.len),t.markDeleted()}delete(e){}gc(e){}write(e,t){e.writeLen(this.len-t)}getRef(){return 1}}const d6=(e,t)=>new c5({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class d8{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;let t={};this.opts=t,e.gc||(t.gc=!1),e.autoLoad&&(t.autoLoad=!0),null!==e.meta&&(t.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new d8(d6(this.doc.guid,this.opts))}splice(e){throw lk()}mergeWith(e){return!1}integrate(e,t){this.doc._item=t,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,t){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}class d7{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new d7(this.embed)}splice(e){throw lk()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeJSON(this.embed)}getRef(){return 5}}class d9{constructor(e,t){this.key=e,this.value=t}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new d9(this.key,this.value)}splice(e){throw lk()}mergeWith(e){return!1}integrate(e,t){let r=t.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,t){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}class pe{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new pe(this.arr)}splice(e){let t=new pe(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){let r=this.arr.length;e.writeLen(r-t);for(let n=t;n<r;n++){let t=this.arr[n];e.writeString(void 0===t?"undefined":JSON.stringify(t))}}getRef(){return 2}}class pt{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new pt(this.arr)}splice(e){let t=new pt(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){let r=this.arr.length;e.writeLen(r-t);for(let n=t;n<r;n++){let t=this.arr[n];e.writeAny(t)}}getRef(){return 8}}class pr{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new pr(this.str)}splice(e){let t=new pr(this.str.slice(e));this.str=this.str.slice(0,e);let r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"",t.str=""+t.str.slice(1)),t}mergeWith(e){return this.str+=e.str,!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeString(0===t?this.str:this.str.slice(t))}getRef(){return 4}}const pn=[e=>new dL,e=>new dP,e=>new dJ,e=>new dK(e.readKey()),e=>new d$,e=>new d0(e.readKey()),e=>new d1],pi=0,ps=1,pa=2,po=3,pl=4,ph=5,pc=6;class pu{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new pu(this.type._copy())}splice(e){throw lk()}mergeWith(e){return!1}integrate(e,t){this.type._integrate(e.doc,t)}delete(e){let t=this.type._start;for(;null!==t;)t.deleted?t.id.clock<(e.beforeState.get(t.id.client)||0)&&e._mergeStructs.push(t):t.delete(e),t=t.right;this.type._map.forEach(t=>{t.deleted?t.id.clock<(e.beforeState.get(t.id.client)||0)&&e._mergeStructs.push(t):t.delete(e)}),e.changed.delete(this.type)}gc(e){let t=this.type._start;for(;null!==t;)t.gc(e,!0),t=t.right;this.type._start=null,this.type._map.forEach(t=>{for(;null!==t;)t.gc(e,!0),t=t.left}),this.type._map=new Map}write(e,t){this.type._write(e)}getRef(){return 7}}const pd=(e,t,r)=>{let{client:n,clock:i}=t.id,s=new pp(uC(n,i+r),t,uC(n,i+r-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(r));return t.deleted&&s.markDeleted(),t.keep&&(s.keep=!0),null!==t.redone&&(s.redone=uC(t.redone.client,t.redone.clock+r)),t.right=s,null!==s.right&&(s.right.left=s),e._mergeStructs.push(s),null!==s.parentSub&&null===s.right&&s.parent._map.set(s.parentSub,s),t.length=r,s};class pp extends d2{constructor(e,t,r,n,i,s,a,o){super(e,o.getLength()),this.origin=r,this.left=t,this.right=n,this.rightOrigin=i,this.parent=s,this.parentSub=a,this.redone=null,this.content=o,this.info=this.content.isCountable()?2:0}set marker(e){(8&this.info)>0!==e&&(this.info^=8)}get marker(){return(8&this.info)>0}get keep(){return(1&this.info)>0}set keep(e){this.keep!==e&&(this.info^=1)}get countable(){return(2&this.info)>0}get deleted(){return(4&this.info)>0}set deleted(e){this.deleted!==e&&(this.info^=4)}markDeleted(){this.info|=4}getMissing(e,t){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=uD(t,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=uD(t,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===uE&&this.id.client!==this.parent.client&&this.parent.clock>=uD(t,this.parent.client))return this.parent.client;if(this.origin&&(this.left=uz(e,t,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=uB(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===d3||this.right&&this.right.constructor===d3)this.parent=null;else if(this.parent){if(this.parent.constructor===uE){let e=uN(t,this.parent);e.constructor===d3?this.parent=null:this.parent=e.content.type}}else this.left&&this.left.constructor===pp&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===pp&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);return null}integrate(e,t){if(t>0&&(this.id.clock+=t,this.left=uz(e,e.doc.store,uC(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(t),this.length-=t),this.parent){if(!this.left&&(!this.right||null!==this.right.left)||this.left&&this.left.right!==this.right){let t,r=this.left;if(null!==r)t=r.right;else if(null!==this.parentSub)for(t=this.parent._map.get(this.parentSub)||null;null!==t&&null!==t.left;)t=t.left;else t=this.parent._start;let n=new Set,i=new Set;for(;null!==t&&t!==this.right;){if(i.add(t),n.add(t),uA(this.origin,t.origin)){if(t.id.client<this.id.client)r=t,n.clear();else if(uA(this.rightOrigin,t.rightOrigin))break}else if(null!==t.origin&&i.has(uN(e.doc.store,t.origin)))n.has(uN(e.doc.store,t.origin))||(r=t,n.clear());else break;t=t.right}this.left=r}if(null!==this.left){let e=this.left.right;this.right=e,this.left.right=this}else{let e;if(null!==this.parentSub)for(e=this.parent._map.get(this.parentSub)||null;null!==e&&null!==e.left;)e=e.left;else e=this.parent._start,this.parent._start=this;this.right=e}null!==this.right?this.right.left=this:null!==this.parentSub&&(this.parent._map.set(this.parentSub,this),null!==this.left&&this.left.delete(e)),null===this.parentSub&&this.countable&&!this.deleted&&(this.parent._length+=this.length),uU(e.doc.store,this),this.content.integrate(e,this),uj(e,this.parent,this.parentSub),(null!==this.parent._item&&this.parent._item.deleted||null!==this.parentSub&&null!==this.right)&&this.delete(e)}else new d3(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;null!==e&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;null!==e&&e.deleted;)e=e.left;return e}get lastId(){return 1===this.length?this.id:uC(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&uA(e.origin,this.lastId)&&this.right===e&&uA(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&null===this.redone&&null===e.redone&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){let t=this.parent._searchMarker;return t&&t.forEach(t=>{t.p===e&&(t.p=this,!this.deleted&&this.countable&&(t.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,null!==this.right&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){let t=this.parent;this.countable&&null===this.parentSub&&(t._length-=this.length),this.markDeleted(),cQ(e.deleteSet,this.id.client,this.id.clock,this.length),uj(e,t,this.parentSub),this.content.delete(e)}}gc(e,t){if(!this.deleted)throw lD();this.content.gc(e),t?uG(e,this,new d3(this.id,this.length)):this.content=new d5(this.length)}write(e,t){let r=t>0?uC(this.id.client,this.id.clock+t-1):this.origin,n=this.rightOrigin,i=this.parentSub,s=31&this.content.getRef()|(null===r?0:128)|(null===n?0:64)|(null===i?0:32);if(e.writeInfo(s),null!==r&&e.writeLeftID(r),null!==n&&e.writeRightID(n),null===r&&null===n){let t=this.parent;if(void 0!==t._item){let r=t._item;if(null===r){let r=uR(t);e.writeParentInfo(!0),e.writeString(r)}else e.writeParentInfo(!1),e.writeLeftID(r.id)}else t.constructor===String?(e.writeParentInfo(!0),e.writeString(t)):t.constructor===uE?(e.writeParentInfo(!1),e.writeLeftID(t)):lD();null!==i&&e.writeString(i)}this.content.write(e,t)}}const pf=(e,t)=>pm[31&t](e),pm=[()=>{lD()},e=>new d5(e.readLen()),e=>{let t=e.readLen(),r=[];for(let n=0;n<t;n++){let t=e.readString();"undefined"===t?r.push(void 0):r.push(JSON.parse(t))}return new pe(r)},e=>new d4(e.readBuf()),e=>new pr(e.readString()),e=>new d7(e.readJSON()),e=>new d9(e.readKey(),e.readJSON()),e=>new pu(pn[e.readTypeRef()](e)),e=>{let t=e.readLen(),r=[];for(let n=0;n<t;n++)r.push(e.readAny());return new pt(r)},e=>new d8(d6(e.readString(),e.readAny())),()=>{lD()}];class pg extends d2{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor===e.constructor&&(this.length+=e.length,!0)}integrate(e,t){lD()}write(e,t){e.writeInfo(10),ld(e.restEncoder,this.length-t)}getMissing(e,t){return null}}const pv="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==z?z:{},py="__ $YJS$ __";!0===pv[py]&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),pv[py]=!0;const px=e=>{if(e.shouldConnect&&null===e.ws){let t=new WebSocket(e.url),r=e.binaryType,n=null;r&&(t.binaryType=r),e.ws=t,e.connecting=!0,e.connected=!1,t.onmessage=t=>{e.lastMessageReceived=l3();let r=t.data,i="string"==typeof r?JSON.parse(r):r;i&&"pong"===i.type&&(clearTimeout(n),n=setTimeout(s,15e3)),e.emit("message",[i,e])};let i=t=>{null!==e.ws&&(e.ws=null,e.connecting=!1,e.connected?(e.connected=!1,e.emit("disconnect",[{type:"disconnect",error:t},e])):e.unsuccessfulReconnects++,setTimeout(px,o2(1200*o1(e.unsuccessfulReconnects+1),2500),e)),clearTimeout(n)},s=()=>{e.ws===t&&e.send({type:"ping"})};t.onclose=()=>i(null),t.onerror=e=>i(e),t.onopen=()=>{e.lastMessageReceived=l3(),e.connecting=!1,e.connected=!0,e.unsuccessfulReconnects=0,e.emit("connect",[{type:"connect"},e]),n=setTimeout(s,15e3)}}};class p_ extends oK{constructor(e,{binaryType:t}={}){super(),this.url=e,this.ws=null,this.binaryType=t||null,this.connected=!1,this.connecting=!1,this.unsuccessfulReconnects=0,this.lastMessageReceived=0,this.shouldConnect=!0,this._checkInterval=setInterval(()=>{this.connected&&3e4<l3()-this.lastMessageReceived&&this.ws.close()},15e3),px(this)}send(e){this.ws&&this.ws.send(JSON.stringify(e))}destroy(){clearInterval(this._checkInterval),this.disconnect(),super.destroy()}disconnect(){this.shouldConnect=!1,null!==this.ws&&this.ws.close()}connect(){this.shouldConnect=!0,this.connected||null!==this.ws||px(this)}}const pb=new Map,pw="undefined"==typeof BroadcastChannel?class{constructor(e){this.room=e,this.onmessage=null,this._onChange=t=>t.key===e&&null!==this.onmessage&&this.onmessage({data:cy(t.newValue||"")}),ht(this._onChange)}postMessage(e){he.setItem(this.room,cv(cg(e)))}close(){hr(this._onChange)}}:BroadcastChannel,pS=e=>oV(pb,e,()=>{let t=oq(),r=new pw(e);return r.onmessage=e=>t.forEach(t=>t(e.data,"broadcastchannel")),{bc:r,subs:t}}),pM=(e,t)=>(pS(e).subs.add(t),t),pT=(e,t)=>{let r=pS(e),n=r.subs.delete(t);return n&&0===r.subs.size&&(r.bc.close(),pb.delete(e)),n},pE=(e,t,r=null)=>{let n=pS(e);n.bc.postMessage(t),n.subs.forEach(e=>e(t,r))},pA=()=>{let e=!0;return(t,r)=>{if(e){e=!1;try{t()}finally{e=!0}}else void 0!==r&&r()}};var pC={};w=Math.floor,S=Math.abs,T=Math.pow,pC=(function e(t,r,n){function i(a,o){if(!r[a]){if(!t[a]){var l=void 0;if(!o&&l)return l(a,!0);if(s)return s(a,!0);var h=Error("Cannot find module '"+a+"'");throw h.code="MODULE_NOT_FOUND",h}var c=r[a]={exports:{}};t[a][0].call(c.exports,function(e){return i(t[a][1][e]||e)},c,c.exports,e,t,r,n)}return r[a].exports}for(var s=void 0,a=0;a<n.length;a++)i(n[a]);return i})({1:[function(e,t,r){function n(e){var t=e.length;if(0<t%4)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var n=r===t?0:4-r%4;return[r,n]}r.byteLength=function(e){var t=n(e),r=t[0],i=t[1];return 3*(r+i)/4-i},r.toByteArray=function(e){var t,r,i=n(e),o=i[0],l=i[1],h=new a(3*(o+l)/4-l),c=0,u=0<l?o-4:o;for(r=0;r<u;r+=4)t=s[e.charCodeAt(r)]<<18|s[e.charCodeAt(r+1)]<<12|s[e.charCodeAt(r+2)]<<6|s[e.charCodeAt(r+3)],h[c++]=255&t>>16,h[c++]=255&t>>8,h[c++]=255&t;return 2===l&&(t=s[e.charCodeAt(r)]<<2|s[e.charCodeAt(r+1)]>>4,h[c++]=255&t),1===l&&(t=s[e.charCodeAt(r)]<<10|s[e.charCodeAt(r+1)]<<4|s[e.charCodeAt(r+2)]>>2,h[c++]=255&t>>8,h[c++]=255&t),h},r.fromByteArray=function(e){for(var t,r=e.length,n=r%3,s=[],a=0,o=r-n;a<o;a+=16383)s.push(function(e,t,r){for(var n,s=[],a=t;a<r;a+=3)s.push(i[63&(n=(16711680&e[a]<<16)+(65280&e[a+1]<<8)+(255&e[a+2]))>>18]+i[63&n>>12]+i[63&n>>6]+i[63&n]);return s.join("")}(e,a,a+16383>o?o:a+16383));return 1===n?s.push(i[(t=e[r-1])>>2]+i[63&t<<4]+"=="):2===n&&s.push(i[(t=(e[r-2]<<8)+e[r-1])>>10]+i[63&t>>4]+i[63&t<<2]+"="),s.join("")};for(var i=[],s=[],a="undefined"==typeof Uint8Array?Array:Uint8Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l=0,h=o.length;l<h;++l)i[l]=o[l],s[o.charCodeAt(l)]=l;s[45]=62,s[95]=63},{}],2:[function(){},{}],3:[function(e,t,r){(function(){(function(){var t=String.fromCharCode,n=Math.min;function i(e){if(2147483647<e)throw RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return t.__proto__=s.prototype,t}function s(e,t,r){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return l(e)}return a(e,t,r)}function a(e,t,r){if("string"==typeof e)return function(e,t){if(("string"!=typeof t||""===t)&&(t="utf8"),!s.isEncoding(t))throw TypeError("Unknown encoding: "+t);var r=0|u(e,t),n=i(r),a=n.write(e,t);return a!==r&&(n=n.slice(0,a)),n}(e,t);if(ArrayBuffer.isView(e))return h(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(C(e,ArrayBuffer)||e&&C(e.buffer,ArrayBuffer))return function(e,t,r){var n;if(0>t||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw RangeError('"length" is outside of buffer bounds');return(n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r)).__proto__=s.prototype,n}(e,t,r);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');var n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return s.from(n,t,r);var a=function(e){if(s.isBuffer(e)){var t,r=0|c(e.length),n=i(r);return 0===n.length||e.copy(n,0,0,r),n}return void 0===e.length?"Buffer"===e.type&&Array.isArray(e.data)?h(e.data):void 0:"number"!=typeof e.length||(t=e.length)!=t?i(0):h(e)}(e);if(a)return a;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return s.from(e[Symbol.toPrimitive]("string"),t,r);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function o(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(0>e)throw RangeError('The value "'+e+'" is invalid for option "size"')}function l(e){return o(e),i(0>e?0:0|c(e))}function h(e){for(var t=0>e.length?0:0|c(e.length),r=i(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}function c(e){if(e>=2147483647)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function u(e,t){if(s.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||C(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,n=2<arguments.length&&!0===arguments[2];if(!n&&0===r)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return w(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return E(e).length;default:if(i)return n?-1:w(e).length;t=(""+t).toLowerCase(),i=!0}}function d(e,r,i){var s,a,o=!1;if((void 0===r||0>r)&&(r=0),r>this.length||((void 0===i||i>this.length)&&(i=this.length),0>=i)||(i>>>=0)<=(r>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,r){var n,i=e.length;(!t||0>t)&&(t=0),(!r||0>r||r>i)&&(r=i);for(var s="",a=t;a<r;++a)s+=16>(n=e[a])?"0"+n.toString(16):n.toString(16);return s}(this,r,i);case"utf8":case"utf-8":return g(this,r,i);case"ascii":return function(e,r,i){var s="";i=n(e.length,i);for(var a=r;a<i;++a)s+=t(127&e[a]);return s}(this,r,i);case"latin1":case"binary":return function(e,r,i){var s="";i=n(e.length,i);for(var a=r;a<i;++a)s+=t(e[a]);return s}(this,r,i);case"base64":return s=r,a=i,0===s&&a===this.length?R.fromByteArray(this):R.fromByteArray(this.slice(s,a));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,r,n){for(var i=e.slice(r,n),s="",a=0;a<i.length;a+=2)s+=t(i[a]+256*i[a+1]);return s}(this,r,i);default:if(o)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}function p(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function f(e,t,r,n,i){var a;if(0===e.length)return -1;if("string"==typeof r?(n=r,r=0):2147483647<r?r=2147483647:-2147483648>r&&(r=-2147483648),(a=r=+r)!=a&&(r=i?0:e.length-1),0>r&&(r=e.length+r),r>=e.length){if(i)return -1;r=e.length-1}else if(0>r){if(!i)return -1;r=0}if("string"==typeof t&&(t=s.from(t,n)),s.isBuffer(t))return 0===t.length?-1:m(e,t,r,n,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):m(e,[t],r,n,i);throw TypeError("val must be string, number or Buffer")}function m(e,t,r,n,i){function s(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}var a,o=1,l=e.length,h=t.length;if(void 0!==n&&("ucs2"===(n=(n+"").toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(2>e.length||2>t.length)return -1;o=2,l/=2,h/=2,r/=2}if(i){var c=-1;for(a=r;a<l;a++)if(s(e,a)!==s(t,-1===c?0:a-c))-1!==c&&(a-=a-c),c=-1;else if(-1===c&&(c=a),a-c+1===h)return c*o}else for(r+h>l&&(r=l-h),a=r;0<=a;a--){for(var u=!0,d=0;d<h;d++)if(s(e,a+d)!==s(t,d)){u=!1;break}if(u)return a}return -1}function g(e,r,i){i=n(e.length,i);for(var s=[],a=r;a<i;){var o,l,h,c,u=e[a],d=null,p=239<u?4:223<u?3:191<u?2:1;a+p<=i&&(1===p?128>u&&(d=u):2===p?128==(192&(o=e[a+1]))&&127<(c=(31&u)<<6|63&o)&&(d=c):3===p?(o=e[a+1],l=e[a+2],128==(192&o)&&128==(192&l)&&2047<(c=(15&u)<<12|(63&o)<<6|63&l)&&(55296>c||57343<c)&&(d=c)):4===p&&(o=e[a+1],l=e[a+2],h=e[a+3],128==(192&o)&&128==(192&l)&&128==(192&h)&&65535<(c=(15&u)<<18|(63&o)<<12|(63&l)<<6|63&h)&&1114112>c&&(d=c))),null===d?(d=65533,p=1):65535<d&&(d-=65536,s.push(55296|1023&d>>>10),d=56320|1023&d),s.push(d),a+=p}return function(e){var r=e.length;if(r<=4096)return t.apply(String,e);for(var n="",i=0;i<r;)n+=t.apply(String,e.slice(i,i+=4096));return n}(s)}function v(e,t,r){if(0!=e%1||0>e)throw RangeError("offset is not uint");if(e+t>r)throw RangeError("Trying to access beyond buffer length")}function y(e,t,r,n,i,a){if(!s.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw RangeError('"value" argument is out of bounds');if(r+n>e.length)throw RangeError("Index out of range")}function x(e,t,r,n){if(r+n>e.length||0>r)throw RangeError("Index out of range")}function _(e,t,r,n,i){return t=+t,r>>>=0,i||x(e,t,r,4,34028234663852886e22,-34028234663852886e22),L.write(e,t,r,n,23,4),r+4}function b(e,t,r,n,i){return t=+t,r>>>=0,i||x(e,t,r,8,17976931348623157e292,-17976931348623157e292),L.write(e,t,r,n,52,8),r+8}function w(e,t){t=t||1/0;for(var r,n=e.length,i=null,s=[],a=0;a<n;++a){if(55295<(r=e.charCodeAt(a))&&57344>r){if(!i){if(56319<r||a+1===n){-1<(t-=3)&&s.push(239,191,189);continue}i=r;continue}if(56320>r){-1<(t-=3)&&s.push(239,191,189),i=r;continue}r=(i-55296<<10|r-56320)+65536}else i&&-1<(t-=3)&&s.push(239,191,189);if(i=null,128>r){if(0>(t-=1))break;s.push(r)}else if(2048>r){if(0>(t-=2))break;s.push(192|r>>6,128|63&r)}else if(65536>r){if(0>(t-=3))break;s.push(224|r>>12,128|63&r>>6,128|63&r)}else if(1114112>r){if(0>(t-=4))break;s.push(240|r>>18,128|63&r>>12,128|63&r>>6,128|63&r)}else throw Error("Invalid code point")}return s}function S(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}function E(e){return R.toByteArray(function(e){if(2>(e=(e=e.split("=")[0]).trim().replace(I,"")).length)return"";for(;0!=e.length%4;)e+="=";return e}(e))}function A(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function C(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}var R=e("base64-js"),L=e("ieee754");r.Buffer=s,r.SlowBuffer=function(e){return+e!=e&&(e=0),s.alloc(+e)},r.INSPECT_MAX_BYTES=50,r.kMaxLength=2147483647,s.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}(),s.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(s.prototype,"parent",{enumerable:!0,get:function(){return s.isBuffer(this)?this.buffer:void 0}}),Object.defineProperty(s.prototype,"offset",{enumerable:!0,get:function(){return s.isBuffer(this)?this.byteOffset:void 0}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&s[Symbol.species]===s&&Object.defineProperty(s,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),s.poolSize=8192,s.from=function(e,t,r){return a(e,t,r)},s.prototype.__proto__=Uint8Array.prototype,s.__proto__=Uint8Array,s.alloc=function(e,t,r){return o(e),0>=e?i(e):void 0===t?i(e):"string"==typeof r?i(e).fill(t,r):i(e).fill(t)},s.allocUnsafe=function(e){return l(e)},s.allocUnsafeSlow=function(e){return l(e)},s.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==s.prototype},s.compare=function(e,t){if(C(e,Uint8Array)&&(e=s.from(e,e.offset,e.byteLength)),C(t,Uint8Array)&&(t=s.from(t,t.offset,t.byteLength)),!s.isBuffer(e)||!s.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,i=t.length,a=0,o=n(r,i);a<o;++a)if(e[a]!==t[a]){r=e[a],i=t[a];break}return r<i?-1:i<r?1:0},s.isEncoding=function(e){switch((e+"").toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(e,t){if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return s.alloc(0);if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var r,n=s.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var a=e[r];if(C(a,Uint8Array)&&(a=s.from(a)),!s.isBuffer(a))throw TypeError('"list" argument must be an Array of Buffers');a.copy(n,i),i+=a.length}return n},s.byteLength=u,s.prototype._isBuffer=!0,s.prototype.swap16=function(){var e=this.length;if(0!=e%2)throw RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)p(this,t,t+1);return this},s.prototype.swap32=function(){var e=this.length;if(0!=e%4)throw RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)p(this,t,t+3),p(this,t+1,t+2);return this},s.prototype.swap64=function(){var e=this.length;if(0!=e%8)throw RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)p(this,t,t+7),p(this,t+1,t+6),p(this,t+2,t+5),p(this,t+3,t+4);return this},s.prototype.toString=function(){var e=this.length;return 0===e?"":0==arguments.length?g(this,0,e):d.apply(this,arguments)},s.prototype.toLocaleString=s.prototype.toString,s.prototype.equals=function(e){if(!s.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===s.compare(this,e)},s.prototype.inspect=function(){var e="",t=r.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},s.prototype.compare=function(e,t,r,i,a){if(C(e,Uint8Array)&&(e=s.from(e,e.offset,e.byteLength)),!s.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===i&&(i=0),void 0===a&&(a=this.length),0>t||r>e.length||0>i||a>this.length)throw RangeError("out of range index");if(i>=a&&t>=r)return 0;if(i>=a)return -1;if(t>=r)return 1;if(t>>>=0,r>>>=0,i>>>=0,a>>>=0,this===e)return 0;for(var o=a-i,l=r-t,h=n(o,l),c=this.slice(i,a),u=e.slice(t,r),d=0;d<h;++d)if(c[d]!==u[d]){o=c[d],l=u[d];break}return o<l?-1:l<o?1:0},s.prototype.includes=function(e,t,r){return -1!==this.indexOf(e,t,r)},s.prototype.indexOf=function(e,t,r){return f(this,e,t,r,!0)},s.prototype.lastIndexOf=function(e,t,r){return f(this,e,t,r,!1)},s.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var i,s,a,o,l,h,c,u,d,p,f,m,g=this.length-t;if((void 0===r||r>g)&&(r=g),0<e.length&&(0>r||0>t)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var v=!1;;)switch(n){case"hex":return function(e,t,r,n){r=+r||0;var i=e.length-r;n?(n=+n)>i&&(n=i):n=i;var s=t.length;n>s/2&&(n=s/2);for(var a,o,l=0;l<n&&!((a=o=parseInt(t.substr(2*l,2),16))!=a);++l)e[r+l]=o;return l}(this,e,t,r);case"utf8":case"utf-8":return l=t,h=r,A(w(e,this.length-l),this,l,h);case"ascii":return c=t,u=r,A(S(e),this,c,u);case"latin1":case"binary":return i=this,s=e,a=t,o=r,A(S(s),i,a,o);case"base64":return d=t,p=r,A(E(e),this,d,p);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return f=t,m=r,A(function(e,t){for(var r,n,i=[],s=0;s<e.length&&!(0>(t-=2));++s)n=(r=e.charCodeAt(s))>>8,i.push(r%256),i.push(n);return i}(e,this.length-f),this,f,m);default:if(v)throw TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),v=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},s.prototype.slice=function(e,t){var r=this.length;e=~~e,t=void 0===t?r:~~t,0>e?0>(e+=r)&&(e=0):e>r&&(e=r),0>t?0>(t+=r)&&(t=0):t>r&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return n.__proto__=s.prototype,n},s.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||v(e,t,this.length);for(var n=this[e],i=1,s=0;++s<t&&(i*=256);)n+=this[e+s]*i;return n},s.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||v(e,t,this.length);for(var n=this[e+--t],i=1;0<t&&(i*=256);)n+=this[e+--t]*i;return n},s.prototype.readUInt8=function(e,t){return e>>>=0,t||v(e,1,this.length),this[e]},s.prototype.readUInt16LE=function(e,t){return e>>>=0,t||v(e,2,this.length),this[e]|this[e+1]<<8},s.prototype.readUInt16BE=function(e,t){return e>>>=0,t||v(e,2,this.length),this[e]<<8|this[e+1]},s.prototype.readUInt32LE=function(e,t){return e>>>=0,t||v(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},s.prototype.readUInt32BE=function(e,t){return e>>>=0,t||v(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},s.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||v(e,t,this.length);for(var n=this[e],i=1,s=0;++s<t&&(i*=256);)n+=this[e+s]*i;return n>=(i*=128)&&(n-=T(2,8*t)),n},s.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||v(e,t,this.length);for(var n=t,i=1,s=this[e+--n];0<n&&(i*=256);)s+=this[e+--n]*i;return s>=(i*=128)&&(s-=T(2,8*t)),s},s.prototype.readInt8=function(e,t){return e>>>=0,t||v(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},s.prototype.readInt16LE=function(e,t){e>>>=0,t||v(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},s.prototype.readInt16BE=function(e,t){e>>>=0,t||v(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},s.prototype.readInt32LE=function(e,t){return e>>>=0,t||v(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},s.prototype.readInt32BE=function(e,t){return e>>>=0,t||v(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},s.prototype.readFloatLE=function(e,t){return e>>>=0,t||v(e,4,this.length),L.read(this,e,!0,23,4)},s.prototype.readFloatBE=function(e,t){return e>>>=0,t||v(e,4,this.length),L.read(this,e,!1,23,4)},s.prototype.readDoubleLE=function(e,t){return e>>>=0,t||v(e,8,this.length),L.read(this,e,!0,52,8)},s.prototype.readDoubleBE=function(e,t){return e>>>=0,t||v(e,8,this.length),L.read(this,e,!1,52,8)},s.prototype.writeUIntLE=function(e,t,r,n){if(e=+e,t>>>=0,r>>>=0,!n){var i=T(2,8*r)-1;y(this,e,t,r,i,0)}var s=1,a=0;for(this[t]=255&e;++a<r&&(s*=256);)this[t+a]=255&e/s;return t+r},s.prototype.writeUIntBE=function(e,t,r,n){if(e=+e,t>>>=0,r>>>=0,!n){var i=T(2,8*r)-1;y(this,e,t,r,i,0)}var s=r-1,a=1;for(this[t+s]=255&e;0<=--s&&(a*=256);)this[t+s]=255&e/a;return t+r},s.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||y(this,e,t,1,255,0),this[t]=255&e,t+1},s.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||y(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},s.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||y(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},s.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||y(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},s.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||y(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},s.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=T(2,8*r-1);y(this,e,t,r,i-1,-i)}var s=0,a=1,o=0;for(this[t]=255&e;++s<r&&(a*=256);)0>e&&0===o&&0!==this[t+s-1]&&(o=1),this[t+s]=255&(e/a>>0)-o;return t+r},s.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=T(2,8*r-1);y(this,e,t,r,i-1,-i)}var s=r-1,a=1,o=0;for(this[t+s]=255&e;0<=--s&&(a*=256);)0>e&&0===o&&0!==this[t+s+1]&&(o=1),this[t+s]=255&(e/a>>0)-o;return t+r},s.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||y(this,e,t,1,127,-128),0>e&&(e=255+e+1),this[t]=255&e,t+1},s.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||y(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},s.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||y(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},s.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||y(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},s.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||y(this,e,t,4,2147483647,-2147483648),0>e&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},s.prototype.writeFloatLE=function(e,t,r){return _(this,e,t,!0,r)},s.prototype.writeFloatBE=function(e,t,r){return _(this,e,t,!1,r)},s.prototype.writeDoubleLE=function(e,t,r){return b(this,e,t,!0,r)},s.prototype.writeDoubleBE=function(e,t,r){return b(this,e,t,!1,r)},s.prototype.copy=function(e,t,r,n){if(!s.isBuffer(e))throw TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),0<n&&n<r&&(n=r),n===r||0===e.length||0===this.length)return 0;if(0>t)throw RangeError("targetStart out of bounds");if(0>r||r>=this.length)throw RangeError("Index out of range");if(0>n)throw RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i=n-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,n);else if(this===e&&r<t&&t<n)for(var a=i-1;0<=a;--a)e[a+t]=this[a+r];else Uint8Array.prototype.set.call(e,this.subarray(r,n),t);return i},s.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw TypeError("encoding must be a string");if("string"==typeof n&&!s.isEncoding(n))throw TypeError("Unknown encoding: "+n);if(1===e.length){var i,a=e.charCodeAt(0);("utf8"===n&&128>a||"latin1"===n)&&(e=a)}}else"number"==typeof e&&(e&=255);if(0>t||this.length<t||this.length<r)throw RangeError("Out of range index");if(r<=t)return this;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{var o=s.isBuffer(e)?e:s.from(e,n),l=o.length;if(0===l)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<r-t;++i)this[i+t]=o[i%l]}return this};var I=/[^+/0-9A-Za-z-_]/g}).call(this)}).call(this,e("buffer").Buffer)},{"base64-js":1,buffer:3,ieee754:9}],4:[function(e,t,r){(function(n){(function(){let i;r.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;let r="color: "+this.color;e.splice(1,0,r,"color: inherit");let n=0,i=0;e[0].replace(/%[a-zA-Z%]/g,e=>{"%%"===e||(n++,"%c"===e&&(i=n))}),e.splice(i,0,r)},r.save=function(e){try{e?r.storage.setItem("debug",e):r.storage.removeItem("debug")}catch(e){}},r.load=function(){let e;try{e=r.storage.getItem("debug")}catch(e){}return!e&&void 0!==n&&"env"in n&&(e=n.env.DEBUG),e},r.useColors=function(){return!!("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))||!("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},r.storage=function(){try{return localStorage}catch(e){}}(),r.destroy=(i=!1,()=>{i||(i=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}),r.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],r.log=console.debug||console.log||(()=>{}),t.exports=e("./common")(r);let{formatters:s}=t.exports;s.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this)}).call(this,e("_process"))},{"./common":5,_process:12}],5:[function(e,t){t.exports=function(t){function r(e){function t(...e){if(!t.enabled)return;let n=+new Date,s=n-(i||n);t.diff=s,t.prev=i,t.curr=n,i=n,e[0]=r.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let a=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(n,i)=>{if("%%"===n)return"%";a++;let s=r.formatters[i];if("function"==typeof s){let r=e[a];n=s.call(t,r),e.splice(a,1),a--}return n}),r.formatArgs.call(t,e),(t.log||r.log).apply(t,e)}let i,s=null;return t.namespace=e,t.useColors=r.useColors(),t.color=r.selectColor(e),t.extend=n,t.destroy=r.destroy,Object.defineProperty(t,"enabled",{enumerable:!0,configurable:!1,get:()=>null===s?r.enabled(e):s,set:e=>{s=e}}),"function"==typeof r.init&&r.init(t),t}function n(e,t){let n=r(this.namespace+(void 0===t?":":t)+e);return n.log=this.log,n}function i(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return r.debug=r,r.default=r,r.coerce=function(e){return e instanceof Error?e.stack||e.message:e},r.disable=function(){let e=[...r.names.map(i),...r.skips.map(i).map(e=>"-"+e)].join(",");return r.enable(""),e},r.enable=function(e){let t;r.save(e),r.names=[],r.skips=[];let n=("string"==typeof e?e:"").split(/[\s,]+/),i=n.length;for(t=0;t<i;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?r.skips.push(RegExp("^"+e.substr(1)+"$")):r.names.push(RegExp("^"+e+"$")))},r.enabled=function(e){let t,n;if("*"===e[e.length-1])return!0;for(t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1},r.humanize=e("ms"),r.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(t).forEach(e=>{r[e]=t[e]}),r.names=[],r.skips=[],r.formatters={},r.selectColor=function(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r)|0;return r.colors[S(t)%r.colors.length]},r.enable(r.load()),r}},{ms:11}],6:[function(e,t){function r(e,t){for(let r in t)Object.defineProperty(e,r,{value:t[r],enumerable:!0,configurable:!0});return e}t.exports=function(e,t,n){if(!e||"string"==typeof e)throw TypeError("Please pass an Error to err-code");n||(n={}),"object"==typeof t&&(n=t,t=""),t&&(n.code=t);try{return r(e,n)}catch(i){n.message=e.message,n.stack=e.stack;let t=function(){};return t.prototype=Object.create(Object.getPrototypeOf(e)),r(new t,n)}}},{}],7:[function(e,t){function r(){r.init.call(this)}function n(e){if("function"!=typeof e)throw TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function i(e){return void 0===e._maxListeners?r.defaultMaxListeners:e._maxListeners}function s(e,t,r,s){var a,o,l;if(n(r),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),l=o[t]),void 0===l)l=o[t]=r,++e._eventsCount;else if("function"==typeof l?l=o[t]=s?[r,l]:[l,r]:s?l.unshift(r):l.push(r),0<(a=i(e))&&l.length>a&&!l.warned){l.warned=!0;var h=Error("Possible EventEmitter memory leak detected. "+l.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.emitter=e,h.type=t,h.count=l.length,console&&console.warn&&console.warn(h)}return e}function a(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0==arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function o(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=a.bind(n);return i.listener=r,n.wrapFn=i,i}function l(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):c(i,i.length)}function h(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function c(e,t){for(var r=Array(t),n=0;n<t;++n)r[n]=e[n];return r}function u(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else if("function"==typeof e.addEventListener)e.addEventListener(t,function i(s){n.once&&e.removeEventListener(t,i),r(s)});else throw TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}var d,p="object"==typeof Reflect?Reflect:null,f=p&&"function"==typeof p.apply?p.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};d=p&&"function"==typeof p.ownKeys?p.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var m=Number.isNaN||function(e){return e!=e};t.exports=r,t.exports.once=function(e,t){return new Promise(function(r,n){var i;function s(r){e.removeListener(t,a),n(r)}function a(){"function"==typeof e.removeListener&&e.removeListener("error",s),r([].slice.call(arguments))}u(e,t,a,{once:!0}),"error"!==t&&(i={once:!0},"function"==typeof e.on&&u(e,"error",s,i))})},r.EventEmitter=r,r.prototype._events=void 0,r.prototype._eventsCount=0,r.prototype._maxListeners=void 0;var g=10;Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return g},set:function(e){if("number"!=typeof e||0>e||m(e))throw RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");g=e}}),r.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(e){if("number"!=typeof e||0>e||m(e))throw RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},r.prototype.getMaxListeners=function(){return i(this)},r.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,i=this._events;if(void 0!==i)n=n&&void 0===i.error;else if(!n)return!1;if(n){if(0<t.length&&(s=t[0]),s instanceof Error)throw s;var s,a=Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var o=i[e];if(void 0===o)return!1;if("function"==typeof o)f(o,this,t);else for(var l=o.length,h=c(o,l),r=0;r<l;++r)f(h[r],this,t);return!0},r.prototype.addListener=function(e,t){return s(this,e,t,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(e,t){return s(this,e,t,!0)},r.prototype.once=function(e,t){return n(t),this.on(e,o(this,e,t)),this},r.prototype.prependOnceListener=function(e,t){return n(t),this.prependListener(e,o(this,e,t)),this},r.prototype.removeListener=function(e,t){var r,i,s,a,o;if(n(t),void 0===(i=this._events)||void 0===(r=i[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(s=-1,a=r.length-1;0<=a;a--)if(r[a]===t||r[a].listener===t){o=r[a].listener,s=a;break}if(0>s)return this;0===s?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,s),1===r.length&&(i[e]=r[0]),void 0!==i.removeListener&&this.emit("removeListener",e,o||t)}return this},r.prototype.off=r.prototype.removeListener,r.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0==arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0==arguments.length){var i,s=Object.keys(r);for(n=0;n<s.length;++n)"removeListener"!==(i=s[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;0<=n;n--)this.removeListener(e,t[n]);return this},r.prototype.listeners=function(e){return l(this,e,!0)},r.prototype.rawListeners=function(e){return l(this,e,!1)},r.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},r.prototype.listenerCount=h,r.prototype.eventNames=function(){return 0<this._eventsCount?d(this._events):[]}},{}],8:[function(e,t){t.exports=function(){if("undefined"==typeof globalThis)return null;var e={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return e.RTCPeerConnection?e:null}},{}],9:[function(e,t,r){r.read=function(e,t,r,n,i){var s,a,o=8*i-n-1,l=(1<<o)-1,h=l>>1,c=-7,u=r?i-1:0,d=r?-1:1,p=e[t+u];for(u+=d,s=p&(1<<-c)-1,p>>=-c,c+=o;0<c;s=256*s+e[t+u],u+=d,c-=8);for(a=s&(1<<-c)-1,s>>=-c,c+=n;0<c;a=256*a+e[t+u],u+=d,c-=8);if(0===s)s=1-h;else{if(s===l)return a?NaN:1/0*(p?-1:1);a+=T(2,n),s-=h}return(p?-1:1)*a*T(2,s-n)},r.write=function(e,t,r,n,i,s){var a,o,l,h=Math.log,c=8*s-i-1,u=(1<<c)-1,d=u>>1,p=23===i?T(2,-24)-T(2,-77):0,f=n?0:s-1,m=n?1:-1,g=0>t||0===t&&0>1/t?1:0;for(isNaN(t=S(t))||t===1/0?(o=isNaN(t)?1:0,a=u):(a=w(h(t)/Math.LN2),1>t*(l=T(2,-a))&&(a--,l*=2),2<=(t+=1<=a+d?p/l:p*T(2,1-d))*l&&(a++,l/=2),a+d>=u?(o=0,a=u):1<=a+d?(o=(t*l-1)*T(2,i),a+=d):(o=t*T(2,d-1)*T(2,i),a=0));8<=i;e[r+f]=255&o,f+=m,o/=256,i-=8);for(a=a<<i|o,c+=i;0<c;e[r+f]=255&a,f+=m,a/=256,c-=8);e[r+f-m]|=128*g}},{}],10:[function(e,t){t.exports="function"==typeof Object.create?function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}}},{}],11:[function(e,t){var r=Math.round;function n(e,t,n,i){return r(e/n)+" "+i+(t>=1.5*n?"s":"")}t.exports=function(e,t){t=t||{};var i,s,a=typeof e;if("string"==a&&0<e.length)return function(e){if(!(100<(e+="").length)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]),n=(t[2]||"ms").toLowerCase();return"years"===n||"year"===n||"yrs"===n||"yr"===n||"y"===n?315576e5*r:"weeks"===n||"week"===n||"w"===n?6048e5*r:"days"===n||"day"===n||"d"===n?864e5*r:"hours"===n||"hour"===n||"hrs"===n||"hr"===n||"h"===n?36e5*r:"minutes"===n||"minute"===n||"mins"===n||"min"===n||"m"===n?6e4*r:"seconds"===n||"second"===n||"secs"===n||"sec"===n||"s"===n?1e3*r:"milliseconds"===n||"millisecond"===n||"msecs"===n||"msec"===n||"ms"===n?r:void 0}}}(e);if("number"===a&&isFinite(e))return t.long?864e5<=(i=S(e))?n(e,i,864e5,"day"):36e5<=i?n(e,i,36e5,"hour"):6e4<=i?n(e,i,6e4,"minute"):1e3<=i?n(e,i,1e3,"second"):e+" ms":864e5<=(s=S(e))?r(e/864e5)+"d":36e5<=s?r(e/36e5)+"h":6e4<=s?r(e/6e4)+"m":1e3<=s?r(e/1e3)+"s":e+"ms";throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},{}],12:[function(e,t){function r(){throw Error("setTimeout has not been defined")}function n(){throw Error("clearTimeout has not been defined")}function i(e){if(h===setTimeout)return setTimeout(e,0);if((h===r||!h)&&setTimeout)return h=setTimeout,setTimeout(e,0);try{return h(e,0)}catch(t){try{return h.call(null,e,0)}catch(t){return h.call(this,e,0)}}}function s(){f&&d&&(f=!1,d.length?p=d.concat(p):m=-1,p.length&&a())}function a(){if(!f){var e=i(s);f=!0;for(var t=p.length;t;){for(d=p,p=[];++m<t;)d&&d[m].run();m=-1,t=p.length}d=null,f=!1,function(e){if(c===clearTimeout)return clearTimeout(e);if((c===n||!c)&&clearTimeout)return c=clearTimeout,clearTimeout(e);try{c(e)}catch(t){try{return c.call(null,e)}catch(t){return c.call(this,e)}}}(e)}}function o(e,t){this.fun=e,this.array=t}function l(){}var h,c,u=t.exports={};!function(){try{h="function"==typeof setTimeout?setTimeout:r}catch(e){h=r}try{c="function"==typeof clearTimeout?clearTimeout:n}catch(e){c=n}}();var d,p=[],f=!1,m=-1;u.nextTick=function(e){var t=Array(arguments.length-1);if(1<arguments.length)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];p.push(new o(e,t)),1!==p.length||f||i(a)},o.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={},u.on=l,u.addListener=l,u.once=l,u.off=l,u.removeListener=l,u.removeAllListeners=l,u.emit=l,u.prependListener=l,u.prependOnceListener=l,u.listeners=function(){return[]},u.binding=function(){throw Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(){throw Error("process.chdir is not supported")},u.umask=function(){return 0}},{}],13:[function(e,t){(function(e){(function(){let r;t.exports="function"==typeof queueMicrotask?queueMicrotask.bind("undefined"==typeof window?e:window):e=>(r||(r=Promise.resolve())).then(e).catch(e=>setTimeout(()=>{throw e},0))}).call(this)}).call(this,void 0===z?"undefined"==typeof self?"undefined"==typeof window?{}:window:self:z)},{}],14:[function(e,t){(function(r,n){(function(){var i=e("safe-buffer").Buffer,s=n.crypto||n.msCrypto;t.exports=s&&s.getRandomValues?function(e,t){if(e>4294967295)throw RangeError("requested too many random bytes");var n=i.allocUnsafe(e);if(0<e){if(65536<e)for(var a=0;a<e;a+=65536)s.getRandomValues(n.slice(a,a+65536));else s.getRandomValues(n)}return"function"==typeof t?r.nextTick(function(){t(null,n)}):n}:function(){throw Error("Secure random number generation is not supported by this browser.\nUse Chrome, Firefox or Internet Explorer 11")}}).call(this)}).call(this,e("_process"),void 0===z?"undefined"==typeof self?"undefined"==typeof window?{}:window:self:z)},{_process:12,"safe-buffer":30}],15:[function(e,t){function r(e,t,r){r||(r=Error);var n=function(e){function r(r,n,i){return e.call(this,"string"==typeof t?t:t(r,n,i))||this}return r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.__proto__=e,r}(r);n.prototype.name=r.name,n.prototype.code=e,i[e]=n}function n(e,t){if(Array.isArray(e)){var r=e.length;return e=e.map(function(e){return e+""}),2<r?"one of ".concat(t," ").concat(e.slice(0,r-1).join(", "),", or ")+e[r-1]:2===r?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(e+"")}var i={};r("ERR_INVALID_OPT_VALUE",function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'},TypeError),r("ERR_INVALID_ARG_TYPE",function(e,t,r){if("string"==typeof t&&(i="not ",t.substr(0,i.length)===i)?(l="must not be",t=t.replace(/^not /,"")):l="must be",s=" argument",(void 0===a||a>e.length)&&(a=e.length),e.substring(a-s.length,a)===s)h="The ".concat(e," ").concat(l," ").concat(n(t,"type"));else{var i,s,a,o,l,h,c=("number"!=typeof o&&(o=0),o+1>e.length||-1===e.indexOf(".",o))?"argument":"property";h='The "'.concat(e,'" ').concat(c," ").concat(l," ").concat(n(t,"type"))}return h+". Received type ".concat(typeof r)},TypeError),r("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),r("ERR_METHOD_NOT_IMPLEMENTED",function(e){return"The "+e+" method is not implemented"}),r("ERR_STREAM_PREMATURE_CLOSE","Premature close"),r("ERR_STREAM_DESTROYED",function(e){return"Cannot call "+e+" after a stream was destroyed"}),r("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),r("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),r("ERR_STREAM_WRITE_AFTER_END","write after end"),r("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),r("ERR_UNKNOWN_ENCODING",function(e){return"Unknown encoding: "+e},TypeError),r("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),t.exports.codes=i},{}],16:[function(e,t){(function(r){(function(){function n(e){return this instanceof n?void(o.call(this,e),l.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",i)))):new n(e)}function i(){this._writableState.ended||r.nextTick(s,this)}function s(e){e.end()}var a=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};t.exports=n;var o=e("./_stream_readable"),l=e("./_stream_writable");e("inherits")(n,o);for(var h,c=a(l.prototype),u=0;u<c.length;u++)h=c[u],n.prototype[h]||(n.prototype[h]=l.prototype[h]);Object.defineProperty(n.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(n.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(n.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(n.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0===this._readableState||void 0===this._writableState||(this._readableState.destroyed=e,this._writableState.destroyed=e)}})}).call(this)}).call(this,e("_process"))},{"./_stream_readable":18,"./_stream_writable":20,_process:12,inherits:10}],17:[function(e,t){function r(e){return this instanceof r?void n.call(this,e):new r(e)}t.exports=r;var n=e("./_stream_transform");e("inherits")(r,n),r.prototype._transform=function(e,t,r){r(null,e)}},{"./_stream_transform":19,inherits:10}],18:[function(e,t){(function(r,n){(function(){function i(t,r,n){b=b||e("./_stream_duplex"),t=t||{},"boolean"!=typeof n&&(n=r instanceof b),this.objectMode=!!t.objectMode,n&&(this.objectMode=this.objectMode||!!t.readableObjectMode),this.highWaterMark=D(this,t,"readableHighWaterMark",n),this.buffer=new P,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(R||(R=e("string_decoder/").StringDecoder),this.decoder=new R(t.encoding),this.encoding=t.encoding)}function s(t){if(b=b||e("./_stream_duplex"),!(this instanceof s))return new s(t);var r=this instanceof b;this._readableState=new i(t,this,r),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),T.call(this)}function a(e,t,r,n,i){w("readableAddChunk",t);var s,a,l,d,p,f=e._readableState;if(null===t)f.reading=!1,function(e,t){if(w("onEofChunk"),!t.ended){if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,t.sync?h(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,c(e)))}}(e,f);else{if(i||(s=f,a=t,E.isBuffer(a)||a instanceof A||"string"==typeof a||void 0===a||s.objectMode||(l=new O("chunk",["string","Buffer","Uint8Array"],a)),p=l),p)z(e,p);else if(f.objectMode||t&&0<t.length){if("string"==typeof t||f.objectMode||Object.getPrototypeOf(t)===E.prototype||(d=t,t=E.from(d)),n)f.endEmitted?z(e,new B):o(e,f,t,!0);else if(f.ended)z(e,new N);else{if(f.destroyed)return!1;f.reading=!1,f.decoder&&!r?(t=f.decoder.write(t),f.objectMode||0!==t.length?o(e,f,t,!1):u(e,f)):o(e,f,t,!1)}}else n||(f.reading=!1,u(e,f))}return!f.ended&&(f.length<f.highWaterMark||0===f.length)}function o(e,t,r,n){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",r)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&h(e)),u(e,t)}function l(e,t){var r;return 0>=e||0===t.length&&t.ended?0:t.objectMode?1:e==e?(e>t.highWaterMark&&(t.highWaterMark=(1073741824<=(r=e)?r=1073741824:(r--,r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r++),r)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0)):t.flowing&&t.length?t.buffer.head.data.length:t.length}function h(e){var t=e._readableState;w("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(w("emitReadable",t.flowing),t.emittedReadable=!0,r.nextTick(c,e))}function c(e){var t=e._readableState;w("emitReadable_",t.destroyed,t.length,t.ended),!t.destroyed&&(t.length||t.ended)&&(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,g(e)}function u(e,t){t.readingMore||(t.readingMore=!0,r.nextTick(d,e,t))}function d(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var r=t.length;if(w("maybeReadMore read 0"),e.read(0),r===t.length)break}t.readingMore=!1}function p(e){var t=e._readableState;t.readableListening=0<e.listenerCount("readable"),t.resumeScheduled&&!t.paused?t.flowing=!0:0<e.listenerCount("data")&&e.resume()}function f(e){w("readable nexttick read 0"),e.read(0)}function m(e,t){w("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),g(e),t.flowing&&!t.reading&&e.read(0)}function g(e){var t=e._readableState;for(w("flow",t.flowing);t.flowing&&null!==e.read(););}function v(e,t){var r;return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):r=t.buffer.consume(e,t.decoder),r)}function y(e){var t=e._readableState;w("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,r.nextTick(x,t,e))}function x(e,t){if(w("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var r=t._writableState;(!r||r.autoDestroy&&r.finished)&&t.destroy()}}function _(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return -1}t.exports=s,s.ReadableState=i,e("events").EventEmitter;var b,w,S=function(e,t){return e.listeners(t).length},T=e("./internal/streams/stream"),E=e("buffer").Buffer,A=n.Uint8Array||function(){},C=e("util");w=C&&C.debuglog?C.debuglog("stream"):function(){};var R,L,I,P=e("./internal/streams/buffer_list"),k=e("./internal/streams/destroy"),D=e("./internal/streams/state").getHighWaterMark,U=e("../errors").codes,O=U.ERR_INVALID_ARG_TYPE,N=U.ERR_STREAM_PUSH_AFTER_EOF,F=U.ERR_METHOD_NOT_IMPLEMENTED,B=U.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;e("inherits")(s,T);var z=k.errorOrDestroy,G=["error","close","destroy","pause","resume"];Object.defineProperty(s.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),s.prototype.destroy=k.destroy,s.prototype._undestroy=k.undestroy,s.prototype._destroy=function(e,t){t(e)},s.prototype.push=function(e,t){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=E.from(e,t),t=""),r=!0),a(this,e,t,!1,r)},s.prototype.unshift=function(e){return a(this,e,null,!0,!1)},s.prototype.isPaused=function(){return!1===this._readableState.flowing},s.prototype.setEncoding=function(t){R||(R=e("string_decoder/").StringDecoder);var r=new R(t);this._readableState.decoder=r,this._readableState.encoding=this._readableState.decoder.encoding;for(var n=this._readableState.buffer.head,i="";null!==n;)i+=r.write(n.data),n=n.next;return this._readableState.buffer.clear(),""!==i&&this._readableState.buffer.push(i),this._readableState.length=i.length,this},s.prototype.read=function(e){w("read",e),e=parseInt(e,10);var t,r=this._readableState,n=e;if(0!==e&&(r.emittedReadable=!1),0===e&&r.needReadable&&((0===r.highWaterMark?0<r.length:r.length>=r.highWaterMark)||r.ended))return w("read: emitReadable",r.length,r.ended),0===r.length&&r.ended?y(this):h(this),null;if(0===(e=l(e,r))&&r.ended)return 0===r.length&&y(this),null;var i=r.needReadable;return w("need readable",i),(0===r.length||r.length-e<r.highWaterMark)&&w("length less than watermark",i=!0),r.ended||r.reading?w("reading or ended",i=!1):i&&(w("do read"),r.reading=!0,r.sync=!0,0===r.length&&(r.needReadable=!0),this._read(r.highWaterMark),r.sync=!1,r.reading||(e=l(n,r))),null===(t=0<e?v(e,r):null)?(r.needReadable=r.length<=r.highWaterMark,e=0):(r.length-=e,r.awaitDrain=0),0===r.length&&(r.ended||(r.needReadable=!0),n!==e&&r.ended&&y(this)),null!==t&&this.emit("data",t),t},s.prototype._read=function(){z(this,new F("_read()"))},s.prototype.pipe=function(e,t){function n(){w("onend"),e.end()}function i(t){w("ondata");var r=e.write(t);w("dest.write",r),!1===r&&((1===u.pipesCount&&u.pipes===e||1<u.pipesCount&&-1!==_(u.pipes,e))&&!f&&(w("false write response, pause",u.awaitDrain),u.awaitDrain++),c.pause())}function s(t){w("onerror",t),l(),e.removeListener("error",s),0===S(e,"error")&&z(e,t)}function a(){e.removeListener("finish",o),l()}function o(){w("onfinish"),e.removeListener("close",a),l()}function l(){w("unpipe"),c.unpipe(e)}var h,c=this,u=this._readableState;switch(u.pipesCount){case 0:u.pipes=e;break;case 1:u.pipes=[u.pipes,e];break;default:u.pipes.push(e)}u.pipesCount+=1,w("pipe count=%d opts=%j",u.pipesCount,t);var d=t&&!1===t.end||e===r.stdout||e===r.stderr?l:n;u.endEmitted?r.nextTick(d):c.once("end",d),e.on("unpipe",function t(r,h){w("onunpipe"),r===c&&h&&!1===h.hasUnpiped&&(h.hasUnpiped=!0,w("cleanup"),e.removeListener("close",a),e.removeListener("finish",o),e.removeListener("drain",p),e.removeListener("error",s),e.removeListener("unpipe",t),c.removeListener("end",n),c.removeListener("end",l),c.removeListener("data",i),f=!0,u.awaitDrain&&(!e._writableState||e._writableState.needDrain)&&p())});var p=function(){var e=c._readableState;w("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&S(c,"data")&&(e.flowing=!0,g(c))};e.on("drain",p);var f=!1;return c.on("data",i),h="error","function"==typeof e.prependListener?e.prependListener(h,s):e._events&&e._events[h]?Array.isArray(e._events[h])?e._events[h].unshift(s):e._events[h]=[s,e._events[h]]:e.on(h,s),e.once("close",a),e.once("finish",o),e.emit("pipe",c),u.flowing||(w("pipe resume"),c.resume()),e},s.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r)),this;if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var s=0;s<i;s++)n[s].emit("unpipe",this,{hasUnpiped:!1});return this}var a=_(t.pipes,e);return -1===a||(t.pipes.splice(a,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r)),this},s.prototype.on=function(e,t){var n=T.prototype.on.call(this,e,t),i=this._readableState;return"data"===e?(i.readableListening=0<this.listenerCount("readable"),!1!==i.flowing&&this.resume()):"readable"!=e||i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.flowing=!1,i.emittedReadable=!1,w("on readable",i.length,i.reading),i.length?h(this):i.reading||r.nextTick(f,this)),n},s.prototype.addListener=s.prototype.on,s.prototype.removeListener=function(e,t){var n=T.prototype.removeListener.call(this,e,t);return"readable"===e&&r.nextTick(p,this),n},s.prototype.removeAllListeners=function(e){var t=T.prototype.removeAllListeners.apply(this,arguments);return("readable"===e||void 0===e)&&r.nextTick(p,this),t},s.prototype.resume=function(){var e=this._readableState;return e.flowing||(w("resume"),e.flowing=!e.readableListening,e.resumeScheduled||(e.resumeScheduled=!0,r.nextTick(m,this,e))),e.paused=!1,this},s.prototype.pause=function(){return w("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(w("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},s.prototype.wrap=function(e){var t=this,r=this._readableState,n=!1;for(var i in e.on("end",function(){if(w("wrapped end"),r.decoder&&!r.ended){var e=r.decoder.end();e&&e.length&&t.push(e)}t.push(null)}),e.on("data",function(i){if(w("wrapped data"),r.decoder&&(i=r.decoder.write(i)),!(r.objectMode&&null==i)&&(r.objectMode||i&&i.length)){var s=t.push(i);s||(n=!0,e.pause())}}),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var s=0;s<G.length;s++)e.on(G[s],this.emit.bind(this,G[s]));return this._read=function(t){w("wrapped _read",t),n&&(n=!1,e.resume())},this},"function"==typeof Symbol&&(s.prototype[Symbol.asyncIterator]=function(){return void 0===L&&(L=e("./internal/streams/async_iterator")),L(this)}),Object.defineProperty(s.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(s.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(s.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),s._fromList=v,Object.defineProperty(s.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(s.from=function(t,r){return void 0===I&&(I=e("./internal/streams/from")),I(s,t,r)})}).call(this)}).call(this,e("_process"),void 0===z?"undefined"==typeof self?"undefined"==typeof window?{}:window:self:z)},{"../errors":15,"./_stream_duplex":16,"./internal/streams/async_iterator":21,"./internal/streams/buffer_list":22,"./internal/streams/destroy":23,"./internal/streams/from":25,"./internal/streams/state":27,"./internal/streams/stream":28,_process:12,buffer:3,events:7,inherits:10,"string_decoder/":31,util:2}],19:[function(e,t){function r(e,t){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(null===n)return this.emit("error",new l);r.writechunk=null,r.writecb=null,null!=t&&this.push(t),n(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function n(e){return this instanceof n?void(u.call(this,e),this._transformState={afterTransform:r.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",i)):new n(e)}function i(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?s(this,null,null):this._flush(function(t,r){s(e,t,r)})}function s(e,t,r){if(t)return e.emit("error",t);if(null!=r&&e.push(r),e._writableState.length)throw new c;if(e._transformState.transforming)throw new h;return e.push(null)}t.exports=n;var a=e("../errors").codes,o=a.ERR_METHOD_NOT_IMPLEMENTED,l=a.ERR_MULTIPLE_CALLBACK,h=a.ERR_TRANSFORM_ALREADY_TRANSFORMING,c=a.ERR_TRANSFORM_WITH_LENGTH_0,u=e("./_stream_duplex");e("inherits")(n,u),n.prototype.push=function(e,t){return this._transformState.needTransform=!1,u.prototype.push.call(this,e,t)},n.prototype._transform=function(e,t,r){r(new o("_transform()"))},n.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},n.prototype._read=function(){var e=this._transformState;null===e.writechunk||e.transforming?e.needTransform=!0:(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform))},n.prototype._destroy=function(e,t){u.prototype._destroy.call(this,e,function(e){t(e)})}},{"../errors":15,"./_stream_duplex":16,inherits:10}],20:[function(e,t){(function(r,n){(function(){function i(e){var t=this;this.next=null,this.entry=null,this.finish=function(){(function(e,t,r){var n=e.entry;for(e.entry=null;n;){var i=n.callback;t.pendingcb--,i(void 0),n=n.next}t.corkedRequestsFree.next=e})(t,e)}}function s(){}function a(t,n,s){f=f||e("./_stream_duplex"),t=t||{},"boolean"!=typeof s&&(s=n instanceof f),this.objectMode=!!t.objectMode,s&&(this.objectMode=this.objectMode||!!t.writableObjectMode),this.highWaterMark=b(this,t,"writableHighWaterMark",s),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var a=!1===t.decodeStrings;this.decodeStrings=!a,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){(function(e,t){var n=e._writableState,i=n.sync,s=n.writecb;if("function"!=typeof s)throw new E;if(n.writing=!1,n.writecb=null,n.length-=n.writelen,n.writelen=0,t)--n.pendingcb,i?(r.nextTick(s,t),r.nextTick(p,e,n),e._writableState.errorEmitted=!0,P(e,t)):(s(t),e._writableState.errorEmitted=!0,P(e,t),p(e,n));else{var a=u(n)||e.destroyed;a||n.corked||n.bufferProcessing||!n.bufferedRequest||c(e,n),i?r.nextTick(h,e,n,a,s):h(e,n,a,s)}})(n,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new i(this)}function o(t){var r=this instanceof(f=f||e("./_stream_duplex"));return r||m.call(o,this)?void(this._writableState=new a(t,this,r),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),v.call(this)):new o(t)}function l(e,t,r,n,i,s,a){t.writelen=n,t.writecb=a,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new C("write")):r?e._writev(i,t.onwrite):e._write(i,s,t.onwrite),t.sync=!1}function h(e,t,r,n){r||0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain")),t.pendingcb--,n(),p(e,t)}function c(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=Array(t.bufferedRequestCount),s=t.corkedRequestsFree;s.entry=r;for(var a=0,o=!0;r;)n[a]=r,r.isBuf||(o=!1),r=r.next,a+=1;n.allBuffers=o,l(e,t,!0,t.length,n,"",s.finish),t.pendingcb++,t.lastBufferedRequest=null,s.next?(t.corkedRequestsFree=s.next,s.next=null):t.corkedRequestsFree=new i(t),t.bufferedRequestCount=0}else{for(;r;){var h=r.chunk,c=r.encoding,u=r.callback,d=t.objectMode?1:h.length;if(l(e,t,!1,d,h,c,u),r=r.next,t.bufferedRequestCount--,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}function u(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function d(e,t){e._final(function(r){t.pendingcb--,r&&P(e,r),t.prefinished=!0,e.emit("prefinish"),p(e,t)})}function p(e,t){var n=u(t);if(n&&(t.prefinished||t.finalCalled||("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.pendingcb++,t.finalCalled=!0,r.nextTick(d,e,t))),0===t.pendingcb&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var i=e._readableState;(!i||i.autoDestroy&&i.endEmitted)&&e.destroy()}return n}t.exports=o,o.WritableState=a;var f,m,g={deprecate:e("util-deprecate")},v=e("./internal/streams/stream"),y=e("buffer").Buffer,x=n.Uint8Array||function(){},_=e("./internal/streams/destroy"),b=e("./internal/streams/state").getHighWaterMark,w=e("../errors").codes,S=w.ERR_INVALID_ARG_TYPE,T=w.ERR_METHOD_NOT_IMPLEMENTED,E=w.ERR_MULTIPLE_CALLBACK,A=w.ERR_STREAM_CANNOT_PIPE,C=w.ERR_STREAM_DESTROYED,R=w.ERR_STREAM_NULL_VALUES,L=w.ERR_STREAM_WRITE_AFTER_END,I=w.ERR_UNKNOWN_ENCODING,P=_.errorOrDestroy;e("inherits")(o,v),a.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(a.prototype,"buffer",{get:g.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(m=Function.prototype[Symbol.hasInstance],Object.defineProperty(o,Symbol.hasInstance,{value:function(e){return!!m.call(this,e)||!(this!==o)&&e&&e._writableState instanceof a}})):m=function(e){return e instanceof this},o.prototype.pipe=function(){P(this,new A)},o.prototype.write=function(e,t,n){var i,a,o,h,c,u,d,p=this._writableState,f=!1,m=!p.objectMode&&(i=e,y.isBuffer(i)||i instanceof x);return m&&!y.isBuffer(e)&&(a=e,e=y.from(a)),"function"==typeof t&&(n=t,t=null),m?t="buffer":t||(t=p.defaultEncoding),"function"!=typeof n&&(n=s),p.ending?(o=n,P(this,h=new L),r.nextTick(o,h)):!m&&(c=e,u=n,null===c?d=new R:"string"==typeof c||p.objectMode||(d=new S("chunk",["string","Buffer"],c)),d&&(P(this,d),r.nextTick(u,d),1))||(p.pendingcb++,f=function(e,t,r,n,i,s){if(!r){var a,o,h=(a=n,o=i,t.objectMode||!1===t.decodeStrings||"string"!=typeof a||(a=y.from(a,o)),a);n!==h&&(r=!0,i="buffer",n=h)}var c=t.objectMode?1:n.length;t.length+=c;var u=t.length<t.highWaterMark;if(u||(t.needDrain=!0),t.writing||t.corked){var d=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:s,next:null},d?d.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else l(e,t,!1,c,n,i,s);return u}(this,p,m,e,t,n)),f},o.prototype.cork=function(){this._writableState.corked++},o.prototype.uncork=function(){var e=this._writableState;!e.corked||(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||c(this,e))},o.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(-1<["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())))throw new I(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(o.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(o.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),o.prototype._write=function(e,t,r){r(new T("_write()"))},o.prototype._writev=null,o.prototype.end=function(e,t,n){var i,s=this._writableState;return"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),s.corked&&(s.corked=1,this.uncork()),s.ending||(i=n,s.ending=!0,p(this,s),i&&(s.finished?r.nextTick(i):this.once("finish",i)),s.ended=!0,this.writable=!1),this},Object.defineProperty(o.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(o.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),o.prototype.destroy=_.destroy,o.prototype._undestroy=_.undestroy,o.prototype._destroy=function(e,t){t(e)}}).call(this)}).call(this,e("_process"),void 0===z?"undefined"==typeof self?"undefined"==typeof window?{}:window:self:z)},{"../errors":15,"./_stream_duplex":16,"./internal/streams/destroy":23,"./internal/streams/state":27,"./internal/streams/stream":28,_process:12,buffer:3,inherits:10,"util-deprecate":32}],21:[function(e,t){(function(r){(function(){function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){return{value:e,done:t}}function s(e){var t=e[h];if(null!==t){var r=e[m].read();null!==r&&(e[p]=null,e[h]=null,e[c]=null,t(i(r,!1)))}}function a(e){r.nextTick(s,e)}var o,l=e("./end-of-stream"),h=Symbol("lastResolve"),c=Symbol("lastReject"),u=Symbol("error"),d=Symbol("ended"),p=Symbol("lastPromise"),f=Symbol("handlePromise"),m=Symbol("stream"),g=Object.getPrototypeOf(function(){}),v=Object.setPrototypeOf((n(o={get stream(){return this[m]},next:function(){var e,t=this,n=this[u];if(null!==n)return Promise.reject(n);if(this[d])return Promise.resolve(i(void 0,!0));if(this[m].destroyed)return new Promise(function(e,n){r.nextTick(function(){t[u]?n(t[u]):e(i(void 0,!0))})});var s,a=this[p];if(a)s=new Promise((e=this,function(t,r){a.then(function(){return e[d]?void t(i(void 0,!0)):void e[f](t,r)},r)}));else{var o=this[m].read();if(null!==o)return Promise.resolve(i(o,!1));s=new Promise(this[f])}return this[p]=s,s}},Symbol.asyncIterator,function(){return this}),n(o,"return",function(){var e=this;return new Promise(function(t,r){e[m].destroy(null,function(e){return e?void r(e):void t(i(void 0,!0))})})}),o),g);t.exports=function(e){var t,r=Object.create(v,(n(t={},m,{value:e,writable:!0}),n(t,h,{value:null,writable:!0}),n(t,c,{value:null,writable:!0}),n(t,u,{value:null,writable:!0}),n(t,d,{value:e._readableState.endEmitted,writable:!0}),n(t,f,{value:function(e,t){var n=r[m].read();n?(r[p]=null,r[h]=null,r[c]=null,e(i(n,!1))):(r[h]=e,r[c]=t)},writable:!0}),t));return r[p]=null,l(e,function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=r[c];return null!==t&&(r[p]=null,r[h]=null,r[c]=null,t(e)),void(r[u]=e)}var n=r[h];null!==n&&(r[p]=null,r[h]=null,r[c]=null,n(i(void 0,!0))),r[d]=!0}),e.on("readable",a.bind(null,r)),r}}).call(this)}).call(this,e("_process"))},{"./end-of-stream":24,_process:12}],22:[function(e,t){function r(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}var n=e("buffer").Buffer,i=e("util").inspect,s=i&&i.custom||"inspect";t.exports=function(){var e;function t(){(function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")})(this,t),this.head=null,this.tail=null,this.length=0}return e=[{key:"push",value:function(e){var t={data:e,next:null};0<this.length?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return this.head=1===this.length?this.tail=null:this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r}},{key:"concat",value:function(e){if(0===this.length)return n.alloc(0);for(var t,r,i=n.allocUnsafe(e>>>0),s=this.head,a=0;s;)t=s.data,r=a,n.prototype.copy.call(t,i,r),a+=s.data.length,s=s.next;return i}},{key:"consume",value:function(e,t){var r;return e<this.head.data.length?(r=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):r=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),r}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,r=1,n=t.data;for(e-=n.length;t=t.next;){var i=t.data,s=e>i.length?i.length:e;if(n+=s===i.length?i:i.slice(0,e),0==(e-=s)){s===i.length?(++r,this.head=t.next?t.next:this.tail=null):(this.head=t,t.data=i.slice(s));break}++r}return this.length-=r,n}},{key:"_getBuffer",value:function(e){var t=n.allocUnsafe(e),r=this.head,i=1;for(r.data.copy(t),e-=r.data.length;r=r.next;){var s=r.data,a=e>s.length?s.length:e;if(s.copy(t,t.length-e,0,a),0==(e-=a)){a===s.length?(++i,this.head=r.next?r.next:this.tail=null):(this.head=r,r.data=s.slice(a));break}++i}return this.length-=i,t}},{key:s,value:function(e,t){return i(this,function(e){for(var t,n=1;n<arguments.length;n++)t=null==arguments[n]?{}:arguments[n],n%2?r(Object(t),!0).forEach(function(r){var n;n=t[r],r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))});return e}({},t,{depth:0,customInspect:!1}))}}],function(e,t){for(var r,n=0;n<t.length;n++)(r=t[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}(t.prototype,e),t}()},{buffer:3,util:2}],23:[function(e,t){(function(e){(function(){function r(e,t){i(e,t),n(e)}function n(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function i(e,t){e.emit("error",t)}t.exports={destroy:function(t,s){var a=this,o=this._readableState&&this._readableState.destroyed,l=this._writableState&&this._writableState.destroyed;return o||l?s?s(t):t&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,e.nextTick(i,this,t)):e.nextTick(i,this,t)):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,function(t){!s&&t?a._writableState?a._writableState.errorEmitted?e.nextTick(n,a):(a._writableState.errorEmitted=!0,e.nextTick(r,a,t)):e.nextTick(r,a,t):s?(e.nextTick(n,a),s(t)):e.nextTick(n,a)})),this},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var r=e._readableState,n=e._writableState;r&&r.autoDestroy||n&&n.autoDestroy?e.destroy(t):e.emit("error",t)}}}).call(this)}).call(this,e("_process"))},{_process:12}],24:[function(e,t){function r(){}var n=e("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;t.exports=function e(t,i,s){if("function"==typeof i)return e(t,null,i);i||(i={}),a=s||r,o=!1,s=function(){if(!o){o=!0;for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.apply(this,t)}};var a,o,l=i.readable||!1!==i.readable&&t.readable,h=i.writable||!1!==i.writable&&t.writable,c=function(){t.writable||d()},u=t._writableState&&t._writableState.finished,d=function(){h=!1,u=!0,l||s.call(t)},p=t._readableState&&t._readableState.endEmitted,f=function(){l=!1,p=!0,h||s.call(t)},m=function(e){s.call(t,e)},g=function(){var e;return l&&!p?(t._readableState&&t._readableState.ended||(e=new n),s.call(t,e)):h&&!u?(t._writableState&&t._writableState.ended||(e=new n),s.call(t,e)):void 0},v=function(){t.req.on("finish",d)};return t.setHeader&&"function"==typeof t.abort?(t.on("complete",d),t.on("abort",g),t.req?v():t.on("request",v)):h&&!t._writableState&&(t.on("end",c),t.on("close",c)),t.on("end",f),t.on("finish",d),!1!==i.error&&t.on("error",m),t.on("close",g),function(){t.removeListener("complete",d),t.removeListener("abort",g),t.removeListener("request",v),t.req&&t.req.removeListener("finish",d),t.removeListener("end",c),t.removeListener("close",c),t.removeListener("finish",d),t.removeListener("end",f),t.removeListener("error",m),t.removeListener("close",g)}}},{"../../../errors":15}],25:[function(e,t){t.exports=function(){throw Error("Readable.from is not available in the browser")}},{}],26:[function(e,t){function r(e){if(e)throw e}function n(e){e()}function i(e,t){return e.pipe(t)}var s,a=e("../../../errors").codes,o=a.ERR_MISSING_ARGS,l=a.ERR_STREAM_DESTROYED;t.exports=function(){for(var t=arguments.length,a=Array(t),h=0;h<t;h++)a[h]=arguments[h];var c=(u=a).length&&"function"==typeof u[u.length-1]?u.pop():r;if(Array.isArray(a[0])&&(a=a[0]),2>a.length)throw new o("streams");var u,d,p=a.map(function(t,r){var i,o,h,u,f,m,g=r<a.length-1;return i=0<r,h=o=function(e){d||(d=e),e&&p.forEach(n),g||(p.forEach(n),c(d))},u=!1,o=function(){u||(u=!0,h.apply(void 0,arguments))},f=!1,t.on("close",function(){f=!0}),void 0===s&&(s=e("./end-of-stream")),s(t,{readable:g,writable:i},function(e){return e?o(e):void(f=!0,o())}),m=!1,function(e){if(!f)return m?void 0:(m=!0,t.setHeader&&"function"==typeof t.abort?t.abort():"function"==typeof t.destroy?t.destroy():void o(e||new l("pipe")))}});return a.reduce(i)}},{"../../../errors":15,"./end-of-stream":24}],27:[function(e,t){var r=e("../../../errors").codes.ERR_INVALID_OPT_VALUE;t.exports={getHighWaterMark:function(e,t,n,i){var s=null==t.highWaterMark?i?t[n]:null:t.highWaterMark;if(null!=s){if(!(isFinite(s)&&w(s)===s)||0>s)throw new r(i?n:"highWaterMark",s);return w(s)}return e.objectMode?16:16384}}},{"../../../errors":15}],28:[function(e,t){t.exports=e("events").EventEmitter},{events:7}],29:[function(e,t,r){(r=t.exports=e("./lib/_stream_readable.js")).Stream=r,r.Readable=r,r.Writable=e("./lib/_stream_writable.js"),r.Duplex=e("./lib/_stream_duplex.js"),r.Transform=e("./lib/_stream_transform.js"),r.PassThrough=e("./lib/_stream_passthrough.js"),r.finished=e("./lib/internal/streams/end-of-stream.js"),r.pipeline=e("./lib/internal/streams/pipeline.js")},{"./lib/_stream_duplex.js":16,"./lib/_stream_passthrough.js":17,"./lib/_stream_readable.js":18,"./lib/_stream_transform.js":19,"./lib/_stream_writable.js":20,"./lib/internal/streams/end-of-stream.js":24,"./lib/internal/streams/pipeline.js":26}],30:[function(e,t,r){function n(e,t){for(var r in e)t[r]=e[r]}function i(e,t,r){return a(e,t,r)}/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var s=e("buffer"),a=s.Buffer;a.from&&a.alloc&&a.allocUnsafe&&a.allocUnsafeSlow?t.exports=s:(n(s,r),r.Buffer=i),i.prototype=Object.create(a.prototype),n(a,i),i.from=function(e,t,r){if("number"==typeof e)throw TypeError("Argument must not be a number");return a(e,t,r)},i.alloc=function(e,t,r){if("number"!=typeof e)throw TypeError("Argument must be a number");var n=a(e);return void 0===t?n.fill(0):"string"==typeof r?n.fill(t,r):n.fill(t),n},i.allocUnsafe=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return a(e)},i.allocUnsafeSlow=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return s.SlowBuffer(e)}},{buffer:3}],31:[function(e,t,r){function n(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(d.isEncoding===p||!p(e)))throw Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=a,this.end=o,t=4;break;case"utf8":this.fillLast=s,t=4;break;case"base64":this.text=l,this.end=h,t=3;break;default:return this.write=c,void(this.end=u)}this.lastNeed=0,this.lastTotal=0,this.lastChar=d.allocUnsafe(t)}function i(e){return 127>=e?0:6==e>>5?2:14==e>>4?3:30==e>>3?4:2==e>>6?-1:-2}function s(e){var t=this.lastTotal-this.lastNeed,r=function(e,t){if(128!=(192&t[0]))return e.lastNeed=0,"";if(1<e.lastNeed&&1<t.length){if(128!=(192&t[1]))return e.lastNeed=1,"";if(2<e.lastNeed&&2<t.length&&128!=(192&t[2]))return e.lastNeed=2,""}}(this,e,t);return void 0===r?this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):void(e.copy(this.lastChar,t,0,e.length),this.lastNeed-=e.length):r}function a(e,t){if(0==(e.length-t)%2){var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(55296<=n&&56319>=n)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function o(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function l(e,t){var r=(e.length-t)%3;return 0==r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1==r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function h(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function c(e){return e.toString(this.encoding)}function u(e){return e&&e.length?this.write(e):""}var d=e("safe-buffer").Buffer,p=d.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};r.StringDecoder=n,n.prototype.write=function(e){var t,r;if(0===e.length)return"";if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},n.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"":t},n.prototype.text=function(e,t){var r=function(e,t,r){var n=t.length-1;if(n<r)return 0;var s=i(t[n]);return 0<=s?(0<s&&(e.lastNeed=s-1),s):--n<r||-2===s?0:0<=(s=i(t[n]))?(0<s&&(e.lastNeed=s-2),s):--n<r||-2===s?0:0<=(s=i(t[n]))?(0<s&&(2===s?s=0:e.lastNeed=s-3),s):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)},n.prototype.fillLast=function(e){return this.lastNeed<=e.length?(e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):void(e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length)}},{"safe-buffer":30}],32:[function(e,t){(function(e){(function(){function r(t){try{if(!e.localStorage)return!1}catch(e){return!1}var r=e.localStorage[t];return null!=r&&"true"===(r+"").toLowerCase()}t.exports=function(e,t){if(r("noDeprecation"))return e;var n=!1;return function(){if(!n){if(r("throwDeprecation"))throw Error(t);r("traceDeprecation")?console.trace(t):console.warn(t),n=!0}return e.apply(this,arguments)}}}).call(this)}).call(this,void 0===z?"undefined"==typeof self?"undefined"==typeof window?{}:window:self:z)},{}],"/":[function(e,t){function r(e){return e.replace(/a=ice-options:trickle\s\n/g,"")}let n=e("debug")("simple-peer"),i=e("get-browser-rtc"),s=e("randombytes"),a=e("readable-stream"),o=e("queue-microtask"),l=e("err-code"),{Buffer:h}=e("buffer");class c extends a.Duplex{constructor(e){if(super(e=Object.assign({allowHalfOpen:!1},e)),this._id=s(4).toString("hex").slice(0,7),this._debug("new peer %o",e),this.channelName=e.initiator?e.channelName||s(20).toString("hex"):null,this.initiator=e.initiator||!1,this.channelConfig=e.channelConfig||c.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},c.config,e.config),this.offerOptions=e.offerOptions||{},this.answerOptions=e.answerOptions||{},this.sdpTransform=e.sdpTransform||(e=>e),this.streams=e.streams||(e.stream?[e.stream]:[]),this.trickle=void 0===e.trickle||e.trickle,this.allowHalfTrickle=void 0!==e.allowHalfTrickle&&e.allowHalfTrickle,this.iceCompleteTimeout=e.iceCompleteTimeout||5e3,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=e.wrtc&&"object"==typeof e.wrtc?e.wrtc:i(),!this._wrtc){if("undefined"==typeof window)throw l(Error("No WebRTC support: Specify `opts.wrtc` option in this environment"),"ERR_WEBRTC_SUPPORT");throw l(Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT")}this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(e){return void this.destroy(l(e,"ERR_PC_CONSTRUCTOR"))}this._isReactNativeWebrtc="number"==typeof this._pc._peerConnectionId,this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=e=>{this._onIceCandidate(e)},"object"==typeof this._pc.peerIdentity&&this._pc.peerIdentity.catch(e=>{this.destroy(l(e,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=e=>{this._setupData(e)},this.streams&&this.streams.forEach(e=>{this.addStream(e)}),this._pc.ontrack=e=>{this._onTrack(e)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&"open"===this._channel.readyState}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(e){if(!this.destroying){if(this.destroyed)throw l(Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if("string"==typeof e)try{e=JSON.parse(e)}catch(t){e={}}this._debug("signal()"),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(e)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(e=>{this._addIceCandidate(e)}),this._pendingCandidates=[],"offer"===this._pc.remoteDescription.type&&this._createAnswer())}).catch(e=>{this.destroy(l(e,"ERR_SET_REMOTE_DESCRIPTION"))}),e.sdp||e.candidate||e.renegotiate||e.transceiverRequest||this.destroy(l(Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(e){let t=new this._wrtc.RTCIceCandidate(e);this._pc.addIceCandidate(t).catch(e=>{!t.address||t.address.endsWith(".local")?console.warn("Ignoring unsupported ICE candidate."):this.destroy(l(e,"ERR_ADD_ICE_CANDIDATE"))})}send(e){if(!this.destroying){if(this.destroyed)throw l(Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(e)}}addTransceiver(e,t){if(!this.destroying){if(this.destroyed)throw l(Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(e,t),this._needsNegotiation()}catch(e){this.destroy(l(e,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:e,init:t}})}}addStream(e){if(!this.destroying){if(this.destroyed)throw l(Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),e.getTracks().forEach(t=>{this.addTrack(t,e)})}}addTrack(e,t){if(this.destroying)return;if(this.destroyed)throw l(Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");let r=this._senderMap.get(e)||new Map,n=r.get(t);if(n){if(n.removed)throw l(Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED");throw l(Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}n=this._pc.addTrack(e,t),r.set(t,n),this._senderMap.set(e,r),this._needsNegotiation()}replaceTrack(e,t,r){if(this.destroying)return;if(this.destroyed)throw l(Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");let n=this._senderMap.get(e),i=n?n.get(r):null;if(!i)throw l(Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");t&&this._senderMap.set(t,n),null==i.replaceTrack?this.destroy(l(Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK")):i.replaceTrack(t)}removeTrack(e,t){if(this.destroying)return;if(this.destroyed)throw l(Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");let r=this._senderMap.get(e),n=r?r.get(t):null;if(!n)throw l(Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{n.removed=!0,this._pc.removeTrack(n)}catch(e){"NS_ERROR_UNEXPECTED"===e.name?this._sendersAwaitingStable.push(n):this.destroy(l(e,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(e){if(!this.destroying){if(this.destroyed)throw l(Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),e.getTracks().forEach(t=>{this.removeTrack(t,e)})}}_needsNegotiation(){this._debug("_needsNegotiation"),this._batchedNegotiation||(this._batchedNegotiation=!0,o(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this.destroying){if(this.destroyed)throw l(Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}destroy(e){this._destroy(e,()=>{})}_destroy(e,t){this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",e&&(e.message||e)),o(()=>{if(this.destroyed=!0,this.destroying=!1,this._debug("destroy (error: %s)",e&&(e.message||e)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch(e){}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch(e){}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,e&&this.emit("error",e),this.emit("close"),t()}))}_setupData(e){if(!e.channel)return this.destroy(l(Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=e.channel,this._channel.binaryType="arraybuffer","number"==typeof this._channel.bufferedAmountLowThreshold&&(this._channel.bufferedAmountLowThreshold=65536),this.channelName=this._channel.label,this._channel.onmessage=e=>{this._onChannelMessage(e)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=e=>{let t=e.error instanceof Error?e.error:Error(`Datachannel error: ${e.message} ${e.filename}:${e.lineno}:${e.colno}`);this.destroy(l(t,"ERR_DATA_CHANNEL"))};let t=!1;this._closingInterval=setInterval(()=>{this._channel&&"closing"===this._channel.readyState?(t&&this._onChannelClose(),t=!0):t=!1},5e3)}_read(){}_write(e,t,r){if(this.destroyed)return r(l(Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(e)}catch(e){return this.destroy(l(e,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>65536?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=r):r(null)}else this._debug("write before connect"),this._chunk=e,this._cb=r}_onFinish(){if(!this.destroyed){let e=()=>{setTimeout(()=>this.destroy(),1e3)};this._connected?e():this.once("connect",e)}}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(e=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(e.sdp=r(e.sdp)),e.sdp=this.sdpTransform(e.sdp);let t=()=>{if(!this.destroyed){let t=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:t.type,sdp:t.sdp})}};this._pc.setLocalDescription(e).then(()=>{this._debug("createOffer success"),this.destroyed||(this.trickle||this._iceComplete?t():this.once("_iceComplete",t))}).catch(e=>{this.destroy(l(e,"ERR_SET_LOCAL_DESCRIPTION"))})}).catch(e=>{this.destroy(l(e,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(e=>{e.mid||!e.sender.track||e.requested||(e.requested=!0,this.addTransceiver(e.sender.track.kind))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(e=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(e.sdp=r(e.sdp)),e.sdp=this.sdpTransform(e.sdp);let t=()=>{if(!this.destroyed){let t=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:t.type,sdp:t.sdp}),this.initiator||this._requestMissingTransceivers()}};this._pc.setLocalDescription(e).then(()=>{this.destroyed||(this.trickle||this._iceComplete?t():this.once("_iceComplete",t))}).catch(e=>{this.destroy(l(e,"ERR_SET_LOCAL_DESCRIPTION"))})}).catch(e=>{this.destroy(l(e,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||"failed"===this._pc.connectionState&&this.destroy(l(Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;let e=this._pc.iceConnectionState,t=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,t),this.emit("iceStateChange",e,t),("connected"===e||"completed"===e)&&(this._pcReady=!0,this._maybeReady()),"failed"===e&&this.destroy(l(Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),"closed"===e&&this.destroy(l(Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(e){let t=e=>("[object Array]"===Object.prototype.toString.call(e.values)&&e.values.forEach(t=>{Object.assign(e,t)}),e);0===this._pc.getStats.length||this._isReactNativeWebrtc?this._pc.getStats().then(r=>{let n=[];r.forEach(e=>{n.push(t(e))}),e(null,n)},t=>e(t)):0<this._pc.getStats.length?this._pc.getStats(r=>{if(this.destroyed)return;let n=[];r.result().forEach(e=>{let r={};e.names().forEach(t=>{r[t]=e.stat(t)}),r.id=e.id,r.type=e.type,r.timestamp=e.timestamp,n.push(t(r))}),e(null,n)},t=>e(t)):e(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;let e=()=>{this.destroyed||this.getStats((t,r)=>{if(this.destroyed)return;t&&(r=[]);let n={},i={},s={},a=!1;r.forEach(e=>{("remotecandidate"===e.type||"remote-candidate"===e.type)&&(n[e.id]=e),("localcandidate"===e.type||"local-candidate"===e.type)&&(i[e.id]=e),("candidatepair"===e.type||"candidate-pair"===e.type)&&(s[e.id]=e)});let o=e=>{a=!0;let t=i[e.localCandidateId];t&&(t.ip||t.address)?(this.localAddress=t.ip||t.address,this.localPort=+t.port):t&&t.ipAddress?(this.localAddress=t.ipAddress,this.localPort=+t.portNumber):"string"==typeof e.googLocalAddress&&(t=e.googLocalAddress.split(":"),this.localAddress=t[0],this.localPort=+t[1]),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let r=n[e.remoteCandidateId];r&&(r.ip||r.address)?(this.remoteAddress=r.ip||r.address,this.remotePort=+r.port):r&&r.ipAddress?(this.remoteAddress=r.ipAddress,this.remotePort=+r.portNumber):"string"==typeof e.googRemoteAddress&&(r=e.googRemoteAddress.split(":"),this.remoteAddress=r[0],this.remotePort=+r[1]),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(r.forEach(e=>{"transport"===e.type&&e.selectedCandidatePairId&&o(s[e.selectedCandidatePairId]),("googCandidatePair"===e.type&&"true"===e.googActiveConnection||("candidatepair"===e.type||"candidate-pair"===e.type)&&e.selected)&&o(e)}),!a&&(!Object.keys(s).length||Object.keys(i).length))return void setTimeout(e,100);if(this._connecting=!1,this._connected=!0,this._chunk){try{this.send(this._chunk)}catch(e){return this.destroy(l(e,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');let e=this._cb;this._cb=null,e(null)}"number"!=typeof this._channel.bufferedAmountLowThreshold&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};e()}_onInterval(){this._cb&&this._channel&&!(this._channel.bufferedAmount>65536)&&this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||("stable"===this._pc.signalingState&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(e=>{this._pc.removeTrack(e),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):e.candidate||this._iceComplete||(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(e){if(this.destroyed)return;let t=e.data;t instanceof ArrayBuffer&&(t=h.from(t)),this.push(t)}_onChannelBufferedAmountLow(){if(!this.destroyed&&this._cb){this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);let e=this._cb;this._cb=null,e(null)}}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.destroy())}_onTrack(e){this.destroyed||e.streams.forEach(t=>{this._debug("on track"),this.emit("track",e.track,t),this._remoteTracks.push({track:e.track,stream:t}),this._remoteStreams.some(e=>e.id===t.id)||(this._remoteStreams.push(t),o(()=>{this._debug("on stream"),this.emit("stream",t)}))})}_debug(){let e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],n.apply(null,e)}}c.WEBRTC_SUPPORT=!!i(),c.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},c.channelConfig={},t.exports=c},{buffer:3,debug:4,"err-code":6,"get-browser-rtc":8,"queue-microtask":13,randombytes:14,"readable-stream":29}]},{},[])("/");const pR=(e,t)=>{ld(e,0),ly(e,u_(t))},pL=(e,t,r)=>{ld(e,1),ly(e,uf(t,r))},pI=(e,t,r)=>pL(t,r,lG(e)),pP=(e,t,r)=>{try{uu(t,lG(e),r)}catch(e){console.error("Caught error while handling a Yjs update",e)}},pk=(e,t)=>{ld(e,2),ly(e,t)},pD=(e,t,r,n)=>{let i=lV(e);switch(i){case 0:pI(e,t,r);break;case 1:case 2:pP(e,r,n);break;default:throw Error("Unknown message type")}return i};class pU extends oK{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{let e=l3();null!==this.getLocalState()&&15e3<=e-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());let t=[];this.meta.forEach((r,n)=>{n!==this.clientID&&3e4<=e-r.lastUpdated&&this.states.has(n)&&t.push(n)}),t.length>0&&pO(this,t,"timeout")},oQ(3e3)),e.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){let t=this.clientID,r=this.meta.get(t),n=void 0===r?0:r.clock+1,i=this.states.get(t);null===e?this.states.delete(t):this.states.set(t,e),this.meta.set(t,{clock:n,lastUpdated:l3()});let s=[],a=[],o=[],l=[];null===e?l.push(t):null==i?null!=e&&s.push(t):(a.push(t),hm(i,e)||o.push(t)),(s.length>0||o.length>0||l.length>0)&&this.emit("change",[{added:s,updated:o,removed:l},"local"]),this.emit("update",[{added:s,updated:a,removed:l},"local"])}setLocalStateField(e,t){let r=this.getLocalState();null!==r&&this.setLocalState({...r,[e]:t})}getStates(){return this.states}}const pO=(e,t,r)=>{let n=[];for(let r=0;r<t.length;r++){let i=t[r];if(e.states.has(i)){if(e.states.delete(i),i===e.clientID){let t=e.meta.get(i);e.meta.set(i,{clock:t.clock+1,lastUpdated:l3()})}n.push(i)}}n.length>0&&(e.emit("change",[{added:[],updated:[],removed:n},r]),e.emit("update",[{added:[],updated:[],removed:n},r]))},pN=(e,t,r=e.states)=>{let n=t.length,i=lo();ld(i,n);for(let s=0;s<n;s++){let n=t[s],a=r.get(n)||null,o=e.meta.get(n).clock;ld(i,n),ld(i,o),lg(i,JSON.stringify(a))}return lh(i)},pF=(e,t,r)=>{let n=lF(t),i=l3(),s=[],a=[],o=[],l=[],h=lV(n);for(let t=0;t<h;t++){let t=lV(n),r=lV(n),h=JSON.parse(lj(n)),c=e.meta.get(t),u=e.states.get(t),d=void 0===c?0:c.clock;(d<r||d===r&&null===h&&e.states.has(t))&&(null===h?t===e.clientID&&null!=e.getLocalState()?r++:e.states.delete(t):e.states.set(t,h),e.meta.set(t,{clock:r,lastUpdated:i}),void 0===c&&null!==h?s.push(t):void 0!==c&&null===h?l.push(t):null!==h&&(hm(h,u)||o.push(t),a.push(t)))}(s.length>0||o.length>0||l.length>0)&&e.emit("change",[{added:s,updated:o,removed:l},r]),(s.length>0||a.length>0||l.length>0)&&e.emit("update",[{added:s,updated:a,removed:l},r])},pB=(e,t)=>{let r=li(e).buffer,n=li(t).buffer;return crypto.subtle.importKey("raw",r,"PBKDF2",!1,["deriveKey"]).then(e=>crypto.subtle.deriveKey({name:"PBKDF2",salt:n,iterations:1e5,hash:"SHA-256"},e,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]))},pz=(e,t)=>{if(!t)return l6(e);let r=crypto.getRandomValues(new Uint8Array(12));return crypto.subtle.encrypt({name:"AES-GCM",iv:r},t,e).then(e=>{let t=lo();return lg(t,"AES-GCM"),ly(t,r),ly(t,new Uint8Array(e)),lh(t)})},pG=(e,t)=>{let r=lo();return lT(r,e),pz(lh(r),t)},pH=(e,t)=>{if(!t)return l6(e);let r=lF(e);"AES-GCM"!==lj(r)&&l5(lP("Unknown encryption algorithm"));let n=lG(r),i=lG(r);return crypto.subtle.decrypt({name:"AES-GCM",iv:n},t,i).then(e=>new Uint8Array(e))},pV=(e,t)=>pH(e,t).then(e=>lY(lF(new Uint8Array(e)))),pW=((e,t)=>{let r=cO[cN],n=hk("log"),i=null!==n&&("*"===n||"true"===n||RegExp(n,"gi").test(t));return cN=(cN+1)%cO.length,t+=": ",i?(...n)=>{1===n.length&&n[0]?.constructor===Function&&(n=n[0]());let i=l3(),s=i-cF;cF=i,e(r,t,cU,...n.map(e=>{switch(null!=e&&e.constructor===Uint8Array&&(e=Array.from(e)),typeof e){case"string":case"symbol":return e;default:return cM(e)}}),r," +"+s+"ms")}:hd})(cG,"y-webrtc"),pj=new Map,pq=new Map,pX=e=>{let t=!0;e.webrtcConns.forEach(e=>{e.synced||(t=!1)}),(!t&&e.synced||t&&!e.synced)&&(e.synced=t,e.provider.emit("synced",[{synced:t}]),pW("synced ",cA,e.name,cC," with all peers"))},pY=(e,t,r)=>{let n=lF(t),i=lo(),s=lV(n);if(void 0===e)return null;let a=e.awareness,o=e.doc,l=!1;switch(s){case 0:{ld(i,0);let t=pD(n,i,o,e);1!==t||e.synced||r(),0===t&&(l=!0);break}case 3:ld(i,1),ly(i,pN(a,Array.from(a.getStates().keys()))),l=!0;break;case 1:pF(a,lG(n),e);break;case 4:{let t=1===lH(n),r=lj(n);if(r!==e.peerId&&(e.bcConns.has(r)&&!t||!e.bcConns.has(r)&&t)){let n=[],i=[];t?(e.bcConns.add(r),i.push(r)):(e.bcConns.delete(r),n.push(r)),e.provider.emit("peers",[{added:i,removed:n,webrtcPeers:Array.from(e.webrtcConns.keys()),bcPeers:Array.from(e.bcConns)}]),p2(e)}break}default:return console.error("Unable to compute message"),i}return l?i:null},pJ=(e,t)=>{let r=e.room;return pW("received message from ",cA,e.remotePeerId,cL," (",r.name,")",cC,cU),pY(r,t,()=>{e.synced=!0,pW("synced ",cA,r.name,cC," with ",cA,e.remotePeerId),pX(r)})},pZ=(e,t)=>{pW("send message to ",cA,e.remotePeerId,cC,cL," (",e.room.name,")",cU);try{e.peer.send(lh(t))}catch(e){}},p$=(e,t)=>{pW("broadcast message in ",cA,e.name,cC),e.webrtcConns.forEach(e=>{try{e.peer.send(t)}catch(e){}})};class pK{constructor(e,t,r,n){var i;pW("establishing connection to ",cA,r),this.room=n,this.remotePeerId=r,this.glareToken=void 0,this.closed=!1,this.connected=!1,this.synced=!1,this.peer=new((i=pC)&&i.__esModule?i.default:i)({initiator:t,...n.provider.peerOpts}),this.peer.on("signal",t=>{void 0===this.glareToken&&(this.glareToken=Date.now()+Math.random()),p5(e,n,{to:r,from:n.peerId,type:"signal",token:this.glareToken,signal:t})}),this.peer.on("connect",()=>{pW("connected to ",cA,r),this.connected=!0;let e=n.provider.doc,t=n.awareness,i=lo();ld(i,0),pR(i,e),pZ(this,i);let s=t.getStates();if(s.size>0){let e=lo();ld(e,1),ly(e,pN(t,Array.from(s.keys()))),pZ(this,e)}}),this.peer.on("close",()=>{this.connected=!1,this.closed=!0,n.webrtcConns.has(this.remotePeerId)&&(n.webrtcConns.delete(this.remotePeerId),n.provider.emit("peers",[{removed:[this.remotePeerId],added:[],webrtcPeers:Array.from(n.webrtcConns.keys()),bcPeers:Array.from(n.bcConns)}])),pX(n),this.peer.destroy(),pW("closed connection to ",cA,r),p1(n)}),this.peer.on("error",e=>{pW("Error in connection to ",cA,r,": ",e),p1(n)}),this.peer.on("data",e=>{let t=pJ(this,e);null!==t&&pZ(this,t)})}destroy(){this.peer.destroy()}}const pQ=(e,t)=>pz(t,e.key).then(t=>e.mux(()=>pE(e.name,t))),p0=(e,t)=>{e.bcconnected&&pQ(e,t),p$(e,t)},p1=e=>{pj.forEach(t=>{t.connected&&(t.send({type:"subscribe",topics:[e.name]}),e.webrtcConns.size<e.provider.maxConns&&p5(t,e,{type:"announce",from:e.peerId}))})},p2=e=>{if(e.provider.filterBcConns){let t=lo();ld(t,4),lu(t,1),lg(t,e.peerId),pQ(e,lh(t))}};class p3{constructor(e,t,r,n){this.peerId=l2(),this.doc=e,this.awareness=t.awareness,this.provider=t,this.synced=!1,this.name=r,this.key=n,this.webrtcConns=new Map,this.bcConns=new Set,this.mux=pA(),this.bcconnected=!1,this._bcSubscriber=e=>pH(new Uint8Array(e),n).then(e=>this.mux(()=>{let t=pY(this,e,()=>{});t&&pQ(this,lh(t))})),this._docUpdateHandler=(e,t)=>{let r=lo();ld(r,0),pk(r,e),p0(this,lh(r))},this._awarenessUpdateHandler=({added:e,updated:t,removed:r},n)=>{let i=e.concat(t).concat(r),s=lo();ld(s,1),ly(s,pN(this.awareness,i)),p0(this,lh(s))},this._beforeUnloadHandler=()=>{pO(this.awareness,[e.clientID],"window unload"),pq.forEach(e=>{e.disconnect()})},"undefined"!=typeof window?window.addEventListener("beforeunload",this._beforeUnloadHandler):void 0!==hg&&hg.on("exit",this._beforeUnloadHandler)}connect(){this.doc.on("update",this._docUpdateHandler),this.awareness.on("update",this._awarenessUpdateHandler),p1(this),pM(this.name,this._bcSubscriber),this.bcconnected=!0,p2(this);let e=lo();ld(e,0),pR(e,this.doc),pQ(this,lh(e));let t=lo();ld(t,0),pL(t,this.doc),pQ(this,lh(t));let r=lo();ld(r,3),pQ(this,lh(r));let n=lo();ld(n,1),ly(n,pN(this.awareness,[this.doc.clientID])),pQ(this,lh(n))}disconnect(){pj.forEach(e=>{e.connected&&e.send({type:"unsubscribe",topics:[this.name]})}),pO(this.awareness,[this.doc.clientID],"disconnect");let e=lo();ld(e,4),lu(e,0),lg(e,this.peerId),pQ(this,lh(e)),pT(this.name,this._bcSubscriber),this.bcconnected=!1,this.doc.off("update",this._docUpdateHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.webrtcConns.forEach(e=>e.destroy())}destroy(){this.disconnect(),"undefined"!=typeof window?window.removeEventListener("beforeunload",this._beforeUnloadHandler):void 0!==hg&&hg.off("exit",this._beforeUnloadHandler)}}const p4=(e,t,r,n)=>{if(pq.has(r))throw lP(`A Yjs Doc connected to room "${r}" already exists!`);let i=new p3(e,t,r,n);return pq.set(r,i),i},p5=(e,t,r)=>{t.key?pG(r,t.key).then(r=>{e.send({type:"publish",topic:t.name,data:cv(r)})}):e.send({type:"publish",topic:t.name,data:r})};class p6 extends p_{constructor(e){super(e),this.providers=new Set,this.on("connect",()=>{pW(`connected (${e})`);let t=Array.from(pq.keys());this.send({type:"subscribe",topics:t}),pq.forEach(e=>p5(this,e,{type:"announce",from:e.peerId}))}),this.on("message",e=>{if("publish"===e.type){let t=e.topic,r=pq.get(t);if(null==r||"string"!=typeof t)return;let n=e=>{let t=r.webrtcConns,n=r.peerId;if(null==e||e.from===n||void 0!==e.to&&e.to!==n||r.bcConns.has(e.from))return;let i=t.has(e.from)?()=>{}:()=>r.provider.emit("peers",[{removed:[],added:[e.from],webrtcPeers:Array.from(r.webrtcConns.keys()),bcPeers:Array.from(r.bcConns)}]);switch(e.type){case"announce":t.size<r.provider.maxConns&&(oV(t,e.from,()=>new pK(this,!0,e.from,r)),i());break;case"signal":if("offer"===e.signal.type){let r=t.get(e.from);if(r){let t=e.token,n=r.glareToken;if(n&&n>t){pW("offer rejected: ",e.from);return}r.glareToken=void 0}}"answer"===e.signal.type&&(pW("offer answered by: ",e.from),t.get(e.from).glareToken=void 0),e.to===n&&(oV(t,e.from,()=>new pK(this,!1,e.from,r)).peer.signal(e.signal),i())}};r.key?"string"==typeof e.data&&pV(cy(e.data),r.key).then(n):n(e.data)}}),this.on("disconnect",()=>pW(`disconnect (${e})`))}}const p8=e=>{e.emit("status",[{connected:e.connected}])};class p7 extends o${constructor(e,t,{signaling:r=["wss://y-webrtc-eu.fly.dev"],password:n=null,awareness:i=new pU(t),maxConns:s=20+oQ(15*l0()),filterBcConns:a=!0,peerOpts:o={}}={}){super(),this.roomName=e,this.doc=t,this.filterBcConns=a,this.awareness=i,this.shouldConnect=!1,this.signalingUrls=r,this.signalingConns=[],this.maxConns=s,this.peerOpts=o,this.key=n?pB(n,e):l6(null),this.room=null,this.key.then(r=>{this.room=p4(t,this,e,r),this.shouldConnect?this.room.connect():this.room.disconnect(),p8(this)}),this.connect(),this.destroy=this.destroy.bind(this),t.on("destroy",this.destroy)}get connected(){return null!==this.room&&this.shouldConnect}connect(){this.shouldConnect=!0,this.signalingUrls.forEach(e=>{let t=oV(pj,e,()=>new p6(e));this.signalingConns.push(t),t.providers.add(this)}),this.room&&(this.room.connect(),p8(this))}disconnect(){this.shouldConnect=!1,this.signalingConns.forEach(e=>{e.providers.delete(this),0===e.providers.size&&(e.destroy(),pj.delete(e.url))}),this.room&&(this.room.disconnect(),p8(this))}destroy(){this.doc.off("destroy",this.destroy),this.key.then(()=>{this.room.destroy(),pq.delete(this.roomName)}),super.destroy()}}async function p9(e){O&&(N.destroy(),O.destroy()),N=new p7(`everything-exhibition-group-${e}`,new c5,{signaling:["wss://demos.yjs.dev/ws"]}),console.log("groupID",e),(O=N.awareness).on("change",async()=>{await g_(O.getStates(),O.clientID)})}async function fe(e,t){k&&(D.destroy(),k.destroy());let r=new c5;U=r.getArray("sketch"),D=new p7(`everything-exhibition-room-${e}-${t}`,r,{signaling:["wss://demos.yjs.dev/ws"]}),console.log("roomname",`everything-exhibition-room-${e}-${t}`),(k=D.awareness).on("change",async()=>{await gn(k.getStates(),k.clientID),await function(e,t){let r=document.getElementById("marker-canvas"),n=r.getContext("2d");n.clearRect(0,0,n.canvas.width,n.canvas.height);let i=n.canvas.width,s=r.dataset.centerX,a=r.dataset.centerZ,o=r.dataset.scale;for(let[r,l]of e)if(l.transformation){let e=l.transformation.position.x,h=l.transformation.position.z,c=i/2-(s-e)/o,u=i/2-(a-h)/o,d=r==t?i/30:i/40;n.fillStyle=l.color;let p=l.transformation.rotation,f=-Math.atan2(p.x,p.z);n.save(),n.translate(c,u),n.rotate(f),n.translate(0,d/Math.sqrt(2)),n.rotate(Math.PI/4),n.fillStyle=l.color,n.fillRect(-d/2,-d/2,d,d),n.restore(),n.beginPath(),n.arc(c,u,d,0,2*Math.PI),n.fill()}}(k.getStates(),k.clientID)}),U.observe(gi)}function ft(){var e,t=0,r=[],n=0,i=0,s=d(function(e){i||o(1,e)}),a=d(function(e){i||o(-1,e)});function o(r,n){i++;var s=0;try{n===m&&p();var a=r>0&&u(n);a?a.call(n,d(function(e){s++,o(1,e)}),d(function(e){s++,o(-1,e)})):(t=r,e=n,l())}catch(e){t||s||o(-1,e)}}function l(){n||(setTimeout(h,0),n=1)}function h(){var e=r;n=0,r=[],e.forEach(c)}function c(e){e()}function u(e){var t=e&&(f(e)||"object"==typeof e)&&e.then;return f(t)&&t}function d(e){var t=0;return function(){for(var r=[],n=arguments.length;n--;)r[n]=arguments[n];t++||e.apply(this,r)}}function p(){throw TypeError("Chaining cycle detected")}var f=function(e){return"function"==typeof e},m={then:function(n,i){var s=ft();return r.push(function(){var r=t>0?n:i;if(f(r))try{var a=r(e);a===s&&p();var o=u(a);o?o.call(a,s.resolve,s.reject):s.resolve(a)}catch(e){s.reject(e)}else s[t>0?"resolve":"reject"](e)}),t&&l(),s},resolve:s,reject:a};return m}function fr(){var e,t,r=new Promise(function(r,n){e=r,t=n});return{then:r.then.bind(r),resolve:e,reject:t}}ft.all=fr.all=function(e){var t=0,r=[],n=fn();return 0===e.length?n.resolve([]):e.forEach(function(i,s){var a=fn();a.resolve(i),a.then(function(i){t++,r[s]=i,t===e.length&&n.resolve(r)},n.reject)}),n};var fn="function"==typeof Promise?fr:ft;function fi(){var e=Object.create(null);function t(e,t){var r=void 0;self.troikaDefine=function(e){return r=e};var n=URL.createObjectURL(new Blob(["/** "+e.replace(/\*/g,"")+" **/\n\ntroikaDefine(\n"+t+"\n)"],{type:"application/javascript"}));try{importScripts(n)}catch(e){console.error(e)}return URL.revokeObjectURL(n),delete self.troikaDefine,r}self.addEventListener("message",function(r){var n=r.data,i=n.messageId,s=n.action,a=n.data;try{"registerModule"===s&&function r(n,i){var s=n.id,a=n.name,o=n.dependencies;void 0===o&&(o=[]);var l=n.init;void 0===l&&(l=function(){});var h=n.getTransferables;if(void 0===h&&(h=null),!e[s])try{o=o.map(function(t){return t&&t.isWorkerModule&&(r(t,function(e){if(e instanceof Error)throw e}),t=e[t.id].value),t}),l=t("<"+a+">.init",l),h&&(h=t("<"+a+">.getTransferables",h));var c=null;"function"==typeof l?c=l.apply(void 0,o):console.error("worker module init function failed to rehydrate"),e[s]={id:s,value:c,getTransferables:h},i(c)}catch(e){e&&e.noLog||console.error(e),i(e)}}(a,function(e){e instanceof Error?postMessage({messageId:i,success:!1,error:e.message}):postMessage({messageId:i,success:!0,result:{isCallable:"function"==typeof e}})}),"callModule"===s&&function(t,r){var n,i=t.id,s=t.args;e[i]&&"function"==typeof e[i].value||r(Error("Worker module "+i+": not found or its 'init' did not return a function"));try{var a=(n=e[i]).value.apply(n,s);a&&"function"==typeof a.then?a.then(o,function(e){return r(e instanceof Error?e:Error(""+e))}):o(a)}catch(e){r(e)}function o(t){try{var n=e[i].getTransferables&&e[i].getTransferables(t);n&&Array.isArray(n)&&n.length||(n=void 0),r(t,n)}catch(e){console.error(e),r(e)}}}(a,function(e,t){e instanceof Error?postMessage({messageId:i,success:!1,error:e.message}):postMessage({messageId:i,success:!0,result:e},t||void 0)})}catch(e){postMessage({messageId:i,success:!1,error:e.stack})}})}var fs=function(){var e=!1;if("undefined"!=typeof window&&void 0!==window.document)try{new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"}))).terminate(),e=!0}catch(e){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+e.message+"]")}return fs=function(){return e},e},fa=0,fo=0,fl=!1,fh=Object.create(null),fc=Object.create(null),fu=Object.create(null);function fd(e){if((!e||"function"!=typeof e.init)&&!fl)throw Error("requires `options.init` function");var t,r=e.dependencies,n=e.init,i=e.getTransferables,s=e.workerId;if(!fs())return(t=function(){for(var e=[],r=arguments.length;r--;)e[r]=arguments[r];return t._getInitResult().then(function(t){if("function"==typeof t)return t.apply(void 0,e);throw Error("Worker module function was called but `init` did not return a callable function")})})._getInitResult=function(){var r=e.dependencies,n=e.init;r=Array.isArray(r)?r.map(function(e){return e&&e._getInitResult?e._getInitResult():e}):[];var i=fn.all(r).then(function(e){return n.apply(null,e)});return t._getInitResult=function(){return i},i},t;null==s&&(s="#default");var a="workerModule"+ ++fa,o=e.name||a,l=null;function h(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];if(!l){l=ff(s,"registerModule",h.workerModuleData);var r=function(){l=null,fc[s].delete(r)};(fc[s]||(fc[s]=new Set)).add(r)}return l.then(function(t){if(t.isCallable)return ff(s,"callModule",{id:a,args:e});throw Error("Worker module function was called but `init` did not return a callable function")})}return r=r&&r.map(function(e){return"function"!=typeof e||e.workerModuleData||(fl=!0,e=fd({workerId:s,name:"<"+o+"> function dependency: "+e.name,init:"function(){return (\n"+fp(e)+"\n)}"}),fl=!1),e&&e.workerModuleData&&(e=e.workerModuleData),e}),h.workerModuleData={isWorkerModule:!0,id:a,name:o,dependencies:r,init:fp(n),getTransferables:i&&fp(i)},h}function fp(e){var t=e.toString();return!/^function/.test(t)&&/^\w+\s*\(/.test(t)&&(t="function "+t),t}function ff(e,t,r){var n=fn(),i=++fo;return fu[i]=function(e){e.success?n.resolve(e.result):n.reject(Error("Error in worker "+t+" call: "+e.error))},(function(e){var t=fh[e];if(!t){var r=fp(fi);(t=fh[e]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+e.replace(/\*/g,"")+" **/\n\n;("+r+")()"],{type:"application/javascript"})))).onmessage=function(e){var t=e.data,r=t.messageId,n=fu[r];if(!n)throw Error("WorkerModule response with empty or unknown messageId");delete fu[r],n(t)}}return t})(e).postMessage({messageId:i,action:t,data:r}),n}var fm=fd({name:"Thenable",dependencies:[fn],init:function(e){return e}});const fg=/\bvoid\s+main\s*\(\s*\)\s*{/g;function fv(e){return e.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,function(e,t){let r=rA[t];return r?fv(r):e})}const fy=[];for(let e=0;e<256;e++)fy[e]=(e<16?"0":"")+e.toString(16);const fx=Object.assign||function(){let e=arguments[0];for(let t=1,r=arguments.length;t<r;t++){let r=arguments[t];if(r)for(let t in r)r.hasOwnProperty(t)&&(e[t]=r[t])}return e},f_=Date.now(),fb=new WeakMap,fw=new Map;let fS=1e10;function fM(e,t,r,n,i){return(n||i||r)&&(e=e.replace(fg,`
${r}
void troikaOrigMain${t}() {`)+`
void main() {
  ${n}
  troikaOrigMain${t}();
  ${i}
}`),e}function fT(e,t){return"uniforms"===e?void 0:"function"==typeof t?t.toString():t}let fE=0;const fA=new Map;function fC(e){function t(){return(self.performance||Date).now()}return function(r,n,i,s,a,o=1){let l,h,c,u,d;let p=t(),f=new Uint8Array(r*n),m=s[2]-s[0],g=s[3]-s[1],v=e(s),y=/([MLQCZ])([^MLQCZ]*)/g;for(;l=y.exec(i);){let e=l[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(e=>parseFloat(e));switch(l[1]){case"M":u=h=e[0],d=c=e[1];break;case"L":(e[0]!==u||e[1]!==d)&&v.addLineSegment(u,d,u=e[0],d=e[1]);break;case"Q":{let t={x:u,y:d};for(let r=1;r<16;r++){let n=function(e,t,r,n,i,s,a){let o=1-a;return{x:o*o*e+2*o*a*r+a*a*i,y:o*o*t+2*o*a*n+a*a*s}}(u,d,e[0],e[1],e[2],e[3],r/15);v.addLineSegment(t.x,t.y,n.x,n.y),t=n}u=e[2],d=e[3];break}case"C":{let t={x:u,y:d};for(let r=1;r<16;r++){let n=function(e,t,r,n,i,s,a,o,l){let h=1-l;return{x:h*h*h*e+3*h*h*l*r+3*h*l*l*i+l*l*l*a,y:h*h*h*t+3*h*h*l*n+3*h*l*l*s+l*l*l*o}}(u,d,e[0],e[1],e[2],e[3],e[4],e[5],r/15);v.addLineSegment(t.x,t.y,n.x,n.y),t=n}u=e[4],d=e[5];break}case"Z":(u!==h||d!==c)&&v.addLineSegment(u,d,h,c)}}for(let e=0;e<r;e++)for(let t=0;t<n;t++){let i=v.findNearestSignedDistance(s[0]+m*(e+.5)/r,s[1]+g*(t+.5)/n,a),l=Math.pow(1-Math.abs(i)/a,o)/2;i<0&&(l=1-l),l=Math.max(0,Math.min(255,Math.round(255*l))),f[t*r+e]=l}return{textureData:f,timing:t()-p}}}function fR(e){let t=!1,r=[];function n(){t&&(r.sort(function(e,t){return e.maxX-t.maxX}),t=!1)}return{addLineSegment:function(e,n,i,s){r.push({x0:e,y0:n,x1:i,y1:s,minX:Math.min(e,i),minY:Math.min(n,s),maxX:Math.max(e,i),maxY:Math.max(n,s)}),t=!0},findNearestSignedDistance:function(e,t){n();let i=1/0,s=1/0;for(let n=r.length;n--;){let a=r[n];if(a.maxX+s<=e)break;if(e+s>a.minX&&t-s<a.maxY&&t+s>a.minY){let r=function(e,t,r,n,i,s){let a=i-r,o=s-n,l=a*a+o*o,h=l?Math.max(0,Math.min(1,((e-r)*a+(t-n)*o)/l)):0,c=e-(r+h*a),u=t-(n+h*o);return c*c+u*u}(e,t,a.x0,a.y0,a.x1,a.y1);r<i&&(s=Math.sqrt(i=r))}}return function(e,t){n();let i=!1;for(let n=r.length;n--;){let s=r[n];if(s.maxX<=e)break;s.minY<t&&s.maxY>t&&s.y0>t!=s.y1>t&&e<(s.x1-s.x0)*(t-s.y0)/(s.y1-s.y0)+s.x0&&(i=!i)}return i}(e,t)&&(s=-s),s}}}const fL=fd({name:"Typr Font Parser",dependencies:[/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function(){var e,t,r;return"undefined"==typeof window&&(self.window=self),(e={},(t={parse:function(e){var r=t._bin,n=new Uint8Array(e);if("ttcf"==r.readASCII(n,0,4)){var i=4;r.readUshort(n,i),i+=2,r.readUshort(n,i),i+=2;var s=r.readUint(n,i);i+=4;for(var a=[],o=0;o<s;o++){var l=r.readUint(n,i);i+=4,a.push(t._readFont(n,l))}return a}return[t._readFont(n,0)]},_readFont:function(e,r){var n=t._bin,i=r;n.readFixed(e,r),r+=4;var s=n.readUshort(e,r);r+=2,n.readUshort(e,r),r+=2,n.readUshort(e,r),r+=2,n.readUshort(e,r),r+=2;for(var a=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GPOS","GSUB","SVG "],o={_data:e,_offset:i},l={},h=0;h<s;h++){var c=n.readASCII(e,r,4);r+=4,n.readUint(e,r),r+=4;var u=n.readUint(e,r);r+=4;var d=n.readUint(e,r);r+=4,l[c]={offset:u,length:d}}for(h=0;h<a.length;h++){var p=a[h];l[p]&&(o[p.trim()]=t[p.trim()].parse(e,l[p].offset,l[p].length,o))}return o},_tabOffset:function(e,r,n){for(var i=t._bin,s=i.readUshort(e,n+4),a=n+12,o=0;o<s;o++){var l=i.readASCII(e,a,4);a+=4,i.readUint(e,a),a+=4;var h=i.readUint(e,a);if(a+=4,i.readUint(e,a),a+=4,l==r)return h}return 0}})._bin={readFixed:function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<8|e[t+3])/65540},readF2dot14:function(e,r){return t._bin.readShort(e,r)/16384},readInt:function(e,r){return t._bin._view(e).getInt32(r)},readInt8:function(e,r){return t._bin._view(e).getInt8(r)},readShort:function(e,r){return t._bin._view(e).getInt16(r)},readUshort:function(e,r){return t._bin._view(e).getUint16(r)},readUshorts:function(e,r,n){for(var i=[],s=0;s<n;s++)i.push(t._bin.readUshort(e,r+2*s));return i},readUint:function(e,r){return t._bin._view(e).getUint32(r)},readUint64:function(e,r){return 4294967296*t._bin.readUint(e,r)+t._bin.readUint(e,r+4)},readASCII:function(e,t,r){for(var n="",i=0;i<r;i++)n+=String.fromCharCode(e[t+i]);return n},readUnicode:function(e,t,r){for(var n="",i=0;i<r;i++)n+=String.fromCharCode(e[t++]<<8|e[t++]);return n},_tdec:"undefined"!=typeof window&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(e,r,n){var i=t._bin._tdec;return i&&0==r&&n==e.length?i.decode(e):t._bin.readASCII(e,r,n)},readBytes:function(e,t,r){for(var n=[],i=0;i<r;i++)n.push(e[t+i]);return n},readASCIIArray:function(e,t,r){for(var n=[],i=0;i<r;i++)n.push(String.fromCharCode(e[t+i]));return n},_view:function(e){return e._dataView||(e._dataView=e.buffer?new DataView(e.buffer,e.byteOffset,e.byteLength):new DataView(new Uint8Array(e).buffer))}},t._lctf={},t._lctf.parse=function(e,r,n,i,s){var a=t._bin,o={},l=r;a.readFixed(e,r),r+=4;var h=a.readUshort(e,r);r+=2;var c=a.readUshort(e,r);r+=2;var u=a.readUshort(e,r);return r+=2,o.scriptList=t._lctf.readScriptList(e,l+h),o.featureList=t._lctf.readFeatureList(e,l+c),o.lookupList=t._lctf.readLookupList(e,l+u,s),o},t._lctf.readLookupList=function(e,r,n){var i=t._bin,s=r,a=[],o=i.readUshort(e,r);r+=2;for(var l=0;l<o;l++){var h=i.readUshort(e,r);r+=2;var c=t._lctf.readLookupTable(e,s+h,n);a.push(c)}return a},t._lctf.readLookupTable=function(e,r,n){var i=t._bin,s=r,a={tabs:[]};a.ltype=i.readUshort(e,r),r+=2,a.flag=i.readUshort(e,r),r+=2;var o=i.readUshort(e,r);r+=2;for(var l=a.ltype,h=0;h<o;h++){var c=i.readUshort(e,r);r+=2;var u=n(e,l,s+c,a);a.tabs.push(u)}return a},t._lctf.numOfOnes=function(e){for(var t=0,r=0;r<32;r++)0!=(e>>>r&1)&&t++;return t},t._lctf.readClassDef=function(e,r){var n=t._bin,i=[],s=n.readUshort(e,r);if(r+=2,1==s){var a=n.readUshort(e,r);r+=2;var o=n.readUshort(e,r);r+=2;for(var l=0;l<o;l++)i.push(a+l),i.push(a+l),i.push(n.readUshort(e,r)),r+=2}if(2==s){var h=n.readUshort(e,r);for(r+=2,l=0;l<h;l++)i.push(n.readUshort(e,r)),r+=2,i.push(n.readUshort(e,r)),r+=2,i.push(n.readUshort(e,r)),r+=2}return i},t._lctf.getInterval=function(e,t){for(var r=0;r<e.length;r+=3){var n=e[r],i=e[r+1];if(e[r+2],n<=t&&t<=i)return r}return -1},t._lctf.readCoverage=function(e,r){var n=t._bin,i={};i.fmt=n.readUshort(e,r),r+=2;var s=n.readUshort(e,r);return r+=2,1==i.fmt&&(i.tab=n.readUshorts(e,r,s)),2==i.fmt&&(i.tab=n.readUshorts(e,r,3*s)),i},t._lctf.coverageIndex=function(e,r){var n=e.tab;if(1==e.fmt)return n.indexOf(r);if(2==e.fmt){var i=t._lctf.getInterval(n,r);if(-1!=i)return n[i+2]+(r-n[i])}return -1},t._lctf.readFeatureList=function(e,r){var n=t._bin,i=r,s=[],a=n.readUshort(e,r);r+=2;for(var o=0;o<a;o++){var l=n.readASCII(e,r,4);r+=4;var h=n.readUshort(e,r);r+=2;var c=t._lctf.readFeatureTable(e,i+h);c.tag=l.trim(),s.push(c)}return s},t._lctf.readFeatureTable=function(e,r){var n=t._bin,i=r,s={},a=n.readUshort(e,r);r+=2,a>0&&(s.featureParams=i+a);var o=n.readUshort(e,r);r+=2,s.tab=[];for(var l=0;l<o;l++)s.tab.push(n.readUshort(e,r+2*l));return s},t._lctf.readScriptList=function(e,r){var n=t._bin,i=r,s={},a=n.readUshort(e,r);r+=2;for(var o=0;o<a;o++){var l=n.readASCII(e,r,4);r+=4;var h=n.readUshort(e,r);r+=2,s[l.trim()]=t._lctf.readScriptTable(e,i+h)}return s},t._lctf.readScriptTable=function(e,r){var n=t._bin,i=r,s={},a=n.readUshort(e,r);r+=2,s.default=t._lctf.readLangSysTable(e,i+a);var o=n.readUshort(e,r);r+=2;for(var l=0;l<o;l++){var h=n.readASCII(e,r,4);r+=4;var c=n.readUshort(e,r);r+=2,s[h.trim()]=t._lctf.readLangSysTable(e,i+c)}return s},t._lctf.readLangSysTable=function(e,r){var n=t._bin,i={};n.readUshort(e,r),r+=2,i.reqFeature=n.readUshort(e,r),r+=2;var s=n.readUshort(e,r);return r+=2,i.features=n.readUshorts(e,r,s),i},t.CFF={},t.CFF.parse=function(e,r,n){var i=t._bin;(e=new Uint8Array(e.buffer,r,n))[r=0],e[++r],e[++r],e[++r],r++;var s=[];r=t.CFF.readIndex(e,r,s);for(var a=[],o=0;o<s.length-1;o++)a.push(i.readASCII(e,r+s[o],s[o+1]-s[o]));r+=s[s.length-1];var l=[];r=t.CFF.readIndex(e,r,l);var h=[];for(o=0;o<l.length-1;o++)h.push(t.CFF.readDict(e,r+l[o],r+l[o+1]));r+=l[l.length-1];var c=h[0],u=[];r=t.CFF.readIndex(e,r,u);var d=[];for(o=0;o<u.length-1;o++)d.push(i.readASCII(e,r+u[o],u[o+1]-u[o]));if(r+=u[u.length-1],t.CFF.readSubrs(e,r,c),c.CharStrings){r=c.CharStrings,u=[],r=t.CFF.readIndex(e,r,u);var p=[];for(o=0;o<u.length-1;o++)p.push(i.readBytes(e,r+u[o],u[o+1]-u[o]));c.CharStrings=p}if(c.ROS){r=c.FDArray;var f=[];for(r=t.CFF.readIndex(e,r,f),c.FDArray=[],o=0;o<f.length-1;o++){var m=t.CFF.readDict(e,r+f[o],r+f[o+1]);t.CFF._readFDict(e,m,d),c.FDArray.push(m)}r+=f[f.length-1],r=c.FDSelect,c.FDSelect=[];var g=e[r];if(r++,3!=g)throw g;var v=i.readUshort(e,r);for(r+=2,o=0;o<v+1;o++)c.FDSelect.push(i.readUshort(e,r),e[r+2]),r+=3}return c.Encoding&&(c.Encoding=t.CFF.readEncoding(e,c.Encoding,c.CharStrings.length)),c.charset&&(c.charset=t.CFF.readCharset(e,c.charset,c.CharStrings.length)),t.CFF._readFDict(e,c,d),c},t.CFF._readFDict=function(e,r,n){var i;for(var s in r.Private&&(i=r.Private[1],r.Private=t.CFF.readDict(e,i,i+r.Private[0]),r.Private.Subrs&&t.CFF.readSubrs(e,i+r.Private.Subrs,r.Private)),r)-1!=["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(s)&&(r[s]=n[r[s]-426+35])},t.CFF.readSubrs=function(e,r,n){var i=t._bin,s=[];r=t.CFF.readIndex(e,r,s);var a,o=s.length;a=o<1240?107:o<33900?1131:32768,n.Bias=a,n.Subrs=[];for(var l=0;l<s.length-1;l++)n.Subrs.push(i.readBytes(e,r+s[l],s[l+1]-s[l]))},t.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],t.CFF.glyphByUnicode=function(e,t){for(var r=0;r<e.charset.length;r++)if(e.charset[r]==t)return r;return -1},t.CFF.glyphBySE=function(e,r){return r<0||r>255?-1:t.CFF.glyphByUnicode(e,t.CFF.tableSE[r])},t.CFF.readEncoding=function(e,r,n){t._bin;var i=[".notdef"],s=e[r];if(r++,0!=s)throw"error: unknown encoding format: "+s;var a=e[r];r++;for(var o=0;o<a;o++)i.push(e[r+o]);return i},t.CFF.readCharset=function(e,r,n){var i=t._bin,s=[".notdef"],a=e[r];if(r++,0==a)for(var o=0;o<n;o++){var l=i.readUshort(e,r);r+=2,s.push(l)}else{if(1!=a&&2!=a)throw"error: format: "+a;for(;s.length<n;){l=i.readUshort(e,r),r+=2;var h=0;for(1==a?(h=e[r],r++):(h=i.readUshort(e,r),r+=2),o=0;o<=h;o++)s.push(l),l++}}return s},t.CFF.readIndex=function(e,r,n){var i=t._bin,s=i.readUshort(e,r)+1,a=e[r+=2];if(r++,1==a)for(var o=0;o<s;o++)n.push(e[r+o]);else if(2==a)for(o=0;o<s;o++)n.push(i.readUshort(e,r+2*o));else if(3==a)for(o=0;o<s;o++)n.push(16777215&i.readUint(e,r+3*o-1));else if(1!=s)throw"unsupported offset size: "+a+", count: "+s;return(r+=s*a)-1},t.CFF.getCharString=function(e,r,n){var i=t._bin,s=e[r],a=e[r+1];e[r+2],e[r+3],e[r+4];var o=1,l=null,h=null;s<=20&&(l=s,o=1),12==s&&(l=100*s+a,o=2),21<=s&&s<=27&&(l=s,o=1),28==s&&(h=i.readShort(e,r+1),o=3),29<=s&&s<=31&&(l=s,o=1),32<=s&&s<=246&&(h=s-139,o=1),247<=s&&s<=250&&(h=256*(s-247)+a+108,o=2),251<=s&&s<=254&&(h=-(256*(s-251))-a-108,o=2),255==s&&(h=i.readInt(e,r+1)/65535,o=5),n.val=null!=h?h:"o"+l,n.size=o},t.CFF.readCharString=function(e,r,n){for(var i=r+n,s=t._bin,a=[];r<i;){var o=e[r],l=e[r+1];e[r+2],e[r+3],e[r+4];var h=1,c=null,u=null;o<=20&&(c=o,h=1),12==o&&(c=100*o+l,h=2),19!=o&&20!=o||(c=o,h=2),21<=o&&o<=27&&(c=o,h=1),28==o&&(u=s.readShort(e,r+1),h=3),29<=o&&o<=31&&(c=o,h=1),32<=o&&o<=246&&(u=o-139,h=1),247<=o&&o<=250&&(u=256*(o-247)+l+108,h=2),251<=o&&o<=254&&(u=-(256*(o-251))-l-108,h=2),255==o&&(u=s.readInt(e,r+1)/65535,h=5),a.push(null!=u?u:"o"+c),r+=h}return a},t.CFF.readDict=function(e,r,n){for(var i=t._bin,s={},a=[];r<n;){var o=e[r],l=e[r+1];e[r+2],e[r+3],e[r+4];var h=1,c=null,u=null;if(28==o&&(u=i.readShort(e,r+1),h=3),29==o&&(u=i.readInt(e,r+1),h=5),32<=o&&o<=246&&(u=o-139,h=1),247<=o&&o<=250&&(u=256*(o-247)+l+108,h=2),251<=o&&o<=254&&(u=-(256*(o-251))-l-108,h=2),255==o)throw u=i.readInt(e,r+1)/65535,h=5,"unknown number";if(30==o){var d=[];for(h=1;;){var p=e[r+h];h++;var f=p>>4,m=15&p;if(15!=f&&d.push(f),15!=m&&d.push(m),15==m)break}for(var g="",v=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],y=0;y<d.length;y++)g+=v[d[y]];u=parseFloat(g)}o<=21&&(c=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][o],h=1,12==o&&(c=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][l],h=2)),null!=c?(s[c]=1==a.length?a[0]:a,a=[]):a.push(u),r+=h}return s},t.cmap={},t.cmap.parse=function(e,r,n){e=new Uint8Array(e.buffer,r,n),r=0;var i=t._bin,s={};i.readUshort(e,r),r+=2;var a=i.readUshort(e,r);r+=2;var o=[];s.tables=[];for(var l=0;l<a;l++){var h=i.readUshort(e,r);r+=2;var c=i.readUshort(e,r);r+=2;var u=i.readUint(e,r);r+=4;var d="p"+h+"e"+c,p=o.indexOf(u);if(-1==p){p=s.tables.length,o.push(u);var f,m=i.readUshort(e,u);0==m?f=t.cmap.parse0(e,u):4==m?f=t.cmap.parse4(e,u):6==m?f=t.cmap.parse6(e,u):12==m?f=t.cmap.parse12(e,u):console.debug("unknown format: "+m,h,c,u),s.tables.push(f)}if(null!=s[d])throw"multiple tables for one platform+encoding";s[d]=p}return s},t.cmap.parse0=function(e,r){var n=t._bin,i={};i.format=n.readUshort(e,r),r+=2;var s=n.readUshort(e,r);r+=2,n.readUshort(e,r),r+=2,i.map=[];for(var a=0;a<s-6;a++)i.map.push(e[r+a]);return i},t.cmap.parse4=function(e,r){var n=t._bin,i=r,s={};s.format=n.readUshort(e,r),r+=2;var a=n.readUshort(e,r);r+=2,n.readUshort(e,r),r+=2;var o=n.readUshort(e,r);r+=2;var l=o/2;s.searchRange=n.readUshort(e,r),r+=2,s.entrySelector=n.readUshort(e,r),r+=2,s.rangeShift=n.readUshort(e,r),r+=2,s.endCount=n.readUshorts(e,r,l),r+=2*l+2,s.startCount=n.readUshorts(e,r,l),r+=2*l,s.idDelta=[];for(var h=0;h<l;h++)s.idDelta.push(n.readShort(e,r)),r+=2;for(s.idRangeOffset=n.readUshorts(e,r,l),r+=2*l,s.glyphIdArray=[];r<i+a;)s.glyphIdArray.push(n.readUshort(e,r)),r+=2;return s},t.cmap.parse6=function(e,r){var n=t._bin,i={};i.format=n.readUshort(e,r),r+=2,n.readUshort(e,r),r+=2,n.readUshort(e,r),r+=2,i.firstCode=n.readUshort(e,r),r+=2;var s=n.readUshort(e,r);r+=2,i.glyphIdArray=[];for(var a=0;a<s;a++)i.glyphIdArray.push(n.readUshort(e,r)),r+=2;return i},t.cmap.parse12=function(e,r){var n=t._bin,i={};i.format=n.readUshort(e,r),r+=4,n.readUint(e,r),r+=4,n.readUint(e,r),r+=4;var s=n.readUint(e,r);r+=4,i.groups=[];for(var a=0;a<s;a++){var o=r+12*a,l=n.readUint(e,o+0),h=n.readUint(e,o+4),c=n.readUint(e,o+8);i.groups.push([l,h,c])}return i},t.glyf={},t.glyf.parse=function(e,t,r,n){for(var i=[],s=0;s<n.maxp.numGlyphs;s++)i.push(null);return i},t.glyf._parseGlyf=function(e,r){var n,i=t._bin,s=e._data,a=t._tabOffset(s,"glyf",e._offset)+e.loca[r];if(e.loca[r]==e.loca[r+1])return null;var o={};if(o.noc=i.readShort(s,a),a+=2,o.xMin=i.readShort(s,a),a+=2,o.yMin=i.readShort(s,a),a+=2,o.xMax=i.readShort(s,a),a+=2,o.yMax=i.readShort(s,a),a+=2,o.xMin>=o.xMax||o.yMin>=o.yMax)return null;if(o.noc>0){o.endPts=[];for(var l=0;l<o.noc;l++)o.endPts.push(i.readUshort(s,a)),a+=2;var h=i.readUshort(s,a);if(a+=2,s.length-a<h)return null;o.instructions=i.readBytes(s,a,h),a+=h;var c=o.endPts[o.noc-1]+1;for(l=0,o.flags=[];l<c;l++){var u=s[a];if(a++,o.flags.push(u),0!=(8&u)){var d=s[a];a++;for(var p=0;p<d;p++)o.flags.push(u),l++}}for(l=0,o.xs=[];l<c;l++){var f=0!=(2&o.flags[l]),m=0!=(16&o.flags[l]);f?(o.xs.push(m?s[a]:-s[a]),a++):m?o.xs.push(0):(o.xs.push(i.readShort(s,a)),a+=2)}for(l=0,o.ys=[];l<c;l++)f=0!=(4&o.flags[l]),m=0!=(32&o.flags[l]),f?(o.ys.push(m?s[a]:-s[a]),a++):m?o.ys.push(0):(o.ys.push(i.readShort(s,a)),a+=2);var g=0,v=0;for(l=0;l<c;l++)g+=o.xs[l],v+=o.ys[l],o.xs[l]=g,o.ys[l]=v}else{o.parts=[];do{n=i.readUshort(s,a),a+=2;var y={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(o.parts.push(y),y.glyphIndex=i.readUshort(s,a),a+=2,1&n){var x=i.readShort(s,a);a+=2;var _=i.readShort(s,a);a+=2}else x=i.readInt8(s,a),a++,_=i.readInt8(s,a),a++;2&n?(y.m.tx=x,y.m.ty=_):(y.p1=x,y.p2=_),8&n?(y.m.a=y.m.d=i.readF2dot14(s,a),a+=2):64&n?(y.m.a=i.readF2dot14(s,a),a+=2,y.m.d=i.readF2dot14(s,a),a+=2):128&n&&(y.m.a=i.readF2dot14(s,a),a+=2,y.m.b=i.readF2dot14(s,a),a+=2,y.m.c=i.readF2dot14(s,a),a+=2,y.m.d=i.readF2dot14(s,a),a+=2)}while(32&n)if(256&n){var b=i.readUshort(s,a);for(a+=2,o.instr=[],l=0;l<b;l++)o.instr.push(s[a]),a++}}return o},t.GPOS={},t.GPOS.parse=function(e,r,n,i){return t._lctf.parse(e,r,n,i,t.GPOS.subt)},t.GPOS.subt=function(e,r,n,i){var s=t._bin,a=n,o={};if(o.fmt=s.readUshort(e,n),n+=2,1==r||2==r||3==r||7==r||8==r&&o.fmt<=2){var l=s.readUshort(e,n);n+=2,o.coverage=t._lctf.readCoverage(e,l+a)}if(1==r&&1==o.fmt){var h=s.readUshort(e,n);n+=2;var c=t._lctf.numOfOnes(h);0!=h&&(o.pos=t.GPOS.readValueRecord(e,n,h))}else if(2==r&&o.fmt>=1&&o.fmt<=2){h=s.readUshort(e,n),n+=2;var u=s.readUshort(e,n);n+=2,c=t._lctf.numOfOnes(h);var d=t._lctf.numOfOnes(u);if(1==o.fmt){o.pairsets=[];var p=s.readUshort(e,n);n+=2;for(var f=0;f<p;f++){var m=a+s.readUshort(e,n);n+=2;var g=s.readUshort(e,m);m+=2;for(var v=[],y=0;y<g;y++){var x=s.readUshort(e,m);m+=2,0!=h&&(E=t.GPOS.readValueRecord(e,m,h),m+=2*c),0!=u&&(A=t.GPOS.readValueRecord(e,m,u),m+=2*d),v.push({gid2:x,val1:E,val2:A})}o.pairsets.push(v)}}if(2==o.fmt){var _=s.readUshort(e,n);n+=2;var b=s.readUshort(e,n);n+=2;var w=s.readUshort(e,n);n+=2;var S=s.readUshort(e,n);for(n+=2,o.classDef1=t._lctf.readClassDef(e,a+_),o.classDef2=t._lctf.readClassDef(e,a+b),o.matrix=[],f=0;f<w;f++){var T=[];for(y=0;y<S;y++){var E=null,A=null;0!=h&&(E=t.GPOS.readValueRecord(e,n,h),n+=2*c),0!=u&&(A=t.GPOS.readValueRecord(e,n,u),n+=2*d),T.push({val1:E,val2:A})}o.matrix.push(T)}}}else{if(9==r&&1==o.fmt){var C=s.readUshort(e,n);n+=2;var R=s.readUint(e,n);if(n+=4,9==i.ltype)i.ltype=C;else if(i.ltype!=C)throw"invalid extension substitution";return t.GPOS.subt(e,i.ltype,a+R)}console.debug("unsupported GPOS table LookupType",r,"format",o.fmt)}return o},t.GPOS.readValueRecord=function(e,r,n){var i=t._bin,s=[];return s.push(1&n?i.readShort(e,r):0),r+=1&n?2:0,s.push(2&n?i.readShort(e,r):0),r+=2&n?2:0,s.push(4&n?i.readShort(e,r):0),r+=4&n?2:0,s.push(8&n?i.readShort(e,r):0),r+=8&n?2:0,s},t.GSUB={},t.GSUB.parse=function(e,r,n,i){return t._lctf.parse(e,r,n,i,t.GSUB.subt)},t.GSUB.subt=function(e,r,n,i){var s=t._bin,a=n,o={};if(o.fmt=s.readUshort(e,n),n+=2,1!=r&&4!=r&&5!=r&&6!=r)return null;if(1==r||4==r||5==r&&o.fmt<=2||6==r&&o.fmt<=2){var l=s.readUshort(e,n);n+=2,o.coverage=t._lctf.readCoverage(e,a+l)}if(1==r&&o.fmt>=1&&o.fmt<=2){if(1==o.fmt)o.delta=s.readShort(e,n),n+=2;else if(2==o.fmt){var h=s.readUshort(e,n);n+=2,o.newg=s.readUshorts(e,n,h),n+=2*o.newg.length}}else if(4==r){o.vals=[],h=s.readUshort(e,n),n+=2;for(var c=0;c<h;c++){var u=s.readUshort(e,n);n+=2,o.vals.push(t.GSUB.readLigatureSet(e,a+u))}}else if(5==r&&2==o.fmt){if(2==o.fmt){var d=s.readUshort(e,n);n+=2,o.cDef=t._lctf.readClassDef(e,a+d),o.scset=[];var p=s.readUshort(e,n);for(n+=2,c=0;c<p;c++){var f=s.readUshort(e,n);n+=2,o.scset.push(0==f?null:t.GSUB.readSubClassSet(e,a+f))}}}else if(6==r&&3==o.fmt){if(3==o.fmt){for(c=0;c<3;c++){h=s.readUshort(e,n),n+=2;for(var m=[],g=0;g<h;g++)m.push(t._lctf.readCoverage(e,a+s.readUshort(e,n+2*g)));n+=2*h,0==c&&(o.backCvg=m),1==c&&(o.inptCvg=m),2==c&&(o.ahedCvg=m)}h=s.readUshort(e,n),n+=2,o.lookupRec=t.GSUB.readSubstLookupRecords(e,n,h)}}else{if(7==r&&1==o.fmt){var v=s.readUshort(e,n);n+=2;var y=s.readUint(e,n);if(n+=4,9==i.ltype)i.ltype=v;else if(i.ltype!=v)throw"invalid extension substitution";return t.GSUB.subt(e,i.ltype,a+y)}console.debug("unsupported GSUB table LookupType",r,"format",o.fmt)}return o},t.GSUB.readSubClassSet=function(e,r){var n=t._bin.readUshort,i=r,s=[],a=n(e,r);r+=2;for(var o=0;o<a;o++){var l=n(e,r);r+=2,s.push(t.GSUB.readSubClassRule(e,i+l))}return s},t.GSUB.readSubClassRule=function(e,r){var n=t._bin.readUshort,i={},s=n(e,r),a=n(e,r+=2);r+=2,i.input=[];for(var o=0;o<s-1;o++)i.input.push(n(e,r)),r+=2;return i.substLookupRecords=t.GSUB.readSubstLookupRecords(e,r,a),i},t.GSUB.readSubstLookupRecords=function(e,r,n){for(var i=t._bin.readUshort,s=[],a=0;a<n;a++)s.push(i(e,r),i(e,r+2)),r+=4;return s},t.GSUB.readChainSubClassSet=function(e,r){var n=t._bin,i=r,s=[],a=n.readUshort(e,r);r+=2;for(var o=0;o<a;o++){var l=n.readUshort(e,r);r+=2,s.push(t.GSUB.readChainSubClassRule(e,i+l))}return s},t.GSUB.readChainSubClassRule=function(e,r){for(var n=t._bin,i={},s=["backtrack","input","lookahead"],a=0;a<s.length;a++){var o=n.readUshort(e,r);r+=2,1==a&&o--,i[s[a]]=n.readUshorts(e,r,o),r+=2*i[s[a]].length}return o=n.readUshort(e,r),r+=2,i.subst=n.readUshorts(e,r,2*o),r+=2*i.subst.length,i},t.GSUB.readLigatureSet=function(e,r){var n=t._bin,i=r,s=[],a=n.readUshort(e,r);r+=2;for(var o=0;o<a;o++){var l=n.readUshort(e,r);r+=2,s.push(t.GSUB.readLigature(e,i+l))}return s},t.GSUB.readLigature=function(e,r){var n=t._bin,i={chain:[]};i.nglyph=n.readUshort(e,r),r+=2;var s=n.readUshort(e,r);r+=2;for(var a=0;a<s-1;a++)i.chain.push(n.readUshort(e,r)),r+=2;return i},t.head={},t.head.parse=function(e,r,n){var i=t._bin,s={};return i.readFixed(e,r),r+=4,s.fontRevision=i.readFixed(e,r),r+=4,i.readUint(e,r),r+=4,i.readUint(e,r),r+=4,s.flags=i.readUshort(e,r),r+=2,s.unitsPerEm=i.readUshort(e,r),r+=2,s.created=i.readUint64(e,r),r+=8,s.modified=i.readUint64(e,r),r+=8,s.xMin=i.readShort(e,r),r+=2,s.yMin=i.readShort(e,r),r+=2,s.xMax=i.readShort(e,r),r+=2,s.yMax=i.readShort(e,r),r+=2,s.macStyle=i.readUshort(e,r),r+=2,s.lowestRecPPEM=i.readUshort(e,r),r+=2,s.fontDirectionHint=i.readShort(e,r),r+=2,s.indexToLocFormat=i.readShort(e,r),r+=2,s.glyphDataFormat=i.readShort(e,r),r+=2,s},t.hhea={},t.hhea.parse=function(e,r,n){var i=t._bin,s={};return i.readFixed(e,r),r+=4,s.ascender=i.readShort(e,r),r+=2,s.descender=i.readShort(e,r),r+=2,s.lineGap=i.readShort(e,r),r+=2,s.advanceWidthMax=i.readUshort(e,r),r+=2,s.minLeftSideBearing=i.readShort(e,r),r+=2,s.minRightSideBearing=i.readShort(e,r),r+=2,s.xMaxExtent=i.readShort(e,r),r+=2,s.caretSlopeRise=i.readShort(e,r),r+=2,s.caretSlopeRun=i.readShort(e,r),r+=2,s.caretOffset=i.readShort(e,r),r+=10,s.metricDataFormat=i.readShort(e,r),r+=2,s.numberOfHMetrics=i.readUshort(e,r),r+=2,s},t.hmtx={},t.hmtx.parse=function(e,r,n,i){for(var s=t._bin,a={aWidth:[],lsBearing:[]},o=0,l=0,h=0;h<i.maxp.numGlyphs;h++)h<i.hhea.numberOfHMetrics&&(o=s.readUshort(e,r),r+=2,l=s.readShort(e,r),r+=2),a.aWidth.push(o),a.lsBearing.push(l);return a},t.kern={},t.kern.parse=function(e,r,n,i){var s=t._bin,a=s.readUshort(e,r);if(r+=2,1==a)return t.kern.parseV1(e,r-2,n,i);var o=s.readUshort(e,r);r+=2;for(var l={glyph1:[],rval:[]},h=0;h<o;h++){r+=2,n=s.readUshort(e,r),r+=2;var c=s.readUshort(e,r);r+=2;var u=c>>>8;if(0!=(u&=15))throw"unknown kern table format: "+u;r=t.kern.readFormat0(e,r,l)}return l},t.kern.parseV1=function(e,r,n,i){var s=t._bin;s.readFixed(e,r),r+=4;var a=s.readUint(e,r);r+=4;for(var o={glyph1:[],rval:[]},l=0;l<a;l++){s.readUint(e,r),r+=4;var h=s.readUshort(e,r);r+=2,s.readUshort(e,r),r+=2;var c=h>>>8;if(0!=(c&=15))throw"unknown kern table format: "+c;r=t.kern.readFormat0(e,r,o)}return o},t.kern.readFormat0=function(e,r,n){var i=t._bin,s=-1,a=i.readUshort(e,r);r+=2,i.readUshort(e,r),r+=2,i.readUshort(e,r),r+=2,i.readUshort(e,r),r+=2;for(var o=0;o<a;o++){var l=i.readUshort(e,r);r+=2;var h=i.readUshort(e,r);r+=2;var c=i.readShort(e,r);r+=2,l!=s&&(n.glyph1.push(l),n.rval.push({glyph2:[],vals:[]}));var u=n.rval[n.rval.length-1];u.glyph2.push(h),u.vals.push(c),s=l}return r},t.loca={},t.loca.parse=function(e,r,n,i){var s=t._bin,a=[],o=i.head.indexToLocFormat,l=i.maxp.numGlyphs+1;if(0==o)for(var h=0;h<l;h++)a.push(s.readUshort(e,r+(h<<1))<<1);if(1==o)for(h=0;h<l;h++)a.push(s.readUint(e,r+(h<<2)));return a},t.maxp={},t.maxp.parse=function(e,r,n){var i=t._bin,s={},a=i.readUint(e,r);return r+=4,s.numGlyphs=i.readUshort(e,r),r+=2,65536==a&&(s.maxPoints=i.readUshort(e,r),r+=2,s.maxContours=i.readUshort(e,r),r+=2,s.maxCompositePoints=i.readUshort(e,r),r+=2,s.maxCompositeContours=i.readUshort(e,r),r+=2,s.maxZones=i.readUshort(e,r),r+=2,s.maxTwilightPoints=i.readUshort(e,r),r+=2,s.maxStorage=i.readUshort(e,r),r+=2,s.maxFunctionDefs=i.readUshort(e,r),r+=2,s.maxInstructionDefs=i.readUshort(e,r),r+=2,s.maxStackElements=i.readUshort(e,r),r+=2,s.maxSizeOfInstructions=i.readUshort(e,r),r+=2,s.maxComponentElements=i.readUshort(e,r),r+=2,s.maxComponentDepth=i.readUshort(e,r),r+=2),s},t.name={},t.name.parse=function(e,r,n){var i=t._bin,s={};i.readUshort(e,r),r+=2;var a=i.readUshort(e,r);r+=2,i.readUshort(e,r);for(var o,l=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],h=r+=2,c=0;c<a;c++){var u=i.readUshort(e,r);r+=2;var d=i.readUshort(e,r);r+=2;var p=i.readUshort(e,r);r+=2;var f=i.readUshort(e,r);r+=2;var m=i.readUshort(e,r);r+=2;var g=i.readUshort(e,r);r+=2;var v,y=l[f],x=h+12*a+g;if(0==u)v=i.readUnicode(e,x,m/2);else if(3==u&&0==d)v=i.readUnicode(e,x,m/2);else if(0==d)v=i.readASCII(e,x,m);else if(1==d)v=i.readUnicode(e,x,m/2);else if(3==d)v=i.readUnicode(e,x,m/2);else{if(1!=u)throw"unknown encoding "+d+", platformID: "+u;v=i.readASCII(e,x,m),console.debug("reading unknown MAC encoding "+d+" as ASCII")}var _="p"+u+","+p.toString(16);null==s[_]&&(s[_]={}),s[_][void 0!==y?y:f]=v,s[_]._lang=p}for(var b in s)if(null!=s[b].postScriptName&&1033==s[b]._lang)return s[b];for(var b in s)if(null!=s[b].postScriptName&&0==s[b]._lang)return s[b];for(var b in s)if(null!=s[b].postScriptName&&3084==s[b]._lang)return s[b];for(var b in s)if(null!=s[b].postScriptName)return s[b];for(var b in s){o=b;break}return console.debug("returning name table with languageID "+s[o]._lang),s[o]},t["OS/2"]={},t["OS/2"].parse=function(e,r,n){var i=t._bin.readUshort(e,r);r+=2;var s={};if(0==i)t["OS/2"].version0(e,r,s);else if(1==i)t["OS/2"].version1(e,r,s);else if(2==i||3==i||4==i)t["OS/2"].version2(e,r,s);else{if(5!=i)throw"unknown OS/2 table version: "+i;t["OS/2"].version5(e,r,s)}return s},t["OS/2"].version0=function(e,r,n){var i=t._bin;return n.xAvgCharWidth=i.readShort(e,r),r+=2,n.usWeightClass=i.readUshort(e,r),r+=2,n.usWidthClass=i.readUshort(e,r),r+=2,n.fsType=i.readUshort(e,r),r+=2,n.ySubscriptXSize=i.readShort(e,r),r+=2,n.ySubscriptYSize=i.readShort(e,r),r+=2,n.ySubscriptXOffset=i.readShort(e,r),r+=2,n.ySubscriptYOffset=i.readShort(e,r),r+=2,n.ySuperscriptXSize=i.readShort(e,r),r+=2,n.ySuperscriptYSize=i.readShort(e,r),r+=2,n.ySuperscriptXOffset=i.readShort(e,r),r+=2,n.ySuperscriptYOffset=i.readShort(e,r),r+=2,n.yStrikeoutSize=i.readShort(e,r),r+=2,n.yStrikeoutPosition=i.readShort(e,r),r+=2,n.sFamilyClass=i.readShort(e,r),r+=2,n.panose=i.readBytes(e,r,10),r+=10,n.ulUnicodeRange1=i.readUint(e,r),r+=4,n.ulUnicodeRange2=i.readUint(e,r),r+=4,n.ulUnicodeRange3=i.readUint(e,r),r+=4,n.ulUnicodeRange4=i.readUint(e,r),r+=4,n.achVendID=[i.readInt8(e,r),i.readInt8(e,r+1),i.readInt8(e,r+2),i.readInt8(e,r+3)],r+=4,n.fsSelection=i.readUshort(e,r),r+=2,n.usFirstCharIndex=i.readUshort(e,r),r+=2,n.usLastCharIndex=i.readUshort(e,r),r+=2,n.sTypoAscender=i.readShort(e,r),r+=2,n.sTypoDescender=i.readShort(e,r),r+=2,n.sTypoLineGap=i.readShort(e,r),r+=2,n.usWinAscent=i.readUshort(e,r),r+=2,n.usWinDescent=i.readUshort(e,r),r+=2},t["OS/2"].version1=function(e,r,n){var i=t._bin;return r=t["OS/2"].version0(e,r,n),n.ulCodePageRange1=i.readUint(e,r),r+=4,n.ulCodePageRange2=i.readUint(e,r),r+=4},t["OS/2"].version2=function(e,r,n){var i=t._bin;return r=t["OS/2"].version1(e,r,n),n.sxHeight=i.readShort(e,r),r+=2,n.sCapHeight=i.readShort(e,r),r+=2,n.usDefault=i.readUshort(e,r),r+=2,n.usBreak=i.readUshort(e,r),r+=2,n.usMaxContext=i.readUshort(e,r),r+=2},t["OS/2"].version5=function(e,r,n){var i=t._bin;return r=t["OS/2"].version2(e,r,n),n.usLowerOpticalPointSize=i.readUshort(e,r),r+=2,n.usUpperOpticalPointSize=i.readUshort(e,r),r+=2},t.post={},t.post.parse=function(e,r,n){var i=t._bin,s={};return s.version=i.readFixed(e,r),r+=4,s.italicAngle=i.readFixed(e,r),r+=4,s.underlinePosition=i.readShort(e,r),r+=2,s.underlineThickness=i.readShort(e,r),r+=2,s},null==t&&(t={}),null==t.U&&(t.U={}),t.U.codeToGlyph=function(e,t){var r=e.cmap,n=-1;if(null!=r.p0e4?n=r.p0e4:null!=r.p3e1?n=r.p3e1:null!=r.p1e0?n=r.p1e0:null!=r.p0e3&&(n=r.p0e3),-1==n)throw"no familiar platform and encoding!";var i=r.tables[n];if(0==i.format)return t>=i.map.length?0:i.map[t];if(4==i.format){for(var s=-1,a=0;a<i.endCount.length;a++)if(t<=i.endCount[a]){s=a;break}return -1==s||i.startCount[s]>t?0:65535&(0!=i.idRangeOffset[s]?i.glyphIdArray[t-i.startCount[s]+(i.idRangeOffset[s]>>1)-(i.idRangeOffset.length-s)]:t+i.idDelta[s])}if(12==i.format){if(t>i.groups[i.groups.length-1][1])return 0;for(a=0;a<i.groups.length;a++){var o=i.groups[a];if(o[0]<=t&&t<=o[1])return o[2]+(t-o[0])}return 0}throw"unknown cmap table format "+i.format},t.U.glyphToPath=function(e,r){var n={cmds:[],crds:[]};if(e.SVG&&e.SVG.entries[r]){var i=e.SVG.entries[r];return null==i?n:("string"==typeof i&&(i=t.SVG.toPath(i),e.SVG.entries[r]=i),i)}if(e.CFF){var s={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:e.CFF.Private?e.CFF.Private.defaultWidthX:0,open:!1},a=e.CFF,o=e.CFF.Private;if(a.ROS){for(var l=0;a.FDSelect[l+2]<=r;)l+=2;o=a.FDArray[a.FDSelect[l+1]].Private}t.U._drawCFF(e.CFF.CharStrings[r],s,a,o,n)}else e.glyf&&t.U._drawGlyf(r,e,n);return n},t.U._drawGlyf=function(e,r,n){var i=r.glyf[e];null==i&&(i=r.glyf[e]=t.glyf._parseGlyf(r,e)),null!=i&&(i.noc>-1?t.U._simpleGlyph(i,n):t.U._compoGlyph(i,r,n))},t.U._simpleGlyph=function(e,r){for(var n=0;n<e.noc;n++){for(var i=0==n?0:e.endPts[n-1]+1,s=e.endPts[n],a=i;a<=s;a++){var o=a==i?s:a-1,l=a==s?i:a+1,h=1&e.flags[a],c=1&e.flags[o],u=1&e.flags[l],d=e.xs[a],p=e.ys[a];if(a==i){if(h){if(!c){t.U.P.moveTo(r,d,p);continue}t.U.P.moveTo(r,e.xs[o],e.ys[o])}else c?t.U.P.moveTo(r,e.xs[o],e.ys[o]):t.U.P.moveTo(r,(e.xs[o]+d)/2,(e.ys[o]+p)/2)}h?c&&t.U.P.lineTo(r,d,p):u?t.U.P.qcurveTo(r,d,p,e.xs[l],e.ys[l]):t.U.P.qcurveTo(r,d,p,(d+e.xs[l])/2,(p+e.ys[l])/2)}t.U.P.closePath(r)}},t.U._compoGlyph=function(e,r,n){for(var i=0;i<e.parts.length;i++){var s={cmds:[],crds:[]},a=e.parts[i];t.U._drawGlyf(a.glyphIndex,r,s);for(var o=a.m,l=0;l<s.crds.length;l+=2){var h=s.crds[l],c=s.crds[l+1];n.crds.push(h*o.a+c*o.b+o.tx),n.crds.push(h*o.c+c*o.d+o.ty)}for(l=0;l<s.cmds.length;l++)n.cmds.push(s.cmds[l])}},t.U._getGlyphClass=function(e,r){var n=t._lctf.getInterval(r,e);return -1==n?0:r[n+2]},t.U.getPairAdjustment=function(e,r,n){var i=0;if(e.GPOS)for(var s=e.GPOS,a=s.lookupList,o=s.featureList,l=[],h=0;h<o.length;h++){var c=o[h];if("kern"==c.tag){for(var u=0;u<c.tab.length;u++)if(!l[c.tab[u]]){l[c.tab[u]]=!0;for(var d=a[c.tab[u]],p=0;p<d.tabs.length;p++)if(null!=d.tabs[p]){var f,m,g=d.tabs[p];if(!g.coverage||-1!=(m=t._lctf.coverageIndex(g.coverage,r))){if(1==d.ltype);else if(2==d.ltype){if(1==g.fmt){var v=g.pairsets[m];for(h=0;h<v.length;h++)v[h].gid2==n&&(f=v[h])}else if(2==g.fmt){var y=t.U._getGlyphClass(r,g.classDef1),x=t.U._getGlyphClass(n,g.classDef2);f=g.matrix[y][x]}f&&f.val1&&f.val1[2]&&(i+=f.val1[2]),f&&f.val2&&f.val2[0]&&(i+=f.val2[0])}}}}}}if(e.kern){var _=e.kern.glyph1.indexOf(r);if(-1!=_){var b=e.kern.rval[_].glyph2.indexOf(n);-1!=b&&(i+=e.kern.rval[_].vals[b])}}return i},t.U._applySubs=function(e,r,n,i){for(var s=e.length-r-1,a=0;a<n.tabs.length;a++)if(null!=n.tabs[a]){var o,l=n.tabs[a];if(!l.coverage||-1!=(o=t._lctf.coverageIndex(l.coverage,e[r]))){if(1==n.ltype)e[r],1==l.fmt?e[r]=e[r]+l.delta:e[r]=l.newg[o];else if(4==n.ltype)for(var h=l.vals[o],c=0;c<h.length;c++){var u=h[c],d=u.chain.length;if(!(d>s)){for(var p=!0,f=0,m=0;m<d;m++){for(;-1==e[r+f+(1+m)];)f++;u.chain[m]!=e[r+f+(1+m)]&&(p=!1)}if(p){for(m=0,e[r]=u.nglyph;m<d+f;m++)e[r+m+1]=-1;break}}}else if(5==n.ltype&&2==l.fmt)for(var g=t._lctf.getInterval(l.cDef,e[r]),v=l.cDef[g+2],y=l.scset[v],x=0;x<y.length;x++){var _=y[x],b=_.input;if(!(b.length>s)){for(p=!0,m=0;m<b.length;m++){var w=t._lctf.getInterval(l.cDef,e[r+1+m]);if(-1==g&&l.cDef[w+2]!=b[m]){p=!1;break}}if(p){var S=_.substLookupRecords;for(c=0;c<S.length;c+=2)S[c],S[c+1]}}}else if(6==n.ltype&&3==l.fmt){if(!t.U._glsCovered(e,l.backCvg,r-l.backCvg.length)||!t.U._glsCovered(e,l.inptCvg,r)||!t.U._glsCovered(e,l.ahedCvg,r+l.inptCvg.length))continue;var T=l.lookupRec;for(x=0;x<T.length;x+=2){g=T[x];var E=i[T[x+1]];t.U._applySubs(e,r+g,E,i)}}}}},t.U._glsCovered=function(e,r,n){for(var i=0;i<r.length;i++)if(-1==t._lctf.coverageIndex(r[i],e[n+i]))return!1;return!0},t.U.glyphsToPath=function(e,r,n){for(var i={cmds:[],crds:[]},s=0,a=0;a<r.length;a++){var o=r[a];if(-1!=o){for(var l=a<r.length-1&&-1!=r[a+1]?r[a+1]:0,h=t.U.glyphToPath(e,o),c=0;c<h.crds.length;c+=2)i.crds.push(h.crds[c]+s),i.crds.push(h.crds[c+1]);for(n&&i.cmds.push(n),c=0;c<h.cmds.length;c++)i.cmds.push(h.cmds[c]);n&&i.cmds.push("X"),s+=e.hmtx.aWidth[o],a<r.length-1&&(s+=t.U.getPairAdjustment(e,o,l))}}return i},t.U.P={},t.U.P.moveTo=function(e,t,r){e.cmds.push("M"),e.crds.push(t,r)},t.U.P.lineTo=function(e,t,r){e.cmds.push("L"),e.crds.push(t,r)},t.U.P.curveTo=function(e,t,r,n,i,s,a){e.cmds.push("C"),e.crds.push(t,r,n,i,s,a)},t.U.P.qcurveTo=function(e,t,r,n,i){e.cmds.push("Q"),e.crds.push(t,r,n,i)},t.U.P.closePath=function(e){e.cmds.push("Z")},t.U._drawCFF=function(e,r,n,i,s){for(var a=r.stack,o=r.nStems,l=r.haveWidth,h=r.width,c=r.open,u=0,d=r.x,p=r.y,f=0,m=0,g=0,v=0,y=0,x=0,_=0,b=0,w=0,S=0,T={val:0,size:0};u<e.length;){t.CFF.getCharString(e,u,T);var E=T.val;if(u+=T.size,"o1"==E||"o18"==E)a.length%2==0||l||(h=a.shift()+i.nominalWidthX),o+=a.length>>1,a.length=0,l=!0;else if("o3"==E||"o23"==E)a.length%2==0||l||(h=a.shift()+i.nominalWidthX),o+=a.length>>1,a.length=0,l=!0;else if("o4"==E)a.length>1&&!l&&(h=a.shift()+i.nominalWidthX,l=!0),c&&t.U.P.closePath(s),p+=a.pop(),t.U.P.moveTo(s,d,p),c=!0;else if("o5"==E)for(;a.length>0;)d+=a.shift(),p+=a.shift(),t.U.P.lineTo(s,d,p);else if("o6"==E||"o7"==E)for(var A=a.length,C="o6"==E,R=0;R<A;R++){var L=a.shift();C?d+=L:p+=L,C=!C,t.U.P.lineTo(s,d,p)}else if("o8"==E||"o24"==E){A=a.length;for(var I=0;I+6<=A;)f=d+a.shift(),m=p+a.shift(),g=f+a.shift(),v=m+a.shift(),d=g+a.shift(),p=v+a.shift(),t.U.P.curveTo(s,f,m,g,v,d,p),I+=6;"o24"==E&&(d+=a.shift(),p+=a.shift(),t.U.P.lineTo(s,d,p))}else{if("o11"==E)break;if("o1234"==E||"o1235"==E||"o1236"==E||"o1237"==E)"o1234"==E&&(m=p,g=(f=d+a.shift())+a.shift(),S=v=m+a.shift(),x=v,b=p,d=(_=(y=(w=g+a.shift())+a.shift())+a.shift())+a.shift(),t.U.P.curveTo(s,f,m,g,v,w,S),t.U.P.curveTo(s,y,x,_,b,d,p)),"o1235"==E&&(f=d+a.shift(),m=p+a.shift(),g=f+a.shift(),v=m+a.shift(),w=g+a.shift(),S=v+a.shift(),y=w+a.shift(),x=S+a.shift(),_=y+a.shift(),b=x+a.shift(),d=_+a.shift(),p=b+a.shift(),a.shift(),t.U.P.curveTo(s,f,m,g,v,w,S),t.U.P.curveTo(s,y,x,_,b,d,p)),"o1236"==E&&(f=d+a.shift(),m=p+a.shift(),g=f+a.shift(),S=v=m+a.shift(),x=v,_=(y=(w=g+a.shift())+a.shift())+a.shift(),b=x+a.shift(),d=_+a.shift(),t.U.P.curveTo(s,f,m,g,v,w,S),t.U.P.curveTo(s,y,x,_,b,d,p)),"o1237"==E&&(f=d+a.shift(),m=p+a.shift(),g=f+a.shift(),v=m+a.shift(),w=g+a.shift(),S=v+a.shift(),y=w+a.shift(),x=S+a.shift(),Math.abs((_=y+a.shift())-d)>Math.abs((b=x+a.shift())-p)?d=_+a.shift():p=b+a.shift(),t.U.P.curveTo(s,f,m,g,v,w,S),t.U.P.curveTo(s,y,x,_,b,d,p));else if("o14"==E){if(a.length>0&&!l&&(h=a.shift()+n.nominalWidthX,l=!0),4==a.length){var P=a.shift(),k=a.shift(),D=a.shift(),U=a.shift(),O=t.CFF.glyphBySE(n,D),N=t.CFF.glyphBySE(n,U);t.U._drawCFF(n.CharStrings[O],r,n,i,s),r.x=P,r.y=k,t.U._drawCFF(n.CharStrings[N],r,n,i,s)}c&&(t.U.P.closePath(s),c=!1)}else if("o19"==E||"o20"==E)a.length%2==0||l||(h=a.shift()+i.nominalWidthX),o+=a.length>>1,a.length=0,l=!0,u+=o+7>>3;else if("o21"==E)a.length>2&&!l&&(h=a.shift()+i.nominalWidthX,l=!0),p+=a.pop(),d+=a.pop(),c&&t.U.P.closePath(s),t.U.P.moveTo(s,d,p),c=!0;else if("o22"==E)a.length>1&&!l&&(h=a.shift()+i.nominalWidthX,l=!0),d+=a.pop(),c&&t.U.P.closePath(s),t.U.P.moveTo(s,d,p),c=!0;else if("o25"==E){for(;a.length>6;)d+=a.shift(),p+=a.shift(),t.U.P.lineTo(s,d,p);f=d+a.shift(),m=p+a.shift(),g=f+a.shift(),v=m+a.shift(),d=g+a.shift(),p=v+a.shift(),t.U.P.curveTo(s,f,m,g,v,d,p)}else if("o26"==E)for(a.length%2&&(d+=a.shift());a.length>0;)f=d,m=p+a.shift(),d=g=f+a.shift(),p=(v=m+a.shift())+a.shift(),t.U.P.curveTo(s,f,m,g,v,d,p);else if("o27"==E)for(a.length%2&&(p+=a.shift());a.length>0;)m=p,g=(f=d+a.shift())+a.shift(),v=m+a.shift(),d=g+a.shift(),p=v,t.U.P.curveTo(s,f,m,g,v,d,p);else if("o10"==E||"o29"==E){var F="o10"==E?i:n;if(0==a.length)console.debug("error: empty stack");else{var B=a.pop(),z=F.Subrs[B+F.Bias];r.x=d,r.y=p,r.nStems=o,r.haveWidth=l,r.width=h,r.open=c,t.U._drawCFF(z,r,n,i,s),d=r.x,p=r.y,o=r.nStems,l=r.haveWidth,h=r.width,c=r.open}}else if("o30"==E||"o31"==E){var G=a.length,H=(I=0,"o31"==E);for(I+=G-(A=-3&G);I<A;)H?(m=p,g=(f=d+a.shift())+a.shift(),p=(v=m+a.shift())+a.shift(),A-I==5?(d=g+a.shift(),I++):d=g,H=!1):(f=d,m=p+a.shift(),g=f+a.shift(),v=m+a.shift(),d=g+a.shift(),A-I==5?(p=v+a.shift(),I++):p=v,H=!0),t.U.P.curveTo(s,f,m,g,v,d,p),I+=4}else{if("o"==(E+"").charAt(0))throw console.debug("Unknown operation: "+E,e),E;a.push(E)}}}r.x=d,r.y=p,r.nStems=o,r.haveWidth=l,r.width=h,r.open=c},r=t,e.Typr=r,e.default={Typr:r},Object.defineProperty(e,"__esModule",{value:!0}),e).Typr},/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function(){return function(e){var t=Uint8Array,r=Uint16Array,n=Uint32Array,i=new t([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),s=new t([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),a=new t([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),o=function(e,t){for(var i=new r(31),s=0;s<31;++s)i[s]=t+=1<<e[s-1];var a=new n(i[30]);for(s=1;s<30;++s)for(var o=i[s];o<i[s+1];++o)a[o]=o-i[s]<<5|s;return[i,a]},l=o(i,2),h=l[0],c=l[1];h[28]=258,c[258]=28;for(var u=o(s,0)[0],d=new r(32768),p=0;p<32768;++p){var f=(43690&p)>>>1|(21845&p)<<1;f=(61680&(f=(52428&f)>>>2|(13107&f)<<2))>>>4|(3855&f)<<4,d[p]=((65280&f)>>>8|(255&f)<<8)>>>1}var m=function(e,t,n){for(var i=e.length,s=0,a=new r(t);s<i;++s)++a[e[s]-1];var o,l=new r(t);for(s=0;s<t;++s)l[s]=l[s-1]+a[s-1]<<1;if(n){o=new r(1<<t);var h=15-t;for(s=0;s<i;++s)if(e[s])for(var c=s<<4|e[s],u=t-e[s],p=l[e[s]-1]++<<u,f=p|(1<<u)-1;p<=f;++p)o[d[p]>>>h]=c}else for(o=new r(i),s=0;s<i;++s)e[s]&&(o[s]=d[l[e[s]-1]++]>>>15-e[s]);return o},g=new t(288);for(p=0;p<144;++p)g[p]=8;for(p=144;p<256;++p)g[p]=9;for(p=256;p<280;++p)g[p]=7;for(p=280;p<288;++p)g[p]=8;var v=new t(32);for(p=0;p<32;++p)v[p]=5;var y=m(g,9,1),x=m(v,5,1),_=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},b=function(e,t,r){var n=t/8|0;return(e[n]|e[n+1]<<8)>>(7&t)&r},w=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(7&t)},S=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],T=function(e,t,r){var n=Error(t||S[e]);if(n.code=e,Error.captureStackTrace&&Error.captureStackTrace(n,T),!r)throw n;return n},E=function(e,o,l){var c,d,p,f,g=e.length;if(!g||l&&!l.l&&g<5)return o||new t(0);var v=!o||l,S=!l||l.i;l||(l={}),o||(o=new t(3*g));var E,A=function(e){var r=o.length;if(e>r){var n=new t(Math.max(2*r,e));n.set(o),o=n}},C=l.f||0,R=l.p||0,L=l.b||0,I=l.l,P=l.d,k=l.m,D=l.n,U=8*g;do{if(!I){l.f=C=b(e,R,1);var O=b(e,R+1,3);if(R+=3,!O){var N=e[(Y=((E=R)/8|0)+(7&E&&1)+4)-4]|e[Y-3]<<8,F=Y+N;if(F>g){S&&T(0);break}v&&A(L+N),o.set(e.subarray(Y,F),L),l.b=L+=N,l.p=R=8*F;continue}if(1==O)I=y,P=x,k=9,D=5;else if(2==O){var B=b(e,R,31)+257,z=b(e,R+10,15)+4,G=B+b(e,R+5,31)+1;R+=14;for(var H=new t(G),V=new t(19),W=0;W<z;++W)V[a[W]]=b(e,R+3*W,7);R+=3*z;var j=_(V),q=(1<<j)-1,X=m(V,j,1);for(W=0;W<G;){var Y,J=X[b(e,R,q)];if(R+=15&J,(Y=J>>>4)<16)H[W++]=Y;else{var Z=0,$=0;for(16==Y?($=3+b(e,R,3),R+=2,Z=H[W-1]):17==Y?($=3+b(e,R,7),R+=3):18==Y&&($=11+b(e,R,127),R+=7);$--;)H[W++]=Z}}var K=H.subarray(0,B),Q=H.subarray(B);k=_(K),D=_(Q),I=m(K,k,1),P=m(Q,D,1)}else T(1);if(R>U){S&&T(0);break}}v&&A(L+131072);for(var ee=(1<<k)-1,et=(1<<D)-1,er=R;;er=R){var en=(Z=I[w(e,R)&ee])>>>4;if((R+=15&Z)>U){S&&T(0);break}if(Z||T(2),en<256)o[L++]=en;else{if(256==en){er=R,I=null;break}var ei=en-254;if(en>264){var es=i[W=en-257];ei=b(e,R,(1<<es)-1)+h[W],R+=es}var ea=P[w(e,R)&et],eo=ea>>>4;if(ea||T(3),R+=15&ea,Q=u[eo],eo>3&&(es=s[eo],Q+=w(e,R)&(1<<es)-1,R+=es),R>U){S&&T(0);break}v&&A(L+131072);for(var el=L+ei;L<el;L+=4)o[L]=o[L-Q],o[L+1]=o[L+1-Q],o[L+2]=o[L+2-Q],o[L+3]=o[L+3-Q];L=el}}l.l=I,l.p=er,l.b=L,I&&(C=1,l.m=k,l.d=P,l.n=D)}while(!C)return L==o.length?o:(c=o,(d=0)<0&&(d=0),(null==(p=L)||p>c.length)&&(p=c.length),(f=new(c instanceof r?r:c instanceof n?n:t)(p-d)).set(c.subarray(d,p)),f)},A=new t(0),C="undefined"!=typeof TextDecoder&&new TextDecoder;try{C.decode(A,{stream:!0})}catch(e){}return e.convert_streams=function(e){var t=new DataView(e),r=0;function n(){var e=t.getUint16(r);return r+=2,e}function i(){var e=t.getUint32(r);return r+=4,e}function s(e){v.setUint16(y,e),y+=2}function a(e){v.setUint32(y,e),y+=4}for(var o={signature:i(),flavor:i(),length:i(),numTables:n(),reserved:n(),totalSfntSize:i(),majorVersion:n(),minorVersion:n(),metaOffset:i(),metaLength:i(),metaOrigLength:i(),privOffset:i(),privLength:i()},l=0;Math.pow(2,l)<=o.numTables;)l++;l--;for(var h=16*Math.pow(2,l),c=16*o.numTables-h,u=12,d=[],p=0;p<o.numTables;p++)d.push({tag:i(),offset:i(),compLength:i(),origLength:i(),origChecksum:i()}),u+=16;var f,m=new Uint8Array(12+16*d.length+d.reduce(function(e,t){return e+t.origLength+4},0)),g=m.buffer,v=new DataView(g),y=0;return a(o.flavor),s(o.numTables),s(h),s(l),s(c),d.forEach(function(e){a(e.tag),a(e.origChecksum),a(u),a(e.origLength),e.outOffset=u,(u+=e.origLength)%4!=0&&(u+=4-u%4)}),d.forEach(function(t){var r=e.slice(t.offset,t.offset+t.compLength);if(t.compLength!=t.origLength){var n=new Uint8Array(t.origLength);E(new Uint8Array(r,2),n)}else n=new Uint8Array(r);m.set(n,t.outOffset);var i=0;(u=t.outOffset+t.origLength)%4!=0&&(i=4-u%4),m.set(new Uint8Array(i).buffer,t.outOffset+t.origLength),f=u+i}),g.slice(0,f)},Object.defineProperty(e,"__esModule",{value:!0}),e}({}).convert_streams},function(e,t){let r;let n={M:2,L:2,Q:4,C:6,Z:0},i={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},s=[null,"isol","init","fina","medi"];return function(a){let o=new Uint8Array(a,0,4),l=e._bin.readASCII(o,0,4);if("wOFF"===l)a=t(a);else if("wOF2"===l)throw Error("woff2 fonts not supported");return function(t){let a=Object.create(null),o={unitsPerEm:t.head.unitsPerEm,ascender:t.hhea.ascender,descender:t.hhea.descender,forEachGlyph(l,h,c,u){let d=0,p=1/o.unitsPerEm*h,f=function(t,n){let a=[];for(let r=0;r<n.length;r++){let i=n.codePointAt(r);i>65535&&r++,a.push(e.U.codeToGlyph(t,i))}let o=t.GSUB;if(o){let t;let{lookupList:l,featureList:h}=o,c=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws)$/,u=[];h.forEach(o=>{if(c.test(o.tag))for(let h=0;h<o.tab.length;h++){if(u[o.tab[h]])continue;u[o.tab[h]]=!0;let c=l[o.tab[h]],d=/^(isol|init|fina|medi)$/.test(o.tag);d&&!t&&(t=function(e){let t=new Uint8Array(e.length),n=32,s=1,a=-1;for(let o=0;o<e.length;o++){let l=e.codePointAt(o),h=0|function(e){if(!r){let e={R:2,L:1,D:4,C:16,U:32,T:8};for(let t in r=new Map,i){let n=0;i[t].split(",").forEach(i=>{let[s,a]=i.split("+");s=parseInt(s,36),a=a?parseInt(a,36):0,r.set(n+=s,e[t]);for(let i=a;i--;)r.set(++n,e[t])})}}return r.get(e)||32}(l),c=1;!(8&h)&&(21&n?22&h?(c=3,(1===s||3===s)&&t[a]++):33&h&&(2===s||4===s)&&t[a]--:34&n&&(2===s||4===s)&&t[a]--,s=t[o]=c,n=h,a=o,l>65535&&o++)}return t}(n));for(let r=0;r<a.length;r++)t&&d&&s[t[r]]!==o.tag||e.U._applySubs(a,r,c,l)}})}return a}(t,l),m=0,g=-1;return f.forEach((r,i)=>{if(-1!==r){let i=a[r];if(!i){let s,o,l,h;let{cmds:c,crds:u}=e.U.glyphToPath(t,r),d="",p=0;for(let e=0,t=c.length;e<t;e++){let t=n[c[e]];d+=c[e];for(let e=1;e<=t;e++)d+=(e>1?",":"")+u[p++]}if(u.length){s=o=1/0,l=h=-1/0;for(let e=0,t=u.length;e<t;e+=2){let t=u[e],r=u[e+1];t<s&&(s=t),r<o&&(o=r),t>l&&(l=t),r>h&&(h=r)}}else s=l=o=h=0;i=a[r]={index:r,advanceWidth:t.hmtx.aWidth[r],xMin:s,yMin:o,xMax:l,yMax:h,path:d,pathCommandCount:c.length}}-1!==g&&(d+=e.U.getPairAdjustment(t,g,r)*p),u.call(null,i,d,m),i.advanceWidth&&(d+=i.advanceWidth*p),c&&(d+=c*h),g=r}m+=l.codePointAt(m)>65535?2:1}),d}};return o}(e.parse(a)[0])}}],init:(e,t,r)=>r(e(),t())}),fI={defaultFontURL:"https://fonts.gstatic.com/s/roboto/v18/KFOmCnqEu92Fr1Mu4mxM.woff",sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},fP=new tU;function fk(){return(self.performance||Date).now()}const fD=Object.create(null);function fU(e,t){var r;e=function(e,t){for(let r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}({},e);let n=fk();if(e.font=(r=e.font||fI.defaultFontURL,i||(i="undefined"==typeof document?{}:document.createElement("a")),i.href=r,i.href),e.text=""+e.text,e.sdfGlyphSize=e.sdfGlyphSize||fI.sdfGlyphSize,null!=e.colorRanges){let t={};for(let r in e.colorRanges)if(e.colorRanges.hasOwnProperty(r)){let n=e.colorRanges[r];"number"!=typeof n&&(n=fP.set(n).getHex()),t[r]=n}e.colorRanges=t}Object.freeze(e);let{textureWidth:s,sdfExponent:a}=fI,{sdfGlyphSize:o}=e,l=`${e.font}@${o}`,h=fD[l];h||((h=fD[l]={count:0,glyphs:new Map,sdfTexture:new sn(new Uint8Array(o*s*4),s,o,1023,void 0,void 0,void 0,void 0,1006,1006)}).sdfTexture.font=e.font),fF(e).then(r=>{let{glyphIds:i,glyphPositions:s,fontSize:l,unitsPerEm:c,timings:u}=r,d=[],p=new Float32Array(4*i.length),f=l/c,m=0,g=0,v=fk();i.forEach((e,t)=>{let n=h.glyphs.get(e);if(!n){let{path:t,pathBounds:i}=r.glyphData[e],s=Math.max(i[2]-i[0],i[3]-i[1])/o*(fI.sdfMargin*o+.5),a=h.count++,l=[i[0]-s,i[1]-s,i[2]+s,i[3]+s];h.glyphs.set(e,n={path:t,atlasIndex:a,sdfViewBox:l}),d.push(n)}let{sdfViewBox:a}=n,l=s[g++],c=s[g++];p[m++]=l+a[0]*f,p[m++]=c+a[1]*f,p[m++]=l+a[2]*f,p[m++]=c+a[3]*f,i[t]=n.atlasIndex}),u.quads=(u.quads||0)+(fk()-v);let y=fk();u.sdf={},fn.all(d.map(({path:e,atlasIndex:t,sdfViewBox:r})=>{let n=Math.max(r[2]-r[0],r[3]-r[1]);return fN(o,o,e,r,n,fI.sdfExponent).then(({textureData:e,timing:r})=>(u.sdf[t]=r,{atlasIndex:t,textureData:e,timing:r}))})).then(s=>{s.length&&(s.forEach(({atlasIndex:e,textureData:t,timing:r})=>{let n=h.sdfTexture.image;for(;n.data.length<(e+1)*o*o;){let e=new Uint8Array(2*n.data.length);e.set(n.data),n.data=e,n.height*=2}let i=Math.floor(e/4),s=n.width/o,a=Math.floor(i/s)*n.width*o*4+i%s*o*4+e%4;for(let e=0;e<o;e++){let r=e*o,i=a+e*n.width*4;for(let e=0;e<o;e++)n.data[i+4*e]=t[r+e]}}),h.sdfTexture.needsUpdate=!0),u.sdfTotal=fk()-y,u.total=fk()-n,t(Object.freeze({parameters:e,sdfTexture:h.sdfTexture,sdfGlyphSize:o,sdfExponent:a,glyphBounds:p,glyphAtlasIndices:i,glyphColors:r.glyphColors,caretPositions:r.caretPositions,caretHeight:r.caretHeight,chunkedBounds:r.chunkedBounds,ascender:r.ascender,descender:r.descender,lineHeight:r.lineHeight,topBaseline:r.topBaseline,blockBounds:r.blockBounds,visibleBounds:r.visibleBounds,timings:r.timings,get totalBounds(){return console.log("totalBounds deprecated, use blockBounds instead"),r.blockBounds},get totalBlockSize(){console.log("totalBlockSize deprecated, use blockBounds instead");let[e,t,n,i]=r.blockBounds;return[n-e,i-t]}}))})})}const fO=fd({name:"Typesetter",dependencies:[fI,fL,function(e,t,r){let{defaultFontURL:n}=r,i=Object.create(null),s=1/0,a=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,o=/[\s\-\u007C\u00AD\u2010\u2012-\u2014\u2027\u2056\u2E17\u2E40]/;function l(t,r){t||(t=n);let s=i[t];if(s)s.pending?s.pending.push(r):r(s);else{var a,o;i[t]={pending:[r]},a=t,o=e=>{let r=i[t].pending;i[t]=e,r.forEach(t=>t(e))},function t(){let r=e=>{console.error(`Failure loading font ${a}${a===n?"":"; trying fallback"}`,e),a!==n&&(a=n,t())};try{let t=new XMLHttpRequest;t.open("get",a,!0),t.responseType="arraybuffer",t.onload=function(){if(t.status>=400)r(Error(t.statusText));else if(t.status>0)try{let r=e(t.response);o(r)}catch(e){r(e)}},t.onerror=r,t.send()}catch(e){r(e)}}()}}function h({text:e="",font:r=n,sdfGlyphSize:i=64,fontSize:h=1,letterSpacing:p=0,lineHeight:f="normal",maxWidth:m=s,direction:g,textAlign:v="left",textIndent:y=0,whiteSpace:x="normal",overflowWrap:_="normal",anchorX:b=0,anchorY:w=0,includeCaretPositions:S=!1,chunkedBoundsSize:T=8192,colorRanges:E=null},A,C=!1){let R=u(),L={fontLoad:0,typesetting:0};e.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),e=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n")),h=+h,p=+p,m=+m,f=f||"normal",y=+y,l(r,r=>{let n=isFinite(m),i=null,l=null,I=null,P=null,k=null,D=null,U=null,O=0,N=0,F="nowrap"!==x,{ascender:B,descender:z,unitsPerEm:G}=r;L.fontLoad=u()-R;let H=u(),V=h/G;"normal"===f&&(f=(B-z)/G);let W=((f*=h)-(B-z)*V)/2,j=-(B*V+W),q=Math.min(f,(B-z)*V),X=(B+z)/2*V-q/2,Y=y,J=new d,Z=[J];r.forEachGlyph(e,h,p,(t,r,i)=>{let s;let l=e.charAt(i),c=t.advanceWidth*V,u=J.count;if("isEmpty"in t||(t.isWhitespace=!!l&&/\s/.test(l),t.canBreakAfter=!!l&&o.test(l),t.isEmpty=t.xMin===t.xMax||t.yMin===t.yMax||a.test(l)),!t.isWhitespace&&!t.isEmpty&&N++,F&&n&&!t.isWhitespace&&r+c+Y>m&&u){if(J.glyphAt(u-1).glyphObj.canBreakAfter)s=new d,Y=-r;else for(let e=u;e--;){if(0===e&&"break-word"===_){s=new d,Y=-r;break}if(J.glyphAt(e).glyphObj.canBreakAfter){let t=(s=J.splitAt(e+1)).glyphAt(0).x;Y-=t;for(let e=s.count;e--;)s.glyphAt(e).x-=t;break}}s&&(J.isSoftWrapped=!0,J=s,Z.push(J),O=m)}let f=J.glyphAt(J.count);f.glyphObj=t,f.x=r+Y,f.width=c,f.charIndex=i,"\n"===l&&(J=new d,Z.push(J),Y=-(r+c+p*h)+y)}),Z.forEach(e=>{for(let t=e.count;t--;){let{glyphObj:r,x:n,width:i}=e.glyphAt(t);if(!r.isWhitespace){e.width=n+i,e.width>O&&(O=e.width);return}}});let $=0,K=0;if(b&&("number"==typeof b?$=-b:"string"==typeof b&&($=-O*("left"===b?0:"center"===b?.5:"right"===b?1:c(b)))),w){if("number"==typeof w)K=-w;else if("string"==typeof w){let e=Z.length*f;K="top"===w?0:"top-baseline"===w?-j:"middle"===w?e/2:"bottom"===w?e:"bottom-baseline"===w?e-W+z*V:c(w)*e}}if(!C){let n,a;let o=t.getEmbeddingLevels(e,g);i=new Uint16Array(N),l=new Float32Array(2*N),I={},D=[s,s,-s,-s],U=[];let h=j;S&&(k=new Float32Array(3*e.length)),E&&(P=new Uint8Array(3*N));let c=0,u=-1,d=-1;Z.forEach((p,m)=>{let{count:g,width:y}=p;if(g>0){let f,m=0;for(let e=g;e--&&p.glyphAt(e).glyphObj.isWhitespace;)m++;let x=0,_=0;if("center"===v)x=(O-y)/2;else if("right"===v)x=O-y;else if("justify"===v&&p.isSoftWrapped){let e=0;for(let t=g-m;t--;)p.glyphAt(t).glyphObj.isWhitespace&&e++;_=(O-y)/e}if(_||x){let e=0;for(let t=0;t<g;t++){let r=p.glyphAt(t),n=r.glyphObj;r.x+=x+e,0!==_&&n.isWhitespace&&t<g-m&&(e+=_,r.width+=_)}}let b=t.getReorderSegments(e,o,p.glyphAt(0).charIndex,p.glyphAt(p.count-1).charIndex);for(let e=0;e<b.length;e++){let[t,r]=b[e],n=1/0,i=-1/0;for(let e=0;e<g;e++)if(p.glyphAt(e).charIndex>=t){let t=e,s=e;for(;s<g;s++){let e=p.glyphAt(s);if(e.charIndex>r)break;s<g-m&&(n=Math.min(n,e.x),i=Math.max(i,e.x+e.width))}for(let e=t;e<s;e++){let t=p.glyphAt(e);t.x=i-(t.x+t.width-n)}break}}let w=e=>f=e;for(let m=0;m<g;m++){let g=p.glyphAt(m),v=(f=g.glyphObj).index,y=1&o.levels[g.charIndex];if(y){let n=t.getMirroredCharacter(e[g.charIndex]);n&&r.forEachGlyph(n,0,0,w)}if(S){let{charIndex:e}=g,t=g.x+$,r=g.x+g.width+$;for(k[3*e]=y?r:t,k[3*e+1]=y?t:r,k[3*e+2]=h+X+K;e-u>1;)k[(u+1)*3]=k[3*u],k[(u+1)*3+1]=k[3*u+1],k[(u+1)*3+2]=k[3*u+2],u++;u=e}if(E){let{charIndex:e}=g;for(;e>d;)d++,E.hasOwnProperty(d)&&(a=E[d])}if(!f.isWhitespace&&!f.isEmpty){let e=c++;I[v]||(I[v]={path:f.path,pathBounds:[f.xMin,f.yMin,f.xMax,f.yMax]});let t=g.x+$,r=h+K;l[2*e]=t,l[2*e+1]=r;let o=t+f.xMin*V,u=r+f.yMin*V,d=t+f.xMax*V,p=r+f.yMax*V;o<D[0]&&(D[0]=o),u<D[1]&&(D[1]=u),d>D[2]&&(D[2]=d),p>D[3]&&(D[3]=p),e%T==0&&(n={start:e,end:e,rect:[s,s,-s,-s]},U.push(n)),n.end++;let m=n.rect;if(o<m[0]&&(m[0]=o),u<m[1]&&(m[1]=u),d>m[2]&&(m[2]=d),p>m[3]&&(m[3]=p),i[e]=v,E){let t=3*e;P[t]=a>>16&255,P[t+1]=a>>8&255,P[t+2]=255&a}}}}h-=f})}L.typesetting=u()-H,A({glyphIds:i,glyphPositions:l,glyphData:I,caretPositions:k,caretHeight:q,glyphColors:P,chunkedBounds:U,fontSize:h,unitsPerEm:G,ascender:B*V,descender:z*V,lineHeight:f,topBaseline:j,blockBounds:[$,K-Z.length*f,$+O,K],visibleBounds:D,timings:L})})}function c(e){let t=e.match(/^([\d.]+)%$/),r=t?parseFloat(t[1]):NaN;return isNaN(r)?0:r/100}function u(){return(self.performance||Date).now()}function d(){this.data=[]}let p=["glyphObj","x","width","charIndex"];return d.prototype={width:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/p.length)},glyphAt(e){let t=d.flyweight;return t.data=this.data,t.index=e,t},splitAt(e){let t=new d;return t.data=this.data.splice(e*p.length),t}},d.flyweight=p.reduce((e,t,r,n)=>(Object.defineProperty(e,t,{get(){return this.data[this.index*p.length+r]},set(e){this.data[this.index*p.length+r]=e}}),e),{data:null,index:0}),{typeset:h,measure:function(e,t){h(e,e=>{let[r,n,i,s]=e.blockBounds;t({width:i-r,height:s-n})},{metricsOnly:!0})},loadFont:l}},function(){return function(e){var t,r,n,i,s={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},a={},o={};a.L=1,o[1]="L",Object.keys(s).forEach(function(e,t){a[e]=1<<t+1,o[a[e]]=e}),Object.freeze(a);var l=a.LRI|a.RLI|a.FSI,h=a.L|a.R|a.AL,c=a.B|a.S|a.WS|a.ON|a.FSI|a.LRI|a.RLI|a.PDI,u=a.BN|a.RLE|a.LRE|a.RLO|a.LRO|a.PDF,d=a.S|a.WS|a.B|l|a.PDI|u,p=null;function f(e){return!function(){if(!p){p=new Map;var e=function(e){if(s.hasOwnProperty(e)){var t=0;s[e].split(",").forEach(function(r){var n=r.split("+"),i=n[0],s=n[1];i=parseInt(i,36),s=s?parseInt(s,36):0,p.set(t+=i,a[e]);for(var o=0;o<s;o++)p.set(++t,a[e])})}};for(var t in s)e(t)}}(),p.get(e.codePointAt(0))||a.L}var m={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function g(e,t){var r,n=0,i=new Map,s=t&&new Map;return e.split(",").forEach(function e(a){if(-1!==a.indexOf("+"))for(var o=+a;o--;)e(r);else{r=a;var l=a.split(">"),h=l[0],c=l[1];h=String.fromCodePoint(n+=parseInt(h,36)),c=String.fromCodePoint(n+=parseInt(c,36)),i.set(h,c),t&&s.set(c,h)}}),{map:i,reverseMap:s}}function v(){if(!t){var e=g(m.pairs,!0),i=e.map,s=e.reverseMap;t=i,r=s,n=g(m.canonical,!1).map}}function y(e){return v(),t.get(e)||null}function x(e){return v(),r.get(e)||null}function _(e){return v(),n.get(e)||null}var b=a.L,w=a.R,S=a.EN,T=a.ES,E=a.ET,A=a.AN,C=a.CS,R=a.B,L=a.S,I=a.ON,P=a.BN,k=a.NSM,D=a.AL,U=a.LRO,O=a.RLO,N=a.LRE,F=a.RLE,B=a.PDF,z=a.LRI,G=a.RLI,H=a.FSI,V=a.PDI;function W(e){return!function(){if(!i){var e=g("14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",!0),t=e.map;e.reverseMap.forEach(function(e,r){t.set(r,e)}),i=t}}(),i.get(e)||null}function j(e,t,r,n){var i=e.length;r=Math.max(0,null==r?0:+r),n=Math.min(i-1,null==n?i-1:+n);var s=[];return t.paragraphs.forEach(function(i){var a=Math.max(r,i.start),o=Math.min(n,i.end);if(a<o){for(var l=t.levels.slice(a,o+1),h=o;h>=a&&f(e[h])&d;h--)l[h]=i.level;for(var c=i.level,u=1/0,p=0;p<l.length;p++){var m=l[p];m>c&&(c=m),m<u&&(u=1|m)}for(var g=c;g>=u;g--)for(var v=0;v<l.length;v++)if(l[v]>=g){for(var y=v;v+1<l.length&&l[v+1]>=g;)v++;v>y&&s.push([y+a,v+a])}}}),s}function q(e,t,r,n){for(var i=j(e,t,r,n),s=[],a=0;a<e.length;a++)s[a]=a;return i.forEach(function(e){for(var t=e[0],r=e[1],n=s.slice(t,r+1),i=n.length;i--;)s[r-i]=n[i]}),s}return e.closingToOpeningBracket=x,e.getBidiCharType=f,e.getBidiCharTypeName=function(e){return o[f(e)]},e.getCanonicalBracket=_,e.getEmbeddingLevels=function(e,t){for(var r=new Uint32Array(e.length),n=0;n<e.length;n++)r[n]=f(e[n]);var i=new Map;function s(e,t){var n=r[e];r[e]=t,i.set(n,i.get(n)-1),n&c&&i.set(c,i.get(c)-1),i.set(t,(i.get(t)||0)+1),t&c&&i.set(c,(i.get(c)||0)+1)}for(var a=new Uint8Array(e.length),o=new Map,p=[],m=null,g=0;g<e.length;g++)m||p.push(m={start:g,end:e.length-1,level:"rtl"===t?1:"ltr"===t?0:tI(g,!1)}),r[g]&R&&(m.end=g,m=null);for(var v=F|N|O|U|l|V|B|R,W=function(e){return e+(1&e?1:2)},j=function(e){return e+(1&e?2:1)},q=0;q<p.length;q++){var X=[{_level:(m=p[q]).level,_override:0,_isolate:0}],Y=void 0,J=0,Z=0,$=0;i.clear();for(var K=m.start;K<=m.end;K++){var Q=r[K];if(Y=X[X.length-1],i.set(Q,(i.get(Q)||0)+1),Q&c&&i.set(c,(i.get(c)||0)+1),Q&v){if(Q&(F|N)){a[K]=Y._level;var ee=(Q===F?j:W)(Y._level);!(ee<=125)||J||Z?!J&&Z++:X.push({_level:ee,_override:0,_isolate:0})}else if(Q&(O|U)){a[K]=Y._level;var et=(Q===O?j:W)(Y._level);!(et<=125)||J||Z?!J&&Z++:X.push({_level:et,_override:Q&O?w:b,_isolate:0})}else if(Q&l){Q&H&&(Q=1===tI(K+1,!0)?G:z),a[K]=Y._level,Y._override&&s(K,Y._override);var er=(Q===G?j:W)(Y._level);er<=125&&0===J&&0===Z?($++,X.push({_level:er,_override:0,_isolate:1,_isolInitIndex:K})):J++}else if(Q&V){if(J>0)J--;else if($>0){for(Z=0;!X[X.length-1]._isolate;)X.pop();var en=X[X.length-1]._isolInitIndex;null!=en&&(o.set(en,K),o.set(K,en)),X.pop(),$--}Y=X[X.length-1],a[K]=Y._level,Y._override&&s(K,Y._override)}else Q&B?(0===J&&(Z>0?Z--:!Y._isolate&&X.length>1&&(X.pop(),Y=X[X.length-1])),a[K]=Y._level):Q&R&&(a[K]=m.level)}else a[K]=Y._level,Y._override&&Q!==P&&s(K,Y._override)}for(var ei=[],es=null,ea=m.start;ea<=m.end;ea++){var eo=r[ea];if(!(eo&u)){var el=a[ea],eh=eo&l,ec=eo===V;es&&el===es._level?(es._end=ea,es._endsWithIsolInit=eh):ei.push(es={_start:ea,_end:ea,_level:el,_startsWithPDI:ec,_endsWithIsolInit:eh})}}for(var eu=[],ed=0;ed<ei.length;ed++){var ep=ei[ed];if(!ep._startsWithPDI||ep._startsWithPDI&&!o.has(ep._start)){for(var ef=[es=ep],em=void 0;es&&es._endsWithIsolInit&&null!=(em=o.get(es._end));)for(var eg=ed+1;eg<ei.length;eg++)if(ei[eg]._start===em){ef.push(es=ei[eg]);break}for(var ev=[],ey=0;ey<ef.length;ey++)for(var ex=ef[ey],e_=ex._start;e_<=ex._end;e_++)ev.push(e_);for(var eb=a[ev[0]],ew=m.level,eS=ev[0]-1;eS>=0;eS--)if(!(r[eS]&u)){ew=a[eS];break}var eM=ev[ev.length-1],eT=a[eM],eE=m.level;if(!(r[eM]&l)){for(var eA=eM+1;eA<=m.end;eA++)if(!(r[eA]&u)){eE=a[eA];break}}eu.push({_seqIndices:ev,_sosType:Math.max(ew,eb)%2?w:b,_eosType:Math.max(eE,eT)%2?w:b})}}for(var eC=0;eC<eu.length;eC++){var eR=eu[eC],eL=eR._seqIndices,eI=eR._sosType,eP=eR._eosType,ek=1&a[eL[0]]?w:b;if(i.get(k))for(var eD=0;eD<eL.length;eD++){var eU=eL[eD];if(r[eU]&k){for(var eO=eI,eN=eD-1;eN>=0;eN--)if(!(r[eL[eN]]&u)){eO=r[eL[eN]];break}s(eU,eO&(l|V)?I:eO)}}if(i.get(S))for(var eF=0;eF<eL.length;eF++){var eB=eL[eF];if(r[eB]&S)for(var ez=eF-1;ez>=-1;ez--){var eG=-1===ez?eI:r[eL[ez]];if(eG&h){eG===D&&s(eB,A);break}}}if(i.get(D))for(var eH=0;eH<eL.length;eH++){var eV=eL[eH];r[eV]&D&&s(eV,w)}if(i.get(T)||i.get(C))for(var eW=1;eW<eL.length-1;eW++){var ej=eL[eW];if(r[ej]&(T|C)){for(var eq=0,eX=0,eY=eW-1;eY>=0&&(eq=r[eL[eY]])&u;eY--);for(var eJ=eW+1;eJ<eL.length&&(eX=r[eL[eJ]])&u;eJ++);eq===eX&&(r[ej]===T?eq===S:eq&(S|A))&&s(ej,eq)}}if(i.get(S)){for(var eZ=0;eZ<eL.length;eZ++)if(r[eL[eZ]]&S){for(var e$=eZ-1;e$>=0&&r[eL[e$]]&(E|u);e$--)s(eL[e$],S);for(eZ++;eZ<eL.length&&r[eL[eZ]]&(E|u|S);eZ++)r[eL[eZ]]!==S&&s(eL[eZ],S)}}if(i.get(E)||i.get(T)||i.get(C))for(var eK=0;eK<eL.length;eK++){var eQ=eL[eK];if(r[eQ]&(E|T|C)){s(eQ,I);for(var e0=eK-1;e0>=0&&r[eL[e0]]&u;e0--)s(eL[e0],I);for(var e1=eK+1;e1<eL.length&&r[eL[e1]]&u;e1++)s(eL[e1],I)}}if(i.get(S))for(var e2=0,e3=eI;e2<eL.length;e2++){var e4=eL[e2],e5=r[e4];e5&S?e3===b&&s(e4,b):e5&h&&(e3=e5)}if(i.get(c)){for(var e6=w|S|A,e8=e6|b,e7=[],e9=[],te=0;te<eL.length;te++)if(r[eL[te]]&c){var tt=e[eL[te]],tr=void 0;if(null!==y(tt)){if(e9.length<63)e9.push({char:tt,seqIndex:te});else break}else if(null!==(tr=x(tt)))for(var tn=e9.length-1;tn>=0;tn--){var ti=e9[tn].char;if(ti===tr||ti===x(_(tt))||y(_(ti))===tt){e7.push([e9[tn].seqIndex,te]),e9.length=tn;break}}}e7.sort(function(e,t){return e[0]-t[0]});for(var ts=0;ts<e7.length;ts++){for(var ta=e7[ts],to=ta[0],tl=ta[1],th=!1,tc=0,tu=to+1;tu<tl;tu++){var td=eL[tu];if(r[td]&e8){th=!0;var tp=r[td]&e6?w:b;if(tp===ek){tc=tp;break}}}if(th&&!tc){tc=eI;for(var tf=to-1;tf>=0;tf--){var tm=eL[tf];if(r[tm]&e8){var tg=r[tm]&e6?w:b;tc=tg!==ek?tg:ek;break}}}if(tc){if(r[eL[to]]=r[eL[tl]]=tc,tc!==ek){for(var tv=to+1;tv<eL.length;tv++)if(!(r[eL[tv]]&u)){f(e[eL[tv]])&k&&(r[eL[tv]]=tc);break}}if(tc!==ek){for(var ty=tl+1;ty<eL.length;ty++)if(!(r[eL[ty]]&u)){f(e[eL[ty]])&k&&(r[eL[ty]]=tc);break}}}}for(var tx=0;tx<eL.length;tx++)if(r[eL[tx]]&c){for(var t_=tx,tb=tx,tw=eI,tS=tx-1;tS>=0;tS--)if(r[eL[tS]]&u)t_=tS;else{tw=r[eL[tS]]&e6?w:b;break}for(var tM=eP,tT=tx+1;tT<eL.length;tT++)if(r[eL[tT]]&(c|u))tb=tT;else{tM=r[eL[tT]]&e6?w:b;break}for(var tE=t_;tE<=tb;tE++)r[eL[tE]]=tw===tM?tw:ek;tx=tb}}}for(var tA=m.start;tA<=m.end;tA++){var tC=a[tA],tR=r[tA];if(1&tC?tR&(b|S|A)&&a[tA]++:tR&w?a[tA]++:tR&(A|S)&&(a[tA]+=2),tR&u&&(a[tA]=0===tA?m.level:a[tA-1]),tA===m.end||f(e[tA])&(L|R))for(var tL=tA;tL>=0&&f(e[tL])&d;tL--)a[tL]=m.level}}return{levels:a,paragraphs:p};function tI(t,n){for(var i=t;i<e.length;i++){var s=r[i];if(s&(w|D))return 1;if(s&(R|b)||n&&s===V)break;if(s&l){var a=function(t){for(var n=1,i=t+1;i<e.length;i++){var s=r[i];if(s&R)break;if(s&V){if(0==--n)return i}else s&l&&n++}return -1}(i);i=-1===a?e.length:a}}return 0}},e.getMirroredCharacter=W,e.getMirroredCharactersMap=function(e,t,r,n){var i=e.length;r=Math.max(0,null==r?0:+r),n=Math.min(i-1,null==n?i-1:+n);for(var s=new Map,a=r;a<=n;a++)if(1&t[a]){var o=W(e[a]);null!==o&&s.set(a,o)}return s},e.getReorderSegments=j,e.getReorderedIndices=q,e.getReorderedString=function(e,t,r,n){var i=q(e,t,r,n),s=[].concat(e);return i.forEach(function(r,n){s[n]=(1&t.levels[r]?W(e[r]):null)||e[r]}),s.join("")},e.openingToClosingBracket=y,Object.defineProperty(e,"__esModule",{value:!0}),e}({})}],init(e,t,r,n){let{defaultFontURL:i}=e;return r(t,n(),{defaultFontURL:i})}}),fN=function(){let e={},t=0;return function(...r){let n="TroikaTextSDFGenerator_"+t++%4,i=e[n];return i||(i=e[n]={workerModule:fd({name:n,workerId:n,dependencies:[fI,fR,fC],init(e,t,r){let{sdfExponent:n,sdfMargin:i}=e;return r(t,{sdfExponent:n,sdfMargin:i})},getTransferables:e=>[e.textureData.buffer]}),requests:0,idleTimer:null}),i.requests++,clearTimeout(i.idleTimer),i.workerModule(...r).then(e=>(0==--i.requests&&(i.idleTimer=setTimeout(()=>{fc[n]&&fc[n].forEach(function(e){e()}),fh[n]&&(fh[n].terminate(),delete fh[n])},2e3)),e))}}(),fF=fd({name:"Typesetter",dependencies:[fO,fm],init:(e,t)=>function(r){let n=new t;return e.typeset(r,n.resolve),n},getTransferables(e){let t=[e.glyphPositions.buffer,e.glyphIds.buffer];return e.caretPositions&&t.push(e.caretPositions.buffer),t}}),fB=(()=>{let e={};new eS;let t="aTroikaGlyphIndex";class r extends or{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new ej,this.boundingBox=new eE}computeBoundingSphere(){}computeBoundingBox(){}set detail(t){if(t!==this._detail){var r;let n;this._detail=t,("number"!=typeof t||t<1)&&(t=1);let i=((n=e[r=t])||(n=e[r]=new rE(1,1,r,r).translate(.5,.5,0)),n);["position","normal","uv"].forEach(e=>{this.attributes[e]=i.attributes[e].clone()}),this.setIndex(i.getIndex().clone())}}get detail(){return this._detail}set curveRadius(e){e!==this._curveRadius&&(this._curveRadius=e,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(e,r,s,a,o){n(this,"aTroikaGlyphBounds",e,4),n(this,t,r,1),n(this,"aTroikaGlyphColor",o,3),this._blockBounds=s,this._chunkedBounds=a,i(this,r.length),this._updateBounds()}_updateBounds(){let e=this._blockBounds;if(e){let{curveRadius:t,boundingBox:r}=this;if(t){let{PI:n,floor:i,min:s,max:a,sin:o,cos:l}=Math,h=n/2,c=2*n,u=Math.abs(t),d=e[0]/u,p=e[2]/u,f=i((d+h)/c)!==i((p+h)/c)?-u:s(o(d)*u,o(p)*u),m=i((d-h)/c)!==i((p-h)/c)?u:a(o(d)*u,o(p)*u),g=i((d+n)/c)!==i((p+n)/c)?2*u:a(u-l(d)*u,u-l(p)*u);r.min.set(f,e[1],t<0?-g:0),r.max.set(m,e[3],t<0?0:g)}else r.min.set(e[0],e[1],0),r.max.set(e[2],e[3],0);r.getBoundingSphere(this.boundingSphere)}}applyClipRect(e){let r=this.getAttribute(t).count,n=this._chunkedBounds;if(n)for(let t=n.length;t--;){r=n[t].end;let i=n[t].rect;if(i[1]<e.w&&i[3]>e.y&&i[0]<e.z&&i[2]>e.x)break}i(this,r)}}function n(e,t,r,n){let i=e.getAttribute(t);r?i&&i.array.length===r.length?(i.array.set(r),i.needsUpdate=!0):(e.setAttribute(t,new so(r,n)),delete e._maxInstanceCount,e.dispose()):i&&e.deleteAttribute(t)}function i(e,t){e[e.hasOwnProperty("instanceCount")?"instanceCount":"maxInstancedCount"]=t}return r.prototype.setAttribute||(r.prototype.setAttribute=function(e,t){return this.attributes[e]=t,this}),r})(),fz=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaDistanceOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,fG=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaDistanceOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaDistanceOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,fH=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaDistanceOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaOutlineOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of encoding in SDFGenerator.js
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,fV=`
float aaDist = troikaGetAADist();
float distance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(distance, uTroikaDistanceOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  distance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`,fW=(()=>{let e=new tO({color:16777215,side:2,transparent:!0}),t=new e0,r=new eS,n=new eS,i=[],s=new eS,a="+x+y";function o(e){return Array.isArray(e)?e[0]:e}let l=()=>{let t=new rs(new rE(1,1),e);return l=()=>t,t},h=()=>{let t=new rs(new rE(1,1,32,1),e);return h=()=>t,t},c={type:"syncstart"},u={type:"synccomplete"},d=["font","fontSize","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],p=d.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");class f extends rs{constructor(){super(new fB,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.fontSize=.1,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=8421504,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=a,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.debugSDF=!1}sync(e){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(e):(this._isSyncing=!0,this.dispatchEvent(c),fU({text:this.text,font:this.font,fontSize:this.fontSize||.1,letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize},t=>{this._isSyncing=!1,this._textRenderInfo=t,this.geometry.updateGlyphs(t.glyphBounds,t.glyphAtlasIndices,t.blockBounds,t.chunkedBounds,t.glyphColors);let r=this._queuedSyncs;r&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{r.forEach(e=>e&&e())})),this.dispatchEvent(u),e&&e()})))}onBeforeRender(e,t,r,n,i,s){this.sync(),i.isTroikaTextMaterial&&this._prepareForRender(i)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}get material(){let t=this._derivedMaterial,r=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=e.clone());if(t&&t.baseMaterial===r||(t=this._derivedMaterial=function(e){let t=function e(t,r){let n=function(e){let t=JSON.stringify(e,fT),r=fA.get(t);return null==r&&fA.set(t,r=++fE),r}(r),i=fb.get(t);if(i||fb.set(t,i=Object.create(null)),i[n])return new i[n];let s=`_onBeforeCompile${n}`,a=function(e){t.onBeforeCompile.call(this,e);let i=this.customProgramCacheKey()+"|"+e.vertexShader+"|"+e.fragmentShader,a=fw[i];if(!a){let t=function({vertexShader:e,fragmentShader:t},r,n){let{vertexDefs:i,vertexMainIntro:s,vertexMainOutro:a,vertexTransform:o,fragmentDefs:l,fragmentMainIntro:h,fragmentMainOutro:c,fragmentColorTransform:u,customRewriter:d,timeUniform:p}=r;if(i=i||"",s=s||"",a=a||"",l=l||"",h=h||"",c=c||"",(o||d)&&(e=fv(e)),(u||d)&&(t=fv(t=t.replace(/^[ \t]*#include <((?:tonemapping|encodings|fog|premultiplied_alpha|dithering)_fragment)>/gm,"\n//!BEGIN_POST_CHUNK $1\n$&\n//!END_POST_CHUNK\n"))),d){let r=d({vertexShader:e,fragmentShader:t});e=r.vertexShader,t=r.fragmentShader}if(u){let e=[];t=t.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,t=>(e.push(t),"")),c=`${u}
${e.join("\n")}
${c}`}if(p){let e=`
uniform float ${p};
`;i=e+i,l=e+l}return o&&(e=`vec3 troika_position_${n};
vec3 troika_normal_${n};
vec2 troika_uv_${n};
${e}
`,i=`${i}
void troikaVertexTransform${n}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${o}
}
`,s=`
troika_position_${n} = vec3(position);
troika_normal_${n} = vec3(normal);
troika_uv_${n} = vec2(uv);
troikaVertexTransform${n}(troika_position_${n}, troika_normal_${n}, troika_uv_${n});
${s}
`,e=e.replace(/\b(position|normal|uv)\b/g,(e,t,r,i)=>/\battribute\s+vec[23]\s+$/.test(i.substr(0,r))?t:`troika_${t}_${n}`)),{vertexShader:e=fM(e,n,i,s,a),fragmentShader:t=fM(t,n,l,h,c)}}(e,r,n);a=fw[i]=t}e.vertexShader=a.vertexShader,e.fragmentShader=a.fragmentShader,fx(e.uniforms,this.uniforms),r.timeUniform&&(e.uniforms[r.timeUniform]={get value(){return Date.now()-f_}}),this[s]&&this[s](e)},o=function(){return l(r.chained?t:t.clone())},l=function(e){let i=Object.create(e,h);return Object.defineProperty(i,"baseMaterial",{value:t}),Object.defineProperty(i,"id",{value:fS++}),i.uuid=function(){let e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(fy[255&e]+fy[e>>8&255]+fy[e>>16&255]+fy[e>>24&255]+"-"+fy[255&t]+fy[t>>8&255]+"-"+fy[t>>16&15|64]+fy[t>>24&255]+"-"+fy[63&r|128]+fy[r>>8&255]+"-"+fy[r>>16&255]+fy[r>>24&255]+fy[255&n]+fy[n>>8&255]+fy[n>>16&255]+fy[n>>24&255]).toUpperCase()}(),i.uniforms=fx({},e.uniforms,r.uniforms),i.defines=fx({},e.defines,r.defines),i.defines[`TROIKA_DERIVED_MATERIAL_${n}`]="",i.extensions=fx({},e.extensions,r.extensions),i._listeners=void 0,i},h={constructor:{value:o},isDerivedMaterial:{value:!0},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return n}},onBeforeCompile:{get:()=>a,set(e){this[s]=e}},copy:{writable:!0,configurable:!0,value:function(e){return t.copy.call(this,e),t.isShaderMaterial||t.isDerivedMaterial||(fx(this.extensions,e.extensions),fx(this.defines,e.defines),fx(this.uniforms,rc.clone(e.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){return l(new t.constructor).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let n=this._depthMaterial;return n||((n=this._depthMaterial=e(t.isDerivedMaterial?t.getDepthMaterial():new iA({depthPacking:3201}),r)).defines.IS_DEPTH_MATERIAL="",n.uniforms=this.uniforms),n}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let n=this._distanceMaterial;return n||((n=this._distanceMaterial=e(t.isDerivedMaterial?t.getDistanceMaterial():new iC,r)).defines.IS_DISTANCE_MATERIAL="",n.uniforms=this.uniforms),n}},dispose:{writable:!0,configurable:!0,value(){let{_depthMaterial:e,_distanceMaterial:r}=this;e&&e.dispose(),r&&r.dispose(),t.dispose.call(this)}}};return i[n]=o,new o}(e,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new ep},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new ex(0,0,0,0)},uTroikaClipRect:{value:new ex(0,0,0,0)},uTroikaDistanceOffset:{value:0},uTroikaOutlineOpacity:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new ep},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new tU},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new ef},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:fz,vertexTransform:fG,fragmentDefs:fH,fragmentColorTransform:fV,customRewriter({vertexShader:e,fragmentShader:t}){let r=/\buniform\s+vec3\s+diffuse\b/;return r.test(t)&&(t=t.replace(r,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),r.test(e)||(e=e.replace(fg,"uniform vec3 diffuse;\n$&\nvTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;\n"))),{vertexShader:e,fragmentShader:t}}});return t.transparent=!0,Object.defineProperties(t,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),t}(r),r.addEventListener("dispose",function e(){r.removeEventListener("dispose",e),t.dispose()})),!this.outlineWidth&&!this.outlineBlur&&!this.outlineOffsetX&&!this.outlineOffsetY)return t;{let e=t._outlineMtl;return e||((e=t._outlineMtl=Object.create(t,{id:{value:t.id+.1}})).isTextOutlineMaterial=!0,e.depthWrite=!1,e.map=null,t.addEventListener("dispose",function r(){t.removeEventListener("dispose",r),e.dispose()})),[e,t]}}set material(e){e&&e.isTroikaTextMaterial?(this._derivedMaterial=e,this._baseMaterial=e.baseMaterial):this._baseMaterial=e}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(e){this.geometry.detail=e}get curveRadius(){return this.geometry.curveRadius}set curveRadius(e){this.geometry.curveRadius=e}get customDepthMaterial(){return o(this.material).getDepthMaterial()}get customDistanceMaterial(){return o(this.material).getDistanceMaterial()}_prepareForRender(e){let i=e.isTextOutlineMaterial,o=e.uniforms,l=this.textRenderInfo;if(l){let e,t,r;let{sdfTexture:n,blockBounds:s}=l;o.uTroikaSDFTexture.value=n,o.uTroikaSDFTextureSize.value.set(n.image.width,n.image.height),o.uTroikaSDFGlyphSize.value=l.sdfGlyphSize,o.uTroikaSDFExponent.value=l.sdfExponent,o.uTroikaTotalBounds.value.fromArray(s),o.uTroikaUseGlyphColors.value=!i&&!!l.glyphColors;let a=0,h=0,c=0,u=0,d=0;if(i){let{outlineWidth:t,outlineOffsetX:r,outlineOffsetY:n,outlineBlur:i,outlineOpacity:s}=this;a=this._parsePercent(t)||0,h=Math.max(0,this._parsePercent(i)||0),e=s,u=this._parsePercent(r)||0,d=this._parsePercent(n)||0}else(c=Math.max(0,this._parsePercent(this.strokeWidth)||0))&&(r=this.strokeColor,o.uTroikaStrokeColor.value.set(null==r?8421504:r),null==(t=this.strokeOpacity)&&(t=1)),e=this.fillOpacity;o.uTroikaDistanceOffset.value=a,o.uTroikaPositionOffset.value.set(u,d),o.uTroikaBlurRadius.value=h,o.uTroikaStrokeWidth.value=c,o.uTroikaStrokeOpacity.value=t,o.uTroikaFillOpacity.value=null==e?1:e,o.uTroikaCurveRadius.value=this.curveRadius||0;let p=this.clipRect;if(p&&Array.isArray(p)&&4===p.length)o.uTroikaClipRect.value.fromArray(p);else{let e=100*(this.fontSize||.1);o.uTroikaClipRect.value.set(s[0]-e,s[1]-e,s[2]+e,s[3]+e)}this.geometry.applyClipRect(o.uTroikaClipRect.value)}o.uTroikaSDFDebug.value=!!this.debugSDF,e.polygonOffset=!!this.depthOffset,e.polygonOffsetFactor=e.polygonOffsetUnits=this.depthOffset||0;let h=i?this.outlineColor||0:this.color;if(null==h)delete e.color;else{let t=e.hasOwnProperty("color")?e.color:e.color=new tU;(h!==t._input||"object"==typeof h)&&t.set(t._input=h)}let c=this.orientation||a;if(c!==e._orientation){let i=o.uTroikaOrient.value,l=(c=c.replace(/[^-+xyz]/g,""))!==a&&c.match(/^([-+])([xyz])([-+])([xyz])$/);if(l){let[,e,a,o,h]=l;r.set(0,0,0)[a]="-"===e?1:-1,n.set(0,0,0)[h]="-"===o?-1:1,t.lookAt(s,r.cross(n),n),i.setFromMatrix4(t)}else i.identity();e._orientation=c}}_parsePercent(e){if("string"==typeof e){let t=e.match(/^(-?[\d.]+)%$/),r=t?parseFloat(t[1]):NaN;e=(isNaN(r)?0:r/100)*this.fontSize}return e}localPositionToTextCoords(e,t=new ep){t.copy(e);let r=this.curveRadius;return r&&(t.x=Math.atan2(e.x,Math.abs(r)-Math.abs(e.z))*Math.abs(r)),t}worldPositionToTextCoords(e,t=new ep){return r.copy(e),this.localPositionToTextCoords(this.worldToLocal(r),t)}raycast(e,t){let{textRenderInfo:r,curveRadius:n}=this;if(r){let s=r.blockBounds,a=n?h():l(),o=a.geometry,{position:c,uv:u}=o.attributes;for(let e=0;e<u.count;e++){let t=s[0]+u.getX(e)*(s[2]-s[0]),r=s[1]+u.getY(e)*(s[3]-s[1]),i=0;n&&(i=n-Math.cos(t/n)*n,t=Math.sin(t/n)*n),c.setXYZ(e,t,r,i)}o.boundingSphere=this.geometry.boundingSphere,o.boundingBox=this.geometry.boundingBox,a.matrixWorld=this.matrixWorld,a.material.side=this.material.side,i.length=0,a.raycast(e,i);for(let e=0;e<i.length;e++)i[e].object=this,t.push(i[e])}}copy(e){let t=this.geometry;return super.copy(e),this.geometry=t,p.forEach(t=>{this[t]=e[t]}),this}clone(){return new this.constructor().copy(this)}}d.forEach(e=>{let t="_private_"+e;Object.defineProperty(f.prototype,e,{get(){return this[t]},set(e){e!==this[t]&&(this[t]=e,this._needsSync=!0)}})});let m=!1;return Object.defineProperty(f.prototype,"anchor",{get(){return this._deprecated_anchor},set(e){this._deprecated_anchor=e,m||(console.warn("TextMesh: `anchor` has been deprecated; use `anchorX` and `anchorY` instead."),m=!0),Array.isArray(e)?(this.anchorX=`${100*(+e[0]||0)}%`,this.anchorY=`${100*(+e[1]||0)}%`):this.anchorX=this.anchorY=0}}),f})(),fj=new WeakMap;new WeakMap;const fq=m8("beige_wall_001",.2,13421772);var fX=m8("plywood",.5,6708552),fY=m8("beach",10,6708552),fJ=new tO({color:13426943}),fZ=new tO({transparent:!0,opacity:0});function f$(e,t,r=1){var n=new iD,i=e.text,s=e.links||[],a=t/10,o=new rs(new ro(t,a,.5),new ab({color:"#eee"}));o.layers.enable(1),o.name="plane",n.add(o);var l=new rs(new ro(t+4*r*2,a,.1),fZ);n.add(l);let h=i.match(/[\uac00-\ud7af]|[\u1100-\u11ff]|[\u3130-\u318f]|[\ua960-\ua97f]|[\ud7b0-\ud7ff]/g);var c=new fW;return c.text=i,c.fontSize=1*r,c.font="fonts/GoNotoCurrent.ttf",h&&(c.font="fonts/NotoSansKR-Regular.otf"),c.anchorX="center",c.anchorY="middle",c.color=0,c.maxWidth=t-2*r,c.position.z=.27,n.add(c),c.sync(()=>{var e=new eE().setFromObject(c),l=Math.max(e.max.x-e.min.x,e.max.z-e.min.z),h=e.max.y-e.min.y;let u=new iD;for(let e of s){let t=e.text,r=e.page,n=RegExp(function(e){if("string"!=typeof e)throw TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}(t),"gi").exec(i);if(n){let e=n.index,i=e+t.length;for(let t of function(e,t,r){let n;if(e){let i=fj.get(e);if(i&&i.start===t&&i.end===r)return i.rects;let{caretPositions:s,caretHeight:a}=e;if(r<t){let e=t;t=r,r=e}t=Math.max(t,0),r=Math.min(r,s.length+1),n=[];let o=null;for(let e=t;e<r;e++){let t=s[3*e],r=s[3*e+1],i=Math.min(t,r),l=Math.max(t,r),h=s[3*e+2];(!o||h!==o.bottom||i>o.right||l<o.left)&&(o={left:1/0,right:-1/0,bottom:h,top:h+a},n.push(o)),o.left=Math.min(i,o.left),o.right=Math.max(l,o.right)}n.sort((e,t)=>t.bottom-e.bottom||e.left-t.left);for(let e=n.length-1;e-- >0;){let t=n[e],r=n[e+1];t.bottom===r.bottom&&t.left<=r.right&&t.right>=r.left&&(r.left=Math.min(r.left,t.left),r.right=Math.max(r.right,t.right),n.splice(e,1))}fj.set(e,{start:t,end:r,rects:n})}return n}(c.textRenderInfo,e,i)){var d=new rs(new ro(t.right-t.left,t.top-t.bottom,.01),fJ);d.position.y=(t.top+t.bottom)/2,d.position.x=(t.left+t.right)/2,d.layers.enable(1),d.myLink=r,u.add(d)}}}u.position.z=.26,n.add(u),l>0&&(o.scale.y=(h+2*r)/a,o.scale.x=(l+2*r)/t)}),n}function fK(e){for(var t=0;t<e.attributes.uv.count;t++){let i=e.attributes.normal.getX(t),s=e.attributes.normal.getY(t),a=e.attributes.normal.getZ(t),o=e.attributes.position.getX(t),l=e.attributes.position.getY(t),h=e.attributes.position.getZ(t);var r=e.attributes.uv.getX(t),n=e.attributes.uv.getY(t);1===i&&0===s&&0===a?(r*=-h/5,n*=l/5):0===i&&1===s&&0===a?(r*=o/5,n*=-h/5):0===i&&0===s&&1===a?(r*=o/5,n*=l/5):-1===i&&0===s&&0===a?(r*=h/5,n*=-l/5):0===i&&-1===s&&0===a?(r*=-o/5,n*=h/5):0===i&&0===s&&-1===a?(r*=-o/5,n*=-l/5):console.log("UV",i,s,a,r,n),e.attributes.uv.setXY(t,r,n)}}function fQ(e,t){e instanceof eS&&(e=new ep(e.x,e.z)),t instanceof eS&&(t=new ep(t.x,t.z));var r=new ro(e.distanceTo(t)+2,50,2);fK(r);var n=new rs(r,fq);SETTINGS.shadows&&(n.castShadow=!0,n.receiveShadow=!0);var i=e.add(t).divideScalar(2);n.position.x=i.x,n.position.z=i.y;let s=Math.atan2(e.y-t.y,e.x-t.x);return n.rotateY(s),n.layers.enable(1),n}const f0=new te(0,0,0,"YXZ"),f1=new eS,f2={type:"change"},f3={type:"lock"},f4={type:"unlock"},f5=Math.PI/2;class f6 extends ee{constructor(e,t){super(),void 0===t&&(console.warn('THREE.PointerLockControls: The second parameter "domElement" is now mandatory.'),t=document.body),this.domElement=t,this.isLocked=!1,this.minPolarAngle=0,this.maxPolarAngle=Math.PI;let r=this;function n(t){if(!1===r.isLocked)return;let n=t.movementX||t.mozMovementX||t.webkitMovementX||0,i=t.movementY||t.mozMovementY||t.webkitMovementY||0;f0.setFromQuaternion(e.quaternion),f0.y-=.002*n,f0.x-=.002*i,f0.x=Math.max(f5-r.maxPolarAngle,Math.min(f5-r.minPolarAngle,f0.x)),e.quaternion.setFromEuler(f0),r.dispatchEvent(f2)}function i(){r.domElement.ownerDocument.pointerLockElement===r.domElement?(r.dispatchEvent(f3),r.isLocked=!0):(r.dispatchEvent(f4),r.isLocked=!1)}function s(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}this.connect=function(){r.domElement.ownerDocument.addEventListener("mousemove",n),r.domElement.ownerDocument.addEventListener("pointerlockchange",i),r.domElement.ownerDocument.addEventListener("pointerlockerror",s)},this.disconnect=function(){r.domElement.ownerDocument.removeEventListener("mousemove",n),r.domElement.ownerDocument.removeEventListener("pointerlockchange",i),r.domElement.ownerDocument.removeEventListener("pointerlockerror",s)},this.dispose=function(){this.disconnect()},this.getObject=function(){return e},this.getDirection=function(){let t=new eS(0,0,-1);return function(r){return r.copy(t).applyQuaternion(e.quaternion)}}(),this.moveForward=function(t){f1.setFromMatrixColumn(e.matrix,0),f1.crossVectors(e.up,f1),e.position.addScaledVector(f1,t)},this.moveRight=function(t){f1.setFromMatrixColumn(e.matrix,0),e.position.addScaledVector(f1,t)},this.lock=function(){this.domElement.requestPointerLock()},this.unlock=function(){r.domElement.ownerDocument.exitPointerLock()},this.connect()}}class f8 extends aB{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new mr(e)}),this.register(function(e){return new mo(e)}),this.register(function(e){return new ml(e)}),this.register(function(e){return new mn(e)}),this.register(function(e){return new mi(e)}),this.register(function(e){return new ms(e)}),this.register(function(e){return new ma(e)}),this.register(function(e){return new me(e)}),this.register(function(e){return new mh(e)})}load(e,t,r,n){let i;let s=this;i=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:ot.extractUrlBase(e),this.manager.itemStart(e);let a=function(t){n?n(t):console.error(t),s.manager.itemError(e),s.manager.itemEnd(e)},o=new aG(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(r){try{s.parse(r,i,function(r){t(r),s.manager.itemEnd(e)},a)}catch(e){a(e)}},r,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return -1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return -1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,r,n){let i;let s={},a={};if("string"==typeof e)i=e;else if(ot.decodeText(new Uint8Array(e,0,4))===mc){try{s[f9.KHR_BINARY_GLTF]=new md(e)}catch(e){n&&n(e);return}i=s[f9.KHR_BINARY_GLTF].content}else i=ot.decodeText(new Uint8Array(e));let o=JSON.parse(i);if(void 0===o.asset||o.asset.version[0]<2){n&&n(Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}let l=new mU(o,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){let t=this.pluginCallbacks[e](l);a[t.name]=t,s[t.name]=!0}if(o.extensionsUsed)for(let e=0;e<o.extensionsUsed.length;++e){let t=o.extensionsUsed[e],r=o.extensionsRequired||[];switch(t){case f9.KHR_MATERIALS_UNLIT:s[t]=new mt;break;case f9.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:s[t]=new mg;break;case f9.KHR_DRACO_MESH_COMPRESSION:s[t]=new mp(o,this.dracoLoader);break;case f9.KHR_TEXTURE_TRANSFORM:s[t]=new mf;break;case f9.KHR_MESH_QUANTIZATION:s[t]=new mv;break;default:r.indexOf(t)>=0&&void 0===a[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}l.setExtensions(s),l.setPlugins(a),l.parse(r,n)}}function f7(){let e={};return{get:function(t){return e[t]},add:function(t,r){e[t]=r},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const f9={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class me{constructor(e){this.parser=e,this.name=f9.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){let e=this.parser,t=this.parser.json.nodes||[];for(let r=0,n=t.length;r<n;r++){let n=t[r];n.extensions&&n.extensions[this.name]&&void 0!==n.extensions[this.name].light&&e._addNodeRef(this.cache,n.extensions[this.name].light)}}_loadLight(e){let t;let r=this.parser,n="light:"+e,i=r.cache.get(n);if(i)return i;let s=r.json,a=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e],o=new tU(16777215);void 0!==a.color&&o.fromArray(a.color);let l=void 0!==a.range?a.range:0;switch(a.type){case"directional":(t=new a8(o)).target.position.set(0,0,-1),t.add(t.target);break;case"point":(t=new a5(o)).distance=l;break;case"spot":(t=new a0(o)).distance=l,a.spot=a.spot||{},a.spot.innerConeAngle=void 0!==a.spot.innerConeAngle?a.spot.innerConeAngle:0,a.spot.outerConeAngle=void 0!==a.spot.outerConeAngle?a.spot.outerConeAngle:Math.PI/4,t.angle=a.spot.outerConeAngle,t.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,t.target.position.set(0,0,-1),t.add(t.target);break;default:throw Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return t.position.set(0,0,0),t.decay=2,void 0!==a.intensity&&(t.intensity=a.intensity),t.name=r.createUniqueName(a.name||"light_"+e),i=Promise.resolve(t),r.cache.add(n,i),i}createNodeAttachment(e){let t=this,r=this.parser,n=r.json.nodes[e],i=(n.extensions&&n.extensions[this.name]||{}).light;return void 0===i?null:this._loadLight(i).then(function(e){return r._getNodeRef(t.cache,i,e)})}}class mt{constructor(){this.name=f9.KHR_MATERIALS_UNLIT}getMaterialType(){return tO}extendParams(e,t,r){let n=[];e.color=new tU(1,1,1),e.opacity=1;let i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){let t=i.baseColorFactor;e.color.fromArray(t),e.opacity=t[3]}void 0!==i.baseColorTexture&&n.push(r.assignTexture(e,"map",i.baseColorTexture))}return Promise.all(n)}}class mr{constructor(e){this.parser=e,this.name=f9.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?aw:null}extendMaterialParams(e,t){let r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();let i=[],s=n.extensions[this.name];if(void 0!==s.clearcoatFactor&&(t.clearcoat=s.clearcoatFactor),void 0!==s.clearcoatTexture&&i.push(r.assignTexture(t,"clearcoatMap",s.clearcoatTexture)),void 0!==s.clearcoatRoughnessFactor&&(t.clearcoatRoughness=s.clearcoatRoughnessFactor),void 0!==s.clearcoatRoughnessTexture&&i.push(r.assignTexture(t,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),void 0!==s.clearcoatNormalTexture&&(i.push(r.assignTexture(t,"clearcoatNormalMap",s.clearcoatNormalTexture)),void 0!==s.clearcoatNormalTexture.scale)){let e=s.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new ep(e,-e)}return Promise.all(i)}}class mn{constructor(e){this.parser=e,this.name=f9.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?aw:null}extendMaterialParams(e,t){let r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();let i=[],s=n.extensions[this.name];return void 0!==s.transmissionFactor&&(t.transmission=s.transmissionFactor),void 0!==s.transmissionTexture&&i.push(r.assignTexture(t,"transmissionMap",s.transmissionTexture)),Promise.all(i)}}class mi{constructor(e){this.parser=e,this.name=f9.KHR_MATERIALS_VOLUME}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?aw:null}extendMaterialParams(e,t){let r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();let i=[],s=n.extensions[this.name];t.thickness=void 0!==s.thicknessFactor?s.thicknessFactor:0,void 0!==s.thicknessTexture&&i.push(r.assignTexture(t,"thicknessMap",s.thicknessTexture)),t.attenuationDistance=s.attenuationDistance||0;let a=s.attenuationColor||[1,1,1];return t.attenuationTint=new tU(a[0],a[1],a[2]),Promise.all(i)}}class ms{constructor(e){this.parser=e,this.name=f9.KHR_MATERIALS_IOR}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?aw:null}extendMaterialParams(e,t){let r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let n=r.extensions[this.name];return t.ior=void 0!==n.ior?n.ior:1.5,Promise.resolve()}}class ma{constructor(e){this.parser=e,this.name=f9.KHR_MATERIALS_SPECULAR}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?aw:null}extendMaterialParams(e,t){let r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();let i=[],s=n.extensions[this.name];t.specularIntensity=void 0!==s.specularFactor?s.specularFactor:1,void 0!==s.specularTexture&&i.push(r.assignTexture(t,"specularIntensityMap",s.specularTexture));let a=s.specularColorFactor||[1,1,1];return t.specularTint=new tU(a[0],a[1],a[2]),void 0!==s.specularColorTexture&&i.push(r.assignTexture(t,"specularTintMap",s.specularColorTexture).then(function(e){e.encoding=3001})),Promise.all(i)}}class mo{constructor(e){this.parser=e,this.name=f9.KHR_TEXTURE_BASISU}loadTexture(e){let t=this.parser,r=t.json,n=r.textures[e];if(!n.extensions||!n.extensions[this.name])return null;let i=n.extensions[this.name],s=r.images[i.source],a=t.options.ktx2Loader;if(!a){if(!(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0))return null;throw Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures")}return t.loadTextureImage(e,s,a)}}class ml{constructor(e){this.parser=e,this.name=f9.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){let t=this.name,r=this.parser,n=r.json,i=n.textures[e];if(!i.extensions||!i.extensions[t])return null;let s=i.extensions[t],a=n.images[s.source],o=r.textureLoader;if(a.uri){let e=r.options.manager.getHandler(a.uri);null!==e&&(o=e)}return this.detectSupport().then(function(i){if(i)return r.loadTextureImage(e,a,o);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){let t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class mh{constructor(e){this.name=f9.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){let t=this.parser.json,r=t.bufferViews[e];if(!r.extensions||!r.extensions[this.name])return null;{let e=r.extensions[this.name],n=this.parser.getDependency("buffer",e.buffer),i=this.parser.options.meshoptDecoder;if(!i||!i.supported){if(!(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0))return null;throw Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files")}return Promise.all([n,i.ready]).then(function(t){let r=e.byteOffset||0,n=e.byteLength||0,s=e.count,a=e.byteStride,o=new ArrayBuffer(s*a),l=new Uint8Array(t[0],r,n);return i.decodeGltfBuffer(new Uint8Array(o),s,a,l,e.mode,e.filter),o})}}}const mc="glTF",mu={JSON:1313821514,BIN:5130562};class md{constructor(e){this.name=f9.KHR_BINARY_GLTF,this.content=null,this.body=null;let t=new DataView(e,0,12);if(this.header={magic:ot.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==mc)throw Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw Error("THREE.GLTFLoader: Legacy binary file detected.");let r=this.header.length-12,n=new DataView(e,12),i=0;for(;i<r;){let t=n.getUint32(i,!0);i+=4;let r=n.getUint32(i,!0);if(i+=4,r===mu.JSON){let r=new Uint8Array(e,12+i,t);this.content=ot.decodeText(r)}else if(r===mu.BIN){let r=12+i;this.body=e.slice(r,r+t)}i+=t}if(null===this.content)throw Error("THREE.GLTFLoader: JSON content not found.")}}class mp{constructor(e,t){if(!t)throw Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=f9.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){let r=this.json,n=this.dracoLoader,i=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes,a={},o={},l={};for(let e in s)a[mE[e]||e.toLowerCase()]=s[e];for(let t in e.attributes){let n=mE[t]||t.toLowerCase();if(void 0!==s[t]){let i=r.accessors[e.attributes[t]],s=mw[i.componentType];l[n]=s,o[n]=!0===i.normalized}}return t.getDependency("bufferView",i).then(function(e){return new Promise(function(t){n.decodeDracoFile(e,function(e){for(let t in e.attributes){let r=e.attributes[t],n=o[t];void 0!==n&&(r.normalized=n)}t(e)},a,l)})})}}class mf{constructor(){this.name=f9.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class mm extends ab{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;let t={specular:{value:new tU().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=t,this.onBeforeCompile=function(e){for(let r in t)e.uniforms[r]=t[r];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>","#ifdef USE_SPECULARMAP\n	uniform sampler2D specularMap;\n#endif").replace("#include <metalnessmap_pars_fragment>","#ifdef USE_GLOSSINESSMAP\n	uniform sampler2D glossinessMap;\n#endif").replace("#include <roughnessmap_fragment>","vec3 specularFactor = specular;\n#ifdef USE_SPECULARMAP\n	vec4 texelSpecular = texture2D( specularMap, vUv );\n	texelSpecular = sRGBToLinear( texelSpecular );\n	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture\n	specularFactor *= texelSpecular.rgb;\n#endif").replace("#include <metalnessmap_fragment>","float glossinessFactor = glossiness;\n#ifdef USE_GLOSSINESSMAP\n	vec4 texelGlossiness = texture2D( glossinessMap, vUv );\n	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture\n	glossinessFactor *= texelGlossiness.a;\n#endif").replace("#include <lights_physical_fragment>","PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.\nmaterial.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\nmaterial.specularColor = specularFactor;")},Object.defineProperties(this,{specular:{get:function(){return t.specular.value},set:function(e){t.specular.value=e}},specularMap:{get:function(){return t.specularMap.value},set:function(e){t.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return t.glossiness.value},set:function(e){t.glossiness.value=e}},glossinessMap:{get:function(){return t.glossinessMap.value},set:function(e){t.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class mg{constructor(){this.name=f9.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return mm}extendParams(e,t,r){let n=t.extensions[this.name];e.color=new tU(1,1,1),e.opacity=1;let i=[];if(Array.isArray(n.diffuseFactor)){let t=n.diffuseFactor;e.color.fromArray(t),e.opacity=t[3]}if(void 0!==n.diffuseTexture&&i.push(r.assignTexture(e,"map",n.diffuseTexture)),e.emissive=new tU(0,0,0),e.glossiness=void 0!==n.glossinessFactor?n.glossinessFactor:1,e.specular=new tU(1,1,1),Array.isArray(n.specularFactor)&&e.specular.fromArray(n.specularFactor),void 0!==n.specularGlossinessTexture){let t=n.specularGlossinessTexture;i.push(r.assignTexture(e,"glossinessMap",t)),i.push(r.assignTexture(e,"specularMap",t))}return Promise.all(i)}createMaterial(e){let t=new mm(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=0,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}class mv{constructor(){this.name=f9.KHR_MESH_QUANTIZATION}}class my extends aM{constructor(e,t,r,n){super(e,t,r,n)}copySampleValue_(e){let t=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=e*n*3+n;for(let e=0;e!==n;e++)t[e]=r[i+e];return t}}my.prototype.beforeStart_=my.prototype.copySampleValue_,my.prototype.afterEnd_=my.prototype.copySampleValue_,my.prototype.interpolate_=function(e,t,r,n){let i=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=2*a,l=3*a,h=n-t,c=(r-t)/h,u=c*c,d=u*c,p=e*l,f=p-l,m=-2*d+3*u,g=d-u,v=1-m,y=g-u+c;for(let e=0;e!==a;e++){let t=s[f+e+a],r=s[f+e+o]*h,n=s[p+e+a],l=s[p+e]*h;i[e]=v*t+y*r+m*n+g*l}return i};const mx=new ew;class m_ extends my{interpolate_(e,t,r,n){let i=super.interpolate_(e,t,r,n);return mx.fromArray(i).normalize().toArray(i),i}}const mb={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},mw={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},mS={9728:1003,9729:1006,9984:1004,9985:1007,9986:1005,9987:1008},mM={33071:1001,33648:1002,10497:1e3},mT={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},mE={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},mA={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},mC={CUBICSPLINE:void 0,LINEAR:2301,STEP:2300},mR={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function mL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e))?e:t+e}function mI(e,t,r){for(let n in r.extensions)void 0===e[n]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[n]=r.extensions[n])}function mP(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function mk(e){let t="",r=Object.keys(e).sort();for(let n=0,i=r.length;n<i;n++)t+=r[n]+":"+e[r[n]]+";";return t}function mD(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class mU{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new f7,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},"undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new on(this.options.manager):this.textureLoader=new aW(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new aG(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){let r=this,n=this.json,i=this.extensions;this.cache.removeAll(),this._invokeAll(function(e){return e._markDefs&&e._markDefs()}),Promise.all(this._invokeAll(function(e){return e.beforeRoot&&e.beforeRoot()})).then(function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])}).then(function(t){let s={scene:t[0][n.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:n.asset,parser:r,userData:{}};mI(i,s,n),mP(s,n),Promise.all(r._invokeAll(function(e){return e.afterRoot&&e.afterRoot(s)})).then(function(){e(s)})}).catch(t)}_markDefs(){let e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[];for(let r=0,n=t.length;r<n;r++){let n=t[r].joints;for(let t=0,r=n.length;t<r;t++)e[n[t]].isBone=!0}for(let t=0,n=e.length;t<n;t++){let n=e[t];void 0!==n.mesh&&(this._addNodeRef(this.meshCache,n.mesh),void 0!==n.skin&&(r[n.mesh].isSkinnedMesh=!0)),void 0!==n.camera&&this._addNodeRef(this.cameraCache,n.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,r){if(e.refs[t]<=1)return r;let n=r.clone();return n.name+="_instance_"+e.uses[t]++,n}_invokeOne(e){let t=Object.values(this.plugins);t.push(this);for(let r=0;r<t.length;r++){let n=e(t[r]);if(n)return n}return null}_invokeAll(e){let t=Object.values(this.plugins);t.unshift(this);let r=[];for(let n=0;n<t.length;n++){let i=e(t[n]);i&&r.push(i)}return r}getDependency(e,t){let r=e+":"+t,n=this.cache.get(r);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this.loadNode(t);break;case"mesh":n=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(t)});break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(t)});break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(t)});break;case"texture":n=this._invokeOne(function(e){return e.loadTexture&&e.loadTexture(t)});break;case"skin":n=this.loadSkin(t);break;case"animation":n=this.loadAnimation(t);break;case"camera":n=this.loadCamera(t);break;default:throw Error("Unknown type: "+e)}this.cache.add(r,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){let r=this;t=Promise.all((this.json[e+("mesh"===e?"es":"s")]||[]).map(function(t,n){return r.getDependency(e,n)})),this.cache.add(e,t)}return t}loadBuffer(e){let t=this.json.buffers[e],r=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[f9.KHR_BINARY_GLTF].body);let n=this.options;return new Promise(function(e,i){r.load(mL(t.uri,n.path),e,void 0,function(){i(Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){let t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){let r=t.byteLength||0,n=t.byteOffset||0;return e.slice(n,n+r)})}loadAccessor(e){let t=this,r=this.json,n=this.json.accessors[e];if(void 0===n.bufferView&&void 0===n.sparse)return Promise.resolve(null);let i=[];return void 0!==n.bufferView?i.push(this.getDependency("bufferView",n.bufferView)):i.push(null),void 0!==n.sparse&&(i.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(i).then(function(e){let i;let s=e[0],a=mT[n.type],o=mw[n.componentType],l=o.BYTES_PER_ELEMENT,h=l*a,c=n.byteOffset||0,u=void 0!==n.bufferView?r.bufferViews[n.bufferView].byteStride:void 0,d=!0===n.normalized;if(u&&u!==h){let e=Math.floor(c/u),r="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+e+":"+n.count,h=t.cache.get(r);h||(h=new iV(new o(s,e*u,n.count*u/l),u/l),t.cache.add(r,h)),i=new ij(h,a,c%u/l,d)}else i=new tB(null===s?new o(n.count*a):new o(s,c,n.count*a),a,d);if(void 0!==n.sparse){let t=mT.SCALAR,r=mw[n.sparse.indices.componentType],l=n.sparse.indices.byteOffset||0,h=n.sparse.values.byteOffset||0,c=new r(e[1],l,n.sparse.count*t),u=new o(e[2],h,n.sparse.count*a);null!==s&&(i=new tB(i.array.slice(),i.itemSize,i.normalized));for(let e=0,t=c.length;e<t;e++){let t=c[e];if(i.setX(t,u[e*a]),a>=2&&i.setY(t,u[e*a+1]),a>=3&&i.setZ(t,u[e*a+2]),a>=4&&i.setW(t,u[e*a+3]),a>=5)throw Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return i})}loadTexture(e){let t=this.json,r=this.options,n=t.textures[e],i=t.images[n.source],s=this.textureLoader;if(i.uri){let e=r.manager.getHandler(i.uri);null!==e&&(s=e)}return this.loadTextureImage(e,i,s)}loadTextureImage(e,t,r){let n=this,i=this.json,s=this.options,a=i.textures[e],o=(t.uri||t.bufferView)+":"+a.sampler;if(this.textureCache[o])return this.textureCache[o];let l=self.URL||self.webkitURL,h=t.uri||"",c=!1,u=!0,d=h.search(/\.jpe?g($|\?)/i)>0||0===h.search(/^data\:image\/jpeg/);if(("image/jpeg"===t.mimeType||d)&&(u=!1),void 0!==t.bufferView)h=n.getDependency("bufferView",t.bufferView).then(function(e){if("image/png"===t.mimeType){let t=new DataView(e,25,1).getUint8(0,!1);u=6===t||4===t||3===t}c=!0;let r=new Blob([e],{type:t.mimeType});return h=l.createObjectURL(r)});else if(void 0===t.uri)throw Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");let p=Promise.resolve(h).then(function(e){return new Promise(function(t,n){let i=t;!0===r.isImageBitmapLoader&&(i=function(e){let r=new ev(e);r.needsUpdate=!0,t(r)}),r.load(mL(e,s.path),i,void 0,n)})}).then(function(t){!0===c&&l.revokeObjectURL(h),t.flipY=!1,a.name&&(t.name=a.name),u||(t.format=1022);let r=(i.samplers||{})[a.sampler]||{};return t.magFilter=mS[r.magFilter]||1006,t.minFilter=mS[r.minFilter]||1008,t.wrapS=mM[r.wrapS]||1e3,t.wrapT=mM[r.wrapT]||1e3,n.associations.set(t,{type:"textures",index:e}),t}).catch(function(){return console.error("THREE.GLTFLoader: Couldn't load texture",h),null});return this.textureCache[o]=p,p}assignTexture(e,t,r){let n=this;return this.getDependency("texture",r.index).then(function(i){if(void 0===r.texCoord||0==r.texCoord||"aoMap"===t&&1==r.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+r.texCoord+" for texture "+t+" not yet supported."),n.extensions[f9.KHR_TEXTURE_TRANSFORM]){let e=void 0!==r.extensions?r.extensions[f9.KHR_TEXTURE_TRANSFORM]:void 0;if(e){let t=n.associations.get(i);i=n.extensions[f9.KHR_TEXTURE_TRANSFORM].extendTexture(i,e),n.associations.set(i,t)}}return e[t]=i,i})}assignFinalMaterial(e){let t=e.geometry,r=e.material,n=void 0!==t.attributes.tangent,i=void 0!==t.attributes.color,s=void 0===t.attributes.normal;if(e.isPoints){let e="PointsMaterial:"+r.uuid,t=this.cache.get(e);t||(t=new sS,tC.prototype.copy.call(t,r),t.color.copy(r.color),t.map=r.map,t.sizeAttenuation=!1,this.cache.add(e,t)),r=t}else if(e.isLine){let e="LineBasicMaterial:"+r.uuid,t=this.cache.get(e);t||(t=new sd,tC.prototype.copy.call(t,r),t.color.copy(r.color),this.cache.add(e,t)),r=t}if(n||i||s){let e="ClonedMaterial:"+r.uuid+":";r.isGLTFSpecularGlossinessMaterial&&(e+="specular-glossiness:"),n&&(e+="vertex-tangents:"),i&&(e+="vertex-colors:"),s&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=r.clone(),i&&(t.vertexColors=!0),s&&(t.flatShading=!0),n&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(r))),r=t}r.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=r}getMaterialType(){return ab}loadMaterial(e){let t;let r=this,n=this.json,i=this.extensions,s=n.materials[e],a={},o=s.extensions||{},l=[];if(o[f9.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){let e=i[f9.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=e.getMaterialType(),l.push(e.extendParams(a,s,r))}else if(o[f9.KHR_MATERIALS_UNLIT]){let e=i[f9.KHR_MATERIALS_UNLIT];t=e.getMaterialType(),l.push(e.extendParams(a,s,r))}else{let n=s.pbrMetallicRoughness||{};if(a.color=new tU(1,1,1),a.opacity=1,Array.isArray(n.baseColorFactor)){let e=n.baseColorFactor;a.color.fromArray(e),a.opacity=e[3]}void 0!==n.baseColorTexture&&l.push(r.assignTexture(a,"map",n.baseColorTexture)),a.metalness=void 0!==n.metallicFactor?n.metallicFactor:1,a.roughness=void 0!==n.roughnessFactor?n.roughnessFactor:1,void 0!==n.metallicRoughnessTexture&&(l.push(r.assignTexture(a,"metalnessMap",n.metallicRoughnessTexture)),l.push(r.assignTexture(a,"roughnessMap",n.metallicRoughnessTexture))),t=this._invokeOne(function(t){return t.getMaterialType&&t.getMaterialType(e)}),l.push(Promise.all(this._invokeAll(function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,a)})))}!0===s.doubleSided&&(a.side=2);let h=s.alphaMode||mR.OPAQUE;return h===mR.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.format=1022,a.transparent=!1,h===mR.MASK&&(a.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&t!==tO&&(l.push(r.assignTexture(a,"normalMap",s.normalTexture)),a.normalScale=new ep(1,-1),void 0!==s.normalTexture.scale&&a.normalScale.set(s.normalTexture.scale,-s.normalTexture.scale)),void 0!==s.occlusionTexture&&t!==tO&&(l.push(r.assignTexture(a,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(a.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&t!==tO&&(a.emissive=new tU().fromArray(s.emissiveFactor)),void 0!==s.emissiveTexture&&t!==tO&&l.push(r.assignTexture(a,"emissiveMap",s.emissiveTexture)),Promise.all(l).then(function(){let n;return n=t===mm?i[f9.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(a):new t(a),s.name&&(n.name=s.name),n.map&&(n.map.encoding=3001),n.emissiveMap&&(n.emissiveMap.encoding=3001),mP(n,s),r.associations.set(n,{type:"materials",index:e}),s.extensions&&mI(i,n,s),n})}createUniqueName(e){let t=oC.sanitizeNodeName(e||""),r=t;for(let e=1;this.nodeNamesUsed[r];++e)r=t+"_"+e;return this.nodeNamesUsed[r]=!0,r}loadGeometries(e){let t=this,r=this.extensions,n=this.primitiveCache,i=[];for(let s=0,a=e.length;s<a;s++){let a=e[s],o=function(e){let t=e.extensions&&e.extensions[f9.KHR_DRACO_MESH_COMPRESSION];return t?"draco:"+t.bufferView+":"+t.indices+":"+mk(t.attributes):e.indices+":"+mk(e.attributes)+":"+e.mode}(a),l=n[o];if(l)i.push(l.promise);else{let e;e=a.extensions&&a.extensions[f9.KHR_DRACO_MESH_COMPRESSION]?function(e){return r[f9.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then(function(r){return mO(r,e,t)})}(a):mO(new t$,a,t),n[o]={primitive:a,promise:e},i.push(e)}}return Promise.all(i)}loadMesh(e){let t=this,r=this.json,n=this.extensions,i=r.meshes[e],s=i.primitives,a=[];for(let e=0,t=s.length;e<t;e++){var o;let t=void 0===s[e].material?(void 0===(o=this.cache).DefaultMaterial&&(o.DefaultMaterial=new ab({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:0})),o.DefaultMaterial):this.getDependency("material",s[e].material);a.push(t)}return a.push(t.loadGeometries(s)),Promise.all(a).then(function(r){let a=r.slice(0,r.length-1),o=r[r.length-1],l=[];for(let r=0,h=o.length;r<h;r++){let h;let c=o[r],u=s[r],d=a[r];if(u.mode===mb.TRIANGLES||u.mode===mb.TRIANGLE_STRIP||u.mode===mb.TRIANGLE_FAN||void 0===u.mode)!0!==(h=!0===i.isSkinnedMesh?new st(c,d):new rs(c,d)).isSkinnedMesh||h.geometry.attributes.skinWeight.normalized||h.normalizeSkinWeights(),u.mode===mb.TRIANGLE_STRIP?h.geometry=mN(h.geometry,1):u.mode===mb.TRIANGLE_FAN&&(h.geometry=mN(h.geometry,2));else if(u.mode===mb.LINES)h=new sb(c,d);else if(u.mode===mb.LINE_STRIP)h=new sy(c,d);else if(u.mode===mb.LINE_LOOP)h=new sw(c,d);else if(u.mode===mb.POINTS)h=new sC(c,d);else throw Error("THREE.GLTFLoader: Primitive mode unsupported: "+u.mode);Object.keys(h.geometry.morphAttributes).length>0&&function(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let r=0,n=t.weights.length;r<n;r++)e.morphTargetInfluences[r]=t.weights[r];if(t.extras&&Array.isArray(t.extras.targetNames)){let r=t.extras.targetNames;if(e.morphTargetInfluences.length===r.length){e.morphTargetDictionary={};for(let t=0,n=r.length;t<n;t++)e.morphTargetDictionary[r[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}(h,i),h.name=t.createUniqueName(i.name||"mesh_"+e),mP(h,i),u.extensions&&mI(n,h,u),t.assignFinalMaterial(h),l.push(h)}if(1===l.length)return l[0];let h=new iD;for(let e=0,t=l.length;e<t;e++)h.add(l[e]);return h})}loadCamera(e){let t;let r=this.json.cameras[e],n=r[r.type];if(!n){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return"perspective"===r.type?t=new rp(ed.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):"orthographic"===r.type&&(t=new rO(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),r.name&&(t.name=this.createUniqueName(r.name)),mP(t,r),Promise.resolve(t)}loadSkin(e){let t=this.json.skins[e],r={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(r):this.getDependency("accessor",t.inverseBindMatrices).then(function(e){return r.inverseBindMatrices=e,r})}loadAnimation(e){let t=this.json.animations[e],r=[],n=[],i=[],s=[],a=[];for(let e=0,o=t.channels.length;e<o;e++){let o=t.channels[e],l=t.samplers[o.sampler],h=o.target,c=void 0!==h.node?h.node:h.id,u=void 0!==t.parameters?t.parameters[l.input]:l.input,d=void 0!==t.parameters?t.parameters[l.output]:l.output;r.push(this.getDependency("node",c)),n.push(this.getDependency("accessor",u)),i.push(this.getDependency("accessor",d)),s.push(l),a.push(h)}return Promise.all([Promise.all(r),Promise.all(n),Promise.all(i),Promise.all(s),Promise.all(a)]).then(function(r){let n=r[0],i=r[1],s=r[2],a=r[3],o=r[4],l=[];for(let e=0,t=n.length;e<t;e++){let t;let r=n[e],h=i[e],c=s[e],u=a[e],d=o[e];if(void 0===r)continue;switch(r.updateMatrix(),r.matrixAutoUpdate=!0,mA[d.path]){case mA.weights:t=aI;break;case mA.rotation:t=ak;break;case mA.position:case mA.scale:default:t=aU}let p=r.name?r.name:r.uuid,f=void 0!==u.interpolation?mC[u.interpolation]:2301,m=[];mA[d.path]===mA.weights?r.traverse(function(e){!0===e.isMesh&&e.morphTargetInfluences&&m.push(e.name?e.name:e.uuid)}):m.push(p);let g=c.array;if(c.normalized){let e=mD(g.constructor),t=new Float32Array(g.length);for(let r=0,n=g.length;r<n;r++)t[r]=g[r]*e;g=t}for(let e=0,r=m.length;e<r;e++){let r=new t(m[e]+"."+mA[d.path],h.array,g,f);"CUBICSPLINE"===u.interpolation&&(r.createInterpolant=function(e){return new(this instanceof ak?m_:my)(this.times,this.values,this.getValueSize()/3,e)},r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(r)}}return new aO(t.name?t.name:"animation_"+e,void 0,l)})}createNodeMesh(e){let t=this.json,r=this,n=t.nodes[e];return void 0===n.mesh?null:r.getDependency("mesh",n.mesh).then(function(e){let t=r._getNodeRef(r.meshCache,n.mesh,e);return void 0!==n.weights&&t.traverse(function(e){if(e.isMesh)for(let t=0,r=n.weights.length;t<r;t++)e.morphTargetInfluences[t]=n.weights[t]}),t})}loadNode(e){let t=this.json,r=this.extensions,n=this,i=t.nodes[e],s=i.name?n.createUniqueName(i.name):"";return(function(){let t=[],r=n._invokeOne(function(t){return t.createNodeMesh&&t.createNodeMesh(e)});return r&&t.push(r),void 0!==i.camera&&t.push(n.getDependency("camera",i.camera).then(function(e){return n._getNodeRef(n.cameraCache,i.camera,e)})),n._invokeAll(function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)}).forEach(function(e){t.push(e)}),Promise.all(t)})().then(function(t){let a;if((a=!0===i.isBone?new sr:t.length>1?new iD:1===t.length?t[0]:new tm)!==t[0])for(let e=0,r=t.length;e<r;e++)a.add(t[e]);if(i.name&&(a.userData.name=i.name,a.name=s),mP(a,i),i.extensions&&mI(r,a,i),void 0!==i.matrix){let e=new e0;e.fromArray(i.matrix),a.applyMatrix4(e)}else void 0!==i.translation&&a.position.fromArray(i.translation),void 0!==i.rotation&&a.quaternion.fromArray(i.rotation),void 0!==i.scale&&a.scale.fromArray(i.scale);return n.associations.set(a,{type:"nodes",index:e}),a})}loadScene(e){let t=this.json,r=this.extensions,n=this.json.scenes[e],i=new iD;n.name&&(i.name=this.createUniqueName(n.name)),mP(i,n),n.extensions&&mI(r,i,n);let s=n.nodes||[],a=[];for(let e=0,r=s.length;e<r;e++)a.push(function e(t,r,n,i){let s=n.nodes[t];return i.getDependency("node",t).then(function(e){let t;return void 0===s.skin?e:i.getDependency("skin",s.skin).then(function(e){t=e;let r=[];for(let e=0,n=t.joints.length;e<n;e++)r.push(i.getDependency("node",t.joints[e]));return Promise.all(r)}).then(function(r){return e.traverse(function(e){if(!e.isMesh)return;let n=[],i=[];for(let e=0,s=r.length;e<s;e++){let s=r[e];if(s){n.push(s);let r=new e0;void 0!==t.inverseBindMatrices&&r.fromArray(t.inverseBindMatrices.array,16*e),i.push(r)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[e])}e.bind(new sa(n,i),e.matrixWorld)}),e})}).then(function(t){r.add(t);let a=[];if(s.children){let r=s.children;for(let s=0,o=r.length;s<o;s++){let o=r[s];a.push(e(o,t,n,i))}}return Promise.all(a)})}(s[e],i,t,this));return Promise.all(a).then(function(){return i})}}function mO(e,t,r){let n=t.attributes,i=[];for(let t in n){let s=mE[t]||t.toLowerCase();s in e.attributes||i.push(function(t,n){return r.getDependency("accessor",t).then(function(t){e.setAttribute(n,t)})}(n[t],s))}if(void 0!==t.indices&&!e.index){let n=r.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});i.push(n)}return mP(e,t),!function(e,t,r){let n=t.attributes,i=new eE;if(void 0===n.POSITION)return;{let e=r.json.accessors[n.POSITION],t=e.min,s=e.max;if(void 0!==t&&void 0!==s){if(i.set(new eS(t[0],t[1],t[2]),new eS(s[0],s[1],s[2])),e.normalized){let t=mD(mw[e.componentType]);i.min.multiplyScalar(t),i.max.multiplyScalar(t)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}let s=t.targets;if(void 0!==s){let e=new eS,t=new eS;for(let n=0,i=s.length;n<i;n++){let i=s[n];if(void 0!==i.POSITION){let n=r.json.accessors[i.POSITION],s=n.min,a=n.max;if(void 0!==s&&void 0!==a){if(t.setX(Math.max(Math.abs(s[0]),Math.abs(a[0]))),t.setY(Math.max(Math.abs(s[1]),Math.abs(a[1]))),t.setZ(Math.max(Math.abs(s[2]),Math.abs(a[2]))),n.normalized){let e=mD(mw[n.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(e)}e.boundingBox=i;let a=new ej;i.getCenter(a.center),a.radius=i.min.distanceTo(i.max)/2,e.boundingSphere=a}(e,t,r),Promise.all(i).then(function(){return void 0!==t.targets?function(e,t,r){let n=!1,i=!1;for(let e=0,r=t.length;e<r;e++){let r=t[e];if(void 0!==r.POSITION&&(n=!0),void 0!==r.NORMAL&&(i=!0),n&&i)break}if(!n&&!i)return Promise.resolve(e);let s=[],a=[];for(let o=0,l=t.length;o<l;o++){let l=t[o];if(n){let t=void 0!==l.POSITION?r.getDependency("accessor",l.POSITION):e.attributes.position;s.push(t)}if(i){let t=void 0!==l.NORMAL?r.getDependency("accessor",l.NORMAL):e.attributes.normal;a.push(t)}}return Promise.all([Promise.all(s),Promise.all(a)]).then(function(t){let r=t[0],s=t[1];return n&&(e.morphAttributes.position=r),i&&(e.morphAttributes.normal=s),e.morphTargetsRelative=!0,e})}(e,t.targets,r):e})}function mN(e,t){let r=e.getIndex();if(null===r){let t=[],n=e.getAttribute("position");if(void 0===n)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<n.count;e++)t.push(e);e.setIndex(t),r=e.getIndex()}let n=r.count-2,i=[];if(2===t)for(let e=1;e<=n;e++)i.push(r.getX(0)),i.push(r.getX(e)),i.push(r.getX(e+1));else for(let e=0;e<n;e++)e%2==0?(i.push(r.getX(e)),i.push(r.getX(e+1)),i.push(r.getX(e+2))):(i.push(r.getX(e+2)),i.push(r.getX(e+1)),i.push(r.getX(e)));i.length/3!==n&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");let s=e.clone();return s.setIndex(i),s}class mF extends rs{constructor(){let e=mF.SkyShader;super(new ro(1,1,1),new ru({name:"SkyShader",fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:rc.clone(e.uniforms),side:1,depthWrite:!1}))}}mF.prototype.isSky=!0,mF.SkyShader={uniforms:{turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new eS},up:{value:new eS(0,1,0)}},vertexShader:`
		uniform vec3 sunPosition;
		uniform float rayleigh;
		uniform float turbidity;
		uniform float mieCoefficient;
		uniform vec3 up;

		varying vec3 vWorldPosition;
		varying vec3 vSunDirection;
		varying float vSunfade;
		varying vec3 vBetaR;
		varying vec3 vBetaM;
		varying float vSunE;

		// constants for atmospheric scattering
		const float e = 2.71828182845904523536028747135266249775724709369995957;
		const float pi = 3.141592653589793238462643383279502884197169;

		// wavelength of used primaries, according to preetham
		const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );
		// this pre-calcuation replaces older TotalRayleigh(vec3 lambda) function:
		// (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))
		const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );

		// mie stuff
		// K coefficient for the primaries
		const float v = 4.0;
		const vec3 K = vec3( 0.686, 0.678, 0.666 );
		// MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K
		const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );

		// earth shadow hack
		// cutoffAngle = pi / 1.95;
		const float cutoffAngle = 1.6110731556870734;
		const float steepness = 1.5;
		const float EE = 1000.0;

		float sunIntensity( float zenithAngleCos ) {
			zenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );
			return EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );
		}

		vec3 totalMie( float T ) {
			float c = ( 0.2 * T ) * 10E-18;
			return 0.434 * c * MieConst;
		}

		void main() {

			vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
			vWorldPosition = worldPosition.xyz;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
			gl_Position.z = gl_Position.w; // set z to camera.far

			vSunDirection = normalize( sunPosition );

			vSunE = sunIntensity( dot( vSunDirection, up ) );

			vSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );

			float rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );

			// extinction (absorbtion + out scattering)
			// rayleigh coefficients
			vBetaR = totalRayleigh * rayleighCoefficient;

			// mie coefficients
			vBetaM = totalMie( turbidity ) * mieCoefficient;

		}`,fragmentShader:`
		varying vec3 vWorldPosition;
		varying vec3 vSunDirection;
		varying float vSunfade;
		varying vec3 vBetaR;
		varying vec3 vBetaM;
		varying float vSunE;

		uniform float mieDirectionalG;
		uniform vec3 up;

		const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );

		// constants for atmospheric scattering
		const float pi = 3.141592653589793238462643383279502884197169;

		const float n = 1.0003; // refractive index of air
		const float N = 2.545E25; // number of molecules per unit volume for air at 288.15K and 1013mb (sea level -45 celsius)

		// optical length at zenith for molecules
		const float rayleighZenithLength = 8.4E3;
		const float mieZenithLength = 1.25E3;
		// 66 arc seconds -> degrees, and the cosine of that
		const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;

		// 3.0 / ( 16.0 * pi )
		const float THREE_OVER_SIXTEENPI = 0.05968310365946075;
		// 1.0 / ( 4.0 * pi )
		const float ONE_OVER_FOURPI = 0.07957747154594767;

		float rayleighPhase( float cosTheta ) {
			return THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );
		}

		float hgPhase( float cosTheta, float g ) {
			float g2 = pow( g, 2.0 );
			float inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );
			return ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );
		}

		void main() {

			vec3 direction = normalize( vWorldPosition - cameraPos );

			// optical length
			// cutoff angle at 90 to avoid singularity in next formula.
			float zenithAngle = acos( max( 0.0, dot( up, direction ) ) );
			float inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );
			float sR = rayleighZenithLength * inverse;
			float sM = mieZenithLength * inverse;

			// combined extinction factor
			vec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );

			// in scattering
			float cosTheta = dot( direction, vSunDirection );

			float rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );
			vec3 betaRTheta = vBetaR * rPhase;

			float mPhase = hgPhase( cosTheta, mieDirectionalG );
			vec3 betaMTheta = vBetaM * mPhase;

			vec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );
			Lin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );

			// nightsky
			float theta = acos( direction.y ); // elevation --> y-axis, [-pi/2, pi/2]
			float phi = atan( direction.z, direction.x ); // azimuth --> x-axis [-pi/2, pi/2]
			vec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );
			vec3 L0 = vec3( 0.1 ) * Fex;

			// composition + solar disc
			float sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );
			L0 += ( vSunE * 19000.0 * Fex ) * sundisk;

			vec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );

			vec3 retColor = pow( texColor, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );

			gl_FragColor = vec4( retColor, 1.0 );

			#include <tonemapping_fragment>
			#include <encodings_fragment>

		}`};class mB extends rs{constructor(e,t={}){super(e);let r=this,n=void 0!==t.textureWidth?t.textureWidth:512,i=void 0!==t.textureHeight?t.textureHeight:512,s=void 0!==t.clipBias?t.clipBias:0,a=void 0!==t.alpha?t.alpha:1,o=void 0!==t.time?t.time:0,l=void 0!==t.waterNormals?t.waterNormals:null,h=void 0!==t.sunDirection?t.sunDirection:new eS(.70707,.70707,0),c=new tU(void 0!==t.sunColor?t.sunColor:16777215),u=new tU(void 0!==t.waterColor?t.waterColor:8355711),d=void 0!==t.eye?t.eye:new eS(0,0,0),p=void 0!==t.distortionScale?t.distortionScale:20,f=void 0!==t.side?t.side:0,m=void 0!==t.fog&&t.fog,g=new r_,v=new eS,y=new eS,x=new eS,_=new e0,b=new eS(0,0,-1),w=new ex,S=new eS,T=new eS,E=new ex,A=new e0,C=new rp,R=new e_(n,i,{minFilter:1006,magFilter:1006,format:1022});ed.isPowerOfTwo(n)&&ed.isPowerOfTwo(i)||(R.texture.generateMipmaps=!1);let L={uniforms:rc.merge([rC.fog,rC.lights,{normalSampler:{value:null},mirrorSampler:{value:null},alpha:{value:1},time:{value:0},size:{value:1},distortionScale:{value:20},textureMatrix:{value:new e0},sunColor:{value:new tU(8355711)},sunDirection:{value:new eS(.70707,.70707,0)},eye:{value:new eS},waterColor:{value:new tU(5592405)}}]),vertexShader:`
				uniform mat4 textureMatrix;
				uniform float time;

				varying vec4 mirrorCoord;
				varying vec4 worldPosition;

				#include <common>
				#include <fog_pars_vertex>
				#include <shadowmap_pars_vertex>
				#include <logdepthbuf_pars_vertex>

				void main() {
					mirrorCoord = modelMatrix * vec4( position, 1.0 );
					worldPosition = mirrorCoord.xyzw;
					mirrorCoord = textureMatrix * mirrorCoord;
					vec4 mvPosition =  modelViewMatrix * vec4( position, 1.0 );
					gl_Position = projectionMatrix * mvPosition;

				#include <beginnormal_vertex>
				#include <defaultnormal_vertex>
				#include <logdepthbuf_vertex>
				#include <fog_vertex>
				#include <shadowmap_vertex>
			}`,fragmentShader:`
				uniform sampler2D mirrorSampler;
				uniform float alpha;
				uniform float time;
				uniform float size;
				uniform float distortionScale;
				uniform sampler2D normalSampler;
				uniform vec3 sunColor;
				uniform vec3 sunDirection;
				uniform vec3 eye;
				uniform vec3 waterColor;

				varying vec4 mirrorCoord;
				varying vec4 worldPosition;

				vec4 getNoise( vec2 uv ) {
					vec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);
					vec2 uv1 = uv / 107.0-vec2( time / -19.0, time / 31.0 );
					vec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );
					vec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );
					vec4 noise = texture2D( normalSampler, uv0 ) +
						texture2D( normalSampler, uv1 ) +
						texture2D( normalSampler, uv2 ) +
						texture2D( normalSampler, uv3 );
					return noise * 0.5 - 1.0;
				}

				void sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {
					vec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );
					float direction = max( 0.0, dot( eyeDirection, reflection ) );
					specularColor += pow( direction, shiny ) * sunColor * spec;
					diffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;
				}

				#include <common>
				#include <packing>
				#include <bsdfs>
				#include <fog_pars_fragment>
				#include <logdepthbuf_pars_fragment>
				#include <lights_pars_begin>
				#include <shadowmap_pars_fragment>
				#include <shadowmask_pars_fragment>

				void main() {

					#include <logdepthbuf_fragment>
					vec4 noise = getNoise( worldPosition.xz * size );
					vec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );

					vec3 diffuseLight = vec3(0.0);
					vec3 specularLight = vec3(0.0);

					vec3 worldToEye = eye-worldPosition.xyz;
					vec3 eyeDirection = normalize( worldToEye );
					sunLight( surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );

					float distance = length(worldToEye);

					vec2 distortion = surfaceNormal.xz * ( 0.001 + 1.0 / distance ) * distortionScale;
					vec3 reflectionSample = vec3( texture2D( mirrorSampler, mirrorCoord.xy / mirrorCoord.w + distortion ) );

					float theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );
					float rf0 = 0.3;
					float reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );
					vec3 scatter = max( 0.0, dot( surfaceNormal, eyeDirection ) ) * waterColor;
					vec3 albedo = mix( ( sunColor * diffuseLight * 0.3 + scatter ) * getShadowMask(), ( vec3( 0.1 ) + reflectionSample * 0.9 + reflectionSample * specularLight ), reflectance);
					vec3 outgoingLight = albedo;
					gl_FragColor = vec4( outgoingLight, alpha );

					#include <tonemapping_fragment>
					#include <fog_fragment>
				}`},I=new ru({fragmentShader:L.fragmentShader,vertexShader:L.vertexShader,uniforms:rc.clone(L.uniforms),lights:!0,side:f,fog:m});I.uniforms.mirrorSampler.value=R.texture,I.uniforms.textureMatrix.value=A,I.uniforms.alpha.value=a,I.uniforms.time.value=o,I.uniforms.normalSampler.value=l,I.uniforms.sunColor.value=c,I.uniforms.waterColor.value=u,I.uniforms.sunDirection.value=h,I.uniforms.distortionScale.value=p,I.uniforms.eye.value=d,r.material=I,r.onBeforeRender=function(e,t,n){if(y.setFromMatrixPosition(r.matrixWorld),x.setFromMatrixPosition(n.matrixWorld),_.extractRotation(r.matrixWorld),v.set(0,0,1),v.applyMatrix4(_),S.subVectors(y,x),S.dot(v)>0)return;S.reflect(v).negate(),S.add(y),_.extractRotation(n.matrixWorld),b.set(0,0,-1),b.applyMatrix4(_),b.add(x),T.subVectors(y,b),T.reflect(v).negate(),T.add(y),C.position.copy(S),C.up.set(0,1,0),C.up.applyMatrix4(_),C.up.reflect(v),C.lookAt(T),C.far=n.far,C.updateMatrixWorld(),C.projectionMatrix.copy(n.projectionMatrix),A.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),A.multiply(C.projectionMatrix),A.multiply(C.matrixWorldInverse),g.setFromNormalAndCoplanarPoint(v,y),g.applyMatrix4(C.matrixWorldInverse),w.set(g.normal.x,g.normal.y,g.normal.z,g.constant);let i=C.projectionMatrix;E.x=(Math.sign(w.x)+i.elements[8])/i.elements[0],E.y=(Math.sign(w.y)+i.elements[9])/i.elements[5],E.z=-1,E.w=(1+i.elements[10])/i.elements[14],w.multiplyScalar(2/w.dot(E)),i.elements[2]=w.x,i.elements[6]=w.y,i.elements[10]=w.z+1-s,i.elements[14]=w.w,d.setFromMatrixPosition(n.matrixWorld);let a=e.getRenderTarget(),o=e.xr.enabled,l=e.shadowMap.autoUpdate;r.visible=!1,e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(R),e.state.buffers.depth.setMask(!0),!1===e.autoClear&&e.clear(),e.render(t,C),r.visible=!0,e.xr.enabled=o,e.shadowMap.autoUpdate=l,e.setRenderTarget(a);let h=n.viewport;void 0!==h&&e.state.viewport(h)}}}mB.prototype.isWater=!0,Array.prototype.sum=function(){return this.reduce((e,t)=>e+t,0)};let mz=!1,mG=!1,mH=!1,mV=!1,mW=!1,mj=!1,mq=!1,mX=!0;const mY=new eS,mJ=new eS;let mZ=800,m$={},mK={},mQ=new iD,m0=0;function m1(e){for(;e.children.length>0;)m1(e.children[0]),e.remove(e.children[0]);e.geometry&&e.geometry.dispose(),e instanceof ox&&e.stop(),e.material&&(Object.keys(e.material).forEach(t=>{e.material[t]&&null!==e.material[t]&&"function"==typeof e.material[t].dispose&&e.material[t].dispose()}),e.material.dispose())}async function m2(e){let t;s&&(m1(s),s.removeFromParent()),m1(mQ),s=await m3(e,0,!1),e.previous&&(r=s,n=e.previous,(t=f$({text:`Back to: ${n}`,links:[{text:n,page:n}]},20)).position.x=-30,t.position.z=-1.01,t.rotateY(Math.PI),r.add(t));var r,n,i=H("add to scene");a.add(s),V(i),go("");var o=H("floor");(function(e){let t=Math.PI/2-Math.random()*Math.PI/6;var r=new eS(60*Math.cos(t),0,60*Math.sin(t));if(h.position.x=r.x,h.position.y=r.y,h.position.z=r.z,h.lookAt(0,0,0),e){let t=new eE().setFromObject(e),r=new eS;t.getCenter(r),r.y=1e3;let n=new eS;t.getSize(n);let i=Math.max(n.x,n.z),s=i/2+50;f.left=-s,f.right=s,f.top=s,f.bottom=-s,f.updateProjectionMatrix(),e.add(function(e,t){let r=new rs(new sI(e,e,.1,64),fY);return r.position.x=t.x,r.position.z=t.z,r.position.y=-25.5,r}(s*Math.sqrt(2),r));let o=mK.boat.clone();o.position.x=r.x,o.position.y=-17,o.position.z=r.z+s*Math.sqrt(2)+11,o.setRotationFromAxisAngle(new eS(0,1,0),Math.PI/2),e.add(o);for(let t=0;t<7;t++){let t=mK["palm-tree"].clone(),n=Math.random()*Math.PI*2,s=(i/2+20)*Math.sqrt(2),a=new eS(Math.cos(n)*s,0,Math.sin(n)*s);t.rotateY(Math.random()*Math.PI*2),t.position.x=a.x+r.x,t.position.y=-25,t.position.z=a.z+r.z,e.add(t)}let l=document.querySelector("#marker-canvas");l.dataset.centerX=r.x,l.dataset.centerZ=r.z,l.dataset.scale=2*s/800,f.position.copy(r),f.up=new eS(0,0,-1),f.lookAt(new eS(r.x,0,r.z)),p.render(a,f)}if(window.SETTINGS.lights){let t=new a5(16777215,1,50);t.position.y+=20,t.position.z+=10,window.SETTINGS.shadows&&(t.castShadow=!0,t.shadow.bias=-.005),e.add(t)}})(s),V(o)}async function m3(e,t,r=!1){go(`Generating "${e.name}"...`);let n=function(e,t){let r=[];for(let i of e.content){if("section"==i.type&&r.push(m3(i,t+1)),window.SETTINGS.images&&"image"==i.type&&i.url.match(/\.(jpg|jpeg|png|svg)$/i)){let t;i.description?.links&&!((t=i.description.links[0].page).endsWith("webm")||t.endsWith("mp4"))&&(t=void 0);let n=function(e,t){var r=function(e,t=30,r=null,n=null,i=null){var s=new aW().load(e);let a=n/i;null!==t&&null===r?r=t*a:null===t&&null!==r?t=r/a:null===t&&null===r&&(t=30,r=30,console.log("Tried to create an image plane without any size."));var o=new rs(new ro(r,t,.1),new ab({map:s,side:2,transparent:!0,alphaTest:.5}));o.layers.enable(1);var l=new rs(new ro(r+8,t,.1),fZ);o.add(l);var h=new ro(r+2,1,1),c=new ro(1,t,1),u=new rs(h,fX);u.position.y-=t/2+.5,o.add(u);var d=new rs(h,fX);d.position.y+=t/2+.5,o.add(d);var p=new rs(c,fX);p.position.x-=r/2+.5,o.add(p);var f=new rs(c,fX);return f.position.x+=r/2+.5,o.add(f),window.SETTINGS.shadows&&(o.receiveShadow=!0),o}(e.url,30,null,e.width,e.height);if(e.description){t&&(e.description.links=[{page:t,text:"View Source"}],e.description.text+=" View Source");var n=f$(e.description,10,.5);n.position.z=1,n.position.y=-18,r.add(n)}return r}(i,t);n.editLink=e.editURL,r.push(n)}if("audio"==i.type&&i.url.match(/\.(ogg|mp3|wav)$/i)&&r.push(function(e,t){var r=f$({text:"audio",links:[]},10,1);let n=new ox(t);return new oa().load(e.url,function(e){n.setBuffer(e),n.setLoop(!0),n.setRefDistance(30),n.setDistanceModel("exponential"),n.setRolloffFactor(10),n.play()}),r.add(n),r}(audio,d)),window.SETTINGS.texts&&"paragraph"==i.type){function n(e){return e.length>600||e.split("\n").length>30}if(i.text=i.text.replaceAll(/\n+/g,"\n"),i.text=i.text.replaceAll(/[^\s]+/g,e=>e.match(/.{1,20}/).join("")),n(i.text)){let t=i.text.split("\n");t=t.map(e=>n(e)?e.split(/(?<=\. )/):e).flat();let s={text:"",links:i.links};for(let a of t)n(s.text+a)?(m4(r,s,e.editURL),s={text:a,links:i.links}):s.text+="\n"+a;m4(r,s,e.editURL)}else m4(r,i,e.editURL)}}return r}(e,t);var i,s,a,o=await Promise.all(n);if(o.length%2==0&&o.length>=2){let e,t,r,n,l=Math.floor(o.length/2);o.splice(l,0,(e=new iD,fK(i=new ro(10,10,2)),s=new rs(i,fq),a=new rs(i,fq),s.position.y=20,a.position.y=-20,e.add(s),e.add(a),fK(t=new ro(5,50,2)),r=new rs(t,fq),n=new rs(t,fq),r.position.x=-7.5,n.position.x=7.5,e.add(r),e.add(n),e.isWindow=!0,e))}var l=H("distribute");let h=function(e,t){let r,n,i,s=new iD;for(let[r,n]of(s.isChapter=!0,(i=e.length>2||2==e.length&&(gr(e[0])||gr(e[1]))||1==e.length&&gr(e[0])?function e(t,r,n){if(1==r.length)return[t];let i=t.map(n).sum(),s=r.sum(),a=function(e,t,r){let n=0;for(let[i,s]of e.entries()){let e=r(s);if(n+e>=t){if(Math.abs(n-t)<Math.abs(n+e-t))return i;return i+1}n+=e}}(t,r[0]/s*i,n),o=t.slice(0,a),l=t.slice(a),h=[o];return h.push(...e(l,r.slice(1),n)),h}(e,[2,1,2],gt):[[],e,[]]).entries())){let e;for(let e=0;e<n.length;e++){let t=new eE().setFromObject(n[e]);n[e].widthL||(n[e].widthL=-t.min.x),n[e].widthR=t.max.x,n[e].originalR=t.max.x,n[e].originalL=-t.min.x,n[e+1]&&(gr(n[e])&&!gr(n[e+1])&&(n[e].widthR=20),!gr(n[e])&&gr(n[e+1])&&(n[e+1].widthL=20))}let i=0;for(let s=0;s<n.length;s++)if(gr(n[s])){if(void 0!=e){if(n[e].widthR+i+n[s].widthL<n[e].originalR+n[s].originalL){let t=(n[e].originalR+n[s].originalL-i)/2;n[e].widthR=t,n[s].widthL=t}}else i+n[s].widthL<n[s].originalL&&(n[s].widthL=n[s].originalL-i),(2==r||0==r&&0==t)&&(n[s].widthL=20);e=s,i=0}else i+=gt(n[s]);(0==r||2==r&&0==t)&&void 0!=e&&(n[e].widthR=20)}let a=Math.max(i[0].map(gt).sum(),i[2].map(gt).sum()),o=Math.max(i[1].map(gt).sum(),74);for(let e of[{start:new eS(-o/2,0,0),dir:new eS(0,0,-1),length:a,objects:i[0],angle:Math.PI/2},{start:new eS(-o/2,0,-a),dir:new eS(1,0,0),length:o,objects:i[1],angle:0},{start:new eS(o/2,0,-a),dir:new eS(0,0,1),length:a,objects:i[2],angle:-Math.PI/2}]){let t=e.objects.map(gt).sum(),r=(e.length-t)/2,n=e.start.clone();for(let t of e.objects){let i=gt(t);if(t.position.copy(e.start.clone().addScaledVector(e.dir,r+t.widthL)),!(t.isChapter||t.isWindow)){let r=e.dir.clone().applyAxisAngle(new eS(0,1,0),-Math.PI/2);t.position.add(r.multiplyScalar(1))}t.rotateY(e.angle),r+=i;let a=e.start.clone().addScaledVector(e.dir,r);if(t.isChapter||t.isWindow){let r=e.dir.clone().multiplyScalar(t.widthL),i=e.dir.clone().multiplyScalar(t.widthR);s.add(fQ(n,t.position.clone().sub(r))),s.add(fQ(t.position.clone().add(i),a))}else s.add(fQ(n,a));n=a,s.add(t)}if(r<e.length){let t=e.start.clone().addScaledVector(e.dir,e.length);s.add(fQ(n,t))}}if(0==t)var l=o/2,h=o/2;else{let e=new eE().setFromObject(s);var l=-e.min.x,h=e.max.x}s.add(fQ(new eS(-l,0,0),new eS(-10,0,0))),s.add(fQ(new eS(10,0,0),new eS(h,0,0)));let c=(fK(r=new ro(o,.1,a)),(n=new rs(r,fX)).layers.enable(1),n);return c.position.z=-a/2,c.position.y=-25,s.add(c),!function(e,t,r){if(e>100&&t>100&&e<400&&t<400){let n=mK.bench.clone();n.position.z=-t/2,t>e&&n.rotateY(Math.PI/2),r.add(n)}}(o,a,s),s}(o,t);V(l);let c=f$({text:e.name,links:[]},50,3);return c.position.x=0,c.position.y=20,c.position.z=1,h.add(c),h}function m4(e,t,r){if(t.text=t.text.trim(),t.text.length>0){let n=f$(t,20);n.getObjectByName("plane").editLink=r,e.push(n)}}function m5(){var e,t,r,n,i,s,d,p,f;let _=u.getDelta();if(_>0&&(m0=(e=m0)+(Math.round(1/_)-e)*(t=(t=(t=.05)<0?0:t)>1?1:t),document.querySelector("#fps").innerHTML=Math.round(m0)),mz&&(v&&g&&(r=[{from:{x:v.x,y:v.y,z:v.z},to:{x:g.x,y:g.y,z:g.z},color:y||"000000"}],U.push(r)),g&&(v=g.clone())),_>.1?(mY.x=0,mY.y=0,mY.z=0):(mY.x-=10*mY.x*_,mY.z-=10*mY.z*_,mY.y-=10*mY.y*_),mJ.z=Number(mG)-Number(mH),mJ.x=Number(mW)-Number(mV),mJ.y=Number(mj)-Number(mq),mJ.normalize(),mJ.length()>0){let e=h.position.clone(),t=mJ.clone();t.z*=-1;let r=t.clone();r.transformDirection(h.matrixWorld),r.y=0,r.normalize(),c.set(e,r);let n=c.intersectObjects(a.children,!0);n.length>0&&n[0].distance<12&&mJ.set(0,0,0)}(mG||mH)&&(mY.z-=mJ.z*mZ*_),(mV||mW)&&(mY.x-=mJ.x*mZ*_),(mj||mq)&&(mY.y-=mJ.y*mZ*3*_),l.moveRight(ed.clamp(-mY.x*_,-100,100)),l.moveForward(ed.clamp(-mY.z*_,-100,100)),l.getObject().position.y+=ed.clamp(mY.y*_,-100,100),l.getObject().position.y<0&&(mY.y=0,l.getObject().position.y=0),c.setFromCamera(new ep(0,0),h);let b=c.intersectObjects(a.children,!0);b.length>0?(m!=b[0].object&&(m=b[0].object),g=b[0].point):(m=null,g=null);let w=l.getObject().getWorldDirection(new eS(0,0,0));for(let[e,t]of(n=l.getObject().position.x,i=l.getObject().position.y,s=l.getObject().position.z,d=w.x,p=w.y,f=w.z,k&&k.setLocalStateField("transformation",{position:{x:n,y:i,z:s},rotation:{x:d,y:p,z:f}}),x.material.uniforms.time.value+=_,o.render(a,h),window.innerWidth,Object.entries(m$)))t.getObjectByName("name")?.lookAt(h.position)}async function m6(){u=new oo,(a=new iH).background=new tU(10732535),a.add(mQ),(h=new rp(75,1280/720,.1,4e3)).layers.enable(2),d=new op,(c=new oI).layers.set(1),(o=new iB({antialias:!0,canvas:document.getElementById("three")})).shadowMap.enabled=!0,o.shadowMap.type=2,o.xr.enabled=!0,o.setClearColor(16711680,1),o.setScissorTest(!0),(p=new iB({antialias:!0,canvas:document.querySelector("#map-canvas")})).setSize(800,800,!1),f=new rO(-1,1,1,-1,0,2e3),l=new f6(h,document.body),o.domElement.addEventListener("click",function(){l.lock()}),document.addEventListener("pointerlockerror",function(){setTimeout(function(){o.domElement.click()},100)}),document.addEventListener("mousedown",()=>{l.isLocked&&(0==event.button?(mz=!0,m.myLink&&(console.log("clicked ",m.myLink),gp(m.myLink))):2==event.button&&m.editLink&&gd(m.editLink))}),document.addEventListener("mouseup",()=>{mz=!1,v=null}),document.addEventListener("keydown",function(e){if(l.isLocked)switch(e.code){case"ArrowUp":case"KeyW":mG=!0;break;case"ArrowLeft":case"KeyA":mV=!0;break;case"ArrowDown":case"KeyS":mH=!0;break;case"ArrowRight":case"KeyD":mW=!0;break;case"KeyQ":mj=!0;break;case"KeyE":mq=!0;break;case"KeyM":mX=!mX;break;case"Space":break;case"KeyC":U.delete(0,U.length);break;case"ShiftLeft":case"ShiftRight":mZ=2400}}),document.addEventListener("keyup",function(e){if(l.isLocked)switch(e.code){case"ArrowUp":case"KeyW":mG=!1;break;case"ArrowLeft":case"KeyA":mV=!1;break;case"ArrowDown":case"KeyS":mH=!1;break;case"ArrowRight":case"KeyD":mW=!1;break;case"KeyQ":mj=!1;break;case"KeyE":mq=!1;break;case"ShiftLeft":case"ShiftRight":mZ=800}}),await m7(),ge(),window.addEventListener("resize",ge),o.setAnimationLoop(m5)}function m8(e,t,r){let n={map:new aW().load(`textures/${e}_diff.png`),normal:new aW().load(`textures/${e}_nor_gl.png`)};for(let[e,r]of Object.entries(n))r.wrapS=1e3,r.wrapT=1e3,r.repeat.set(t,t);return new ab({map:n.map,normalMap:n.normal})}async function m7(){var e=new mF;e.scale.setScalar(3e5),e.material.uniforms.turbidity.value=2,e.material.uniforms.rayleigh.value=1,e.material.uniforms.mieCoefficient.value=.005,e.material.uniforms.mieDirectionalG.value=.8;let t=ed.degToRad(60),r=ed.degToRad(0),n=new eS;n.setFromSphericalCoords(1,t,r),e.material.uniforms.sunPosition.value.copy(n),a.add(e);let i=new a7(16777215,.2);window.SETTINGS.lights||(i.intensity=1),a.add(i),(x=new mB(new rE(1e4,1e4),{textureWidth:512,textureHeight:512,waterNormals:new aW().load("textures/waternormals.jpg",function(e){e.wrapS=e.wrapT=1e3}),sunDirection:new eS,sunColor:16777215,waterColor:7695,distortionScale:3.7,fog:void 0!==a.fog})).rotation.x=-Math.PI/2,x.position.y=-31,a.add(x);let s=new tO({color:12370159});var o=new rs(new ag(.005),s);o.position.z=-.5,h.add(o),h.add(d),a.add(h),a.add(f);let l=new a8(16777215,.5);l.position.x+=3,l.position.y+=3,l.position.z+=1,l.castShadow=!0,l.shadow.mapSize.width=2048,l.shadow.mapSize.height=2048,l.shadow.bias=-.0001,a.add(l),await m9("bench",10),await m9("palm-tree",100),await m9("boat",13)}function m9(e,t){return new Promise(function(r){new f8().load(`models/${e}/scene.gltf`,function(n){let i=new eE().setFromObject(n.scene),s=i.max.y-i.min.y;n.scene.scale.set(t/s,t/s,t/s),n.scene.position.y=-25-i.min.y,mK[e]=n.scene,r()},function(e){console.log(e.loaded/e.total*100+"% loaded")},function(e){console.log("An error happened",e)})})}function ge(){let e=document.querySelector("#three-div"),t=e.getBoundingClientRect().width,r=e.getBoundingClientRect().height;h.aspect=t/r,h.updateProjectionMatrix(),o.setSize(t,r,!1),o.setViewport(0,0,t,r),o.setScissor(0,0,t,r)}function gt(e){if(e.widthL)return e.widthL+e.widthR;let t=new eE().setFromObject(e);return t.max.x-t.min.x}function gr(e){let t;return(t=new eE().setFromObject(e)).max.z-t.min.z>4}async function gn(e,t){for(let[r,n]of e){if(!m$[r]){let e=new rs(new sI(5,5,10,32),new ab({color:15610675}));e.layers.set(2),m$[r]=e,a.add(e)}if(r!==t){if(m$[r].myFace!==n.face){m$[r].children.length>0&&m$[r].remove(m$[r].getObjectByName("face"));let e=await f$({text:n.face,links:[]},20,2);if(e.position.y=10,e.name="face",m$[r].add(e),m$[r].myFace=n.face,m$[r].myColor){e.children[0].material.color=new tU(m$[r].myColor);let t=new tU;e.material?.color?.getHSL(t),t.l<.5?e.children[2].color=16777215:e.children[2].color=0}}if(m$[r].myName!==n.name){let e=n.name.match(/[\uac00-\ud7af]|[\u1100-\u11ff]|[\u3130-\u318f]|[\ua960-\ua97f]|[\ud7b0-\ud7ff]/g);m$[r].getObjectByName("name")&&m$[r].remove(m$[r].getObjectByName("name"));let t=new fW;t.text=n.name,t.fontSize=2,t.font="fonts/GoNotoCurrent.ttf",e&&(t.font="fonts/NotoSansKR-Regular.otf"),t.anchorX="center",t.anchorY="middle",t.color=0,t.position.y=15,t.name="name",m$[r].add(t),m$[r].myName=n.name}}if(m$[r].myColor!=n.color){m$[r].material.color=new tU(n.color);let e=m$[r].getObjectByName("face");if(e){e.children[0].material.color=new tU(n.color);let t=new tU;e.children[0].material.color.getHSL(t),t.l<.5?e.children[2].color=16777215:e.children[2].color=0}m$[r].myColor=n.color}if(n.transformation){m$[r].position.x=n.transformation.position.x,m$[r].position.y=n.transformation.position.y-20,m$[r].position.z=n.transformation.position.z;let e=new eS(n.transformation.rotation.x,n.transformation.rotation.y,n.transformation.rotation.z);e.multiplyScalar(500),e.add(n.transformation.position),m$[r].children.length>0&&m$[r].getObjectByName("face")?.lookAt(e)}r===t&&(y=n.color)}for(let t of Object.keys(m$))e.has(parseInt(t))||(a.remove(m$[t]),delete m$[t])}function gi(e,t){m1(mQ),e.target.forEach(e=>{let t=new eS(e.from.x,e.from.y,e.from.z),r=new eS(e.to.x,e.to.y,e.to.z),n=t.distanceTo(r),i=new rs(new sI(.1,.1,n,6),new tO({color:e.color}));i.position.set(t.x,t.y,t.z),i.lookAt(r),i.rotateX(Math.PI/2),i.translateY(n/2),mQ.add(i)})}async function gs(e){window.fetch(`${await j(F)}?action=opensearch&format=json&formatversion=2&search=${e}&namespace=0&limit=10&origin=*`).then(e=>{e.json().then(function(e){for(let t of(document.getElementById("suggestions").innerHTML="",e[1]))!function(e){let t=document.getElementById("suggestions"),r=document.createElement("option");r.value=`${e}`,t.appendChild(r)}(t)})})}function ga(e){let t=document.getElementById("face-suggestions"),r=document.createElement("option");r.value=`${e}`,t.appendChild(r)}function go(e){document.querySelector("#status").innerHTML=e}async function gl(){F=document.getElementById("domain").value;let e=document.getElementById("topic");e.blur();let t=document.getElementById("suggestions").firstChild;t&&(e.value=t.value);let r=e.value,n=await X(F);gp(`${F}/${n}${r}`)}async function gh(){window.fetch(`${await j(F)}?action=query&format=json&list=random&rnlimit=1&rnnamespace=0&origin=*`).then(e=>{e.json().then(async function(e){let t=await X(F);gp(`${F}/${t}${e.query.random[0].title}`)})})}async function gc(e){let t=e.split("/"),r="https://"+t[2],n=t.slice(3).join("/").replace(/^(index\.php|wiki)\//,"");return(null==(n=decodeURIComponent(n))||""==n)&&(n=await Y(r)),{domain:r,topic:n}}async function gu(e){let t=await gc(e);if(t.domain&&(F=t.domain),t.topic){let e=t.topic;document.getElementById("domain").value=F,document.getElementById("topic").value=e,M.updateTextFields()}}function gd(e){window.open(e,"_blank")}async function gp(e){e.startsWith("/")&&(e=`${F}${e}`);let t=await gc(e);if(!await j(t.domain)||e.endsWith("webm")||e.endsWith("mp4")){gd(e);return}try{await j(t.domain)}catch(t){window.open(e,"_blank");return}e=e.replaceAll(/[_ ]/g,"%20"),F=(t=await gc(e)).domain;let r=t.topic;await gu(e),B[B.length-1]===e||(B[B.length-2]===e?B.pop():B.push(e));var n=B[B.length-2];localStorage.setItem("topicStack",JSON.stringify(B)),document.getElementById("topic").value=r,window.SETTINGS={lights:document.querySelector("#lights")?.checked||!1,shadows:document.querySelector("#shadows")?.checked||!1,textures:document.querySelector("#textures")?.checked||!1,images:document.querySelector("#images")?.checked||!0,texts:document.querySelector("#texts")?.checked||!0},G={};var i=H("entire generation");go("Generating..."),document.getElementById("group-button").onclick=async t=>{M.toast({html:"Group link copied to clipboard!"});let r=gx(30);gy(document.location.protocol+"//"+document.location.host+document.location.pathname+"?group="+r+"#"+e),await gm(r),await gf(e,r)},document.getElementById("invite-button").onclick=async t=>{M.toast({html:"Invite link copied to clipboard!"});let r=localStorage.getItem("groupID");gy(document.location.protocol+"//"+document.location.host+document.location.pathname+"?group="+r+"#"+e)},history.pushState(null,null,document.location.pathname+"#"+e),s=e,O&&O.setLocalStateField("url",s),localStorage.setItem("url",e);try{let t,c;var s,a,o,l=await J(r,F);console.log(l);var h=(a=F,o=[t={type:"section",name:r,content:[]}],c=0,l.childNodes.forEach(e=>{var t=o[o.length-1];if(e.nodeName.match(/^H\d$/)){let t=parseInt(e.nodeName[1])-2,n={type:"section",name:e.textContent,content:[],editURL:`${a}/wiki/${r}?action=edit&section=${c++}`};console.log(n.editURL);let i=-(t-(o.length-2))+1;i>o.length-1&&(i=o.length-1),o.splice(o.length-i,i),o[o.length-1].content.push(n),o.push(n)}else if(["P","BLOCKQUOTE","DL","DIV"].includes(e.nodeName))""!==e.textContent.trim()&&t.content.push(K(e));else if("TABLE"==e.nodeName){let r;let n=(console.log(e),r={type:"paragraph",text:"",links:[]},[...e.querySelectorAll("tr")].map(e=>{let t=[...e.querySelectorAll("th, td")].map(e=>{for(let t of e.querySelectorAll("a"))r.links.push($(t));return e.textContent}).join(" | ");r.text+=t+"\n"}),r);t.content.push(n)}else if("FIGURE"==e.nodeName){let r=function(e){if("IMG"==e.nodeName)var t=[e];else var t=[...e.querySelectorAll("img")];if(0==t.length)return console.log("No image found in node",e),[];{let r=K(e),n=t.map(t=>{let r=t.dataset.fileWidth||t.style.width.replace("px","")||t.width,n=t.dataset.fileHeight||t.style.height.replace("px","")||t.height;r||console.log("Image has no size: ",e);let i=n/r;r=Math.floor((n=Math.min(n,1e3))/i);let s=t.src;return s.startsWith("data:image")&&(s=t.dataset.src.replace(/\/revision\/.*$/,"")),{type:"image",url:s=s.replace(/\/[0-9]*px-/,`/${r}px-`),width:r,height:n}});return 1==n.length?((n=n[0]).type="image",n.description=r):n={type:"section",name:r.text,content:n},n}}(e);t.content.push(r)}else["LINK","#comment"].includes(e.nodeName)||("#text"==e.nodeName?e.textContent.match(/^\s*$/)||console.log("Skipping non-empty #text node: "+e.textContent):["UL","OL"].includes(e.nodeName)?t.content.push(function(e){let t={type:"paragraph",text:"",links:[]},r=e.querySelectorAll("li");if(r)for(let e of r)for(let r of(t.text+=" "+e.textContent+"\n",e.querySelectorAll("a")))t.links.push($(r));else console.log("Got an empty list?",e);return t}(e)):(console.log("Skipping node of type "+e.nodeName),console.log(e)))}),function e(t){t.content&&(t.content.forEach(t=>e(t)),1==t.content.length&&"section"==t.content[0].type&&(t.name=`${t.name}: ${t.content[0].name}`,t.content=t.content[0].content))}(t),t);console.log(h),h.previous=n;let u=localStorage.getItem("groupID");await gf(e,u),await m2(h),V(i)}catch(e){console.log(e),go("Error: "+e.message)}console.log(G)}async function gf(e,t){await fe(e,t),document.getElementById("name").dispatchEvent(new Event("input")),document.getElementById("face").dispatchEvent(new Event("input")),document.getElementById("color").dispatchEvent(new Event("input"))}async function gm(e){localStorage.setItem("groupID",e),await p9(e)}async function gg(e){e=(e=e.replace(/%/g,"%25")).replace(/&/g,"%26");let t=await window.fetch("https://query.wikidata.org/bigdata/namespace/wdq/sparql?format=json&query="+e);if(200!==t.status){go(`The query took too long or failed. This is probably a bug, let us know! (Status code: ${t.status})`);return}return(await t.json()).results.bindings}async function gv(){document.querySelector("select");let e=`
SELECT ?languageCode ?languageLabel ?records (GROUP_CONCAT(?nativeLabel; SEPARATOR = "/") AS ?nativeLabels) WHERE {
  ?wiki wdt:P31 wd:Q10876391;
    wdt:P424 ?languageCode;
    wdt:P407 ?language.
  OPTIONAL { ?wiki wdt:P4876 ?records. }
  ?language wdt:P1705 ?nativeLabel.
  MINUS { ?wiki wdt:P576 ?when. }
  SERVICE wikibase:label { bd:serviceParam wikibase:language "en". }
}
GROUP BY ?languageCode ?languageLabel ?records ORDER BY DESC(?records)
    `,t=await gg(e);for(let e of(document.getElementById("domain-suggestions").innerHTML="",t))!function(e){let t=document.getElementById("domain-suggestions"),r=document.createElement("option");r.value=`${e}`,t.appendChild(r)}(`https://${e.languageCode.value}.wikipedia.org`)}function gy(e){var t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style={position:"absolute",left:"-9999px"},document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}function gx(e){for(var t="",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=r.length,i=0;i<e;i++)t+=r.charAt(Math.floor(Math.random()*n));return t}async function g_(e,t){let r=document.getElementById("name-list");for(let[n,i]of(r.innerHTML="",e))if(n!=t){let e=document.createElement("li");if(e.classList.add("collection-item"),e.innerHTML=i.name,e.style.backgroundColor=i.color,i.url){let t=document.createElement("a");t.classList.add("secondary-content"),t.href="#"+i.url;let r=await gc(i.url);t.innerHTML=r.topic,e.appendChild(t)}r.appendChild(e)}}!function({font:e,characters:t,sdfGlyphSize:r},n){fU({font:e,sdfGlyphSize:r,text:Array.isArray(t)?t.join("\n"):""+t},n)}({font:null},()=>{}),window.SETTINGS={},String.prototype.trunc=String.prototype.trunc||function(e){return this.length>e?this.substr(0,e-1)+"&hellip;":this},window.onload=async function(){await gv(),ga("^_^"),ga("OvO"),ga("'o'"),ga("-.-"),ga("UwU"),document.getElementById("domain").addEventListener("change",function(){F=this.value}),document.getElementById("topic").addEventListener("keyup",async e=>{"Enter"===e.key&&(B=[],await gl())}),document.getElementById("generate-button").addEventListener("click",async()=>{B=[],await gl()}),document.getElementById("random-button").addEventListener("click",async function(){B=[],await gh()}),document.getElementById("topic").addEventListener("input",async e=>{let t=e.target.value;""===t||await gs(t)}),document.getElementById("color").addEventListener("input",e=>{var t;t=e.target.value,k&&k.setLocalStateField("color",t),O&&O.setLocalStateField("color",t),localStorage.setItem("color",e.target.value)}),document.getElementById("name").addEventListener("input",e=>{var t;t=e.target.value,k&&k.setLocalStateField("name",t),O&&O.setLocalStateField("name",t),localStorage.setItem("name",e.target.value)}),document.getElementById("face").addEventListener("input",e=>{var t;t=e.target.value,k&&k.setLocalStateField("face",t),localStorage.setItem("face",e.target.value)});let e=document.querySelectorAll("select");M.FormSelect.init(e,{});var t=document.querySelectorAll(".modal");M.Modal.init(t,{onOpenStart:function(){console.log(window.location)}}),document.getElementById("help-button").addEventListener("click",e=>{M.Modal.getInstance(document.getElementById("help-modal")).open(),e.stopPropagation()}),localStorage.getItem("url")||M.Modal.getInstance(document.getElementById("help-modal")).open(),document.getElementById("domain").addEventListener("click",e=>{e.target.value=""}),B=JSON.parse(localStorage.getItem("topicStack")||"[]"),await m6();let r=localStorage.getItem("color")||"#"+Math.floor(16777215*Math.random()).toString(16).padStart(6,"0");if(document.getElementById("color").value=r,location.hash)var n=decodeURIComponent(location.hash.substr(1));else var n=localStorage.getItem("url");n?(await gu(n),gp(n)):(F="https://en.wikipedia.org",await gh());let i=new URLSearchParams(window.location.search).get("group")||localStorage.getItem("groupID")||gx(30);await gm(i),window.addEventListener("hashchange",async function(){if(location.hash){let e=decodeURIComponent(location.hash.substr(1));await gu(e),gp(e)}});let s=localStorage.getItem("name")||"anonymous";document.getElementById("name").value=s;let a=localStorage.getItem("face")||"^_^";document.getElementById("face").value=a,m5()};
//# sourceMappingURL=index.6bbdf69c.js.map
